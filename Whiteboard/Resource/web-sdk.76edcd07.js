(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+x/n":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)};var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);e.exports=t.default},"4TD3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);var a=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")};t.default=a,e.exports=t.default},GmzI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("aHma")),i=a(n("u4r5"));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v5",80,i.default);t.default=o,e.exports=t.default},RaMe:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i,a=s(n("+x/n")),o=s(n("4TD3"));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,u=0;var l=function(e,t,n){var s=t&&n||0,l=t||[],h=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==d){var p=e.random||(e.rng||a.default)();null==h&&(h=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=i=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,m=f-c+(v-u)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||f>c)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=f,u=v,i=d;var g=(1e4*(268435455&(f+=122192928e5))+v)%4294967296;l[s++]=g>>>24&255,l[s++]=g>>>16&255,l[s++]=g>>>8&255,l[s++]=255&g;var y=f/4294967296*1e4&268435455;l[s++]=y>>>8&255,l[s++]=255&y,l[s++]=y>>>24&15|16,l[s++]=y>>>16&255,l[s++]=d>>>8|128,l[s++]=255&d;for(var b=0;b<6;++b)l[s+b]=h[b];return t||(0,o.default)(l)};t.default=l,e.exports=t.default},aHma:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=function(e,r,a,o){var s=a&&o||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)),"string"==typeof r&&(r=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(r)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(r)||16!==r.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=n(r.concat(e));if(c[6]=15&c[6]|t,c[8]=63&c[8]|128,a)for(var u=0;u<16;++u)a[s+u]=c[u];return a||(0,i.default)(c)};try{r.name=e}catch(e){}return r.DNS=a,r.URL=o,r},t.URL=t.DNS=void 0;var r,i=(r=n("4TD3"))&&r.__esModule?r:{default:r};var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},cIdt:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("+x/n")),i=a(n("4TD3"));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||(0,i.default)(o)};t.default=o,e.exports=t.default},lOZ2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return o.default}});var r=s(n("RaMe")),i=s(n("zLF4")),a=s(n("cIdt")),o=s(n("GmzI"));function s(e){return e&&e.__esModule?e:{default:e}}},pMVe:function(e,t,n){"use strict";function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r((s=r(r(t,e),r(i,o)))<<(c=a)|s>>>32-c,n);var s,c}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var n=0;n<t.length;n++)e[n]=t.charCodeAt(n)}return function(e){var t,n,r,i=[],a=32*e.length;for(t=0;t<a;t+=8)n=e[t>>5]>>>t%32&255,r=parseInt("0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n),16),i.push(r);return i}(function(e,t){var n,i,u,l,h;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var d=1732584193,p=-271733879,f=-1732584194,v=271733878;for(n=0;n<e.length;n+=16)i=d,u=p,l=f,h=v,d=a(d,p,f,v,e[n],7,-680876936),v=a(v,d,p,f,e[n+1],12,-389564586),f=a(f,v,d,p,e[n+2],17,606105819),p=a(p,f,v,d,e[n+3],22,-1044525330),d=a(d,p,f,v,e[n+4],7,-176418897),v=a(v,d,p,f,e[n+5],12,1200080426),f=a(f,v,d,p,e[n+6],17,-1473231341),p=a(p,f,v,d,e[n+7],22,-45705983),d=a(d,p,f,v,e[n+8],7,1770035416),v=a(v,d,p,f,e[n+9],12,-1958414417),f=a(f,v,d,p,e[n+10],17,-42063),p=a(p,f,v,d,e[n+11],22,-1990404162),d=a(d,p,f,v,e[n+12],7,1804603682),v=a(v,d,p,f,e[n+13],12,-40341101),f=a(f,v,d,p,e[n+14],17,-1502002290),p=a(p,f,v,d,e[n+15],22,1236535329),d=o(d,p,f,v,e[n+1],5,-165796510),v=o(v,d,p,f,e[n+6],9,-1069501632),f=o(f,v,d,p,e[n+11],14,643717713),p=o(p,f,v,d,e[n],20,-373897302),d=o(d,p,f,v,e[n+5],5,-701558691),v=o(v,d,p,f,e[n+10],9,38016083),f=o(f,v,d,p,e[n+15],14,-660478335),p=o(p,f,v,d,e[n+4],20,-405537848),d=o(d,p,f,v,e[n+9],5,568446438),v=o(v,d,p,f,e[n+14],9,-1019803690),f=o(f,v,d,p,e[n+3],14,-187363961),p=o(p,f,v,d,e[n+8],20,1163531501),d=o(d,p,f,v,e[n+13],5,-1444681467),v=o(v,d,p,f,e[n+2],9,-51403784),f=o(f,v,d,p,e[n+7],14,1735328473),p=o(p,f,v,d,e[n+12],20,-1926607734),d=s(d,p,f,v,e[n+5],4,-378558),v=s(v,d,p,f,e[n+8],11,-2022574463),f=s(f,v,d,p,e[n+11],16,1839030562),p=s(p,f,v,d,e[n+14],23,-35309556),d=s(d,p,f,v,e[n+1],4,-1530992060),v=s(v,d,p,f,e[n+4],11,1272893353),f=s(f,v,d,p,e[n+7],16,-155497632),p=s(p,f,v,d,e[n+10],23,-1094730640),d=s(d,p,f,v,e[n+13],4,681279174),v=s(v,d,p,f,e[n],11,-358537222),f=s(f,v,d,p,e[n+3],16,-722521979),p=s(p,f,v,d,e[n+6],23,76029189),d=s(d,p,f,v,e[n+9],4,-640364487),v=s(v,d,p,f,e[n+12],11,-421815835),f=s(f,v,d,p,e[n+15],16,530742520),p=s(p,f,v,d,e[n+2],23,-995338651),d=c(d,p,f,v,e[n],6,-198630844),v=c(v,d,p,f,e[n+7],10,1126891415),f=c(f,v,d,p,e[n+14],15,-1416354905),p=c(p,f,v,d,e[n+5],21,-57434055),d=c(d,p,f,v,e[n+12],6,1700485571),v=c(v,d,p,f,e[n+3],10,-1894986606),f=c(f,v,d,p,e[n+10],15,-1051523),p=c(p,f,v,d,e[n+1],21,-2054922799),d=c(d,p,f,v,e[n+8],6,1873313359),v=c(v,d,p,f,e[n+15],10,-30611744),f=c(f,v,d,p,e[n+6],15,-1560198380),p=c(p,f,v,d,e[n+13],21,1309151649),d=c(d,p,f,v,e[n+4],6,-145523070),v=c(v,d,p,f,e[n+11],10,-1120210379),f=c(f,v,d,p,e[n+2],15,718787259),p=c(p,f,v,d,e[n+9],21,-343485551),d=r(d,i),p=r(p,u),f=r(f,l),v=r(v,h);return[d,p,f,v]}(function(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e[t/8])<<t%32;return n}(e),8*e.length))};t.default=u,e.exports=t.default},u4r5:function(e,t,n){"use strict";function r(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function i(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=new Array(a.length);for(var o=0;o<a.length;o++)e[o]=a.charCodeAt(o)}e.push(128);var s=e.length/4+2,c=Math.ceil(s/16),u=new Array(c);for(o=0;o<c;o++){u[o]=new Array(16);for(var l=0;l<16;l++)u[o][l]=e[64*o+4*l]<<24|e[64*o+4*l+1]<<16|e[64*o+4*l+2]<<8|e[64*o+4*l+3]}for(u[c-1][14]=8*(e.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(e.length-1)&4294967295,o=0;o<c;o++){for(var h=new Array(80),d=0;d<16;d++)h[d]=u[o][d];for(d=16;d<80;d++)h[d]=i(h[d-3]^h[d-8]^h[d-14]^h[d-16],1);var p=n[0],f=n[1],v=n[2],m=n[3],g=n[4];for(d=0;d<80;d++){var y=Math.floor(d/20),b=i(p,5)+r(y,f,v,m)+g+t[y]+h[d]>>>0;g=m,m=v,v=i(f,30)>>>0,f=p,p=b}n[0]=n[0]+p>>>0,n[1]=n[1]+f>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+g>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]};t.default=a,e.exports=t.default},w318:function(e,t,n){"use strict";(function(e,r,i){var a;function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return p(e)||P(e)||A(e)||d()}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function h(e,t){return p(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||A(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e){if(Array.isArray(e))return e}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return v(e,arguments,S(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),g(n,e)})(e)}function v(e,t,n){return(v=w()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&g(i,n.prototype),i}).apply(null,arguments)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=w();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}function b(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?k(e):t}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){x(a,r,i,o,s,"next",e)}function s(e){x(a,r,i,o,s,"throw",e)}o(void 0)}))}}function C(e){return function(e){if(Array.isArray(e))return N(e)}(e)||P(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),e}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=A(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function A(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n("pNMO"),n("4Brf"),n("0oug"),n("ma9I"),n("piMb"),n("yyme"),n("TeQF"),n("fbCW"),n("x0AG"),n("QWBl"),n("pjDv"),n("yq1k"),n("yXV3"),n("4mDm"),n("uqXc"),n("2B1R"),n("E9XD"),n("9N29"),n("Junv"),n("+2oP"),n("Rfxz"),n("ToJy"),n("pDQq"),n("wZ/5"),n("rOQg"),n("9LPj"),n("Tskq"),n("qePV"),n("i6QF"),n("WDsR"),n("r/Vq"),n("5uH8"),n("w1rZ"),n("JevA"),n("zKZe"),n("3KgV"),n("5DmW"),n("27RR"),n("cDke"),n("NBAS"),n("tkto"),n("r5Og"),n("ExoC"),n("07d7"),n("rNhl"),n("4l63"),n("5s+n"),n("SuFq"),n("XUE8"),n("TWNs"),n("rB9j"),n("JfAA"),n("YGK4"),n("9bJ7"),n("inlA"),n("9tb/"),n("JTJg"),n("PKPk"),n("Rm1S"),n("TZCg"),n("OM9Z"),n("UxlC"),n("hByQ"),n("EnZy"),n("LKBx"),n("SYor"),n("XMab"),n("moxL"),n("qXVe"),n("c162"),n("waxf"),n("0TkE"),n("Onu3"),n("1dYe"),n("gvgV"),n("6R/c"),n("YL0P"),n("X5Zq"),n("MoCz"),n("P8wP"),n("ypFw"),n("JaFt"),n("zSZm"),n("KVSy"),n("ZJ55"),n("IZzc"),n("s5qe"),n("cvf0"),n("ENF9"),n("H+LF"),n("FZtP"),n("3bBZ"),n("Kz25"),n("vxnP"),n("ls82");var L=Object.create,j=Object.defineProperty,D=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyNames,F=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty,U=function(e){return j(e,"__esModule",{value:!0})},V=function(e,t){for(var n in U(e),t)j(e,n,{get:t[n],enumerable:!0})},W=function(e){return function(e,t,n){if(t&&"object"==R(t)||"function"==typeof t){var r,i=E(z(t));try{var a=function(){var i=r.value;!B.call(e,i)&&"default"!==i&&j(e,i,{get:function(){return t[i]},enumerable:!(n=D(t,i))||n.enumerable})};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return e}(U(j(null!=e?L(F(e)):{},"default",e&&e.__esModule&&"default"in e?{get:function(){return e.default},enumerable:!0}:{value:e,enumerable:!0})),e)},H=function(e,t,n,r){for(var i,a=r>1?void 0:r?D(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&j(t,n,a),a};V(t,{AdminObserverId:function(){return nn},AkkoVersion:function(){return Ge},AnimationMode:function(){return Uh},ApplianceNames:function(){return iw},AsyncModuleLoadMode:function(){return $b},CNode:function(){return qu},CursorNames:function(){return Wx},DefaultHotKeys:function(){return Sk},DeviceType:function(){return Ah},DisplayerConsumer:function(){return vw},EventPhase:function(){return ar},EventScope:function(){return Mn},InvisiblePlugin:function(){return ww},KeyboardKind:function(){return sk},LoggerReportMode:function(){return Fx},ObserverMode:function(){return jS},PPTKind:function(){return Nk},PPTTaskStatus:function(){return Rk},PPTTaskStep:function(){return Lk},PlayerConsumer:function(){return gw},PlayerPhase:function(){return RS},RenderEngine:function(){return Aw},RoomConsumer:function(){return mw},RoomErrorLevel:function(){return Kw},RoomPhase:function(){return Qw},ScenePathType:function(){return ow},ScreenType:function(){return Xx},ShapeType:function(){return rw},ViewMode:function(){return Nw},ViewVisionMode:function(){return Vw},WhiteVersion:function(){return eI},WhiteWebSdk:function(){return qx},autorun:function(){return lk.autorun},contentModeAspectFill:function(){return qk},contentModeAspectFillScale:function(){return Jk},contentModeAspectFit:function(){return $k},contentModeAspectFitScale:function(){return tw},contentModeAspectFitSpace:function(){return ew},contentModeScale:function(){return Kk},createPPTTask:function(){return Hk},createPlugins:function(){return yw},injectCustomStyle:function(){return Kx},isPlayer:function(){return $x},isRoom:function(){return Jx},previewPPT:function(){return Db},reaction:function(){return lk.reaction},setAsyncModuleLoadMode:function(){return ak}});var _={sdkVersion:"2.13.16",defaultRegion:"cn-hz",modules:{identifier:"link.netless/white-model-render",origin:"https://sdk.netless.link"},shuntApiHosts:["api.netless.link"],hosts:{pptApi:"api.netless.link"},log:{argusOptions:{reportResourceURL:"https://rest-argus-ad.agoralab.co/v3/report",vid:3}}};(0,W(n("Pzfo")).configure)({isolateGlobalState:!0});W(n("HrR1"));var G={};V(G,{ActionFrameType:function(){return Pn},AdminObserverId:function(){return nn},AkkoApp:function(){return cc},AkkoFetcher:function(){return te},AkkoVersion:function(){return Ge},Environment:function(){return Sr},EventPhase:function(){return ar},EventScope:function(){return Mn},FramePicker:function(){return Gn},ImagePhase:function(){return Ei},KickReason:function(){return $r},Library:function(){return Gr},MagixPhase:function(){return Ys},ReconstructorFactory:function(){return sc},ReconstructorPhase:function(){return nc},RoomHelperFactory:function(){return lc},SocketErrorCode:function(){return wi},UpdateEventKind:function(){return ei},__context:function(){return ni},copy:function(){return zo},createBuffer:function(){return Ie},createElement:function(){return ha},event:function(){return pr},findClass:function(){return Do},findClassId:function(){return jo},findIdentifierWith:function(){return ro},getAuthorId:function(){return ci},getClassReflection:function(){return ai},getCurrentTimestamp:function(){return si},getEnvironment:function(){return oi},getLibrary:function(){return ri},getResource:function(){return Cr},getSnapshot:function(){return pi},getUser:function(){return hi},getUserIds:function(){return di},getUsersCount:function(){return li},hasUser:function(){return ui},isAkkoObject:function(){return ii},isAkkoWrappedObjectAccessible:function(){return Ro},isBuffer:function(){return Pe},isInstanceOf:function(){return Lo},noEffects:function(){return sr},resolve:function(){return Ee},socketFactory:function(){return Si},transient:function(){return or},translateToAckFrame:function(){return _n},wrapBuffer:function(){return Ce}});var Y=Object.defineProperty,X=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,K=function(e,t,n){return t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};function q(e,t){return void 0===e?t:e}var J=function(){function e(t){M(this,e);var n={},r=[];for(var i in t){var a=t[i],o=q(a.enablePing,!0),s=q(a.useSSL,!0),c=[],u={};for(var l in a.hosts)"*"===l?c.push.apply(c,C(this.readStringArray(a.hosts[l]))):u[l]=this.readStringArray(a.hosts[l]);r.push(i),n[i]=Object.freeze({enablePing:o,useSSL:s,hosts:Object.freeze({default:Object.freeze(c),regions:Object.freeze(u)})})}this.keys=Object.freeze(r.sort()),this.hosts=Object.freeze(function(e,t){for(var n in t||(t={}))Q.call(t,n)&&K(e,n,t[n]);if(X){var r,i=E(X(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Z.call(t,n)&&K(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e}({},n))}return O(e,[{key:"readStringArray",value:function(e){return"string"==typeof e?Object.freeze([e]):Object.freeze(C(e))}},{key:"host",value:function(e){var t=this.hosts[e];if(!t)throw new Error("cannot find host ".concat(JSON.stringify(e)));return t}}]),e}(),$=function(){function e(t,n){var r;if(M(this,e),this.nextIndex=0,this.enablePing=t.enablePing,this.useSSL=t.useSSL,0===(r=void 0===n?t.hosts.default:t.hosts.regions[n]||t.hosts.default).length)throw void 0===n?new Error("expect region: unexpect undefined"):new Error("invalid region ".concat(JSON.stringify(n),": cannot find any hosts of region"));this.hosts=r}return O(e,[{key:"hostsCount",get:function(){return this.hosts.length}},{key:"host",value:function(){return this.hosts[this.nextIndex]}},{key:"markSuccess",value:function(e){}},{key:"markFail",value:function(e){var t=this.nextIndex+1;t>=this.hosts.length&&(t=0),this.nextIndex=t}}]),e}(),ee=function(){function e(t){M(this,e),this.fetcher=t}return O(e,[{key:"fetch",value:function(e,t,n){var r=this;return new Promise((function(i,a){var o=setTimeout((function(){o=null,a(new Error("timeout"))}),n);r.fetcher(e,t).then((function(e){null!==o&&(clearTimeout(o),i(e))})).catch((function(e){null!==o&&(clearTimeout(o),a(e))}))}))}}]),e}(),te=function(){function e(t){M(this,e);var n=new J(t.configmap),r={};this.fetcher=new ee(t.fetcher),this.keys=n.keys,this.onIngoreFetchError=t.onIngoreFetchError,this.retryCount=t.retryCount,this.retryLoopsCount=t.retryLoopsCount,this.timeout=e.parseTimeoutFromParams(t.timeout),this.bussySleepDuration=q(t.bussySleepDuration,3e3);var i,a=E(this.keys);try{for(a.s();!(i=a.n()).done;){var o=i.value;r[o]=new $(n.host(o),t.region)}}catch(e){a.e(e)}finally{a.f()}this.loops=Object.freeze(r)}var t;return O(e,[{key:"fetch",value:function(e){var t=this,n=this.parseFetchingContext(e),r=n.key,i=this.loop(r);return function(e,r){return t.fetchWithKey(n,i,e,r)}}},{key:"origin",value:function(e,t){var n=this.loop(t),r=n.host(),i=e;return/:$/im.test(i)||(i+=":"),this.replaceProtocol(i,n.useSSL)+"//"+r}},{key:"reportSuccess",value:function(e,t){this.loop(e).markSuccess(t)}},{key:"reportFail",value:function(e,t){this.loop(e).markFail(t)}},{key:"fetchWithKey",value:(t=I(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c,u,l,h,d,p,f,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(i&&i.method||"get").toLowerCase(),void 0===(o=t.enableRetry)&&(o=this.checkIsIdempotent(a)),s=o?this.getFetchingCount(t,n):1,c=null,u=0;case 4:if(!(u<s)){e.next=28;break}return l=Date.now(),e.prev=6,h=n.host(),d=this.replaceURL(r,h,n.useSSL),p=t.timeout.length,f=u<p?t.timeout[u]:t.timeout[p-1],e.next=13,this.fetcher.fetch(d,i,f);case 13:if(v=e.sent,this.isServerBussyCode(v.status)){e.next=16;break}return e.abrupt("return",(n.markSuccess(Date.now()-l),v));case 16:if(e.t0=u<s-1,!e.t0){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,t.bussySleepDuration)}));case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(6),c=e.t1,n.markFail(Date.now()-l);case 25:++u,e.next=4;break;case 28:throw this.onIngoreFetchError&&c&&this.onIngoreFetchError(c),m="fail to ".concat(a," ").concat(r),s>1&&(m+=" after ".concat(s," times retries")),c=c?new Error("".concat(m," and the last Error is: ").concat(c.message)):new Error(m);case 31:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"getFetchingCount",value:function(e,t){var n,r;return"number"==typeof e.retryCount&&(n=e.retryCount+1),"number"==typeof e.retryLoopsCount&&(r=(e.retryLoopsCount+1)*t.hostsCount),void 0!==n&&void 0!==r?Math.max(n,r):void 0!==n?n:void 0!==r?r:t.hostsCount}},{key:"replaceURL",value:function(e,t,n){var r=new URL(e),i=r.protocol,a=r.port,o=r.pathname,s=r.search,c=this.replaceProtocol(i,n),u=t;return a&&(u+=":"+a),"".concat(c,"//").concat(u).concat(o).concat(s)}},{key:"parseFetchingContext",value:function(t){var n=t;return"string"==typeof n&&(n={key:n}),Object.freeze({key:n.key,enableRetry:n.enableRetry,timeout:e.parseTimeoutFromParams(n.timeout,this.timeout),retryCount:q(n.retryCount,this.retryCount),retryLoopsCount:q(n.retryLoopsCount,this.retryLoopsCount),bussySleepDuration:q(n.bussySleepDuration,this.bussySleepDuration)})}},{key:"checkIsIdempotent",value:function(e){switch(e){case"put":case"options":case"head":case"patch":case"delete":case"get":return!0;default:return!1}}},{key:"isServerBussyCode",value:function(e){switch(e){case 503:case 504:return!0;default:return!1}}},{key:"replaceProtocol",value:function(e,t){switch(e){case"http:":case"https:":return t?"https:":"http:";case"ws:":case"wss:":return t?"wss:":"ws:";default:return e}}},{key:"loop",value:function(e){var t=this.loops[e];if(!t)throw new Error("undefined key ".concat(JSON.stringify(e)));return t}}],[{key:"parseTimeoutFromParams",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultTimeout;if("number"==typeof t)return Object.freeze([t]);if(Array.isArray(t)){if(0===t.length)throw new Error("timeout cannot be []");return Object.freeze(C(t))}return n}}]),e}();te.defaultTimeout=Object.freeze([5e3,1e4,25e3]);var ne=W(n("aaBP")),re=Object.defineProperty,ie=Object.defineProperties,ae=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,ue=function(e,t,n){return t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},le=function(e,t){for(var n in t||(t={}))se.call(t,n)&&ue(e,n,t[n]);if(oe){var r,i=E(oe(t));try{for(i.s();!(r=i.n()).done;){n=r.value;ce.call(t,n)&&ue(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},he=function(e,t){return ie(e,ae(t))},de=function(){function e(){M(this,e)}return O(e,[{key:"id",get:function(){return void 0===this._id&&(this._id="".concat(e.nextBufferId),e.nextBufferId+=1),this._id}}]),e}();de.nextBufferId=0;var pe=function(){for(var e={},t=0;t<256;++t){var n=t.toString(16);1===n.length&&(e["0"+n]=t),e[n]=t}return Object.freeze(e)}(),fe=function(){for(var e=[],t=0;t<256;++t){var n=t.toString(16);1===n.length?e[t]="0"+n:e[t]=n}return Object.freeze(e)}();function ve(e,t,n){for(var r=new String(new Number(n).toString(16)),i=16-r.length,a=0;a<8;++a){var o=2*a-i;if(o<-1)e.setUint8(t+a,0);else if(-1===o){var s=r.substr(0,1),c=pe[s];e.setUint8(t+a,c)}else{var u=r.substr(o,2),l=pe[u];e.setUint8(t+a,l)}}}function me(e,t){for(var n="",r=0;r<8;++r){var i=e.getUint8(t+r);n+=fe[i]}return parseInt(n,16)}var ge,ye,be=function(e){m(n,e);var t=y(n);function n(e,r){var i;return M(this,n),(i=t.call(this)).buffer=e,i.create=r,i}return O(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.buffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.buffer.length-e,n=this.create(t),r=n.buffer,i=0;i<t;++i)r.writeUInt8(this.buffer.readUInt8(e+i),i);return n}},{key:"getFloat64",value:function(e){return this.buffer.readDoubleLE(e)}},{key:"getUint16",value:function(e){return this.buffer.readUInt16LE(e)}},{key:"getInt32",value:function(e){return this.buffer.readInt32LE(e)}},{key:"getUint32",value:function(e){return this.buffer.readUInt32LE(e)}},{key:"getUint8",value:function(e){return this.buffer.readUInt8(e)}},{key:"getUint64",value:function(e){return me(this,e)}}]),n}(de),ke=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,be.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.byteLength-n,i=e.primitiveBuffer;if(i instanceof ArrayBuffer){for(var a=new DataView(i),o=this.buffer.byteLength-t,s=Math.min(r,o),c=0;c<s;++c)this.buffer.writeUInt8(a.getUint8(c+n),c+t);return s}return i.copy(this.buffer,t,n,n+r)}},{key:"setFloat64",value:function(e,t){this.buffer.writeDoubleLE(t,e)}},{key:"setUint16",value:function(e,t){this.buffer.writeUInt16LE(t,e)}},{key:"setInt32",value:function(e,t){this.buffer.writeInt32LE(t,e)}},{key:"setUint32",value:function(e,t){this.buffer.writeUInt32LE(t,e)}},{key:"setUint8",value:function(e,t){this.buffer.writeUInt8(t,e)}},{key:"setUint64",value:function(e,t){ve(this,e,t)}}]),n}(be),we=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this)).arrayBuffer=e,r.dataView=new DataView(e),r}return O(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.arrayBuffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.arrayBuffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dataView.byteLength-e,n=new ArrayBuffer(t),r=new DataView(n),i=0;i<t;++i)r.setUint8(i,this.dataView.getUint8(e+i));return new Se(n)}},{key:"getFloat64",value:function(e){return this.dataView.getFloat64(e,!0)}},{key:"getUint16",value:function(e){return this.dataView.getUint16(e,!0)}},{key:"getInt32",value:function(e){return this.dataView.getInt32(e,!0)}},{key:"getUint32",value:function(e){return this.dataView.getUint32(e,!0)}},{key:"getUint8",value:function(e){return this.dataView.getUint8(e)}},{key:"getUint64",value:function(e){return me(this,e)}}]),n}(de),Se=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,we.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,i=e.primitiveBuffer,a=this.dataView.byteLength-t,o=Math.min(r,a);if(i instanceof ArrayBuffer)for(var s=new DataView(i),c=0;c<o;++c)this.dataView.setUint8(c+t,s.getUint8(c+n));else for(var u=0;u<o;++u)this.dataView.setUint8(u+t,i.readUInt8(u+n));return o}},{key:"setFloat64",value:function(e,t){this.dataView.setFloat64(e,t,!0)}},{key:"setUint16",value:function(e,t){this.dataView.setUint16(e,t,!0)}},{key:"setInt32",value:function(e,t){this.dataView.setInt32(e,t,!0)}},{key:"setUint32",value:function(e,t){this.dataView.setUint32(e,t,!0)}},{key:"setUint8",value:function(e,t){this.dataView.setUint8(e,t)}},{key:"setUint64",value:function(e,t){ve(this,e,t)}}]),n}(we),xe=new function t(){var n=this;M(this,t),this.create=function(e){return n.nodeBuffer?new ke(n.nodeBuffer.alloc(e),n.create):new Se(new ArrayBuffer(e))},this.wrap=function(e){return n.nodeBuffer&&e instanceof n.nodeBuffer?new ke(e,n.create):new Se(e)},this.nodeBuffer="function"==typeof e?r.Buffer:null},Ie=xe.create,Ce=xe.wrap;function Pe(e){return e instanceof be||e instanceof we}(ye=ge||(ge={})).Any="any",ye.Never="never",ye.Undefined="undefined",ye.Null="null",ye.String="string",ye.Number="number",ye.Boolean="boolean",ye.Function="function",ye.Object="object",ye.And="and",ye.Or="or",ye.Generic="generic",ye.Generator="generator",ye.Reference="reference",ye.GlobalReference="globalReference";var Me=new(function(){function e(){M(this,e),this.singletonMap=e.createSingletonMap()}return O(e,[{key:"getSingletonType",value:function(e){return this.singletonMap[e]}},{key:"getFunctionType",value:function(){return{typeEnum:ge.Function}}},{key:"getObjectType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.index,r=e.properties;return{typeEnum:ge.Object,key:t||this.getSingletonType(ge.Undefined),index:n||this.getSingletonType(ge.Undefined),properties:r||{}}}},{key:"getCompoundType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{typeEnum:e,children:t}}},{key:"getGenericType",value:function(e){return{index:e,typeEnum:ge.Generic}}},{key:"getGeneratorType",value:function(e){var t=e.template,n=e.params;return{typeEnum:ge.Generator,template:t,params:n||[]}}},{key:"getReferenceType",value:function(e){return{typeEnum:ge.Reference,name:e}}},{key:"getGlobalReferenceType",value:function(e,t){return{typeEnum:ge.GlobalReference,path:e,name:t}}}],[{key:"createSingletonMap",value:function(){for(var e={},t=0,n=[ge.Any,ge.Never,ge.Undefined,ge.Null,ge.String,ge.Number,ge.Boolean];t<n.length;t++){var r=n[t];e[r]={typeEnum:r}}return Object.freeze(e)}}]),e}()),Te=(Me.getSingletonType.bind(Me),Me.getFunctionType.bind(Me),Me.getObjectType.bind(Me),Me.getCompoundType.bind(Me),Me.getGenericType.bind(Me),Me.getGeneratorType.bind(Me),Me.getReferenceType.bind(Me),Me.getGlobalReferenceType.bind(Me),function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).name="RuntimeError",r}return n}(f(Error))),Oe=function(){function e(t,n,r,i){M(this,e),this.akkoVersion=t,this.akkoObjectBaseClass=n,this.libraryFactory=r,this.onCreatedLibrary=i,this.classHandlers={}}return O(e,[{key:"baseClass",value:function(){return this.akkoObjectBaseClass}},{key:"wrapSuperClass",value:function(e){if(e===Object)return this.akkoObjectBaseClass;if("function"!=typeof e)return e;for(var t=e;t!==this.akkoObjectBaseClass;){var n=Object.getPrototypeOf(t.prototype);if(!n)throw new Te("class ".concat(e.name," can't be extended, it's out of library"));t=n.constructor}return e}},{key:"declareClass",value:function(e){var t=e.classId,n=e.clazz,r=e.superClass,i=e.memberDecorators;if(this.classHandlers[t])throw new Te("class id ".concat(t," was declared"));this.classHandlers[t]={classId:t,clazz:n,superClass:r,memberDecorators:i||{}}}},{key:"createLibrary",value:function(e,t){var n={};for(var r in t.classes){var i,a=t.classes[r],o=this.classHandlers[r],s=[],c=E(a.members);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=o.memberDecorators[u.name];s.push(he(le({},u),{decorators:l||Object.freeze([])}))}}catch(e){c.e(e)}finally{c.f()}n[r]={classId:o.classId,clazz:o.clazz,superClass:o.superClass,objectFormatId:a.objectFormatId,members:s}}var h=this.libraryFactory({appIdentifier:t.identifier,appVersion:t.version,akkoVersion:t.akko,formatBase64:t.formatBase64,formatHash:t.formatHash,rootConstructor:e,classDeclarations:n});return Object.defineProperty(e,"__library",{enumerable:!1,configurable:!1,writable:!1,value:h}),this.onCreatedLibrary(h),e}}]),e}();function Ee(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(e){return Ae(e)})).forEach((function(t){e=0!==e.length&&Ne(t)?Re(e,t):t})),e.join("/")}function Ae(e){var t=e.split("/");return t.length>0&&("."===t[0]&&t.shift(),""===t[t.length-1]&&t.pop()),t}function Ne(e){return e.length>0&&""!==e[0]}function Re(e,t){var n=Le(e),r=Le(t);if(n.pureCells.length>r.doubleDotsCount){for(var i=0;i<r.doubleDotsCount;++i)n.pureCells.pop();return[].concat(C(je(n.doubleDotsCount)),C(n.pureCells),C(r.pureCells))}var a=r.doubleDotsCount-n.pureCells.length;return[].concat(C(je(n.doubleDotsCount+a)),C(r.pureCells))}function Le(e){var t,n=[],r=0,i=E(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;".."===a?r+=1:n.push(a)}}catch(e){i.e(e)}finally{i.f()}return{doubleDotsCount:r,pureCells:n}}function je(e){for(var t=[],n=0;n<e;++n)t.push("..");return t}var De,ze,Fe=function e(t){var n=this;M(this,e),this.contextsStack=[],this.context=function(e){switch(e){case"index":var t=function(e){var t=new Oe(e.akkoVersion,e.akkoObjectBaseClass,e.libraryFactory,e.onCreatedLibrary);return Object.freeze({baseClass:t.baseClass.bind(t),wrapSuperClass:t.wrapSuperClass.bind(t),declareClass:t.declareClass.bind(t),createLibrary:t.createLibrary.bind(t),creator:e.coreFunctions.creator,updater:e.coreFunctions.updater,wrapper:e.coreFunctions.wrapper,unwrapper:e.coreFunctions.unwrapper,jsxUnwrapper:e.coreFunctions.jsxUnwrapper,getter:e.coreFunctions.getter,setter:e.coreFunctions.setter,caller:e.coreFunctions.caller,remover:e.coreFunctions.remover,prefix:e.coreFunctions.prefix,postfix:e.coreFunctions.postfix})}({akkoVersion:n.akkoVersion,akkoObjectBaseClass:n.akkoObjectBaseClass,libraryFactory:n.libraryFactory,coreFunctions:n.coreFunctions,onCreatedLibrary:function(){return n.contextsStack.pop()}});return n.contextsStack.push(t),t;case"module":var r=n.contextsStack[n.contextsStack.length-1];if(!r)throw new Te("can't import index out of library");return r;default:throw new Te("unexpect mode ".concat(JSON.stringify(e)))}},this.isAkkoObject=function(e){return e instanceof n.akkoObjectBaseClass},this.getLibrary=function(e){if("function"==typeof e){var t=e.__library;if("object"==R(t))return t}else if(n.isAkkoObject(e))return n.getLibrary(e.constructor)},this.akkoVersion=t.akkoVersion,this.akkoObjectBaseClass=t.akkoObjectBaseClass,this.libraryFactory=t.libraryFactory,this.coreFunctions=Object.freeze(le({},t.coreFunctions))};function Be(e){return e.type===De.Property}function Ue(e){return e.type===De.Method}!function(e){e.Method="method",e.Property="property"}(De||(De={})),function(e){e.Value="value",e.Readonly="readonly",e.Writeonly="writeonly",e.Accessible="accessible"}(ze||(ze={}));var Ve=function(){function e(t){var n=this;M(this,e),this.invoker=t,this.timer=null,this.invokeWhenTimeout=function(){n.timer=null,n.invoker()}}return O(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}(),We=function(){function e(t,n){M(this,e),this.isFreezed=!1,this.shouldInvokeAfterFreeze=!1,this.latestInvokeTimestamp=0,this.timer=-1,this._limitDuration=t,this.invoker=n,this.invokeWhenTimeout=this.invokeWhenTimeout.bind(this)}return O(e,[{key:"limitDuration",get:function(){return this._limitDuration},set:function(e){if(this._limitDuration!==e){if(this._limitDuration=e,-1!==this.timer){clearTimeout(this.timer);var t=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,t)}this.invoke()}}},{key:"invoke",value:function(){if(this.isFreezed)this.shouldInvokeAfterFreeze=!0;else if(-1===this.timer){var e=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,e)}}},{key:"nextInvokeTimeDuration",value:function(){var e=Date.now(),t=this.latestInvokeTimestamp+this.limitDuration-e;return Math.max(0,t)}},{key:"invokeWhenTimeout",value:function(){this.timer=-1,this.latestInvokeTimestamp=Date.now(),this.invoker()}},{key:"cancel",value:function(){this.isFreezed?this.shouldInvokeAfterFreeze=!1:-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1)}},{key:"freeze",value:function(){this.isFreezed||(-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1,this.shouldInvokeAfterFreeze=!0),this.isFreezed=!0)}},{key:"unfreeze",value:function(){!this.isFreezed||(this.isFreezed=!1,this.shouldInvokeAfterFreeze&&(this.shouldInvokeAfterFreeze=!1,this.invoke()))}}]),e}(),He=Object.freeze(["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]),_e=function(){function e(t,n,r,i){M(this,e),this.x=t,this.y=n,this.z=r,this.suffix=i,Object.freeze(this)}return O(e,[{key:"withoutSuffix",value:function(){return new e(this.x,this.y,this.z)}},{key:"toString",value:function(){var e="".concat(this.x,".").concat(this.y,".").concat(this.z);return this.suffix&&(e+="-".concat(this.suffix.greekLetter,".").concat(this.suffix.number)),e}}],[{key:"parse",value:function(t){if(!/^\d+\.\d+\.\d+(-\w+\.\d+)?$/i.test(t))throw new Error("invalid version format ".concat(JSON.stringify(t)));var n,r=t.match(/-\w+\.\d+$/),i=t;r&&(n=e.parseSuffix(t,r[0].replace(/^-/i,"")),i=t.substring(0,t.length-r[0].length));var a=h(e.parseVersionArray(t,i),3);return new e(a[0],a[1],a[2],n)}},{key:"parseSuffix",value:function(e,t){var n=t.split("."),r=n[0];if(-1===He.indexOf(r))throw new Error("invalid Greek letter ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));var i=parseInt(n[1],10);if(!Number.isSafeInteger(i))throw new Error("invalid version number ".concat(JSON.stringify(i)," of ").concat(JSON.stringify(e)));return Object.freeze({greekLetter:r,number:i})}},{key:"parseVersionArray",value:function(e,t){var n,r=[],i=E(t.split("."));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=parseInt(a,10);if(!Number.isSafeInteger(o))throw new Error("invalid version number ".concat(JSON.stringify(a)," of ").concat(JSON.stringify(e)));r.push(o)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"compare",value:function(e,t){var n=e.x-t.x;if(0!==n||0!==(n=e.y-t.y)||0!==(n=e.z-t.z))return n;if(!e.suffix&&t.suffix)return 1;if(e.suffix&&!t.suffix)return-1;if(!e.suffix&&!t.suffix)return 0;var r=e.suffix.greekLetter,i=t.suffix.greekLetter;return 0!==(n=He.indexOf(r)-He.indexOf(i))?n:e.suffix.number-t.suffix.number}}]),e}(),Ge="1.4.4",Ye=W(n("aaBP")),Xe=Object.defineProperty,Qe=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,$e=function(e,t,n){return t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},et=function(e,t){for(var n in t||(t={}))qe.call(t,n)&&$e(e,n,t[n]);if(Ke){var r,i=E(Ke(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Je.call(t,n)&&$e(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e};var tt,nt,rt,it=Math.pow(2,32),at=(Math.pow(2,16),it-1),ot=function(){function e(){M(this,e),this._length=0,this.bufferChunks=[],this.appendNewChunk()}return O(e,[{key:"length",get:function(){return this._length}},{key:"toBuffer",value:function(){var e,t=Ie(this.length),n=0,r=E(this.bufferChunks);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.fill(i.buffer,n,0,i.length),n+=i.length}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"generateHash",value:function(e,t){for(var n=0,r=e;;){if(n>=this.bufferChunks.length)return"";var i=this.bufferChunks[n].length;if(r<i)break;r-=i,n+=1}for(var a=t,o=new ne.default,s=[0];n<this.bufferChunks.length;++n){for(var c=this.bufferChunks[n],u=c.buffer,l=c.length,h=r;h<l;++h)if(s[0]=u.getUint8(h),o.appendBinary(String.fromCharCode.apply(String,s)),(a-=1)<=0)return o.end(!0);r=0}return o.end(!0)}},{key:"pushBuffer",value:function(e,t,n){var r=Math.min(n,this.currentChunk.buffer.byteLength-this.currentChunk.length);r>0&&(this.currentChunk.buffer.fill(e,this.currentChunk.length,t,r),this.currentChunk.length+=r,this._length+=r);var i=n-r;i>0&&(this.currentChunk={buffer:e.slice(t+r,i),length:i},this.bufferChunks.push(this.currentChunk),this._length+=i)}},{key:"pushUint8",value:function(e){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint8(this.currentChunk.length,e),this.currentChunk.length+=1,this._length+=1}},{key:"pushUint8Holder",value:function(){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=1,this._length+=1,function(n){return t.setUint8(e,n)}}},{key:"pushUint16",value:function(e){this.currentChunk.length+2>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint16(this.currentChunk.length,e),this.currentChunk.length+=2,this._length+=2}},{key:"pushInt32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setInt32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32Holder",value:function(){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=4,this._length+=4,function(n){return t.setUint32(e,n)}}},{key:"pushFloat64",value:function(e){this.currentChunk.length+8>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setFloat64(this.currentChunk.length,e),this.currentChunk.length+=8,this._length+=8}},{key:"appendNewChunk",value:function(){var e=Ie(256);this.currentChunk={buffer:e,length:0},this.bufferChunks.push(this.currentChunk)}}]),e}();!function(e){e[e.Never=0]="Never",e[e.Undefined=1]="Undefined",e[e.Null=2]="Null",e[e.String=3]="String",e[e.Integer32=4]="Integer32",e[e.Integer53=5]="Integer53",e[e.Float=6]="Float",e[e.Function=7]="Function",e[e.Object=8]="Object",e[e.Array=9]="Array",e[e.True=10]="True",e[e.False=11]="False",e[e.Buffer=12]="Buffer",e[e.HangUpObject=13]="HangUpObject"}(tt||(tt={})),function(e){e[e.Array=0]="Array",e[e.DeducedObject=1]="DeducedObject",e[e.AssertedObject=2]="AssertedObject",e[e.HangUpObject=3]="HangUpObject"}(nt||(nt={})),function(e){e[e.Array=0]="Array",e[e.Object=1]="Object",e[e.HangUpObject=2]="HangUpObject"}(rt||(rt={}));var st="__identifier",ct="__hangUpMetadata",ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};M(this,e),this.decorateObjectEnums=Object.freeze([1]),this.decorateObject=t}return O(e,[{key:"createObject",value:function(e,t){var n=0===t?[]:{};return Object.defineProperty(n,st,{enumerable:!1,configurable:!0,value:e}),n}},{key:"findIdentifier",value:function(e){return e[st]}},{key:"findHangUpMetadata",value:function(e){return e[ct]}},{key:"checkObjectEnum",value:function(e){return e.constructor===Array?0:ct in e?2:1}},{key:"length",value:function(e){return e.length}},{key:"keys",value:function(e){return Object.keys(e)}},{key:"hasKey",value:function(e,t){return t in e}},{key:"getValue",value:function(e,t){return e[t]}},{key:"setValue",value:function(e,t,n){e[t]=n}},{key:"completeHangUpObject",value:function(e,t){Object.defineProperty(e,ct,{enumerable:!1,configurable:!0,value:Object.freeze(et({},t))})}}]),e}();function lt(){var e={id:-1};return e.key=e,e.index=e,e.properties=Object.freeze({}),Object.freeze(e)}var ht="0".charCodeAt(0),dt="9".charCodeAt(0)+1,pt="a".charCodeAt(0),ft="f".charCodeAt(0)+1,vt=new(function(){function e(){M(this,e);for(var t=[],n=[],r=0;r<16;++r){var i=r.toString(16).charCodeAt(0);t[r]=i,n[i]=r}this.integerToCode=Object.freeze(t),this.codeToInteger=Object.freeze(n)}return O(e,[{key:"cleanUnmeaningZero",value:function(e,t){for(;e.length>t&&0===this.codeToInteger[e[e.length-1]];)e.pop()}},{key:"pushInt53",value:function(e,t){var n=0|t,r=(t-n)/it;this.pushUint32(e,n),this.pushUint32(e,r)}},{key:"readInt53",value:function(e,t){var n=this.readInt32(e,t);return this.readInt32(e,t+8)*it+n}},{key:"pushUint32",value:function(e,t){var n=e.length;e[n]=this.integerToCode[15&t],e[n+1]=this.integerToCode[t>>4&15],e[n+2]=this.integerToCode[t>>8&15],e[n+3]=this.integerToCode[t>>12&15],e[n+4]=this.integerToCode[t>>16&15],e[n+5]=this.integerToCode[t>>20&15],e[n+6]=this.integerToCode[t>>24&15],e[n+7]=this.integerToCode[t>>28&15]}},{key:"readUint32",value:function(e,t){var n=this.readInt32(e,t);return n<0&&(n+=it),n}},{key:"readInt32",value:function(e,t){for(var n=0,r=0;r<8;++r){var i=this.codeToInteger[e.charCodeAt(t+r)];if(void 0===i)return NaN;n|=i<<4*r}return n}},{key:"parseCode",value:function(e){return this.codeToInteger[e]}},{key:"toCode",value:function(e){return this.integerToCode[e]}},{key:"increment",value:function(e,t){for(var n=t;;){if(e.length<=n){e[n]=ht+1;break}var r=!0;switch(e[n]+=1,e[n]){case dt:e[n]=pt;break;case ft:e[n]=ht,n+=1,r=!1}if(r)break}}},{key:"parseString",value:function(e){for(var t=new String(e),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n}},{key:"stringify",value:function(e){return String.fromCharCode.apply(String,e)}}]),e}());function mt(e,t){var n=[];return vt.pushInt53(n,e),"number"==typeof t&&(vt.pushInt53(n,t),vt.cleanUnmeaningZero(n,16)),new gt(e,n)}var gt=function(){function e(t,n){M(this,e),this.scopeId=t,this.codes=n}return O(e,[{key:"generate",value:function(){var e=vt.stringify(this.codes);return vt.increment(this.codes,16),e}},{key:"createdCount",get:function(){for(var e=16,t=0,n=0,r=0;r<8;++r){var i=this.codes[e+r];t|=(i=void 0===i?0:vt.parseCode(i))<<4*r}e+=8;for(var a=0;a<8;++a){var o=this.codes[e+a];n|=(o=void 0===o?0:vt.parseCode(o))<<4*a}return n*it+t}},{key:"clone",value:function(){return new e(this.scopeId,C(this.codes))}}]),e}(),yt=function(){function e(t,n){M(this,e),this.observerId=t,this.codes=n,this._createdCount=0}return O(e,[{key:"scopeId",get:function(){return 0}},{key:"createdCount",get:function(){return this._createdCount}},{key:"generate",value:function(){return this._createdCount+=1,vt.increment(this.codes,8),vt.stringify(this.codes)}},{key:"clone",value:function(){return new e(this.observerId,C(this.codes))}},{key:"makeSureNextGenerationIdAfter",value:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);if(void 0===vt.parseCode(r))throw new Error("invalid generationId");t[n]=r}for(var i=0;i<t.length;++i)this.codes[i+8]=t[i]}}]),e}(),bt=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).name="SerializerError",r}return n}(f(Error)),kt=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).name="DeserializerError",r}return n}(f(Error)),wt=Math.pow(2,31)-1,St=-Math.pow(2,31),xt=function(){function e(t,n,r,i){M(this,e),this.writer=t,this.objectFormats=n,this.objectAdapter=r,this.assertObjectFormat=i,this.anyObjectFormat=lt(),this.serializeTasksQueue=[],this.serializeBufferQueue=[],this.didObjectInQueueSet={},this.bufferIndexMap={}}return O(e,[{key:"serialize",value:function(e,t){var n=this.writer.putUint32Holder(),r=this.writer.didWriteBytes;1!==this.objectFormats.length&&this.writer.writeUint32(e.length);for(var i=0;i<e.length;++i){var a=this.objectFormats[i]||this.anyObjectFormat,o=e[i];this.serializeValue(a,o)}for(;this.serializeTasksQueue.length>0;)this.handleSerializeTask(this.serializeTasksQueue.shift());this.writer.writeBigInt(""),this.writer.writeUint32(this.serializeBufferQueue.length);var s,c=E(this.serializeBufferQueue);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.writer.writeUint8(u.readonly?255:0),this.writer.writeBuffer(u)}}catch(e){c.e(e)}finally{c.f()}var l=this.writer.didWriteBytes-r,h=t?this.writer.generateHash(r,l):Gt;this.serializeHash(h),n(l+_t)}},{key:"serializeValue",value:function(e,t){"object"!=R(t)?this.serializeNotObjectValue(t):null===t?this.writer.writeUint8(tt.Null):Pe(t)?this.serializeBufferValue(t):this.serializeObjectValue(e,t)}},{key:"handleSerializeTask",value:function(e){var t=e.identifier,n=e.object,r=e.objectEnum,i=e.deducedFormat;switch(this.writer.writeBigInt(t),r){case rt.Array:this.writer.writeUint8(nt.Array),this.handleArraySerializeTask(n,i);break;case rt.Object:var a=this.assertObjectFormat(n),o=a?nt.AssertedObject:nt.DeducedObject,s=a||i,c=!a;this.writer.writeUint8(o),this.handleObjectSerializeTask(n,s,c);break;case rt.HangUpObject:var u=this.objectAdapter.findHangUpMetadata(n),l=_e.parse(u.version),h=l.x,d=l.y,p=l.z;this.writer.writeUint8(nt.HangUpObject),this.writer.writeUint32(u.objectFormatId),this.writer.writeUint16(h),this.writer.writeUint16(d),this.writer.writeUint16(p),this.writer.writeUint8(tt.Never),this.handleHangUpObjectSerializeTask(n)}}},{key:"serializeNotObjectValue",value:function(e){switch(R(e)){case"undefined":this.writer.writeUint8(tt.Undefined);break;case"string":this.writer.writeUint8(tt.String),this.writer.writeString(e);break;case"number":Number.isSafeInteger(e)?St<=e&&e<=wt?(this.writer.writeUint8(tt.Integer32),this.writer.writeInt32(e)):(this.writer.writeUint8(tt.Integer53),this.writer.writeInt53(e)):(this.writer.writeUint8(tt.Float),this.writer.writeFloat64(e));break;case"boolean":e?this.writer.writeUint8(tt.True):this.writer.writeUint8(tt.False);break;default:throw new bt("not support ".concat(R(e)," now"))}}},{key:"serializeBufferValue",value:function(e){var t=this.bufferIndexMap[e.id];void 0===t&&(t=this.serializeBufferQueue.length,this.bufferIndexMap[e.id]=t,this.serializeBufferQueue[t]=e),this.writer.writeUint8(tt.Buffer),this.writer.writeUint32(t)}},{key:"serializeObjectValue",value:function(e,t){var n,r=this.objectAdapter.findIdentifier(t),i=this.objectAdapter.checkObjectEnum(t);switch(i){case rt.Array:n=tt.Array;break;case rt.Object:n=tt.Object;break;case rt.HangUpObject:n=tt.HangUpObject;break;default:throw new Error("unrecognized object enum ".concat(i))}this.writer.writeUint8(n),this.writer.writeUint8(0),this.writer.writeBigInt(r),this.pushToSerializeTaskQueueIfFirstCall({identifier:r,object:t,deducedFormat:e,objectEnum:i})}},{key:"pushToSerializeTaskQueueIfFirstCall",value:function(e){this.didObjectInQueueSet[e.identifier]||(this.didObjectInQueueSet[e.identifier]=!0,this.serializeTasksQueue.push(e))}},{key:"handleArraySerializeTask",value:function(e,t){var n=this.objectAdapter.length(e),r=t.index;this.writer.writeUint32(n);for(var i=0;i<n;++i)this.serializeValue(r,this.objectAdapter.getValue(e,i))}},{key:"handleObjectSerializeTask",value:function(e,t,n){for(var r in this.writer.writeUint32(t.id),t.properties){var i=t.properties[r];this.objectAdapter.hasKey(e,r)?this.serializeValue(i,this.objectAdapter.getValue(e,r)):this.writer.writeUint8(tt.Never)}if(n){var a,o=this.writer.putUint32Holder(),s=0,c=E(this.objectAdapter.keys(e));try{for(c.s();!(a=c.n()).done;){var u=a.value;u in t.properties||(this.writer.writeString(u),this.serializeValue(t.key,this.objectAdapter.getValue(e,u)),s+=1)}}catch(e){c.e(e)}finally{c.f()}o(s)}else this.writer.writeUint32(0)}},{key:"handleHangUpObjectSerializeTask",value:function(e){var t,n=this.writer.putUint32Holder(),r=0,i=E(this.objectAdapter.keys(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;this.writer.writeString(a),this.serializeValue(this.anyObjectFormat,this.objectAdapter.getValue(e,a)),r+=1}}catch(e){i.e(e)}finally{i.f()}n(r)}},{key:"serializeHash",value:function(e){for(var t=0;t<_t;++t)t<e.length?this.writer.writeUint8(e.charCodeAt(t)):this.writer.writeUint8(0)}}]),e}(),It=function(){function e(t,n,r,i){M(this,e),this.reader=t,this.format=n,this.objectAdapter=r,this.valuesLength=i,this.objectStateMap={},this.holdersMap={},this.deserializeBufferSetterQueue=[],this.cacheMap=Object.freeze([{},{},{}])}return O(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s)this.deserializeValue(n,o,s);for(;;){var c=this.reader.readBigInt();if(""===c)break;this.deserializeArrayOrObjectBody(c)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var u=this.reader.didReadBytes-i;if(r!==u+_t)throw new kt("expect bytes ".concat(r,", instead of ").concat(u));var l=this.deserializeHash();if(!t&&l!==Gt&&l!==this.reader.generateHash(i,u))throw new kt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.valuesLength?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e,t=Object.freeze([]),n=E(this.objectAdapter.decorateObjectEnums);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.cacheMap[r];for(var a in i){var o=i[a],s=this.objectStateMap[a];if(s){var c=this.holdersMap[a]||t,u=s.type,l=s.objectFormat;this.objectAdapter.decorateObject(o,u,c,l)}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"deserializeValue",value:function(e,t,n){var r,i=this.reader.readUint8();switch(i){case tt.Undefined:e.setValue(t,n,void 0);break;case tt.Null:e.setValue(t,n,null);break;case tt.String:e.setValue(t,n,this.reader.readString());break;case tt.Integer32:e.setValue(t,n,this.reader.readInt32());break;case tt.Integer53:e.setValue(t,n,this.reader.readInt53());break;case tt.Float:e.setValue(t,n,this.reader.readFloat64());break;case tt.True:e.setValue(t,n,!0);break;case tt.False:e.setValue(t,n,!1);break;case tt.Array:this.reader.readUint8(),r=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(r,rt.Array);e.setValue(t,n,a);break;case tt.Object:this.reader.readUint8(),r=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(r,rt.Object);e.setValue(t,n,o);break;case tt.HangUpObject:this.reader.readUint8(),r=this.reader.readBigInt();var s=this.readAndPushToDeserializeTaskQueueIfNeed(r,rt.HangUpObject);e.setValue(t,n,s);break;case tt.Buffer:var c=this.reader.readUint32(),u=this.deserializeBufferSetterQueue[c];u||(u=this.deserializeBufferSetterQueue[c]=[]),u.push((function(r){return e.setValue(t,n,r)}));break;case tt.Never:break;default:throw new bt("unrecognized primitiveType ".concat(JSON.stringify(i)))}return r}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t){var n=this.cacheMap[t],r=n[e];return r||(n[e]=r=this.objectAdapter.createObject(e,t)),r}},{key:"deserializeArrayOrObjectBody",value:function(e){var t=this.reader.readUint8();switch(t){case nt.Array:this.objectStateMap[e]={type:t},this.handleArrayDeserializerTask(this.cacheMap[rt.Array][e]);break;case nt.DeducedObject:case nt.AssertedObject:var n=this.cacheMap[rt.Object][e],r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[e]={type:t,objectFormat:i},this.handleObjectDeserializerTask(n,i);break;case nt.HangUpObject:var a=this.cacheMap[rt.HangUpObject][e],o=this.reader.readUint32(),s=this.reader.readUint16(),c=this.reader.readUint16(),u=this.reader.readUint16();this.objectStateMap[e]={type:t},this.reader.readUint8(),this.handleHangUpObjectDeserializerTask(a,{objectFormatId:o,version:"".concat(s,".").concat(c,".").concat(u)})}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=E(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e){for(var t=this.reader.readUint32(),n=0;n<t;++n)this.deserializeValueAndRecordHolders(e,n)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(e,a)}}},{key:"handleHangUpObjectDeserializerTask",value:function(e,t){for(var n=this.reader.readUint32(),r=0;r<n;++r){var i=this.reader.readString();this.deserializeValueAndRecordHolders(e,i)}this.objectAdapter.completeHangUpObject(e,t)}},{key:"deserializeValueAndRecordHolders",value:function(e,t){var n=this.deserializeValue(this.objectAdapter,e,t);if(void 0!==n){var r=this.holdersMap[n];r||(this.holdersMap[n]=r=[]),r.push({object:e,key:t})}}},{key:"deserializeHash",value:function(){for(var e=new Array(_t),t=0;t<_t;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}();It.simpleObjectAdapter=new ut;var Ct,Pt=function(){function e(t,n,r,i){M(this,e),this.reader=t,this.format=n,this.objectFormats=r,this.objectAdapter=i,this.arrayCacheMap={},this.objectCacheMap={},this.objectStateMap={},this.holdersMap={},this.deserializeTasksQueue=[],this.deserializeBufferSetterQueue=[]}return O(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s){var c=this.objectFormats[s]||e.neverObjectFormat;this.deserializeValue(c,n,o,s)}for(;;){var u=this.reader.readBigInt();if(""===u)break;var l=this.takeNextDeserializerTask(u);this.handleDeserializerTask(l)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var h=this.reader.didReadBytes-i;if(r!==h+_t)throw new kt("expect bytes ".concat(r,", instead of ").concat(h));var d=this.deserializeHash();if(!t&&d!==Gt&&d!==this.reader.generateHash(i,h))throw new kt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.objectFormats.length?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e=Object.freeze([]);for(var t in this.objectCacheMap){var n=this.objectCacheMap[t],r=this.holdersMap[t]||e,i=this.objectStateMap[t],a=i.objectFormat,o=i.type;this.objectAdapter.decorateObject(n,o,r,a)}}},{key:"deserializeValueAndRecordHolders",value:function(e,t,n){var r=this.deserializeValue(e,this.objectAdapter,t,n);if(void 0!==r){var i=this.holdersMap[r];i||(this.holdersMap[r]=i=[]),i.push({object:t,key:n})}}},{key:"deserializeValue",value:function(e,t,n,r){var i;switch(this.reader.readUint8()){case tt.Undefined:t.setValue(n,r,void 0);break;case tt.Null:t.setValue(n,r,null);break;case tt.String:t.setValue(n,r,this.reader.readString());break;case tt.Integer32:t.setValue(n,r,this.reader.readInt32());break;case tt.Integer53:t.setValue(n,r,this.reader.readInt53());break;case tt.Float:t.setValue(n,r,this.reader.readFloat64());break;case tt.True:t.setValue(n,r,!0);break;case tt.False:t.setValue(n,r,!1);break;case tt.Object:i=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!1);t.setValue(n,r,a);break;case tt.Array:i=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!0);t.setValue(n,r,o);break;case tt.Buffer:var s=this.reader.readUint32(),c=this.deserializeBufferSetterQueue[s];c||(c=this.deserializeBufferSetterQueue[s]=[]),c.push((function(e){return t.setValue(n,r,e)}))}return i}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t,n){var r=n?this.arrayCacheMap:this.objectCacheMap,i=r[e];return i||(r[e]=i=this.objectAdapter.createObject(e,n?rt.Array:rt.Object),this.deserializeTasksQueue.push({isArray:n,identifier:e,deducedFormat:t,object:i})),i}},{key:"takeNextDeserializerTask",value:function(e){for(var t=0;t<this.deserializeTasksQueue.length;++t){var n=this.deserializeTasksQueue[t];if(e===n.identifier)return this.deserializeTasksQueue.splice(t,1),n}throw new kt("can't find identifier ".concat(e," in task queue"))}},{key:"handleDeserializerTask",value:function(e){var t=this.reader.readUint8(),n=e.identifier;switch(t){case nt.Array:if(!e.isArray)throw new kt("expect array");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleArrayDeserializerTask(e.object,e.deducedFormat);break;case nt.DeducedObject:if(e.isArray)throw new kt("expect object");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleObjectDeserializerTask(e.object,e.deducedFormat);break;case nt.AssertedObject:if(e.isArray)throw new kt("expect object");var r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[n]={type:t,objectFormat:i},this.handleObjectDeserializerTask(e.object,i)}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=E(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e,t){for(var n=t.index,r=this.reader.readUint32(),i=0;i<r;++i)this.deserializeValueAndRecordHolders(n,e,i)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(t.properties[n],e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(t.key,e,a)}}},{key:"deserializeHash",value:function(){for(var e=new Array(_t),t=0;t<_t;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}();Pt.neverObjectFormat=lt(),Pt.simpleObjectAdapter=new ut,function(e){e[e.V0=0]="V0",e[e.V1=1]="V1"}(Ct||(Ct={}));var Mt=_e.parse("1.4.2");function Tt(e){var t=e;return"string"==typeof t&&(t=_e.parse(t)),_e.compare(t,Mt)<0?0:1}var Ot=function(){function e(t){M(this,e),this.format=t.format,this.objectAdapter=t.objectAdapter,this.assertObjectFormat=t.assertObjectFormat||function(){}}return O(e,[{key:"serialize",value:function(e){var t=e.writer,n=e.values,r=e.objectFormats,i=e.includesHash;new xt(t,r,this.objectAdapter,this.assertObjectFormat).serialize(n,i)}},{key:"deserialize",value:function(e){var t=e.reader,n=e.objectFormats,r=e.ignoreHashChecking;switch(e.version){case Ct.V0:return new Pt(t,this.format,n,this.objectAdapter).deserialize(r);case Ct.V1:return new It(t,this.format,this.objectAdapter,n.length).deserialize(r);default:return[]}}}]),e}(),Et="0".charCodeAt(0),At=function(){function e(){M(this,e),this.buffer=new ot}return O(e,[{key:"generateHash",value:function(e,t){return this.buffer.generateHash(e,t)}},{key:"didWriteBytes",get:function(){return this.buffer.length}},{key:"writeBuffer",value:function(e){this.buffer.pushUint32(e.byteLength),e.byteLength>0&&this.buffer.pushBuffer(e,0,e.byteLength)}},{key:"writeUint8",value:function(e){this.buffer.pushUint8(e)}},{key:"putUint8Holder",value:function(){return this.buffer.pushUint8Holder()}},{key:"writeUint16",value:function(e){this.buffer.pushUint16(e)}},{key:"writeInt32",value:function(e){this.buffer.pushInt32(e)}},{key:"writeUint32",value:function(e){this.buffer.pushUint32(e)}},{key:"putUint32Holder",value:function(){return this.buffer.pushUint32Holder()}},{key:"writeInt53",value:function(e){var t=0|e,n=(e-t)/it;this.buffer.pushInt32(t),this.buffer.pushInt32(n)}},{key:"writeFloat64",value:function(e){this.buffer.pushFloat64(e)}},{key:"writeString",value:function(e){var t=function(e){for(var t=new String(e),n=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?n+=1:r<2048?n+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,n+=4):n+=3;return n}(e);this.writeInt32(t),function(e,t){for(var n,r,i=new String(e),a=0;a<i.length;++a)(n=i.charCodeAt(a))<128?t.pushUint8(n):n<2048?(t.pushUint8(n>>6|192),t.pushUint8(63&n|128)):55296==(64512&n)&&56320==(64512&(r=i.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&r),++a,t.pushUint8(n>>18|240),t.pushUint8(n>>12&63|128),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128)):(t.pushUint8(n>>12|224),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128))}(e,this.buffer)}},{key:"writeBigInt",value:function(e){var t=new String(e);if(t.length>255)throw new bt("length of identifier ".concat(t.length," is greater than 255"));this.buffer.pushUint8(t.length);for(var n=Math.ceil(t.length/2),r=0;r<n;++r){var i=t.charCodeAt(2*r),a=t.charCodeAt(2*r+1);Number.isNaN(a)&&(a=Et);var o=vt.parseCode(i),s=vt.parseCode(a);if(void 0===o||void 0===s)throw new bt("invalid big integer ".concat(JSON.stringify(e)));this.buffer.pushUint8(o|s<<4)}}},{key:"writeReadSlice",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.offset,a=r.byteLength,o=r.buffer;this.buffer.pushBuffer(o,i,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"toBuffer",value:function(){return this.buffer.toBuffer()}}]),e}(),Nt=[],Rt=[0],Lt=[0,0],jt=[0,0,0],Dt=[0,0,0,0],zt=[0,0,0,0,0],Ft=[0,0,0,0,0,0],Bt=[0,0,0,0,0,0,0],Ut=[0,0,0,0,0,0,0,0];var Vt,Wt,Ht=function(){function e(t){M(this,e),this._offset=0,this.buffer=t}return O(e,[{key:"offset",get:function(){return this._offset}},{key:"generateHash",value:function(e,t){for(var n=Math.min(e+t-1,this.buffer.byteLength-1),r=new Ye.default,i=[0],a=e;a<=n;++a)i[0]=this.buffer.getUint8(a),r.appendBinary(String.fromCharCode.apply(String,i));return r.end(!0)}},{key:"didReadBytes",get:function(){return this._offset}},{key:"readBuffer",value:function(){var e=this.buffer.getUint32(this._offset);this._offset+=4;var t=this.buffer.slice(this._offset,e);return this._offset+=e,t}},{key:"readUint8",value:function(){var e=this.buffer.getUint8(this._offset);return this._offset+=1,e}},{key:"readUint16",value:function(){var e=this.buffer.getUint16(this._offset);return this._offset+=2,e}},{key:"readInt32",value:function(){var e=this.buffer.getInt32(this._offset);return this._offset+=4,e}},{key:"readUint32",value:function(){var e=this.buffer.getUint32(this._offset);return this._offset+=4,e}},{key:"readInt53",value:function(){var e=this.buffer.getInt32(this._offset);this._offset+=4;var t=this.buffer.getInt32(this._offset);return this._offset+=4,t*it+e}},{key:"readFloat64",value:function(){var e=this.buffer.getFloat64(this._offset);return this._offset+=8,e}},{key:"readString",value:function(){var e=this.readInt32(),t=function(e,t,n){var r=t;if(n<1)return"";for(var i,a=r+n,o=[],s=null,c=0;r<a;)(i=e.getUint8(r++))<128?o[c++]=i:i>191&&i<224?o[c++]=(31&i)<<6|63&e.getUint8(r++):i>239&&i<365?(i=((7&i)<<18|(63&e.getUint8(r++))<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++))-65536,o[c++]=55296+(i>>10),o[c++]=56320+(1023&i)):o[c++]=(15&i)<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++),c>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),c=0);return s?(c&&s.push(String.fromCharCode.apply(String,o.slice(0,c))),s.join("")):String.fromCharCode.apply(String,o.slice(0,c))}(this.buffer,this._offset,e);return this._offset+=e,t}},{key:"readBigInt",value:function(){for(var e=this.readUint8(),t=Math.ceil(e/2),n=function(e){switch(e){case 0:return Nt;case 1:return Rt;case 2:return Lt;case 3:return jt;case 4:return Dt;case 5:return zt;case 6:return Ft;case 7:return Bt;case 8:return Ut;default:return[]}}(e),r=0;r<t;++r){var i=this.readUint8(),a=15&i,o=i>>4&15;n[2*r]=vt.toCode(a),2*r+1<e&&(n[2*r+1]=vt.toCode(o))}return String.fromCharCode.apply(String,n)}},{key:"skipBytes",value:function(e){return this._offset+=e,e}},{key:"sliceLatestBytes",value:function(e){return[{offset:this._offset-e,buffer:this.buffer,byteLength:e}]}}]),e}(),_t=16,Gt=function(){for(var e=[],t=0;t<_t;++t)e[t]=0;return String.fromCharCode.apply(String,e)}(),Yt=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).name="FormatError",r}return n}(f(Error));!function(e){e[e.Indeterminate=0]="Indeterminate",e[e.Circular=1]="Circular",e[e.Noncircular=2]="Noncircular"}(Vt||(Vt={})),function(e){e[e.Border=0]="Border",e[e.Compound=1]="Compound",e[e.Object=2]="Object",e[e.Handle=3]="Handle"}(Wt||(Wt={}));var Xt=function(){function e(t,n,r){M(this,e),this.templateEnvironment=t,this.templateType=n,this.params=r,this.expandedParamNodes=[],this.convertTypeToGeneratorParam=this.convertTypeToGeneratorParam.bind(this);for(var i=0;i<r.length;++i)this.expandedParamNodes[i]=void 0}return O(e,[{key:"getExpandedExpression",value:function(){return this.expandNode(this.templateType)}},{key:"expandNode",value:function(e){switch(e.typeEnum){case ge.Any:case ge.Never:case ge.Undefined:case ge.Null:case ge.String:case ge.Number:case ge.Boolean:case ge.Function:return{type:e,clazz:0};case ge.Object:var t=e,n={};for(var r in t.properties){var i=t.properties[r];n[r]=this.expandNode(i)}return{type:t,clazz:2,key:this.expandNode(t.key),index:this.expandNode(t.index),properties:n};case ge.And:case ge.Or:var a,o=e,s=[],c=E(o.children);try{for(c.s();!(a=c.n()).done;){var u=a.value;s.push(this.expandNode(u))}}catch(e){c.e(e)}finally{c.f()}return{type:o,clazz:1,children:s};case ge.Generator:return this.expandGeneratorType(e);case ge.Generic:return this.expandGenericType(e);case ge.Reference:case ge.GlobalReference:return this.expandReferenceType(e)}throw new Yt("unrecognized enum type "+e.typeEnum)}},{key:"expandGeneratorType",value:function(e){var t=e.params.map(this.convertTypeToGeneratorParam);return{clazz:3,handle:this.templateEnvironment.getTemplate(e.template).getHandle(t)}}},{key:"convertTypeToGeneratorParam",value:function(e){var t=this.expandNode(e);return 3===t.clazz?t.handle:t.type}},{key:"expandGenericType",value:function(e){var t=e.index,n=this.expandedParamNodes[t];if(!n){var r=this.params[t];if(!r)throw new Yt("generic index ".concat(t," is out of range: 0 ~ ").concat(this.params.length-1));n=this.covertParamTypeToExpandedNode(r),this.expandedParamNodes[t]=n}return n}},{key:"expandReferenceType",value:function(e){var t,n=this.templateEnvironment.replaceReferenceType(e);return t=n.typeEnum===ge.Generator?n:{typeEnum:ge.Generator,template:n,params:[]},this.expandGeneratorType(t)}},{key:"covertParamTypeToExpandedNode",value:function(e){return"id"in e?this.expandNode(e):{clazz:3,handle:e}}}]),e}(),Qt=function(){function e(t){M(this,e),this.rootExpandedNode=t}return O(e,[{key:"getCollapsedExpression",value:function(){return this.collapseNode(this.rootExpandedNode)}},{key:"collapseNode",value:function(t){switch(t.clazz){case Wt.Border:return{id:e.generateId(),hasCircular:!1,types:[t.type.typeEnum]};case Wt.Object:return this.collapseObjectExpandedNode(t);case Wt.Handle:return this.collapseHandleExpandedNode(t);case Wt.Compound:return this.collapseCompoundExpandedNode(t,t.type.typeEnum);default:throw new Error("invalid class ".concat(t.clazz))}}},{key:"collapseObjectExpandedNode",value:function(t){var n=t.key,r=t.index,i=t.properties,a=this.collapseNode(n),o=this.collapseNode(r),s=a.hasCircular||o.hasCircular,c={};for(var u in i){var l=i[u],h=this.collapseNode(l);c[u]=h,s=s||h.hasCircular}var d={key:a,index:o,properties:c};return this.isCollapsedObjectHasNeverPropertyTypes(d)?e.neverCollapsedNode:{id:e.generateId(),hasCircular:s,types:[ge.Object],object:d}}},{key:"collapseHandleExpandedNode",value:function(t){var n=t.handle;switch(n.state){case Vt.Noncircular:return n.collapsedNode;case Vt.Indeterminate:case Vt.Circular:return{id:e.generateId(),hasCircular:!0,types:[ge.Object],handle:n};default:throw new Error("invalid state ".concat(n.state))}}},{key:"collapseCompoundExpandedNode",value:function(t,n){var r,i=[],a=E(t.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.push(this.collapseNode(o))}}catch(e){a.e(e)}finally{a.f()}if(0===i.length)return e.neverCollapsedNode;if(1===i.length)return i[0];for(var s=0,c=i;s<c.length;s++){var u=c[s];if(u.handle&&u.handle.state===Vt.Indeterminate){var l=n===ge.And?"&":"|";throw new Yt('can not operate an indeterminate expression with "'.concat(l,'" sign'))}}return n===ge.And?this.pruneAndMergeNodes(i):this.flattenNodes(i)}},{key:"pruneAndMergeNodes",value:function(t){var n=this.collectCrossTypeEnumsWith(t);if(0===n.length||n.find((function(e){return e===ge.Never})))return e.neverCollapsedNode;var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,ge.And)}},{key:"flattenNodes",value:function(t){var n=this.collectUnionTypeEnumsWith(t);if(0===(n=n.filter((function(e){return e!==ge.Never}))).length)return e.neverCollapsedNode;if(n.find((function(e){return e===ge.Any})))return{id:e.generateId(),hasCircular:!1,types:[ge.Any]};var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,ge.Or)}},{key:"collectCrossTypeEnumsWith",value:function(e){var t,n={},r=E(e);try{for(r.s();!(t=r.n()).done;){var i,a=E(t.value.types);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=n[o];void 0===s&&(s=0),n[o]=s+1}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var c=[];for(var u in n)n[u]===e.length&&c.push(u);return c}},{key:"collectUnionTypeEnumsWith",value:function(e){var t,n={},r=E(e);try{for(r.s();!(t=r.n()).done;){var i,a=E(t.value.types);try{for(a.s();!(i=a.n()).done;){n[i.value]=!0}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var o=[];for(var s in n)n[s]&&o.push(s);return o}},{key:"collectAllObjectCollapsedNodesIn",value:function(e){var t,n=[],r=E(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;(i.object||i.handle)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"handleObjectCollapsedNodesWithTypeEnums",value:function(t,n,r){var i,a=t;if(0===a.length)return{id:e.generateId(),hasCircular:!1,types:n};if(1===a.length)return function(e,t){return Qe(e,Ze(t))}(et({},a[0]),{id:e.generateId(),types:n});var o=[];if(a=a.filter((function(e){return!e.handle||(o.push(e),!1)})),o.length>=2){var s=r===ge.And?"&":"|";throw new Yt("can not ".concat(o.length,' circular expression with "').concat(s,'" sign'))}(i=a).push.apply(i,o);for(var c=a[0].object,u=1;u<a.length;++u){if(r===ge.And&&this.isCollapsedObjectHasNeverPropertyTypes(c))return e.neverCollapsedNode;var l=a[u],h=this.getObjectFromObjectCollapsedNode(l);c=r===ge.And?this.factorizeWithAndOperation(c,h):this.factorizeWithOrOperation(c,h)}return this.isCollapsedObjectHasNeverPropertyTypes(c)?e.neverCollapsedNode:{id:e.generateId(),types:n,hasCircular:this.hasCircularIn(a),object:c}}},{key:"getObjectFromObjectCollapsedNode",value:function(e){for(var t=e;;){if(t.object)return t.object;t=t.handle.collapsedNode}}},{key:"hasCircularIn",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){if(t.value.hasCircular)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"factorizeWithAndOperation",value:function(e,t){var n=[],r=[],i=[];for(var a in e.properties)a in t.properties?n.push(a):r.push(a);for(var o in t.properties)o in e.properties||i.push(o);for(var s={},c=0,u=n;c<u.length;c++){var l=u[c],h=e.properties[l],d=t.properties[l];s[l]=this.pruneAndMergeNodes([h,d])}for(var p=0,f=r;p<f.length;p++){var v=f[p];s[v]=e.properties[v]}for(var m=0,g=i;m<g.length;m++){var y=g[m];s[y]=t.properties[y]}return{key:this.pruneAndMergeKeyOrIndexNodes(e.key,t.key),index:this.pruneAndMergeKeyOrIndexNodes(e.index,t.index),properties:s}}},{key:"factorizeWithOrOperation",value:function(e,t){var n=[];for(var r in e.properties)r in t.properties&&n.push(r);for(var i={},a=0,o=n;a<o.length;a++){var s=o[a],c=e.properties[s],u=t.properties[s];i[s]=this.flattenNodes([c,u])}return{key:this.flattenNodesKeyOrIndexNodes(e.key,t.key),index:this.flattenNodesKeyOrIndexNodes(e.index,t.index),properties:i}}},{key:"pruneAndMergeKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,ge.Undefined)?t:this.isCollapsedNodeTypeEqual(t,ge.Undefined)?e:this.pruneAndMergeNodes([e,t])}},{key:"flattenNodesKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,ge.Undefined)?t:this.isCollapsedNodeTypeEqual(t,ge.Undefined)?e:this.flattenNodes([e,t])}},{key:"isCollapsedObjectHasNeverPropertyTypes",value:function(e){if(this.isCollapsedNodeTypeEqual(e.key,ge.Never)||this.isCollapsedNodeTypeEqual(e.index,ge.Never))return!0;for(var t in e.properties)if(this.isCollapsedNodeTypeEqual(e.properties[t],ge.Never))return!0;return!1}},{key:"isCollapsedNodeTypeEqual",value:function(e,t){return 1===e.types.length&&e.types[0]===t}}],[{key:"generateId",value:function(){var e=this.nextId;return this.nextId+=1,"".concat(e)}}]),e}(),Zt=Qt;Zt.nextId=0,Zt.neverCollapsedNode={id:Qt.generateId(),hasCircular:!1,types:[ge.Never]};var Kt,qt=function(){function e(t){M(this,e),this.replaceReferenceType=t,this.templatesTable={}}return O(e,[{key:"getTemplate",value:function(e){if(void 0===e.id)throw new Yt("templateType don't have id");var t=this.templatesTable[e.id];return t||(t=new Jt(this,e),this.templatesTable[e.id]=t),t}}]),e}(),Jt=function(){function e(t,n){M(this,e),this.templateEnvironment=t,this.templateType=n,this.handlesCache=[]}return O(e,[{key:"getHandle",value:function(e){var t=this.getHandleByParams(e);if(!t){t={state:Vt.Indeterminate},this.setHandleWithParams(t,C(e));var n=this.createCollapsedNode(e);t.collapsedNode=n,t.state=n.hasCircular?Vt.Circular:Vt.Noncircular}return t}},{key:"createCollapsedNode",value:function(e){var t=new Xt(this.templateEnvironment,this.templateType,e).getExpandedExpression();return new Zt(t).getCollapsedExpression()}},{key:"getHandleByParams",value:function(t){var n,r=E(this.handlesCache);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.isParamsEquals(i.params,t))return i.handle}}catch(e){r.e(e)}finally{r.f()}}},{key:"setHandleWithParams",value:function(e,t){if(this.handlesCache.length>=2500)throw new Yt("the template's definition is divergence");this.handlesCache.push({handle:e,params:t})}}],[{key:"isParamsEquals",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n){var r=e[n],i=t[n];if(!(r===i||"id"in r&&"id"in i&&r.id===i.id))return!1}return!0}}]),e}(),$t=function(){function e(t){M(this,e),this.collapsedNodeToRecordMap={},this.recordMap={},this.nextRecordId=0,this.templateEnvironment=new qt(t);var n=this.nextRecordId;this.nextRecordId+=1,this.recordMap[n]=this.anyObjectFormatRecord={id:n,key:n,index:n,properties:{}}}return O(e,[{key:"covert",value:function(e){var t=this.templateEnvironment.getTemplate(e).getHandle([]).collapsedNode,n=this.findRecordId(t);return this.recordMap[n]}},{key:"getObjectFormatRecords",value:function(){var e=[];for(var t in this.recordMap)e.push(this.recordMap[t]);return e}},{key:"findRecordId",value:function(e){if(e.types.some((function(e){return e===ge.Object}))){var t=this.collapsedNodeToRecordMap[e.id];if(!t){var n={id:this.nextRecordId};this.nextRecordId+=1,this.collapsedNodeToRecordMap[e.id]=n,this.recordMap[n.id]=n,this.convertCollapsedNodeAndFillObjectFormatRecord(e,n),t=n}return t.id}return this.anyObjectFormatRecord.id}},{key:"convertCollapsedNodeAndFillObjectFormatRecord",value:function(e,t){for(var n=e;n.handle;)n=n.handle.collapsedNode;var r=n.object,i={};for(var a in r.properties)i[a]=this.findRecordId(r.properties[a]);t.key=this.findRecordId(r.key),t.index=this.findRecordId(r.index),t.properties=i}}]),e}(),en=function(){function e(){M(this,e),this.replaceReferenceType=function(){throw new Yt("not define referenceTypeReplacer")}}return O(e,[{key:"createWithRecords",value:function(e,t){var n,r=new $t(t||this.replaceReferenceType),i=[],a={},o=E(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.type,u=s.interrupter,l=r.covert(c);u&&(a[l.id]=u),i.push(l.id)}}catch(e){o.e(e)}finally{o.f()}for(var h=r.getObjectFormatRecords().map((function(e){var t=a[e.id];return t?t(e):e})),d=new tn(h),p=[],f=0,v=i;f<v.length;f++){var m=v[f];p.push(d.findObjectFormat(m))}return{format:d,objectFormats:p}}},{key:"createWithBuffer",value:function(e){return new tn(tn.deserialize(e))}}]),e}(),tn=function(){function e(t){M(this,e),this.records={},this.formats={};var n,r=null,i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o={};this.records[a.id]=a,this.formats[a.id]=o,this.isAnyObjectFormatRecord(a)&&(r=o)}}catch(e){i.e(e)}finally{i.f()}var s,c=E(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.completeObjectFormat(this.formats[u.id],u)}}catch(e){c.e(e)}finally{c.f()}if(!r)throw new Error("can't find any object format");this.anyObjectFormat=r,this.objectFormatIds=Object.freeze(t.map((function(e){return e.id})).sort())}return O(e,[{key:"isAnyObjectFormatRecord",value:function(e){for(var t in e.properties)return!1;return e.index===e.id&&e.key===e.id}},{key:"completeObjectFormat",value:function(e,t){for(var n in e.id=t.id,e.key=this.formats[t.key],e.index=this.formats[t.index],e.properties={},t.properties)e.properties[n]=this.formats[t.properties[n]];Object.freeze(e.properties),Object.freeze(e)}},{key:"findObjectFormat",value:function(e){var t=this.formats[e];if(!t)throw new Error("can't find ObjectFormat with id ".concat(e));return t}},{key:"serialize",value:function(){var e=[],t=new At;for(var n in this.records)e.push(this.records[n]);e.sort((function(e,t){return e.id-t.id})),t.writeUint32(e.length);for(var r=0,i=e;r<i.length;r++){var a=i[r];this.serializeRecord(a,t)}return t.toBuffer()}},{key:"serializeRecord",value:function(e,t){if(e.id>at)throw new Yt("ObjectFormat's number can't greater than ".concat(at));var n=Object.keys(e.properties).sort();if(n.length>at)throw new Yt("ObjectFormat's properties number can't greater than ".concat(at));t.writeUint32(e.id),t.writeUint32(e.key),t.writeUint32(e.index),t.writeUint32(n.length);var r,i=E(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.writeString(a),t.writeUint32(e.properties[a])}}catch(e){i.e(e)}finally{i.f()}}}],[{key:"deserialize",value:function(e){for(var t=[],n=new Ht(e),r=n.readUint32(),i=0;i<r;++i){for(var a=n.readUint32(),o=n.readUint32(),s=n.readUint32(),c=n.readUint32(),u={},l=0;l<c;++l){var h=n.readString(),d=n.readUint32();u[h]=d}t.push({id:a,key:o,index:s,properties:u})}return t}}]),e}(),nn=Math.pow(2,32)-1,rn=W(n("d+02")),an=Object.defineProperty,on=Object.getOwnPropertySymbols,sn=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable,un=function(e,t,n){return t in e?an(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ln=function(e,t){for(var n in t||(t={}))sn.call(t,n)&&un(e,n,t[n]);if(on){var r,i=E(on(t));try{for(i.s();!(r=i.n()).done;){n=r.value;cn.call(t,n)&&un(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},hn=function(){function e(t){M(this,e),this.sockets=[],this.logger=t}return O(e,[{key:"socketsCount",get:function(){return this.sockets.length}},{key:"addSocket",value:function(e){-1===this.sockets.indexOf(e)&&this.sockets.push(e)}},{key:"removeSocket",value:function(e){var t=this.sockets.indexOf(e);-1!==t&&this.sockets.splice(t,1)}},{key:"forEachSockets",value:function(e){this.sockets.forEach(e)}},{key:"emit",value:function(e,t){var n,r=E(this.sockets);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i.emit(e,t)}catch(e){this.logger.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),dn=function(){function e(t){M(this,e),this.typesMap={},this.typeToIndexMap={},this.typesMap=Object.freeze(this.createTypesMap(t)),this.typeToIndexMap=Object.freeze(this.createTypeToIndexMap(this.typesMap))}return O(e,[{key:"createTypesMap",value:function(e){for(var t={},n=0;n<e.length;++n)t[n]=e[n];return t}},{key:"createTypeToIndexMap",value:function(e){var t={};for(var n in e){var r=parseInt(n,10),i=e[r];if(i in t)throw new Error('find duplicated type "'.concat(i,' in parameters of new TypesMap(...)"'));t[i]=r}return t}},{key:"hasType",value:function(e){return e in this.typeToIndexMap}},{key:"findTypeId",value:function(e){var t=this.typeToIndexMap[e];if(void 0===t)throw new Error("can't find id with type ".concat(e));return t}},{key:"findTypeById",value:function(e){var t=this.typesMap[e];if(!t)throw new Error("can't find type with id ".concat(e));return t}},{key:"extendsTypesMap",value:function(t){var n=[];for(var r in this.typesMap)n.push(this.typesMap[r]);for(var i in t.typesMap)n.push(t.typesMap[i]);return new e(n)}}],[{key:"create",value:function(t){return new e(t)}}]),e}();!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(Kt||(Kt={}));var pn,fn=function(){function e(t){var n=this;M(this,e),this.invoker=t,this.timer=null,this.invokeWhenTimeout=function(){n.timer=null,n.invoker()}}return O(e,[{key:"refreshAndInvokeAfterInterval",value:function(e){null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}(),vn=function(){function e(){M(this,e),this.eventListeners={}}return O(e,[{key:"on",value:function(e,t){var n=this.eventListeners[e];n||(n=[],this.eventListeners[e]=n),-1===n.indexOf(t)&&n.push(t)}},{key:"off",value:function(e,t){var n=this.eventListeners[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.eventListeners[e])}}},{key:"once",value:function(e,t){var n=this;this.on(e,(function r(i){try{t(i)}finally{n.off(e,r)}}))}},{key:"dispatchToListeners",value:function(e,t){var n=this.eventListeners[e];if(n){var r,i=E(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(t)}catch(e){console.error(e)}}}catch(e){i.e(e)}finally{i.f()}}}}]),e}(),mn=Math.pow(2,32);function gn(e,t,n){var r=n%mn,i=(n-r)/mn;e.setInt32(t,r),e.setInt32(t+4,i)}function yn(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*mn+n}!function(e){e[e.Buffer=0]="Buffer",e[e.String=1]="String",e[e.Integer=2]="Integer"}(pn||(pn={}));var bn=function(){function e(t,n,r){var i=this;M(this,e),this.typesMap=t,this.socket=n,this.receiver=r,this.latestThreePackageBytes=[0,0,0],this.nextSelfPackageId=0,this._latestReceivedRemoteId=-1,this.onMessage=function(e){try{if(i.receivedPackageHeadBuffer){var t=i.receivedPackageHeadBuffer,n=Ce(e.data),r=i.parsePackage(t,n);i._latestReceivedRemoteId=Math.max(r.id,i._latestReceivedRemoteId),i.receivedPackageHeadBuffer=void 0,i.receiver(null,r)}else i.receivedPackageHeadBuffer=Ce(e.data)}catch(t){i.receiver(t,null)}},n.binaryType="arraybuffer",n.addEventListener("message",this.onMessage)}return O(e,[{key:"bufferedAmount",get:function(){return this.socket.bufferedAmount}},{key:"maxPackageBytesInLatestThree",get:function(){return Math.max.apply(Math,[0].concat(C(this.latestThreePackageBytes)))}},{key:"latestReceivedRemoteId",get:function(){return this._latestReceivedRemoteId}},{key:"sendPackage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object.freeze({id:this.nextSelfPackageId,receivedId:this._latestReceivedRemoteId,type:e,data:t});this.nextSelfPackageId+=1;var r=this.createPackageHead(n),i=this.wrapPackageData(n.data),a=r.byteLength+i.byteLength;return this.socket.send(r.primitiveBuffer),this.socket.send(i.primitiveBuffer),this.latestThreePackageBytes[0]=this.latestThreePackageBytes[1],this.latestThreePackageBytes[1]=this.latestThreePackageBytes[2],this.latestThreePackageBytes[2]=a,n.id}},{key:"createPackageHead",value:function(e){var t=Ie(18);return gn(t,0,e.id),gn(t,8,e.receivedId),t.setUint8(16,this.typesMap.findTypeId(e.type)),t.setUint8(17,function(e){switch(R(e)){case"number":return 2;case"string":return 1;default:return 0}}(e.data)),t}},{key:"wrapPackageData",value:function(e){if("string"==typeof e){for(var t=new String(e),n=Ie(2*t.length),r=0;r<t.length;++r)n.setUint16(2*r,65535&t.charCodeAt(r));return n}if("number"==typeof e){var i=Ie(8);return gn(i,0,e),i}return e}},{key:"parsePackage",value:function(e,t){var n,r=yn(e,0),i=yn(e,8),a=e.getUint8(16),o=e.getUint8(17);switch(o){case pn.String:for(var s=t.byteLength/2,c=[],u=0;u<s;++u)c[u]=t.getUint16(2*u);n=String.fromCharCode.apply(String,c);break;case pn.Integer:n=yn(t,0);break;case pn.Buffer:n=t;break;default:throw new Error("unrecognized data type ".concat(o))}return Object.freeze({id:r,receivedId:i,type:this.typesMap.findTypeById(a),data:n})}}]),e}(),kn=function(){function e(t,n,r,i,a){var o=this;M(this,e),this.receivedWhenNotWorkingBuffer=[],this.remoteHeartbeatTimeout=void 0,this.crashByChannelError=!1,this.isWorking=!1,this.isLimit=!1,this.becameLimitTimestamp=0,this.sendHeartbeat=function(){o.isWorking&&(o.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(o.akkoSocket.params.heartbeatInterval),o.chanel.sendPackage("heartbeat"))},this.handleRemoteHeartbeatTimeout=function(){o.crashByChannelError||(o.crashByChannelError=!0,o.callbacks.onRemoteHeartbeatTimeout())},this.onReceivedPackage=function(e,t){if(!o.crashByChannelError)if(!e&&t)if(o.isWorking)try{o.handleReceivedPackage(t)}finally{o.delayRemoteHeartbeatTimeoutChecking()}else o.receivedWhenNotWorkingBuffer.push(t);else e&&!t&&o.callbacks.onParseMessageFailed(e)},this.akkoSocket=t,this.logger=r,this.chanel=new bn(i,n,this.onReceivedPackage),this.callbacks=Object.freeze(ln({},a)),this.sendHeartbeatDelayer=new fn(this.sendHeartbeat),this.remoteHeartbeatTimeoutDelayer=new fn(this.handleRemoteHeartbeatTimeout)}return O(e,[{key:"send",value:function(e,t){if(this.isWorking)if(t instanceof Array){var n,r=E(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.sendPackage(e,i)}}catch(e){r.e(e)}finally{r.f()}}else this.sendPackage(e,t)}},{key:"sendPackage",value:function(e,t){if(this.checkBufferedAmountOverflow())throw this.crashByChannelError||(this.crashByChannelError=!0,this.callbacks.onSendingBufferOverflow()),new Error("sending buffer overflow");this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage(e,t)}},{key:"checkBufferedAmountOverflow",value:function(){var e=!1,t=this.akkoSocket.params,n=t.sendingBufferCrash,r=t.sendingBufferLimit,i=t.sendingBufferLimitDuration,a=this.chanel,o=a.bufferedAmount,s=a.maxPackageBytesInLatestThree;if(o>n+s)e=!0;else if(o>r+s){var c=Date.now();this.isLimit?c-this.becameLimitTimestamp>i&&(this.isLimit=!1,e=!0):(this.isLimit=!0,this.becameLimitTimestamp=c)}else this.isLimit=!1;return e}},{key:"dispatchClose",value:function(e){var t=JSON.stringify(e);this.chanel.sendPackage("close",t)}},{key:"start",value:function(){this.isWorking||(this.isWorking=!0,this.delayRemoteHeartbeatTimeoutChecking(),this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage("setHeartbeatTimeout",this.akkoSocket.params.heartbeatTimeout),this.cleanReceivedWhenNotWorkingBuffer())}},{key:"cleanReceivedWhenNotWorkingBuffer",value:function(){var e=this.receivedWhenNotWorkingBuffer.splice(0,this.receivedWhenNotWorkingBuffer.length);if(e.length>0)try{var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.handleReceivedPackage(r)}}catch(e){n.e(e)}finally{n.f()}}finally{this.delayRemoteHeartbeatTimeoutChecking()}}},{key:"stop",value:function(){this.isWorking&&(this.isWorking=!1,this.sendHeartbeatDelayer.cancel(),this.remoteHeartbeatTimeoutDelayer.cancel(),this.remoteHeartbeatTimeout=void 0)}},{key:"handleReceivedPackage",value:function(t){if(e.sessionEventTypesMap.hasType(t.type)){if("setHeartbeatTimeout"===t.type)"number"==typeof t.data&&t.data>0?this.remoteHeartbeatTimeout=t.data:this.logger.warn("illegal remote heartbeat timeout: ".concat(t.data));else if("close"===t.type){var n;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(e){this.logger.warn("parse close payload as JSON failed: ".concat(e.message))}this.callbacks.onCloseByRemote(n)}}else this.callbacks.onEvent(t.type,t.data)}},{key:"delayRemoteHeartbeatTimeoutChecking",value:function(){void 0===this.remoteHeartbeatTimeout?this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatTimeout):this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.remoteHeartbeatTimeout)}}]),e}();kn.sessionEventTypesMap=dn.create(["heartbeat","setHeartbeatTimeout","close"]);var wn,Sn,xn=function(){function e(t,n){var r=this;M(this,e),this.socket=t,this.logger=n,this.paddingExecutors=[],this.createdAt=Date.now(),this.isConnecting=!0,this.onOpen=function(){if(r.isConnecting){r.finishConnecting();var e,t=Date.now()-r.createdAt,n=E(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.resolve({duration:t})}}catch(e){n.e(e)}finally{n.f()}}},this.onError=function(e){if(r.isConnecting){r.finishConnecting();var t,n=new Error(e.message||"connect failed"),i=E(r.paddingExecutors.splice(0));try{for(i.s();!(t=i.n()).done;){t.value.reject(n)}}catch(e){i.e(e)}finally{i.f()}}},this.onTimeout=function(){if(r.isConnecting){r.finishConnecting();var e,t=new Error("timeout"),n=E(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.reject(t)}}catch(e){n.e(e)}finally{n.f()}try{var i=1e3;r.socket.close(1e3)}catch(i){r.logger.error(i)}}},t.addEventListener("open",this.onOpen),t.addEventListener("error",this.onError),this.timeoutTimer=setTimeout(this.onTimeout,25e3)}return O(e,[{key:"waitToConnected",value:function(){var e=this;return new Promise((function(t,n){e.paddingExecutors.push({resolve:t,reject:n})}))}},{key:"finishConnecting",value:function(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("error",this.onError),this.isConnecting=!1,this.timeoutTimer=null}}]),e}(),In=function(e){m(i,e);var t,n,r=y(i);function i(e,t,n,a){var o;return M(this,i),(o=r.call(this)).connectingManager=null,o.connectFailError=void 0,o.onError=function(){o.logger.warn("websocket received error")},o.onCloseByRemote=function(e){if(o._phase===wn.Connected){o.sessionChannel.stop(),o.closeSocket(1e3),o.updatePhase(wn.Disconnected);var t=e&&e.error,n=e&&e.reason;t?o.params.onDisconnect({reason:Sn.RemoteError,message:t,remoteCode:e.errorCode}):o.params.onDisconnect({reason:Sn.Normal,message:n||"ok"})}},o.onClose=function(e){var t=e.code,n=void 0===t?1e3:t,r=e.reason;if(o._phase===wn.Connected){var i=o.errorMessageWithCode(n)||"disconnected with code ".concat(n,' "').concat(r,'"');o.sessionChannel.stop(),o.updatePhase(wn.Disconnected),o.params.onDisconnect({reason:Sn.WebSocketError,message:i,webSocketCode:n})}},o.socket=e,o.socket.binaryType="arraybuffer",o.logger=t,o.params=Object.freeze(ln({},a)),o.sessionChannel=new kn(k(o),e,t,n,{onCloseByRemote:o.onCloseByRemote,onEvent:function(e,t){return o.dispatchToListeners(e,t)},onRemoteHeartbeatTimeout:function(){return o.onCommunicationErrorMessage("remote heartbeat timeout")},onSendingBufferOverflow:function(){return o.onCommunicationErrorMessage("sending buffer overflow")},onParseMessageFailed:function(e){return o.onCommunicationErrorMessage("parse message failed: "+e.message)}}),o.initializePhaseWithSocketReadyState(),o}return O(i,[{key:"initializePhaseWithSocketReadyState",value:function(){switch(this.socket.readyState){case Kt.CONNECTING:this._phase=wn.Connecting,this.connect();break;case Kt.OPEN:this._phase=wn.Connected,this.addSessionListeners(),this.sessionChannel.start();break;default:var e=Kt[this.socket.readyState];throw e||(e="".concat(this.socket.readyState)),new Error("invalid readyState of WebSocket: ".concat(e))}}},{key:"phase",get:function(){return this._phase}},{key:"updatePhase",value:function(e){if(this._phase!==e)try{this.params.onPhaseChanged(e)}finally{this._phase=e}}},{key:"emit",value:function(e,t){if(this._phase!==wn.Connected)throw new Error("AkkoSocket can't emit when phase is ".concat(this.phase));try{this.sessionChannel.send(e,t)}catch(e){throw this.disconnectForceWithCode(1e3),this.params.onDisconnect({reason:Sn.WebSocketError,message:e.message}),e}}},{key:"connect",value:(n=I(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.connectingManager=new xn(this.socket,this.logger),e.next=4,this.connectingManager.waitToConnected();case 4:this.addSessionListeners(),this.sessionChannel.start(),this.updatePhase(wn.Connected),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.updatePhase(wn.Disconnected),this.connectFailError=e.t0;case 12:return e.prev=12,this.connectingManager=null,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])}))),function(){return n.apply(this,arguments)})},{key:"addSessionListeners",value:function(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("error",this.onError)}},{key:"waitToConnected",value:function(){if(this.connectFailError)throw this.connectFailError;if(this._phase===wn.Connected)return Promise.resolve({duration:0});if(this._phase===wn.Connecting)return this.connectingManager.waitToConnected();throw new Error("AkkoSocket's phase had became ".concat(this._phase))}},{key:"disconnect",value:function(e){return e?this.disconnectWithCodeAndReason({reason:e}):this.disconnectWithCodeAndReason()}},{key:"disconnectWithErrorDescription",value:function(e){var t=e.message,n=e.code;return this.disconnectWithCodeAndReason({error:t,errorCode:n})}},{key:"disconnectForce",value:function(){if(this._phase===wn.Connected){this.disconnectForceWithCode(1e3)}}},{key:"disconnectForceWithCode",value:function(e){this.sessionChannel.stop(),this.closeSocket(e),this.updatePhase(wn.Disconnected)}},{key:"disconnectWithCodeAndReason",value:(t=I(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.didCallDisconnect){e.next=2;break}throw new Error("AkkoSocket did call disconnect");case 2:this.didCallDisconnect=!0,n=!0,e.t0=this._phase,e.next=e.t0===wn.Disconnecting||e.t0===wn.Disconnected?7:e.t0===wn.Connecting?8:17;break;case 7:throw new Error("AkkoSocket can't disconnect when phase is ".concat(this.phase));case 8:return e.prev=8,e.next=11,this.waitToConnected();case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(8),n=!1;case 16:return e.abrupt("break",17);case 17:if(!n){e.next=26;break}return this.updatePhase(wn.Disconnecting),this.sessionChannel.dispatchClose(t),e.next=22,this.waitUtilCloseAndCheckTimeout();case 22:if(!e.sent){e.next=25;break}this.closeSocket(1e3);case 25:this.sessionChannel.stop(),this.updatePhase(wn.Disconnected);case 26:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(e){return t.apply(this,arguments)})},{key:"waitUtilCloseAndCheckTimeout",value:function(){var e=this,t=null,n=new Promise((function(e){t=setTimeout((function(){t=null,e(!0)}),3e3)})),r=new Promise((function(t){e.socket.readyState===Kt.CLOSED?t(!1):e.socket.addEventListener("close",(function(){return t(!1)}))}));return Promise.race([n,r]).then((function(e){return null!==t&&clearTimeout(t),e}))}},{key:"onCommunicationErrorMessage",value:function(e){this._phase===wn.Connected&&(this.disconnectForce(),this.params.onDisconnect({reason:Sn.CommunicationError,message:e}))}},{key:"closeSocket",value:function(e){try{this.socket.close(e)}catch(e){this.logger.error(e)}}},{key:"errorMessageWithCode",value:function(e){switch(e){case 1e3:return"CLOSE_NORMAL";case 1001:return"CLOSE_GOING_AWAY";case 1002:return"CLOSE_PROTOCOL_ERROR";case 1003:return"CLOSE_UNSUPPORTED";case 1005:return"CLOSE_NO_STATUS";case 1006:return"CLOSE_ABNORMAL";case 1007:return"Unsupported Data";case 1008:return"Policy Violation";case 1009:return"CLOSE_TOO_LARGE";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1015:return"TLS Handshake";default:return}}}]),i}(vn),Cn=function(){function e(t){M(this,e),this.eventTypesMap=kn.sessionEventTypesMap.extendsTypesMap(dn.create(t))}return O(e,[{key:"createSocket",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new In(t,n,this.eventTypesMap,ln(ln({},e.defaultSocketParams),r))}},{key:"createCombinedSockets",value:function(e){return new hn(e)}}]),e}();Cn.defaultSocketParams=Object.freeze({heartbeatInterval:4e4,heartbeatTimeout:12e4,sendingBufferLimit:5242880,sendingBufferLimitDuration:3e4,sendingBufferCrash:104857600,onDisconnect:function(){},onPhaseChanged:function(){}}),function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(wn||(wn={})),function(e){e.Normal="normal",e.WebSocketError="webSocketError",e.CommunicationError="communicationError",e.RemoteError="remoteError"}(Sn||(Sn={}));var Pn,Mn,Tn=Object.defineProperty,On=Object.defineProperties,En=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,Nn=Object.prototype.hasOwnProperty,Rn=Object.prototype.propertyIsEnumerable,Ln=function(e,t,n){return t in e?Tn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},jn=function(e,t){for(var n in t||(t={}))Nn.call(t,n)&&Ln(e,n,t[n]);if(An){var r,i=E(An(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Rn.call(t,n)&&Ln(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Dn=function(e,t){return On(e,En(t))};function zn(e){return 0===e.type}function Fn(e){return 1===e.type}function Bn(e){return 3===e.type}function Un(e){return 4===e.type}!function(e){e[e.Invoker=0]="Invoker",e[e.Event=1]="Event",e[e.Ack=2]="Ack",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave"}(Pn||(Pn={})),function(e){e[e.System=0]="System",e[e.App=1]="App",e[e.Custom=2]="Custom",e[e.Magix=3]="Magix"}(Mn||(Mn={}));var Vn=function(){function e(t,n){M(this,e);var r=t.format.anyObjectFormat;this.serialization=t,this.rootClassReflection=n,this.rootObjectFormats=Object.freeze([this.rootClassReflection.objectFormat]),this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return O(e,[{key:"serializeSnapshotFrame",value:function(e){var t=new At;return this.serializeFrameHeader(t,e),this.serializeUsers(t,e.users),this.serialization.serialize({writer:t,values:[e.rootObject],objectFormats:this.rootObjectFormats,includesHash:!0}),t.toBuffer()}},{key:"serializeUsers",value:function(e,t){var n=[this.serialization.format.anyObjectFormat];e.writeUint32(t.length);var r,i=E(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.writeUint32(a.userId),e.writeUint32(a.nextFrameId),e.writeString(a.session),this.serialization.serialize({writer:e,values:[a.payload],objectFormats:n,includesHash:!0})}}catch(e){i.e(e)}finally{i.f()}}},{key:"deserializeSnapshotFrame",value:function(e,t,n){var r,i=new Ht(e),a=this.deserializeFrameHeader(i);r=t!==Ct.V0?this.deserializeUsers(i,t,n):function(e){var t=e.readInt32();e.readInt32();for(var n=[],r=0;r<t;++r){var i=e.readUint32();n.push({userId:i,nextFrameId:0,session:"",payload:void 0})}return n}(i);var o=h(this.serialization.deserialize({reader:i,objectFormats:this.rootObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Dn(jn({},a),{users:r,rootObject:o})}},{key:"deserializeUsers",value:function(e,t,n){for(var r=e.readUint32(),i=[],a=[this.serialization.format.anyObjectFormat],o=0;o<r;++o){var s=e.readUint32(),c=e.readUint32(),u=e.readString(),l=h(this.serialization.deserialize({reader:e,objectFormats:a,ignoreHashChecking:n,version:t}),1)[0];i.push({userId:s,nextFrameId:c,session:u,payload:l})}return Object.freeze(i)}},{key:"serializeActionFrame",value:function(e,t){var n=new At;if(this.serializeFrameHeader(n,e),n.writeUint8(e.type),n.writeInt53(e.scopeId),n.writeInt53(e.beginObjectId),zn(e)){n.writeUint32(e.methodId);var r=this.rootClassReflection.methodNames[e.methodId],i=this.rootClassReflection.methods[r].parameterFormatObjects;this.serialization.serialize({writer:n,values:e.parameters,objectFormats:i,includesHash:t})}else Fn(e)?(n.writeUint8(e.scope),n.writeString(e.event),this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t})):Bn(e)?(n.writeString(e.session),this.serialization.serialize({writer:n,values:[e.userPayload,e.connectedPayload],objectFormats:this.twoAnyObjectFormats,includesHash:t})):Un(e)&&this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t});return n.toBuffer()}},{key:"deserializeActionFrame",value:function(e,t,n){var r,i=new Ht(e),a=this.deserializeFrameHeader(i),o=i.readUint8(),s=0,c=0;switch(t!==Ct.V0&&(s=i.readInt53(),c=i.readInt53()),o){case Pn.Invoker:var u=i.readUint32(),l=this.rootClassReflection.methodNames[u],d=this.rootClassReflection.methods[l].parameterFormatObjects,p=this.serialization.deserialize({reader:i,objectFormats:d,ignoreHashChecking:n,version:t});return t===Ct.V0&&(r=i.readBigInt()),Dn(jn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,methodId:u,parameters:p});case Pn.Event:var f=i.readUint8(),v=i.readString(),m=h(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return t===Ct.V0&&(r=i.readBigInt()),Dn(jn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,scope:f,event:v,payload:m});case Pn.Ack:return Dn(jn({},a),{type:o,scopeId:s,beginObjectId:c});case Pn.Enter:var g=i.readString(),y=h(this.serialization.deserialize({reader:i,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:n,version:t}),2),b=y[0],k=y[1];return Dn(jn({},a),{type:o,scopeId:s,beginObjectId:c,session:g,userPayload:b,connectedPayload:k});case Pn.Leave:var w=h(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Dn(jn({},a),{type:o,scopeId:s,beginObjectId:c,payload:w});default:throw new Error("invalid type ".concat(o))}}},{key:"serializeFrameHeader",value:function(e,t){e.writeUint32(t.frameId),e.writeUint32(t.originalFrameId),e.writeInt53(t.timestamp),e.writeUint32(t.authorId)}},{key:"deserializeFrameHeader",value:function(e){return{frameId:e.readUint32(),originalFrameId:e.readUint32(),timestamp:e.readInt53(),authorId:e.readUint32()}}}]),e}(),Wn=Math.pow(2,32);Math.pow(2,16);function Hn(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*Wn+n}function _n(e){for(var t=new Ht(e),n=new At,r=0;r<20;++r)n.writeUint8(t.readUint8());return n.writeUint8(Pn.Ack),n.toBuffer()}var Gn=function(){function e(t){if(M(this,e),t.byteLength<20)throw new Error("Buffer is to short");this.frameBuffer=t}return O(e,[{key:"frameId",get:function(){return this.frameBuffer.getUint32(0)},set:function(e){this.frameBuffer.setUint32(0,e)}},{key:"originalFrameId",get:function(){return this.frameBuffer.getUint32(4)},set:function(e){this.frameBuffer.setUint32(4,e)}},{key:"timestamp",get:function(){return Hn(this.frameBuffer,8)},set:function(e){var t=0|e,n=(e-t)/Wn;this.frameBuffer.setInt32(8,t),this.frameBuffer.setInt32(12,n)}},{key:"authorId",get:function(){return this.frameBuffer.getUint32(16)},set:function(e){this.frameBuffer.setUint32(16,e)}},{key:"type",get:function(){return this.frameBuffer.getUint8(20)}},{key:"scopeId",get:function(){return Hn(this.frameBuffer,21)}},{key:"beginObjectId",get:function(){return Hn(this.frameBuffer,29)}},{key:"scope",get:function(){return this.frameBuffer.getUint8(37)}},{key:"fetchEventContent",value:function(){var e=new Ht(this.frameBuffer);if(e.skipBytes(37),this.type===Pn.Event){var t=e.readUint8();return{event:e.readString(),scope:t}}}}]),e}(),Yn=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.call(this)}return O(n,[{key:"createObject",value:function(e,t){var r=l(S(n.prototype),"createObject",this).call(this,e,t);return n.objectsCollection&&n.objectsCollection.push(r),r}}],[{key:"startCollection",value:function(){this.objectsCollection=[]}},{key:"completeCollection",value:function(){try{if(!this.objectsCollection)return[];var e,t=E(this.objectsCollection);try{for(t.s();!(e=t.n()).done;){delete e.value.__identifier}}catch(e){t.e(e)}finally{t.f()}return this.objectsCollection}finally{this.objectsCollection=void 0}}}]),n}(ut);function Xn(e,t){return new Vn(e,t)}Yn.objectsCollection=void 0;var Qn,Zn=function(){function e(){M(this,e),this.listeners=[]}return O(e,[{key:"currentNode",get:function(){return this._currentNode}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"runWith",value:function(e,t){var n=this._currentNode;this._currentNode=e,this.dispatch(e,!0);try{return t()}finally{this._currentNode=n,this.dispatch(e,!1),n&&this.dispatch(n,!0)}}},{key:"dispatch",value:function(e,t){var n,r=E(this.listeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i(e,t)}catch(e){console.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}();!function(e){e[e.SingleForward=0]="SingleForward",e[e.DoubleForward=1]="DoubleForward"}(Qn||(Qn={}));var Kn,qn,Jn,$n=new Zn;!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.Displayer=3]="Displayer"}(Kn||(Kn={})),function(e){e[e.Uncommitted=0]="Uncommitted",e[e.Committed=1]="Committed",e[e.Rejected=2]="Rejected"}(qn||(qn={})),function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(Jn||(Jn={}));var er=function(){function e(t){M(this,e),this.operator=t,this.floatObjects={}}return O(e,[{key:"collectValue",value:function(e){var t=this;if("object"==R(e)&&null!==e){var n=this.operator.identifier(e);return n in this.floatObjects||(this.floatObjects[n]=e,this.operator.forEach(e,(function(e){t.collectValue(e)}))),n}}}]),e}(),tr=function e(){M(this,e)};function nr(e){return e instanceof tr}function rr(e){var t=function(e,t,n){return n};return Object.setPrototypeOf(t,tr.prototype),Object.defineProperty(t,"payload",{enumerable:!0,configurable:!1,writable:!1,value:e}),t}var ir,ar,or=rr(null),sr=rr(null),cr=function e(t){var n=this;M(this,e),this.filters=[],this.filter=function(e,t,r){var i,a=E(n.filters);try{for(a.s();!(i=a.n()).done;){if((0,i.value)(e,t,r))return!0}}catch(e){a.e(e)}finally{a.f()}return!1};var r,i=[],a=E(t);try{var o=function(){var e=r.value,t=void 0;if("function"==typeof e)t=e;else if("string"==typeof e)t=function(t){return t===e};else{if(!(e instanceof RegExp))throw new Error("unrecognized condition "+e);t=function(t){return e.test(t)}}i.push(t)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.filters=Object.freeze(i)};function ur(e,t){return{event:e.event,payload:e.payload,authorId:e.authorId,scope:lr(e.scope),phase:t}}function lr(e){switch(e){case Mn.System:return ir.System;case Mn.App:return ir.App;case Mn.Custom:return ir.Custom;default:return ir.Magix}}!function(e){e.System="system",e.App="app",e.Custom="custom",e.Magix="magix"}(ir||(ir={})),function(e){e.Dispatched="dispatched",e.Updated="updated",e.Canceled="canceled"}(ar||(ar={}));var hr=function e(t){M(this,e),this.eventFilter=new cr(t).filter};function dr(e){return"object"==R(e)&&null!==e&&e instanceof hr}function pr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return rr(new hr(t))}var fr="__reflection",vr=function(){function e(t,n,r,i){M(this,e),this.isRootClass=n,this.id=r.classId,this.name=r.clazz.name,this.clazz=r.clazz,this.superClass=r.superClass,this.objectFormat=t.findObjectFormat(r.objectFormatId);for(var a={},o={},s=[r].concat(C(i)),c=s.length-1;c>=0;--c){var u,l=s[c],h=l.clazz,d=E(l.members);try{for(d.s();!(u=d.n()).done;){var p=u.value;Be(p)?a[p.name]=this.createProperty(p,h,this.objectFormat):Ue(p)&&(o[p.name]=this.createMethod(p,h,t))}}catch(e){d.e(e)}finally{d.f()}}this.properties=Object.freeze(a),this.methods=Object.freeze(o),this.methodNames=Object.freeze(Object.keys(this.methods))}return O(e,[{key:"createProperty",value:function(e,t,n){var r=e.decorators.some((function(e){return e===or}));return Object.freeze({name:e.name,mode:e.mode,belongsClass:t,isTransient:r,isPublic:e.isPublic,objectFormat:n.properties[e.name],decorators:e.decorators})}},{key:"createMethod",value:function(e,t,n){var r,i=e.name,a=e.parameters,o=e.decorators,s=[],c=E(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(n.findObjectFormat(u))}}catch(e){c.e(e)}finally{c.f()}return Object.freeze({name:i,belongsClass:t,isPublic:e.isPublic,parameterFormatObjects:Object.freeze(s),decorators:Object.freeze(C(o))})}}]),e}(),mr=function(e){m(n,e);var t=y(n);function n(e,r,i,a,o){var s;return M(this,n),(s=t.call(this,(function(e,t,n,r){return s.handleDecorateObject(e,t,n,r)}))).decorateObjectEnums=Object.freeze([rt.Object,rt.Array]),s.proxyRuntime=e,s.idGenerator=i,s.covertIdToClass=r,s.toOverrideObjects=a,s.overrideNodeCatcher=o,s}return O(n,[{key:"createObject",value:function(e,t){if(t===rt.HangUpObject)throw new kt("not support hang up object: ".concat(e));return l(S(n.prototype),"createObject",this).call(this,e,t)}},{key:"handleDecorateObject",value:function(e,t,n,r){var i=e.__identifier,a=this.proxyRuntime.objectOperator,o=this.getClassReflection(t,r),s=this.toOverrideObjects[i];if(!s||!this.isTypeMatch(s,t))switch(t){case nt.Array:s=a.createObject(this.idGenerator.generate(),[]);break;case nt.DeducedObject:s=a.createObject(this.idGenerator.generate(),{});break;case nt.AssertedObject:Object.setPrototypeOf(e,o.clazz.prototype),s=a.createObject(this.idGenerator.generate(),e);break;default:throw new kt("invalid ObjectType ".concat(t))}var c,u=E(n);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.object[l.key]=s}}catch(e){u.e(e)}finally{u.f()}this.overrideNodeCatcher(s,e,o)}},{key:"isTypeMatch",value:function(e,t){switch(this.proxyRuntime.objectOperator.kind(e)){case Kn.Array:return t===nt.Array;case Kn.FlatObject:return t===nt.DeducedObject;case Kn.AkkoObject:return t===nt.AssertedObject;default:return!1}}},{key:"getClassReflection",value:function(e,t){if(e===nt.AssertedObject){if(!t)throw new kt("expect object format");var n=this.covertIdToClass(t.id);if(!n)throw new kt("can't find class by object format id ".concat(t.id));return n[fr]}return null}}]),n}(ut),gr=function(){function e(t){var n=this;M(this,e),this.assertObjectFormat=function(e){var t=n.proxyRuntime.objectOperator.getClassReflection(e);if(t)return t.objectFormat};var r=new er(t.proxyRuntime.objectOperator);this.format=t.format,this.snapshotObjectFormats=t.snapshotObjectFormats,this.idGenerator=t.idGenerator,this.proxyRuntime=t.proxyRuntime,this.covertIdToClass=t.covertIdToClass,r.collectValue(t.rootObject),this.floatObjects=r.floatObjects}return O(e,[{key:"recoverFrom",value:function(t,n){for(var r,i=[],a=new mr(this.proxyRuntime,this.covertIdToClass,this.idGenerator,this.floatObjects,(function(e,t,n){return i.push({object:e,tempObject:t,classReflection:n})})),o=!n,s=h(new Ot({format:this.format,objectAdapter:a,assertObjectFormat:this.assertObjectFormat}).deserialize({reader:t,objectFormats:this.snapshotObjectFormats,ignoreHashChecking:o,version:e.akkoSerVersion}),1)[0],c=0,u=i;c<u.length;c++){var l=u[c],d=l.object,p=l.tempObject,f=l.classReflection;this.proxyRuntime.objectOperator.override(d,p,f),p===s&&(r=d)}return r}}]),e}();gr.akkoSerVersion=Tt(Ge);var yr,br=null,kr=null;$n.addListener((function(e,t){t&&e.tools?(yr=e.coreFunctions,kr=e.tools.idGenerator,br=e.proxyRuntime):(yr=null,kr=null,br=null)}));var wr,Sr,xr=function(){function e(t,n){M(this,e),this.format=n.format,this.covertIdToClass=n.covertObjectFormatIdToClass,this.description=Object.freeze({roomUUID:t,appIdentifier:n.appIdentifier,appVersion:n.appVersion,appHash:n.appHash,akkoVersion:n.akkoVersion})}return O(e,[{key:"createSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!$n.currentNode)throw new Error("can't call createSnapshot out of Magix");var n=yr.wrapper(e),r=new At,i=this.readObjectFormatWith(n),a=t;return r.writeUint8(t?255:0),t&&(r.writeString(this.description.roomUUID),r.writeString(this.description.appIdentifier),r.writeString(this.description.appVersion),r.writeString(this.description.appHash),r.writeString(this.description.akkoVersion)),r.writeUint32(i.id),br.frameHandler.createSerialization(this.format).serialize({writer:r,values:[n],objectFormats:[i],includesHash:a}),r.toBuffer().freeze()}},{key:"recoverWithSnapshot",value:function(e,t){if(!$n.currentNode)throw new Error("can't call recoverWithSnapshot out of Magix");var n=yr.wrapper(t),r=new Ht(e),i=this.readDescription(r),a=r.readUint32();if(n&&this.readObjectFormatWith(n).id!==a)throw new Error("target's class isn't matching");var o=this.format.findObjectFormat(a),s=this.shouldOverrideTarget(i)?n:void 0;return new gr({rootObject:s,format:this.format,snapshotObjectFormats:[o],idGenerator:kr,proxyRuntime:br,covertIdToClass:this.covertIdToClass}).recoverFrom(r,void 0!==i)}},{key:"readObjectFormatWith",value:function(e){var t=br.objectOperator;if(t.kind(e)!==Kn.AkkoObject)throw new Error("can't only create snapshot of AkkoObject");return t.getClassReflection(e).objectFormat}},{key:"readDescription",value:function(e){if(e.readUint8()){var t=e.readString(),n=e.readString(),r=e.readString(),i=e.readString(),a=e.readString();if(n!==this.description.appIdentifier)throw new Error("invalid snapshot: appIdentifier not matches");if(r!==this.description.appVersion)throw new Error("invalid snapshot: appVersion not matches");if(i!==this.description.appHash)throw new Error("invalid snapshot: appHash not matches");if(a!==this.description.akkoVersion)throw new Error("invalid snapshot: akkoVersion not matches");return{roomUUID:t,appIdentifier:n,appVersion:r,appHash:i,akkoVersion:a}}}},{key:"shouldOverrideTarget",value:function(e){return!e||e.roomUUID===this.description.roomUUID}}]),e}();function Ir(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new xr(t,e)}function Cr(){if(!wr)throw new Error("you can not call this function out of Magix");return wr.resource}$n.addListener((function(e,t){wr=t&&e.tools?e.tools.extra:void 0})),function(e){e.Real="real",e.Illusion="illusion",e.NoEffects="noEffects"}(Sr||(Sr={}));var Pr=function(){function e(t){M(this,e),this.atob=t}return O(e,[{key:"parse",value:function(e){for(var t=new String(this.atob(e)),n=Ie(t.length),r=0;r<t.length;++r)n.setUint8(r,t.charCodeAt(r));return n}}]),e}();function Mr(e){var t={},n=function(n){var r=e[n];t[n]="function"==typeof r?function(){var e;try{for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];e=r.apply(t,i)}catch(e){console.error(e)}return e}:r};for(var r in e)n(r);return Object.freeze(t)}var Tr="__identifier";function Or(e,t){Object.defineProperty(e,Tr,{enumerable:!1,configurable:!0,value:t})}var Er,Ar,Nr,Rr,Lr,jr,Dr,zr,Fr,Br,Ur,Vr=function(){function e(t,n){M(this,e),this.foundObjects=[],this.idGenerator=t,this.operator=n}return O(e,[{key:"complete",value:function(){var e,t=E(this.foundObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[Tr]}}catch(e){t.e(e)}finally{t.f()}}},{key:"bind",value:function(e){if("object"!=R(e)||null===e||Pe(e))return e;if(this.operator.isDisplayerObject(e))return this.operator.copyDisplayer(e);if(e.constructor===Array)return this.bindArray(e);if(e.constructor===Object)return this.bindObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function(e){var t=e[Tr];void 0===t&&(Or(e,t=this.idGenerator.generate()),this.foundObjects.push(e));for(var n=0;n<e.length;++n)this.bind(e[n])}},{key:"bindObject",value:function(e){var t=e[Tr];for(var n in void 0===t&&(Or(e,t=this.idGenerator.generate()),this.foundObjects.push(e)),e)this.bind(e[n])}}]),e}(),Wr=function(){function e(t){M(this,e),this._phase=t.phase||t.getCurrentPhase(),this.getCurrentPhase=t.getCurrentPhase,this.onPhaseChanged=t.onPhaseChanged}return O(e,[{key:"phase",get:function(){return this._phase}},{key:"touch",value:function(){var e=this.getCurrentPhase(),t=this._phase;t!==e&&(this._phase=e,this.onPhaseChanged&&this.onPhaseChanged(e,t))}}]),e}(),Hr=function(){function e(t,n){var r=this;M(this,e),this.paddingPayloadList=null,this.callback=function(e){if(r.paddingPayloadList)r.paddingPayloadList.push(e);else try{r._callback(e)}catch(e){r.logger.error(e)}},this.logger=t,this._callback=n}return O(e,[{key:"isPadding",get:function(){return!!this.paddingPayloadList},set:function(e){if(this.isPadding!==e)if(e)this.paddingPayloadList=[];else{var t,n=E(this.paddingPayloadList);try{for(n.s();!(t=n.n()).done;){var r=t.value;try{this._callback(r)}catch(e){this.logger.error(e)}}}catch(e){n.e(e)}finally{n.f()}this.paddingPayloadList=null}}}]),e}(),_r=function(){function e(t){M(this,e),this.base64Parser=new Pr(t)}return O(e,[{key:"create",value:function(e){if(!this.isSupportedAkkoVersion(e.akkoVersion))throw new Te("can not support library (built by akko ".concat(e.akkoVersion,")"));var t=this.createFormat(e.formatBase64),n=this.createClassReflections(t,e.rootConstructor,e.classDeclarations),r=this.createObjectFormatToClassMap(n);return new Gr(e.appIdentifier,e.appVersion,e.formatHash,e.akkoVersion,e.rootConstructor,(function(e){return r[e]}),t,n)}},{key:"isSupportedAkkoVersion",value:function(e){var t=Ge.split("."),n=e.split(".");return!(n.length<2||t[0]!==n[0]||t[1]!==n[1])&&(!(t.length>=3)||t[2]>=n[2])}},{key:"createFormat",value:function(e){var t=new en,n=this.base64Parser.parse(e);return t.createWithBuffer(n)}},{key:"createClassReflections",value:function(e,t,n){var r={};for(var i in n){var a=n[i],o=a.clazz,s=o===t,c=u(this.searchThisAndSuperClassDeclarations(a,n)),l=c[0],h=c.slice(1),d=new vr(e,s,l,h);if(void 0!==Object.getOwnPropertyDescriptor(o,fr))throw new Te("class ".concat(o.name,' has defined  reserved word static property "').concat(fr));Object.defineProperty(o,fr,{value:d,writable:!1,configurable:!1}),r[i]=d}return Object.freeze(r)}},{key:"createObjectFormatToClassMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.objectFormat.id]=r.clazz}return Object.freeze(t)}},{key:"searchThisAndSuperClassDeclarations",value:function(e,t){for(var n=[],r=e;n.push(r),r.superClass&&r.superClass!==Object;)r=this.findClassDeclarationsWithConstructor(r.superClass,t);return n}},{key:"findClassDeclarationsWithConstructor",value:function(e,t){for(var n in t){var r=t[n];if(r.clazz===e)return r}throw new Te("can not find superClass")}}]),e}(),Gr=function(){function e(t,n,r,i,a,o,s,c){M(this,e),this.appIdentifier=t,this.appVersion=n,this.appHash=r,this.akkoVersion=i,this.rootClass=a,this.covertObjectFormatIdToClass=o,this.format=s,this.classReflections=c}return O(e,[{key:"classReflection",value:function(e){var t=this.classReflections[e];if(!t)throw new Error("can't find class with id ".concat(e));return t}}]),e}();function Yr(e){Er=e.creator,Ar=e.updater,Nr=e.wrapper,Rr=e.unwrapper,Lr=e.jsxUnwrapper,jr=e.getter,Dr=e.setter,zr=e.caller,Fr=e.remover,Br=e.prefix,Ur=e.postfix}var Xr,Qr,Zr=Object.freeze({creator:function(e){return e},updater:function(e){return e},wrapper:function(e){return e},unwrapper:function(e){return e},jsxUnwrapper:function(e){return e},getter:function(e,t){return e[t]},setter:function(e,t,n){return e[t]=n},caller:function(e,t,n,r){return(r||e)[t].apply(e,n)},remover:function(e,t){return delete e[t]},prefix:function(e,t,n){return e[t]+=n},postfix:function(e,t,n){var r=e[t];return e[t]+=n,r}});function Kr(){if(!Xr){var e=this.constructor&&this.constructor.name;throw e?new Error("can't construct ".concat(e," out of Magix, it's an AkkoObject")):new Error("can't construct an AkkoObject out of Magix")}Xr(this)}Yr(Zr),$n.addListener((function(e,t){Yr(t?e.coreFunctions:Zr)})),$n.addListener((function(e,t){Xr=t?e.coreFunctions.creator:void 0})),Object.setPrototypeOf(Kr.prototype,Object.prototype),$n.addListener((function(e,t){Qr=t?e.proxyRuntime.objectOperator:void 0}));var qr=function(){var e=new _r(rn.default.bind(null));return new Fe({akkoVersion:Ge,akkoObjectBaseClass:Kr,libraryFactory:e.create.bind(e),coreFunctions:{creator:function(e){return Er(e)},updater:function(e){return Ar(e)},wrapper:function(e){return Nr(e)},unwrapper:function(e){return Rr(e)},jsxUnwrapper:function(e){return Lr(e)},getter:function(e,t){return jr(e,t)},setter:function(e,t,n){return Dr(e,t,n)},caller:function(e,t,n,r){return zr(e,t,n,r)},remover:function(e,t){return Fr(e,t)},prefix:function(e,t,n){return Br(e,t,n)},postfix:function(e,t,n){return Ur(e,t,n)}}})}();var Jr,$r,ei,ti,ni=qr.context,ri=qr.getLibrary;function ii(e){if(!Qr)throw new Error("can't call isAkkoObject out of Magix");return Qr.isValidObject(e)||qr.isAkkoObject(e)}function ai(e){if("function"==typeof e){var t=e[fr];if("object"==R(t)&&null!==t)return t}else if(qr.isAkkoObject(e))return ai(e.constructor)}function oi(){if(!Jr)throw fi();return Jr.environment}function si(){if(!Jr)throw fi();return Jr.timestamp}function ci(){if(!Jr)throw fi();return Jr.functions.getAuthorId()}function ui(e){if(!Jr)throw fi();return Jr.functions.hasUser(e)}function li(){if(!Jr)throw fi();return Jr.functions.getUsersCount()}function hi(e){if(!Jr)throw fi();return Jr.functions.getUser(e)}function di(){if(!Jr)throw fi();return Jr.functions.getUserIds()}function pi(){if(!Jr)throw fi();return Jr.snapshot}function fi(){return new Error("you can not call this function out of Magix")}function vi(e){for(var t=new Ht(e),n=t.readUint32(),r=[],i=t.readUint32(),a=0;a<i;++a){var o=t.readInt53(),s=t.readUint32();r.push(Object.freeze({beginScopeId:o,count:s}))}return Object.freeze({userId:n,initializeSlices:Object.freeze(r)})}$n.addListener((function(e,t){Jr=t&&e.tools?e.tools:void 0})),function(e){e.RoomDelete="roomDelete",e.RoomZombie="roomZombie",e.RoomBan="roomBan",e.GatewayAdjust="GatewayAdjust",e.KickByAdmin="kickByAdmin",e.ReplaceByOther="replaceByOther",e.Crash="crash"}($r||($r={})),function(e){e[e.Inserted=0]="Inserted",e[e.Updated=1]="Updated",e[e.Removed=2]="Removed"}(ei||(ei={})),function(e){e[e.Readonly=0]="Readonly",e[e.Writable=1]="Writable"}(ti||(ti={}));var mi=function(){function e(t,n){M(this,e);var r=n.format.anyObjectFormat;this.serialization=new Ot({format:n.format,objectAdapter:new Yn}),this.objectOperator=t,this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return O(e,[{key:"serialize",value:function(e){var t=new At,n=mt(-1),r=new Vr(n,this.objectOperator);t.writeUint8(e.kind);try{switch(e.kind){case ti.Writable:var i=e.userPayload,a=e.connectedPayload;r.bind(i),r.bind(a),this.serialization.serialize({writer:t,values:[i,a],objectFormats:this.twoAnyObjectFormats,includesHash:!1});break;case ti.Readonly:var o=e.payload;r.bind(o),this.serialization.serialize({writer:t,values:[o],objectFormats:this.oneAnyObjectFormats,includesHash:!1})}return t.toBuffer()}finally{r.complete()}}},{key:"deserialize",value:function(t){try{Yn.startCollection();var n=new Ht(t),r=n.readUint8();switch(r){case ti.Writable:var i=h(this.serialization.deserialize({reader:n,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),2);return{kind:r,userPayload:i[0],connectedPayload:i[1]};case ti.Readonly:return{kind:r,payload:h(this.serialization.deserialize({reader:n,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),1)[0]};default:throw new Error("invalid kind ".concat(r))}}finally{Yn.completeCollection()}}}]),e}();mi.akkoSerVersion=Tt(Ge);var gi=function(){function e(){M(this,e)}return O(e,[{key:"serialize",value:function(e){var t=new At;return t.writeString(e.libIdentifier),t.writeString(e.appIdentifier),t.writeString(e.appVersion),t.writeString(e.appHash),t.toBuffer()}},{key:"deserialize",value:function(e){var t=new Ht(e);return{libIdentifier:t.readString(),appIdentifier:t.readString(),appVersion:t.readString(),appHash:t.readString()}}}]),e}();function yi(e){return function(e){var t=new At;return t.writeUint32(e.id),t.writeInt53(e.timestamp),t.toBuffer()}(e)}function bi(e){return function(e){var t=new Ht(e),n=t.readUint32(),r=t.readInt53();return Object.freeze({id:n,timestamp:r})}(e)}var ki=function(){function e(t){if(M(this,e),this.storageSlices=[],this.usingSlice=void 0,this.nextScopeId=0,t){var n,r=E(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.appendScopeSlice(i)}}catch(e){r.e(e)}finally{r.f()}}}return O(e,[{key:"allocScopeId",value:function(){if(this.usingSlice){var e=this.nextScopeId;return e===this.usingSlice.beginScopeId+this.usingSlice.count-1?(this.usingSlice=this.storageSlices.shift(),this.usingSlice&&(this.nextScopeId=this.usingSlice.beginScopeId)):this.nextScopeId+=1,e}}},{key:"appendScopeSlice",value:function(e){this.usingSlice?this.storageSlices.push(e):(this.usingSlice=e,this.nextScopeId=e.beginScopeId)}}]),e}();var wi,Si=new Cn(["error","snapshot","action","chunk","session-build","update-online","allocate-user","release-user","allocate-scope","update-access","ban-access","hang-up","library-description","ping","pong"]);!function(e){e[e.Undefined=0]="Undefined",e[e.NoUserToRelease=1]="NoUserToRelease",e[e.WritableAccessForbidden=2]="WritableAccessForbidden",e[e.StuffedOfWritableUsers=3]="StuffedOfWritableUsers",e[e.WrongWritablePhase=4]="WrongWritablePhase"}(wi||(wi={}));var xi=function(){function e(t,n,r){M(this,e),this.nextFrameId=0,this.userId=t,this.scopeStorage=n,this.nextFrameId=r}return O(e,[{key:"createFrameId",value:function(){var e=this.nextFrameId;return this.nextFrameId+=1,e}},{key:"appendScopeSlices",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.scopeStorage.appendScopeSlice(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"allocateIdentifierGenerator",value:function(){var e=this.scopeStorage.allocScopeId();if(void 0===e)throw new Te("run out of scope ID");return mt(e)}}]),e}(),Ii=function(){function e(t,n,r,i){M(this,e),this.objectOperator=n,this.proxyFrameHandler=r,this.deserializerVersion=i;var a=ai(t.rootClass),o=new Ot({format:t.format,objectAdapter:new Yn});this.flatFrameSerialization=Xn(o,a)}return O(e,[{key:"deserialize",value:function(e,t){var n,r;try{Yn.startCollection(),n=this.flatFrameSerialization.deserializeActionFrame(e,this.deserializerVersion,t)}finally{r=Yn.completeCollection()}var i,a=E(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;Object.freeze(o)}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"serialize",value:function(e,t,n){var r=new Vr(e,this.objectOperator);try{this.replaceWithBindsActionFrame(r,t);var i=Dn(jn({},t),{beginObjectId:e.createdCount});return this.flatFrameSerialization.serializeActionFrame(i,n)}finally{r.complete()}}},{key:"getIllusionFrameResult",value:function(e){return{frameBuffer:e,illusionFrame:this.proxyFrameHandler.deserializeActionFrame(e,this.deserializerVersion,!0)}}},{key:"replaceWithBindsActionFrame",value:function(e,t){if(Fn(t))e.bind(t.payload);else if(zn(t)){var n,r=E(t.parameters);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.bind(i)}}catch(e){r.e(e)}finally{r.f()}}else Bn(t)?(e.bind(t.userPayload),e.bind(t.connectedPayload)):Un(t)&&e.bind(t.payload)}}]),e}(),Ci=function(){function e(t,n){if(M(this,e),this.users={},this._usersCount=0,this.paddingImageCreatingTask=null,this.proxyRuntime=t,n){var r,i=E(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.users[a.userId]={userId:a.userId,nextFrameId:a.nextFrameId,session:a.session,payload:a.payload},this._usersCount+=1}}catch(e){i.e(e)}finally{i.f()}}else this.users[nn]={userId:nn,nextFrameId:0,session:"",payload:void 0},this._usersCount+=1}return O(e,[{key:"hasUser",value:function(e){return e in this.users}},{key:"userIds",get:function(){var e=[];for(var t in this.users)e.push(parseInt(t,10));return e.sort()}},{key:"usersCount",get:function(){return this._usersCount}},{key:"user",value:function(e,t){var n=this.users[e];if(n){var r=n.payload;return t||(r=this.proxyRuntime.objectOperator.wrapDisplayer(this.proxyRuntime,r)),{userId:e,session:n.session,payload:r}}}},{key:"snapshotUsers",value:function(){var e,t=[],n=E(this.userIds);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.users[r];t.push({userId:r,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"createImageAuthor",value:function(e){var t=this,n=e.userId,r=this.users[n];if(r){var i=new ki(e.initializeSlices),a=new xi(e.userId,i,r.nextFrameId);return Promise.resolve(a)}return new Promise((function(n){t.paddingImageCreatingTask={allocatedUser:e,resolve:n}}))}},{key:"cancelImageAuthorCreating",value:function(){this.paddingImageCreatingTask&&(this.paddingImageCreatingTask.resolve(null),this.paddingImageCreatingTask=null)}},{key:"updateUserNextFrameId",value:function(e,t){var n=this.users[e];n&&(n.nextFrameId=t)}},{key:"userEnter",value:function(e,t,n,r){if(e in this.users||(this._usersCount+=1),this.users[e]={userId:e,nextFrameId:t,session:n,payload:r},this.paddingImageCreatingTask){var i=this.paddingImageCreatingTask.allocatedUser,a=i.userId,o=i.initializeSlices;if(a===e){var s=new ki(o),c=new xi(e,s,t);this.paddingImageCreatingTask.resolve(c),this.paddingImageCreatingTask=null}}this.proxyRuntime.reportUsersChanged(this._usersCount)}},{key:"userLeave",value:function(e){e in this.users&&(this._usersCount-=1,delete this.users[e]),this.proxyRuntime.reportUsersChanged(this._usersCount)}}]),e}(),Pi=function(){function e(t,n,r){M(this,e),this.author=t,this.actionFrameHelper=n,this.includesFrameHash=r}return O(e,[{key:"appendScopeSlices",value:function(e){this.author.appendScopeSlices(e)}},{key:"createIllusionEventFrame",value:function(e,t,n,r){var i=this.createEventFrame(e,t,n,r);return this.actionFrameHelper.getIllusionFrameResult(i)}},{key:"createIllusionInvokerFrame",value:function(e,t,n,r){var i=this.createInvokerFrame(e,t,n,r);return this.actionFrameHelper.getIllusionFrameResult(i)}},{key:"createEventFrame",value:function(e,t,n,r){var i=this.author.createFrameId(),a={frameId:i,originalFrameId:i,timestamp:n,authorId:this.author.userId,type:Pn.Event,scopeId:r.scopeId,beginObjectId:0,event:e,payload:t,scope:Mn.Custom};return this.actionFrameHelper.serialize(r,a,this.includesFrameHash)}},{key:"createInvokerFrame",value:function(e,t,n,r){var i=this.author.createFrameId(),a={frameId:i,originalFrameId:i,timestamp:n,authorId:this.author.userId,type:Pn.Invoker,scopeId:r.scopeId,beginObjectId:0,methodId:e,parameters:t};return this.actionFrameHelper.serialize(r,a,this.includesFrameHash)}}]),e}(),Mi=function(){function e(t){M(this,e),this.didCompleteInit=!1,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.onEventFire=t.onEventFire,this.onCatchErrorWhenAppendFrame=t.onCatchErrorWhenAppendFrame;var n=ai(t.library.rootClass),r=[],i={},a={};for(var o in n.methods){var s=n.methods[o],c=e.findEventPayloadWithDecorators(s.decorators);c&&r.push(Object.freeze({filter:c.eventFilter,method:o})),a[o]=e.findNoEffectsWithDecorators(s.decorators)}for(var u=0;u<n.methodNames.length;++u)i[n.methodNames[u]]=u;this.methodNames=n.methodNames,this.methodNameToIdMap=Object.freeze(i),this.eventHandlers=Object.freeze(r),this.noEffectsMethods=Object.freeze(a)}return O(e,[{key:"completeInit",value:function(){this.didCompleteInit=!0}},{key:"methodNameToId",value:function(e){return this.methodNameToIdMap[e]}},{key:"isNoEffectMethod",value:function(e){return this.noEffectsMethods[e]}},{key:"dispatch",value:function(e,t){var n,r=this.proxyRuntime.rootObject.target,i=Mn.Custom,a=E(this.eventHandlers);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.filter,c=o.method;s(e,t,i)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(r,[e,t,i])}}catch(e){a.e(e)}finally{a.f()}}},{key:"invoke",value:function(e,t){var n=this.proxyRuntime.rootObject.target;return this.proxyRuntime.rootObject.getRootMethod(e).apply(n,t)}},{key:"appendAction",value:function(e,t){var n=this;(t.mode===Jn.Real||t.mode===Jn.RealAck)&&this.imageUsers.updateUserNextFrameId(e.authorId,e.originalFrameId+1);var r=!this.isForcesOnIllusionLine(t.mode);try{var i;return this.proxyRuntime.block.runWithMagix(t,(function(){zn(e)?i=n.invokeActionFrame(e):Fn(e)?n.handleEventActionFrame(e):Bn(e)?n.handleEnterActionFrame(e):Un(e)&&n.handleLeaveActionFrame(e)})),i}catch(i){return void(this.onCatchErrorWhenAppendFrame&&this.onCatchErrorWhenAppendFrame(e.authorId,i))}finally{r&&(this.frameId=e.frameId,this.timestamp=e.timestamp),this.onEventFire&&this.dispatchEventIfNeed(e,this.proxyRuntime.rootObject.observerId,this.onEventFire)}}},{key:"invokeActionFrame",value:function(e){var t=e.methodId,n=e.parameters,r=this.proxyRuntime.rootObject.target,i=this.methodNames[t];return this.proxyRuntime.rootObject.getRootMethod(i).apply(r,n)}},{key:"handleEventActionFrame",value:function(e){if(void 0!==e.beginGenerationId&&e.scope===Mn.System)switch(e.event){case"Enter":var t=e.authorId,n=e.originalFrameId+1;this.imageUsers.userEnter(t,n,"",void 0);break;case"Leave":this.imageUsers.userLeave(e.authorId)}this.invokeEventCallbacks(e.event,e.payload,e.scope)}},{key:"handleEnterActionFrame",value:function(e){var t=e.authorId,n=e.originalFrameId+1,r=e.session,i=e.userPayload;this.imageUsers.userEnter(t,n,r,i),this.invokeEventCallbacks("Enter",e.connectedPayload,Mn.System)}},{key:"handleLeaveActionFrame",value:function(e){var t=e.authorId,n=e.payload;this.imageUsers.userLeave(t),this.invokeEventCallbacks("Leave",n,Mn.System)}},{key:"invokeEventCallbacks",value:function(e,t,n){var r,i=this.proxyRuntime.rootObject.target,a=E(this.eventHandlers);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.filter,c=o.method;s(e,t,n)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(i,[e,t,n])}}catch(e){a.e(e)}finally{a.f()}}},{key:"dispatchEventIfNeed",value:function(e,t,n){this.didCompleteInit&&(Fn(e)?e.authorId!==t&&n({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId}):Bn(e)?n({event:"Enter",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.connectedPayload),scope:Mn.System,authorId:e.authorId}):Un(e)&&n({event:"Leave",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:Mn.System,authorId:e.authorId}))}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case Jn.Real:case Jn.RealAck:return!1;case Jn.Illusion:case Jn.IllusionRebuild:return!0;case Jn.Outside:return this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.hasBranch;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"findEventPayloadWithDecorators",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(nr(r)&&dr(r.payload))return r.payload}}catch(e){n.e(e)}finally{n.f()}}},{key:"findNoEffectsWithDecorators",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){if(t.value===sr)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}}]),e}(),Ti=function(){function e(t,n,r){M(this,e),this.observerId=t,this.logger=n,this.onLengthChanged=r,this.queue=[]}return O(e,[{key:"length",get:function(){return this.queue.length}},{key:"pushIllusionActionFrame",value:function(e,t){this.queue.push({frameId:e.originalFrameId,timestamp:e.timestamp,picker:e,section:t}),this.onLengthChanged(this.queue.length)}},{key:"forFrames",value:function(e){var t,n=E(this.queue);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.frameId,a=r.timestamp;e(r.picker,r.section,i,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"replaceActionFrame",value:function(e){var t,n,r,i=new Gn(e),a=this.isAckFrame(i);if(a){var o=this.takeIllusionFrame(i.frameId,i.originalFrameId),s=o.picker;t=Date.now()-o.timestamp,s.frameId=i.frameId,s.originalFrameId=i.originalFrameId,s.timestamp=i.timestamp,n=s.frameBuffer,r=o.section}else{if(i.type===Pn.Ack)throw new Error("received others' ACK frame");n=e}return{replacedBuffer:n,isAck:a,rttTimeInterval:t,section:r}}},{key:"takeIllusionFrame",value:function(e,t){var n=this.queue.findIndex((function(e){return e.frameId===t}));if(n>0&&this.logger.warn("received frame can't touch first illusion frame"),-1===n)throw new Error("not found frameId ".concat(t," match to ACK frameId"));var r=this.queue.splice(n,1)[0];return this.onLengthChanged(this.queue.length),r}},{key:"isAckFrame",value:function(e){switch(e.type){case Pn.Ack:case Pn.Invoker:return e.authorId===this.observerId;case Pn.Event:if(e.scope===Mn.Custom)return e.authorId===this.observerId}return!1}}]),e}();function Oi(e){return void 0===e.beginGenerationId?mt(e.scopeId,e.beginObjectId):function(e,t){if(e>at)throw new Error("observerId ".concat(e," is out of range 0 ~ ").concat(at));var n=[],r=new yt(e,n);return vt.pushUint32(n,e),r.makeSureNextGenerationIdAfter(t),r}(e.authorId,e.beginGenerationId)}var Ei,Ai=function(){function e(t,n,r,i,a,o,s){M(this,e),this.logger=t,this.strategy=n,this.proxyRuntime=r,this.triggerInvoker=i,this.assertAppendFrameId=a,this.onReceivedRttReport=o,this.onIllusionQueueLengthChanged=s,this.observerId=null,this._illusionQueue=null}return O(e,[{key:"illusionQueue",get:function(){return this._illusionQueue}},{key:"setObserverId",value:function(e){if(this._illusionQueue)throw new Error("did set observer ID");this.observerId=e,this._illusionQueue=new Ti(e,this.logger,this.onIllusionQueueLengthChanged)}},{key:"cleanObserverId",value:function(){var e=this,t=this._illusionQueue;return 0===t.length?(this.observerId=null,this._illusionQueue=null,this.onIllusionQueueLengthChanged(t.length),Promise.resolve()):new Promise((function(t){e.onIllusionQueueEmpty=function(){e.observerId=null,e._illusionQueue=null,t()}}))}},{key:"appendActionFramesWithDoubleMode",value:function(e){var t,n,r=E(e);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking,{mode:Jn.Real}),o=Oi(a);this.assertAppendFrameId(a),t=this.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:Jn.Real,timestamp:a.timestamp,identifierGenerator:o})}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"appendActionFrames",value:function(e){var t,n,r=this,i=[],a=[],o=!1,s=E(e);try{for(s.s();!(t=s.n()).done;){var c=t.value,u=this._illusionQueue.replaceActionFrame(c);u.isAck||(o=!0);var l={frameBuffer:u.replacedBuffer,frameSection:u.section};o?a.push(l.frameBuffer):i.push(l),void 0!==u.rttTimeInterval&&this.onReceivedRttReport(u.rttTimeInterval)}}catch(e){s.e(e)}finally{s.f()}return this.proxyRuntime.block.runWithDisableObserve((function(){var e,t=E(i);try{for(t.s();!(e=t.n()).done;){var n=e.value,a=n.frameBuffer,o=n.frameSection,s=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking,{mode:Jn.RealAck,frameSection:o}),c=Oi(s);r.assertAppendFrameId(s),r.triggerInvoker.appendAction(s,{authorId:s.authorId,mode:Jn.RealAck,timestamp:s.timestamp,frameSection:o,identifierGenerator:c}),o.completeACK()}}catch(e){t.e(e)}finally{t.f()}})),a.length>0&&(this.proxyRuntime.mergeBranch(),n=this.appendActionFramesWithDoubleMode(a),this._illusionQueue.length>0&&this.rebuildIllusionBranch()),this.proxyRuntime.hasBranch&&0===this._illusionQueue.length&&this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.mergeBranch(),this.onIllusionQueueEmpty&&0===this._illusionQueue.length&&(this.onIllusionQueueEmpty(),this.onIllusionQueueEmpty=void 0),n}},{key:"rebuildIllusionBranch",value:function(){var e=this;this.proxyRuntime.forkBranchRuntime();var t=this._illusionQueue;this._illusionQueue=new Ti(this.observerId,this.logger,this.onIllusionQueueLengthChanged),t.forFrames((function(t,n){var r=e.proxyRuntime.createFrameSection(n);e._illusionQueue.pushIllusionActionFrame(t,r);var i=e.proxyRuntime.frameHandler.deserializeActionFrame(t.frameBuffer,e.strategy.deserializerVersion,e.strategy.ignoreHashChecking,{mode:Jn.IllusionRebuild,frameSection:r}),a=Oi(i);e.triggerInvoker.appendAction(i,{authorId:i.authorId,mode:Jn.IllusionRebuild,timestamp:i.timestamp,frameSection:r,identifierGenerator:a}),r.completeRebuild()})),t.length>0&&this.onIllusionQueueLengthChanged(this._illusionQueue.length)}}]),e}(),Ni=function(){function e(t){var n=this;if(M(this,e),this.modifiable=!0,this.frameGenerator=null,this.didDestroy=!1,this.assertAppendFrameId=function(e){var t=e.frameId,r=n.triggerInvoker.frameId+1;if(r!==t)throw new Error("find unexpected frame id ".concat(t,", wanna ").concat(r))},this.invokeMethod=function(e,t){n.assertEnableSendActionFrames();var r,i=Date.now(),a=n.frameGenerator;if(!a)throw new Error("cannot invoke ".concat(e,", frameGenerator is not prepare"));var o=a.author.allocateIdentifierGenerator(),s=n.proxyRuntime.block.runWithContinuousUpdated((function(){var s=n.proxyRuntime.createFrameSection(),c={authorId:a.author.userId,mode:Jn.Illusion,frameSection:s,timestamp:i,identifierGenerator:o};r=n.proxyRuntime.block.runWithMagix(c,(function(){var r,c=n.triggerInvoker.methodNameToId(e);try{r=a.createIllusionInvokerFrame(c,t,i,o)}catch(e){throw n.clientCrashWithError(e),e}try{return n.triggerInvoker.invoke(e,r.illusionFrame.parameters)}finally{n.handleActionFrame(r.frameBuffer,s)}}))}));return n.callbacks.onModified&&s.didUpdated&&n.callbacks.onModified(),r},this.currentPhase=function(){var e=n.branchImageHelper.illusionQueue;return e&&0===e.length?Ei.Real:Ei.Illusion},this.library=t.library,this.logger=t.logger,this.proxyRuntime=t.proxyRuntime,this.actionFrameHelper=this.createActionFrameHelper(t),this.imageUsers=t.imageUsers,this.strategy=t.strategy,this.callbacks=Mr(t.callbacks||{}),this.callbacks.onEventFire&&(this.eventFireNode=new Hr(t.logger,this.callbacks.onEventFire),this.eventFireNode.isPadding=!0),this.triggerInvoker=new Mi({library:this.library,imageUsers:this.imageUsers,proxyRuntime:t.proxyRuntime,onEventFire:this.eventFireNode&&this.eventFireNode.callback,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}),this.triggerInvoker.frameId=t.frameId,this.triggerInvoker.timestamp=t.timestamp,this.proxyRuntime.rootObject.onInvokedTriggerMethod=this.invokeMethod,t.actionFrames){var r,i=E(t.actionFrames);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this.proxyRuntime.frameHandler.deserializeActionFrame(a,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),s=Oi(o);this.triggerInvoker.appendAction(o,{authorId:o.authorId,timestamp:o.timestamp,mode:Jn.Real,identifierGenerator:s})}}catch(e){i.e(e)}finally{i.f()}}this.phaseNode=new Wr({phase:Ei.Real,getCurrentPhase:this.currentPhase,onPhaseChanged:this.callbacks.onPhaseChanged}),this.branchImageHelper=new Ai(this.logger,this.strategy,this.proxyRuntime,this.triggerInvoker,this.assertAppendFrameId,this.callbacks.onReceivedRttReport||function(){},this.callbacks.onIllusionQueueLengthChanged||function(){}),this.triggerInvoker.completeInit(),this.eventFireNode&&Promise.resolve().then((function(){return n.eventFireNode.isPadding=!1})).catch((function(e){return console.error(e)}))}var t;return O(e,[{key:"createActionFrameHelper",value:function(e){return new Ii(e.library,e.proxyRuntime.objectOperator,e.proxyRuntime.frameHandler,e.strategy.deserializerVersion)}},{key:"hasDoubleLines",get:function(){return this.proxyRuntime.hasDoubleLines}},{key:"trigger",get:function(){return this.proxyRuntime.rootObject.displayer}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"userIds",get:function(){return this.imageUsers.userIds}},{key:"usersCount",get:function(){return this.imageUsers.usersCount}},{key:"hasUser",value:function(e){return this.imageUsers.hasUser(e)}},{key:"user",value:function(e){return this.imageUsers.user(e,!1)}},{key:"verifiedFrameId",get:function(){return this.triggerInvoker.frameId}},{key:"frameId",get:function(){var e=this.triggerInvoker.frameId,t=this.branchImageHelper.illusionQueue;return t&&(e+=t.length),e},set:function(e){var t=this.branchImageHelper.illusionQueue,n=e;t&&(n-=t.length),this.triggerInvoker.frameId=n}},{key:"timestamp",get:function(){return this.triggerInvoker.timestamp}},{key:"appendActionFrames",value:function(e){var t,n,r=this;this.eventFireNode&&(this.eventFireNode.isPadding=!0);try{t=this.proxyRuntime.block.runWithContinuousUpdated((function(){n=r.proxyRuntime.hasDoubleLines?r.proxyRuntime.hasBranch?r.branchImageHelper.appendActionFrames(e):r.branchImageHelper.appendActionFramesWithDoubleMode(e):r.appendActionFramesWithSingleMode(e)})),this.phaseNode.touch()}finally{this.eventFireNode&&(this.eventFireNode.isPadding=!1)}return this.callbacks.onModified&&t.didUpdated&&this.callbacks.onModified(),n}},{key:"appendScopeSlices",value:function(e){this.frameGenerator&&this.frameGenerator.appendScopeSlices(e)}},{key:"appendActionFramesWithSingleMode",value:function(e){var t,n,r=E(e);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),o=Oi(a);this.assertAppendFrameId(a),t=this.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:Jn.Real,timestamp:a.timestamp,identifierGenerator:o})}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"dispatch",value:function(e,t){var n=this;this.assertEnableSendActionFrames();var r=Date.now(),i=this.frameGenerator;if(!i)throw new Error("cannot dispatch event ".concat(e,", frameGenerator is not prepare"));var a=i.author.allocateIdentifierGenerator(),o=this.proxyRuntime.block.runWithContinuousUpdated((function(){var o=n.proxyRuntime.createFrameSection(),s={authorId:i.author.userId,mode:Jn.Illusion,timestamp:r,frameSection:o,identifierGenerator:a};n.proxyRuntime.block.runWithMagix(s,(function(){var s;try{s=i.createIllusionEventFrame(e,t,r,a)}catch(e){throw n.clientCrashWithError(e),e}try{return n.triggerInvoker.dispatch(e,s.illusionFrame.payload)}finally{n.handleActionFrame(s.frameBuffer,o)}}))}));this.eventFireNode&&this.eventFireNode.callback({event:e,payload:t,scope:Mn.Custom,authorId:i.author.userId}),this.callbacks.onModified&&o.didUpdated&&this.callbacks.onModified()}},{key:"handleActionFrame",value:function(e,t){var n=new Gn(e);this.branchImageHelper.illusionQueue.pushIllusionActionFrame(n,t),this.phaseNode.touch(),this.callbacks.onGeneratedActionFrame&&this.callbacks.onGeneratedActionFrame(e)}},{key:"snapshot",value:function(){var e=this,t=this.frameGenerator?this.frameGenerator.author.userId:nn,n={frameId:this.frameId,originalFrameId:this.frameId,timestamp:this.timestamp,authorId:t,rootObject:this.proxyRuntime.rootObject.snapshotRootObject(),users:this.imageUsers.snapshotUsers()},r={authorId:t,mode:Jn.Outside,timestamp:n.timestamp,identifierGenerator:mt(-1)};return this.proxyRuntime.block.runWithMagix(r,(function(){return e.proxyRuntime.frameHandler.serializeSnapshotFrame(n)}))}},{key:"setAllocatedUser",value:(t=I(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.imageUsers.createImageAuthor(t);case 2:(n=e.sent)&&(this.frameGenerator=new Pi(n,this.actionFrameHelper,this.strategy.includesFrameHash),this.proxyRuntime.reportObserverIdChanged(t.userId),this.branchImageHelper.setObserverId(n.userId));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"removeAllocatedUser",value:function(){return this.imageUsers.cancelImageAuthorCreating(),this.frameGenerator=null,this.proxyRuntime.reportObserverIdChanged(nn),this.branchImageHelper.cleanObserverId()}},{key:"destroy",value:function(){this.didDestroy||(this.imageUsers.cancelImageAuthorCreating(),this.frameGenerator=null,this.didDestroy=!0,this.proxyRuntime.dispose(),this.phaseNode.touch())}},{key:"createInvokerFrameBuffer",value:function(e){var t=this.triggerInvoker.methodNameToId(e.method);if(void 0===t)throw new Error("can't find method ".concat(JSON.stringify(e.method)));if(this.triggerInvoker.isNoEffectMethod(e.method))throw new Error("can't create frame for no effects method ".concat(JSON.stringify(e.method)));var n=Dn(jn({},this.createFrameHeader(e)),{type:Pn.Invoker,scopeId:e.identifierGenerator.scopeId,methodId:t,parameters:e.parameters});return this.serializeActionFrame(e.identifierGenerator,n)}},{key:"createEventFrameBuffer",value:function(e){var t=Dn(jn({},this.createFrameHeader(e)),{type:Pn.Event,scopeId:e.identifierGenerator.scopeId,scope:e.scope,event:e.event,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createEnterFrameBuffer",value:function(e){var t=Dn(jn({},this.createFrameHeader(e)),{type:Pn.Enter,scopeId:e.identifierGenerator.scopeId,session:e.session,userPayload:e.userPayload,connectedPayload:e.connectedPayload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createLeaveFrameBuffer",value:function(e){var t=Dn(jn({},this.createFrameHeader(e)),{type:Pn.Leave,scopeId:e.identifierGenerator.scopeId,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createFrameHeader",value:function(e){var t=e.frameId,n=e.originalFrameId,r=e.authorId;return{frameId:t,originalFrameId:void 0===n?t:n,timestamp:Date.now(),authorId:r,beginObjectId:0}}},{key:"serializeActionFrame",value:function(e,t){var n=this,r={authorId:this.frameGenerator?this.frameGenerator.author.userId:nn,mode:Jn.Outside,timestamp:t.timestamp,identifierGenerator:e};return this.proxyRuntime.block.runWithMagix(r,(function(){return n.actionFrameHelper.serialize(e,t,n.strategy.includesFrameHash)}))}},{key:"assertEnableSendActionFrames",value:function(){if(this.didDestroy)throw new Error("image was desctroy");var e=this.branchImageHelper.illusionQueue;if((e?e.length:0)>=700)throw this.clientCrashWithError(new Error("illusion queue is overflow")),new Error("can't modify. illusion queue is overflow")}},{key:"clientCrashWithError",value:function(e){var t=this;this.callbacks.onClientCrashWithError&&Promise.resolve().then((function(){return t.callbacks.onClientCrashWithError(e)})).catch((function(e){return console.error(e)}))}}]),e}();!function(e){e.Real="real",e.Illusion="illusion"}(Ei||(Ei={}));var Ri=function(){function e(t){M(this,e),this.proxyManager=t}return O(e,[{key:"createAccessUpdaterSerialization",value:function(e){return new mi(this.proxyManager.objectOperator,e)}},{key:"createWithParameters",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=new Ci(r),a=Date.now();r.setupWithParameters(t.constructorScopeId,t.args,a,{logger:t.logger,imageUsers:i,snapshotManager:Ir(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var o=new Ni({frameId:0,timestamp:a,library:t.library,logger:t.logger,proxyRuntime:r,actionFrames:[],imageUsers:i,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),o}},{key:"parseSnapshotFrame",value:function(e,t){var n=this.proxyManager.createProxyRuntime(e),r=Ct.V1;return n.frameHandler.deserializeSnapshotFrame(t,r,!1)}},{key:"createWithSnapshot",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=t.snapshotDeserializerVersion;void 0===i&&(i=Tt(Ge));var a=r.frameHandler.deserializeSnapshotFrame(t.snapshotFrame,i,t.ignoreHashChecking),o=a.rootObject,s=new Ci(r,a.users);r.setupWithRootObject(o,{logger:t.logger,imageUsers:s,snapshotManager:Ir(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var c=new Ni({frameId:a.frameId,timestamp:a.timestamp,library:t.library,logger:t.logger,actionFrames:t.actionFrames,proxyRuntime:r,imageUsers:s,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),c}},{key:"findOriginProxyRuntime",value:function(e){var t=e.originalImage;if(t)return t.proxyRuntime}}],[{key:"wrapStrategy",value:function(e){var t=e.actionDeserializerVersion;return void 0===t&&(t=Tt(Ge)),Object.freeze({roomUUID:e.roomUUID,ignoreHashChecking:e.ignoreHashChecking,includesFrameHash:e.includesFrameHash,deserializerVersion:t})}}]),e}(),Li=Object.freeze([{methodName:"toString",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"toLocaleString",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"join",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"indexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"lastIndexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"every",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"some",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"forEach",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduce",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduceRight",returnArray:!1,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"concat",returnArray:!0,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reverse",returnArray:!0,lengthChanged:!1,elementChanged:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"slice",returnArray:!0,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"splice",returnArray:!0,lengthChanged:!0,elementChanged:!0,touchLength:!0,pickTouchedSegment:function(e,t){var n,r=t[0];if(r>=0&&r<e.length)if(t.length>1){var i=t[1];void 0===i&&(i=0);var a=t.length-2;a<0&&(a=0),a===i?a>0&&(n={beginIndex:r,length:a}):n={beginIndex:r,length:e.length-r}}else n={beginIndex:r,length:e.length-r};return n}},{methodName:"map",returnArray:!0,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"filter",returnArray:!0,lengthChanged:!1,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"sort",returnArray:!0,lengthChanged:!1,elementChanged:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"push",returnArray:!1,lengthChanged:!0,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length-1,length:1}}},{methodName:"pop",returnArray:!1,lengthChanged:!0,elementChanged:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length,length:1}}},{methodName:"shift",returnArray:!1,lengthChanged:!0,elementChanged:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length+1}}},{methodName:"unshift",returnArray:!1,lengthChanged:!0,elementChanged:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}}]);var ji=function(){function e(t){M(this,e),this.nodes={};var n,r={},i=E(t);try{var a=function(){var e=n.value,t=e.clazz,i=e.banList,a=e.proxyList,o={},s=t.name;r[s]=Object.freeze({clazz:t,methods:o});var c,u=E(i);try{var l=function(){var e=c.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is ban in Magix"))}};for(u.s();!(c=u.n()).done;)l()}catch(e){u.e(e)}finally{u.f()}var h,d=E(a);try{var p=function(){var e=h.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is not defined"))}};for(d.s();!(h=d.n()).done;)p()}catch(e){d.e(e)}finally{d.f()}Object.seal(o)};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}this.nodes=r}return O(e,[{key:"findMethod",value:function(e,t){var n=this.findNode(e);if(n)return n.methods[t]}},{key:"proxyMethod",value:function(e,t,n){var r=this.findNode(e);if(!r)throw new Error("invalid class");if(!(t in r.methods))throw new Error("invalid method ".concat(JSON.stringify(t)));r.methods[t]=n}},{key:"findNode",value:function(e){var t=e.name,n=this.nodes[t];if(n&&n.clazz===e)return n}}]),e}();var Di=Object.defineProperty,zi=Object.getOwnPropertySymbols,Fi=Object.prototype.hasOwnProperty,Bi=Object.prototype.propertyIsEnumerable,Ui=function(e,t,n){return t in e?Di(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Vi=function(e,t){for(var n in t||(t={}))Fi.call(t,n)&&Ui(e,n,t[n]);if(zi){var r,i=E(zi(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Bi.call(t,n)&&Ui(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e};function Wi(e){return e instanceof _i}function Hi(e){var t=e.__proxy;return t.didDispose?qn.Rejected:t.realTarget?qn.Committed:qn.Uncommitted}var _i=function e(t){M(this,e),Object.defineProperty(this,"__proxy",{value:t,writable:!1,enumerable:!1,configurable:!1})};function Gi(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object.defineProperty(e,t,{enumerable:n,configurable:!0,get:function(){var e=this.__proxy,n=e.proxyRuntime.pullValue(e.displayerTarget()[t]);return e.assertAccessible(),e.touchKey(t),n}})}function Yi(e,t){delete e[t]}var Xi=function(){function e(t){M(this,e),this.usersCache={},this.observerId=t.observerId,this.environment=t.environment,this.authorId=t.authorId,this.core=t.coreFunctions,this.roomObserver=t.roomObserver,this.imageUsers=t.imageUsers}return O(e,[{key:"getAuthorId",value:function(){return this.environment===Sr.NoEffects&&this.observerId===this.authorId&&this.roomObserver.reportObservedSelfUserId(),this.authorId}},{key:"hasUser",value:function(e){return this.environment===Sr.NoEffects&&this.roomObserver.reportObservedUsers(),this.imageUsers.hasUser(e)}},{key:"getUsersCount",value:function(){return this.environment===Sr.NoEffects&&this.roomObserver.reportObservedUsers(),this.imageUsers.usersCount}},{key:"getUser",value:function(e){var t;return this.imageUsers.hasUser(e)&&((t=this.usersCache[e])||(t=this.usersCache[e]=this.core.creator(this.imageUsers.user(e,!0)))),this.environment===Sr.NoEffects&&this.roomObserver.reportObservedUsers(),t}},{key:"getUserIds",value:function(){return this.userIdsCache||(this.userIdsCache=this.core.creator(this.imageUsers.userIds)),this.environment===Sr.NoEffects&&this.roomObserver.reportObservedUsers(),this.userIdsCache}}]),e}(),Qi=function(){function e(t){M(this,e),this.observerId=nn,this._hasDoubleLines=!1,this._branchRuntime=null,this.logger=t.logger,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.toolsExtra=t.toolsExtra,this.snapshotManager=t.snapshotManager}return O(e,[{key:"hasDoubleLines",get:function(){return this._hasDoubleLines}},{key:"branchRuntime",get:function(){return this._branchRuntime}},{key:"changeToDoubleLines",value:function(){this._hasDoubleLines=!0}},{key:"forkBranchRuntime",value:function(){return this._branchRuntime=function(e){return new Ya(e)}(this.logger),this._branchRuntime}},{key:"releaseBranchRuntime",value:function(){this._branchRuntime&&(this._branchRuntime=null)}},{key:"getForwardMode",value:function(){return!this._hasDoubleLines||this._branchRuntime?Qn.SingleForward:Qn.DoubleForward}},{key:"runWithMagix",value:function(t,n){var r=t.authorId,i=this.getEnvironment(t.mode),a=this.getForwardMode(),o=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),s=Object.freeze({idGenerator:t.identifierGenerator,environment:i,timestamp:t.timestamp,snapshot:this.snapshotManager,extra:this.toolsExtra,functions:new Xi({observerId:this.observerId,environment:i,authorId:r,coreFunctions:o,roomObserver:this.proxyRuntime.roomObserver,imageUsers:this.imageUsers})}),c={mode:t.mode,coreFunctions:o,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:a,tools:s};return $n.runWith(c,n)}},{key:"runWithSerialization",value:function(t,n){var r=this.getForwardMode(),i=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),a={mode:t.mode,coreFunctions:i,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:r};return $n.runWith(a,n)}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case Fa.Real:case Fa.RealAck:return!1;case Fa.Illusion:case Fa.IllusionRebuild:return!0;case Fa.Outside:return this._hasDoubleLines&&!!this._branchRuntime;default:throw new Error("invalid mode ".concat(e))}}},{key:"getEnvironment",value:function(e){switch(e){case Fa.Illusion:case Fa.IllusionRebuild:return Sr.Illusion;case Fa.Real:case Fa.RealAck:return Sr.Real;case Fa.Outside:return Sr.NoEffects;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"coreFunctionsSwitcher",get:function(){return this._coreFunctionsSwitcher||(this._coreFunctionsSwitcher=new Ua),this._coreFunctionsSwitcher}}]),e}();function Zi(e,t,n){return t.constructor===Object?Po(e,n,t):To(e,n,t)}var Ki,qi="__identifier";function Ji(e,t){Object.defineProperty(e,qi,{enumerable:!1,configurable:!0,value:t})}$n.addListener((function(e,t){Ki=t?e.coreFunctions.creator:void 0}));var $i=function(){function e(t,n,r){M(this,e),this.proxyRuntime=t,this.identifierGenerator=n,this.banFunction=r,this.proxyNodes={},this.modifyObjects=[]}return O(e,[{key:"complete",value:function(){var e,t=E(this.modifyObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[qi]}}catch(e){t.e(e)}finally{t.f()}}},{key:"wrap",value:function(e){if(this.banFunction&&"function"==typeof e)throw new Error("can't wrap function");if("object"!=R(e)||null===e||Pe(e))return e;if(Wi(e))throw new Error("can't let displayer node pass Magix border");if(e.constructor===Array)return this.wrapArray(e);if(e.constructor===Object)return this.wrapObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"wrapArray",value:function(e){var t,n=e[qi];if(void 0===n){Ji(e,n=this.identifierGenerator.generate());for(var r=(t=this.createProxyNode([],n)).target(),i=0;i<e.length;++i)r[i]=this.wrap(e[i]);this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"wrapObject",value:function(e){var t,n=e[qi];if(void 0===n){Ji(e,n=this.identifierGenerator.generate());var r,i=(t=this.createProxyNode({},n)).target(),a=E(Object.keys(e).sort());try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=this.wrap(e[o])}}catch(e){a.e(e)}finally{a.f()}this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"createProxyNode",value:function(e,t){return Ki?Ki(e,t):Zi(this.proxyRuntime,e,t)}}]),e}(),ea=function(){function e(t){M(this,e),t&&(this.observer=t.create("room observer"))}return O(e,[{key:"reportSelfUserIdChanged",value:function(t){this.observer&&this.observer.reportChanged(e.selfUserId,t,ei.Updated)}},{key:"reportUsersChanged",value:function(t){this.observer&&this.observer.reportChanged(e.users,t,ei.Updated)}},{key:"reportObservedSelfUserId",value:function(){this.observer&&this.observer.reportObservedKey(e.selfUserId)}},{key:"reportObservedUsers",value:function(){this.observer&&this.observer.reportObservedKey(e.users)}}]),e}();function ta(e,t){Object.defineProperty(e,no,{enumerable:!1,writable:!1,configurable:!0,value:t})}ea.selfUserId="userId",ea.users="users";var na=function(){function e(){M(this,e),this.didTouchedSet={}}return O(e,[{key:"copyProxyNode",value:function(e){var t=e.identifier;this.didTouchedSet[t]||(this.didTouchedSet[t]=!0,io(e)?this.copyAkkoObjectProxyNode(e):so(e)?this.copyFlatObjectProxyNode(e):ho(e)&&this.copyArrayProxyNode(e))}},{key:"copyAkkoObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=Object.getOwnPropertyDescriptor(t,r);if(i&&!i.get&&!i.set){var a=t[r];Ja(a)&&this.copyProxyNode(a),n[r]=a}}ta(n,e),Object.setPrototypeOf(n,e.struct.classReflection.clazz.prototype),e.illuTarget=n}}},{key:"copyFlatObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=t[r];Ja(i)&&this.copyProxyNode(i),n[r]=i}ta(n,e),e.illuTarget=n}}},{key:"copyArrayProxyNode",value:function(e){var t=e.realTarget;if(t){for(var n=[],r=0;r<t.length;++r)if(r in t){var i=t[r];Ja(i)&&this.copyProxyNode(i),n[r]=i}ta(n,e),e.illuTarget=n}}}]),e}(),ra=function(){function e(){M(this,e),this.disable=!1,this.delegates={},this.unbindsDelegated={},this.updatedObjects={},this._didUpdated=!1}return O(e,[{key:"didUpdated",get:function(){return this._didUpdated}},{key:"callbackDelegates",value:function(){for(var e in this.delegates)if(e in this.unbindsDelegated)delete this.delegates[e];else{var t=this.delegates[e],n=this.updatedObjects[e];t.updateDisplayer(n)}for(var r in this.delegates){var i=this.delegates[r],a=this.updatedObjects[r];i.reportChanged(a)}}},{key:"unbindDelegate",value:function(e){this.disable||(this.unbindsDelegated[e.identifier]=!0)}},{key:"addProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case ei.Removed:i.kind=ei.Updated;break;case ei.Inserted:i.kind=ei.Inserted;break;case ei.Updated:i.kind=ei.Updated}else r[t]={kind:ei.Inserted,value:n,isIndex:"number"==typeof t}}}},{key:"setProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case ei.Removed:i.kind=ei.Updated;break;case ei.Inserted:i.kind=ei.Inserted;break;case ei.Updated:i.kind=ei.Updated}else r[t]={kind:ei.Updated,value:n,isIndex:"number"==typeof t}}}},{key:"removeProperty",value:function(e,t){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var n=this.getBufferObject(e),r=n[t];if(r)switch(r.kind){case ei.Removed:break;case ei.Inserted:delete n[t];break;case ei.Updated:r.kind=ei.Removed,r.value=void 0}else n[t]={kind:ei.Removed,value:void 0,isIndex:"number"==typeof t}}}},{key:"getBufferObject",value:function(e){var t=e.identifier,n=this.updatedObjects[t];return n||(this.delegates[t]=e,this.updatedObjects[t]=n={}),n}}]),e}(),ia=new(function(){function e(){M(this,e)}return O(e,[{key:"addProperty",value:function(e,t,n){}},{key:"removeProperty",value:function(e,t){}},{key:"setProperty",value:function(e,t,n){}},{key:"unbindDelegate",value:function(e){}},{key:"callbackDelegates",value:function(){return{didUpdated:!1}}}]),e}());function aa(){return ia}function oa(e){var t=ia,n=new ra;try{return ia=n,e(),n.callbackDelegates(),{didUpdated:n.didUpdated}}finally{ia=t}}var sa,ca=function(){function e(t,n){M(this,e),this.runtime=t,this.observerAdapter=n}return O(e,[{key:"runWithMagix",value:function(e,t){return this.runtime.runWithMagix(e,t)}},{key:"runWithDisableObserve",value:function(e){var t=aa();try{return t.disable=!0,e()}finally{t.disable=!1}}},{key:"runWithContinuousUpdated",value:function(e){var t;return this.observerAdapter?this.observerAdapter.observeUpdate((function(){t=oa(e)})):t=oa(e),t}}]),e}(),ua=function(){function e(t,n,r,i){var a=i.observerAdapter,o=i.escapeObjectFilter,s=i.jsxFactory;M(this,e),this.objectOperator=t,this.library=n,this.observerAdapter=a,this.escapeObjectFilter=o||function(){return!1},this.jsxFactory=s,this.roomObserver=new ea(a),this.noEffectsIdGenerator=mt(-1),this.frameHandler=new Eo(this,this.library),r&&r.library===this.library?this.structMap=Vi({},r.structMap):this.structMap={}}return O(e,[{key:"runtime",get:function(){return this._runtime}},{key:"block",get:function(){return this.proxyBlock}},{key:"rootObject",get:function(){return this._rootObject}},{key:"hasDoubleLines",get:function(){return this._runtime.hasDoubleLines}},{key:"hasBranch",get:function(){return!!this._runtime.branchRuntime}},{key:"forkBranchRuntime",value:function(){this._runtime.forkBranchRuntime()}},{key:"mergeBranch",value:function(){var e=this._runtime;e.branchRuntime.syncTwoBranches(),e.releaseBranchRuntime()}},{key:"reportUsersChanged",value:function(e){this.roomObserver.reportUsersChanged(e)}},{key:"reportObserverIdChanged",value:function(e){this._runtime.observerId=e,this.roomObserver.reportSelfUserIdChanged(e)}},{key:"createFrameSection",value:function(e){var t=this._runtime;t.hasDoubleLines||((new na).copyProxyNode(this._rootObject.snapshotRootObject()),t.changeToDoubleLines());var n,r=t.branchRuntime;return r||(r=t.forkBranchRuntime()),e&&(n=e.takeCreatedProxyNodes()),r.createFrameSection(n)}},{key:"setupWithParameters",value:function(e,t,n,r){var i=this;this.setupRuntime(r);var a=nn,o=mt(e),s=this.pushValues(o,t,!0),c={authorId:a,mode:Jn.Real,timestamp:n,identifierGenerator:o},u=this.runtime.runWithMagix(c,(function(){return v(i.library.rootClass,C(s))})).__proxy;this._rootObject=new Ao(this._runtime,u,this.observerAdapter)}},{key:"setupWithRootObject",value:function(e,t){if(this.setupRuntime(t),!io(e))throw new Error("rootObject should be AkkoObjectProxyNode");this._rootObject=new Ao(this._runtime,e,this.observerAdapter)}},{key:"setupRuntime",value:function(e){if(this._runtime)throw new Error("did bind runtime params");this._runtime=new Qi({logger:e.logger,imageUsers:e.imageUsers,snapshotManager:e.snapshotManager,proxyRuntime:this,toolsExtra:e.toolsExtra}),this.proxyBlock=new ca(this._runtime,this.observerAdapter)}},{key:"pullValue",value:function(e){return"object"!=R(e)||null===e?e:Ja(e)?e.displayer:Pe(e)?e.readonly?e:e.slice():this.escapeObjectFilter(e)?e:void 0}},{key:"pushValues",value:function(e,t,n){var r=[],i=new $i(this,e,n);try{for(var a=0;a<t.length;++a)r[a]=i.wrap(t[a]);return r}finally{i.complete()}}},{key:"getAkkoObjectStruct",value:function(e){var t=this.structMap[e.id];return t||(t=this.structMap[e.id]=new Qa(e)),t}},{key:"dispose",value:function(){}}]),e}(),la=new ji([{clazz:Object,proxyList:["assign"],banList:["getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","create","defineProperty","defineProperties"]},{clazz:Array,proxyList:[],banList:["from"]},{clazz:String,proxyList:["fromCodePoint","fromCharCode"],banList:[]},{clazz:Number,proxyList:["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"],banList:[]}]);function ha(){if(!sa)throw $n.currentNode?new Error("can't create JSX. you didn't set jsxFactory"):new Error("can't create JSX. maybe you called it out of Magix");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return sa.apply(void 0,t)}la.proxyMethod(Object,"assign",(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length>0){var i=n[0];i&&Ja(i)&&(e=i)}for(var a=0;a<n.length;++a)n[a]=$a(n[a]);var o=Object.assign.apply(this,n),s=o[no];return e&&e!==s&&(s=e,Za(e,o)),s})),la.proxyMethod(String,"fromCodePoint",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=$a(t[r]);return String.fromCodePoint.apply(this,t)})),la.proxyMethod(String,"fromCharCode",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=$a(t[r]);return String.fromCharCode.apply(this,t)})),la.proxyMethod(Number,"isFinite",Number.isFinite),la.proxyMethod(Number,"isInteger",Number.isInteger),la.proxyMethod(Number,"isNaN",Number.isNaN),la.proxyMethod(Number,"isSafeInteger",Number.isSafeInteger),la.proxyMethod(Number,"parseFloat",Number.parseFloat),la.proxyMethod(Number,"parseInt",Number.parseInt),$n.addListener((function(e,t){sa=t?e.proxyRuntime.jsxFactory:void 0}));var da=function(){function e(){M(this,e),this.unwrappedMap={}}return O(e,[{key:"unwrap",value:function(e){return Ja(e)?this.unwrapProxyNode(e):Pe(e)?e.readonly?e:e.slice():e}},{key:"unwrapProxyNode",value:function(e){if(io(e))return e.displayer;var t=e.identifier,n=this.unwrappedMap[t];if(!n){var r=e.target();if(so(e))for(var i in this.unwrappedMap[t]=n={},r)n[i]=this.unwrap(r[i]);else if(ho(e)){this.unwrappedMap[t]=n=[];for(var a=0;a<r.length;++a)n[a]=this.unwrap(r[a])}}return n}}]),e}();function pa(e){if("object"==R(e)&&null!==e){if(Ja(e))return e;var t=e[no];return Ja(t)?t:void 0}}function fa(e){return e instanceof Kr?e.__proxy:e}var va,ma,ga,ya,ba,ka,wa,Sa,xa,Ia,Ca,Pa,Ma,Ta=function(){function e(){M(this,e)}return O(e,[{key:"updater",value:function(e){return e}},{key:"getter",value:function(e,t){var n=pa(e);return n?n.getValue(t):e[t]}},{key:"caller",value:function(e,t,n,r){if("function"==typeof e){if(fr in e)return e[t].apply(e,n);var i=la.findMethod(e,t);if(i)return i.apply(e,n);if("function"==typeof Function.prototype[t])return e[t].apply(e,C(n));throw new Error("can't call ".concat(e.name,".").concat(t,", it's not supported"))}var a,o;return r&&(a=r[t]),Ja(e)?(o=e.target(),a||(a=e.getMethod(t))):(o=e,a||(a=e[t])),a.apply(o,n)}},{key:"setter",value:function(e,t,n){var r=pa(e),i=n;return i=fa(i),r?r.setValue(t,i):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=pa(e);return r?r.prefix(t,n):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=pa(e);if(r)return r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=pa(e);return n?n.removeKey(t):delete e[t]}},{key:"wrapper",value:function(e){return"object"!=R(e)||null===e?e:e[no]||e}},{key:"unwrapper",value:function(e){return Ja(e)?e.target():e}},{key:"jsxUnwrapper",value:function(e){return(new da).unwrap(e)}}]),e}(),Oa=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"onContextUpdate",value:function(e,t){t?(va=e.tools&&e.tools.idGenerator,ma=e.frameSection,ga=e.proxyRuntime):(va=void 0,ma=void 0,ga=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:va.generate();if(e.constructor===Array)t=To(ga,n,e);else if(e.constructor===Object)t=Po(ga,n,e);else{var r=e.constructor[fr];if("object"!=R(r)||null===r)throw new Error("can't find __reflection");var i=ga.getAkkoObjectStruct(r);t=Mo(ga,n,e,i)}return ma.addCreatedObject(t),t}},{key:"updater",value:function(e){return Ja(e)&&ma.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=pa(e),i=n;return i=fa(i),r?(ma.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=pa(e);return r?(ma.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=pa(e);if(r)return ma.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=pa(e);return n?(ma.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(Ta),Ea=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"onContextUpdate",value:function(e,t){t?(ya=e.tools&&e.tools.idGenerator,ba=e.frameSection,ka=e.proxyRuntime):(ya=void 0,ba=void 0,ka=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ya.generate(),n=ba.illusionTakeCreatedObject(t,e);if(n)n.replaceIlluTarget(e);else if(e.constructor===Array)n=To(ka,t,e);else if(e.constructor===Object)n=Po(ka,t,e);else{var r=e.constructor[fr];if("object"!=R(r)||null===r)throw new Error("can't find __reflection");var i=ka.getAkkoObjectStruct(r);n=Mo(ka,t,e,i)}return ba.addCreatedObject(n),n}},{key:"updater",value:function(e){return Ja(e)&&ba.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=pa(e),i=n;return i=fa(i),r?(ba.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=pa(e);return r?(ba.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=pa(e);if(r)return ba.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=pa(e);return n?(ba.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(Ta),Aa=Qn.SingleForward,Na=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"onContextUpdate",value:function(e,t){t?(wa=e.tools&&e.tools.idGenerator,Sa=e.proxyRuntime,Aa=e.forwardMode):(wa=void 0,Sa=void 0,Aa=Qn.SingleForward)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wa.generate();if(e.constructor===Array)t=To(Sa,n,e);else if(e.constructor===Object)t=Po(Sa,n,e);else{var r=e.constructor[fr];if("object"!=R(r)||null===r)throw new Error("can't find __reflection");var i=Sa.getAkkoObjectStruct(r);t=Mo(Sa,n,e,i)}return Aa===Qn.DoubleForward&&t.converge(),t}},{key:"wrapper",value:function(e){if("object"!=R(e)||null===e)return e;var t=e[no];return t?(Aa===Qn.DoubleForward&&t.converge(),t):e}}]),n}(Ta),Ra=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"onContextUpdate",value:function(e,t){t?(xa=e.tools&&e.tools.idGenerator,Ia=e.frameSection,Ca=e.proxyRuntime):(xa=void 0,Ia=void 0,Ca=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xa.generate(),n=Ia.realTakeCreatedObject(t,e);if(n)n.realTarget=Za(n,e);else if(e.constructor===Array)(n=To(Ca,t,e)).converge(),Ia.realUpdateProxyNode(n);else if(e.constructor===Object)(n=Po(Ca,t,e)).converge(),Ia.realUpdateProxyNode(n);else{var r=e.constructor[fr];if("object"!=R(r)||null===r)throw new Error("can't find __reflection");var i=Ca.getAkkoObjectStruct(r);(n=Mo(Ca,t,e,i)).converge(),Ia.realUpdateProxyNode(n)}return n}},{key:"wrapper",value:function(e){if("object"!=R(e)||null===e)return e;var t=e[no];return t?(t.illuTarget||(t.converge(),Ia.realUpdateProxyNode(t)),t):e}},{key:"updater",value:function(e){return Ja(e)&&Ia.realUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=pa(e),i=n;return i=fa(i),r?(Ia.realUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=pa(e);return r?(Ia.realUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=pa(e);if(r)return Ia.realUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=pa(e);return n?(Ia.realUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(Ta),La=Da;function ja(e){return-1===function(e){return vt.readInt53(e,0)}(e.identifier)}function Da(){return!0}function za(e,t){if(La(e))return!0;var n=ai(e.target());if(n){var r=n.properties[t];if(r&&r.isTransient)return!0}return!1}$n.addListener((function(e,t){La=t&&e.tools&&e.mode===Fa.Outside?ja:Da}));var Fa,Ba=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"onContextUpdate",value:function(e,t){t?(Pa=e.tools&&e.tools.idGenerator,Ma=e.proxyRuntime):(Pa=void 0,Ma=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pa.generate();if(e.constructor===Array)t=To(Ma,n,e);else if(e.constructor===Object)t=Po(Ma,n,e);else{var r=e.constructor[fr];if("object"!=R(r)||null===r)throw new Error("can't find __reflection");var i=Ma.getAkkoObjectStruct(r);t=Mo(Ma,n,e,i)}return t}},{key:"getter",value:function(e,t){var n=pa(e);if(n){var r=n.getValue(t);return n.touchKey(t),r}return e[t]}},{key:"unwrapper",value:function(e){return Ja(e)?(e.touchKey(),e.target()):e}},{key:"setter",value:function(e,t,n){var r=pa(e),i=n;if(r&&za(r,t))return i=fa(i),r?r.setValue(t,i):e[t]=i;throw new Error("Magix is frozen, you can't modify anything")}},{key:"prefix",value:function(e,t,n){var r=pa(e);if(r&&za(r,t)){var i=r.prefix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"postfix",value:function(e,t,n){var r=pa(e);if(r&&za(r,t)){var i=r.postfix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"remover",value:function(e,t){var n=pa(e);if(n&&za(n,t))return n.removeKey(t);throw new Error("Magix is frozen, you can't modify anything")}}]),n}(Ta);!function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(Fa||(Fa={}));var Ua=function(){function e(){var t=this;M(this,e),this.illusion=e.bind(new Oa),this.illusionRebuild=e.bind(new Ea),this.real=e.bind(new Na),this.realAck=e.bind(new Ra),this.outside=e.bind(new Ba),this.currentCoreFunctions=this.illusion,$n.addListener((function(e,n){return t.currentCoreFunctions.onContextUpdate(e,n)}))}return O(e,[{key:"switchCoreFunctions",value:function(e){switch(e){case 0:this.currentCoreFunctions=this.illusion;break;case 1:this.currentCoreFunctions=this.illusionRebuild;break;case 2:this.currentCoreFunctions=this.real;break;case 3:this.currentCoreFunctions=this.realAck;break;case 4:this.currentCoreFunctions=this.outside}return this.currentCoreFunctions}}],[{key:"bind",value:function(e){return Object.freeze({creator:e.creator.bind(e),updater:e.updater.bind(e),wrapper:e.wrapper.bind(e),unwrapper:e.unwrapper.bind(e),jsxUnwrapper:e.jsxUnwrapper.bind(e),getter:e.getter.bind(e),setter:e.setter.bind(e),caller:e.caller.bind(e),remover:e.remover.bind(e),prefix:e.prefix.bind(e),postfix:e.postfix.bind(e),onContextUpdate:e.onContextUpdate.bind(e)})}}]),e}();var Va=function(){function e(){M(this,e),this.counterSet={},this.elementSet={}}return O(e,[{key:"hasElement",value:function(e){var t=this.elementSet[e.identifier];return!!t&&t===e}},{key:"createSubSet",value:function(){return new Wa(this)}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t];e&&e(n),delete this.counterSet[t],delete this.elementSet[t]}}},{key:"add",value:function(e){var t=e.identifier;return t in this.counterSet?this.counterSet[t]+=1:(this.elementSet[t]=e,this.counterSet[t]=1)}},{key:"remove",value:function(e){var t=this.counterSet[e];return void 0===t?t=0:0===(t-=1)&&(delete this.counterSet[e],delete this.elementSet[e]),t}}]),e}(),Wa=function(){function e(t){M(this,e),this.uniteSet=t,this.elementSet={}}return O(e,[{key:"add",value:function(e){var t=e.identifier;t in this.elementSet||(this.elementSet[t]=e,this.uniteSet.add(e))}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t],r=this.uniteSet.remove(t);e&&0===r&&e(n),delete this.elementSet[t]}}}]),e}();function Ha(e,t){return e!==t&&(Number.isNaN(e)?!Number.isNaN(t):!Pe(e)||!Pe(t)||!e.isEqualsTo(t))}var _a,Ga,Ya=function(){function e(t){M(this,e),this.logger=t,this.updatedProxyNodes=new Va,this.noConvergentRealNodes={},this.noConvergentIllusionNodes={}}return O(e,[{key:"createFrameSection",value:function(e){return new Xa(this,this.updatedProxyNodes.createSubSet(),e)}},{key:"syncTwoBranches",value:function(){for(var e in this.updatedProxyNodes.release((function(e){e.converge()})),this.noConvergentIllusionNodes){var t=this.noConvergentIllusionNodes[e];t!==this.noConvergentRealNodes[e]&&t.converge(),delete this.noConvergentIllusionNodes[e]}for(var n in this.noConvergentRealNodes)this.noConvergentRealNodes[n].converge(),delete this.noConvergentRealNodes[n]}},{key:"isUpdatedProxyNode",value:function(e){return this.updatedProxyNodes.hasElement(e)}},{key:"isNoConvergentIllusionProxyNode",value:function(e){return e in this.noConvergentIllusionNodes}},{key:"isNoConvergentRealProxyNode",value:function(e){return e in this.noConvergentRealNodes}},{key:"addNoConvergentIllusionProxyNode",value:function(e){this.logger.warn("found no convergent illusion object: ".concat(e.identifier)),this.noConvergentIllusionNodes[e.identifier]=e}},{key:"addNoConvergentRealProxyNode",value:function(e){this.logger.warn("found no convergent real object: ".concat(e.identifier)),this.noConvergentRealNodes[e.identifier]=e}}]),e}(),Xa=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};M(this,e),this.createdProxyNodes={},this.branch=t,this.illuUpdatedProxyNodes=n,this.realUpdatedProxyNodes={},this.legacyCreatedProxyNodes=r}return O(e,[{key:"takeCreatedProxyNodes",value:function(){try{return this.createdProxyNodes}finally{this.createdProxyNodes={}}}},{key:"illusionUpdateProxyNode",value:function(e){this.branch.isNoConvergentIllusionProxyNode(e.identifier)||this.illuUpdatedProxyNodes.add(e)}},{key:"realUpdateProxyNode",value:function(e){!this.branch.isNoConvergentRealProxyNode(e.identifier)&&!this.branch.isUpdatedProxyNode(e)&&(this.realUpdatedProxyNodes[e.identifier]=e)}},{key:"addCreatedObject",value:function(e){e.identifier in this.createdProxyNodes||(this.createdProxyNodes[e.identifier]=e),this.illuUpdatedProxyNodes.add(e)}},{key:"illusionTakeCreatedObject",value:function(e,t){return this.takeCreatedObject(e,t,this.legacyCreatedProxyNodes)}},{key:"realTakeCreatedObject",value:function(e,t){var n=this.takeCreatedObject(e,t,this.createdProxyNodes);return n&&!this.branch.isUpdatedProxyNode(n)&&(this.realUpdatedProxyNodes[e]=n),n}},{key:"takeCreatedObject",value:function(e,t,n){var r=n[e];return r&&(delete n[e],(ho(r)&&t.constructor!==Array||so(r)&&t.constructor!==Object||io(r)&&t.constructor!==r.struct.classReflection.clazz)&&(r.dispose(),r=void 0)),r}},{key:"completeRebuild",value:function(){for(var e in this.legacyCreatedProxyNodes)this.legacyCreatedProxyNodes[e].dispose(),delete this.legacyCreatedProxyNodes[e]}},{key:"completeACK",value:function(){var t=this;for(var n in this.realUpdatedProxyNodes){var r=this.realUpdatedProxyNodes[n];e.isShallowEquals(r)||this.branch.addNoConvergentRealProxyNode(r),delete this.realUpdatedProxyNodes[n]}for(var i in this.illuUpdatedProxyNodes.release((function(n){n.realTarget&&!e.isShallowEquals(n)&&t.branch.addNoConvergentIllusionProxyNode(n)})),this.createdProxyNodes)this.createdProxyNodes[i].dispose(),delete this.createdProxyNodes[i]}}],[{key:"isShallowEquals",value:function(e){var t=e.realTarget,n=e.illuTarget;if(!t||!n)return!1;switch(e.kind){case eo.Array:var r=t,i=n;if(r.length!==i.length)return!1;for(var a=0;a<r.length;++a)if(Ha(r[a],i[a]))return!1;return!0;case eo.FlatObject:case eo.HangUpObject:for(var o in t)if(!(o in n)||Ha(n[o],t[o]))return!1;for(var s in n)if(!(s in t))return!1;return!0;case eo.AkkoObject:var c,u=E(e.struct.serializableValueProperties);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(l in t!=l in n||Ha(t[l],n[l]))return!1}}catch(e){u.e(e)}finally{u.f()}return!0;default:return!1}}}]),e}();!function(e){e[e.ReadValue=0]="ReadValue",e[e.ReadByGetter=1]="ReadByGetter",e[e.CanNotReadGetter=2]="CanNotReadGetter",e[e.CanNotReadPrivateValue=3]="CanNotReadPrivateValue",e[e.CanNotReadPrivateGetter=4]="CanNotReadPrivateGetter"}(_a||(_a={})),function(e){e[e.NoEffects=0]="NoEffects",e[e.Modifiable=1]="Modifiable",e[e.Private=2]="Private",e[e.EventReceiver=3]="EventReceiver"}(Ga||(Ga={}));var Qa=function(){function e(t){M(this,e),this.valuePropertiesSet={},this.classReflection=t;var n=[],r=[],i=[],a={};for(var o in t.properties){var s=t.properties[o],c=s.mode===ze.Value,u=s.decorators.some((function(e){return e===sr})),l=s.decorators.some((function(e){return e===or}));c&&(a[o]=!0,l?n.push(o):r.push(o)),s.isPublic&&(c||u)&&i.push(o)}this.transientValueProperties=Object.freeze(n),this.serializableValueProperties=Object.freeze(r),this.copyableProperties=Object.freeze(i),this.displayerNodeClass=this.createAkkoDisplayerNodeClass(t),this.valuePropertiesSet=Object.freeze(a),this.propertyKinds=this.createPropertyReadableKinds(t),this.methodKinds=this.createMethodCallableKinds(t)}return O(e,[{key:"isValueProperty",value:function(e){return e in this.valuePropertiesSet}},{key:"getPropertyReadableKind",value:function(e){return this.propertyKinds[e]}},{key:"getMethodCallableKind",value:function(e){return this.methodKinds[e]}},{key:"getValueOutsideFromProxyNode",value:function(e,t){switch(this.propertyKinds[t]){case 0:case 1:return e.proxyRuntime.pullValue(this.getValueFromProxyNode(e,t));case 2:throw new Error("can't read property ".concat(JSON.stringify(t)," unless it has @noEffects"));case 3:case 4:throw new Error("can't read private property ".concat(JSON.stringify(t)));default:return}}},{key:"getValueFromProxyNode",value:function(e,t){switch(e.assertAccessible(),this.propertyKinds[t]){case 0:case 3:var n=e.displayerTarget()[t];return e.touchKey(t),n;case 1:var r=e.proxyRuntime.runtime,i=e.proxyRuntime.noEffectsIdGenerator,a={authorId:null===r.observerId?nn:r.observerId,mode:Fa.Outside,timestamp:Date.now(),identifierGenerator:i};return r.runWithMagix(a,(function(){return e.target()[t]}));default:return}}},{key:"createAkkoDisplayerNodeClass",value:function(e){var t=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(_i),n=function(e){Object.defineProperty(t.prototype,e,{enumerable:!1,configurable:!1,get:function(){var t=this.__proxy,n=t.struct;return t.assertAccessible(),n.getValueOutsideFromProxyNode(t,e)}})};for(var r in e.properties)n(r);var i=function(e){t.prototype[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.__proxy.callOutside(e,n)}};for(var a in e.methods)i(a);return t}},{key:"createPropertyReadableKinds",value:function(e){var t={};for(var n in e.properties){var r=e.properties[n];r.isPublic?r.mode===ze.Value?t[n]=0:r.decorators.some((function(e){return e===sr}))?t[n]=1:t[n]=2:r.mode===ze.Value?t[n]=3:t[n]=4}return Object.freeze(t)}},{key:"createMethodCallableKinds",value:function(e){var t={};for(var n in e.methods){var r=e.methods[n];r.isPublic?r.decorators.some((function(e){return nr(e)&&dr(e.payload)}))?t[n]=3:r.decorators.some((function(e){return e===sr}))?t[n]=0:t[n]=1:t[n]=2}return Object.freeze(t)}}]),e}();function Za(e,t){return Object.defineProperty(t,no,{enumerable:!1,writable:!1,configurable:!0,value:e}),t}var Ka=!1,qa=Qn.SingleForward;function Ja(e){return e instanceof to}function $a(e){return"object"!=R(e)||null===e?e:e instanceof to?e.target():e}$n.addListener((function(e,t){if(t){var n=e.proxyRuntime.runtime;Ka=n.isForcesOnIllusionLine(e.mode),qa=e.forwardMode}else Ka=!1,qa=Qn.SingleForward}));var eo,to=function(){function e(t,n,r){M(this,e),this._didDispose=!1,this.proxyRuntime=t,this.identifier=n,Ka?this.illuTarget=Za(this,r):this.realTarget=Za(this,r)}return O(e,[{key:"didDispose",get:function(){return this._didDispose}},{key:"assertAccessible",value:function(){if(this._didDispose)throw new Error("akko wrapped object isn't accessible")}},{key:"reportChanged",value:function(e){if(this.listeners){var t,n=E(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getValue",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){var t=this.proxyRuntime.observerAdapter;t&&(this.observer||(this.observer=t.create(this.getDebugName())),void 0===e?this.observer.reportObservedIteration():this.observer.reportObservedKey(e))}},{key:"dispose",value:function(){this._didDispose=!0,aa().unbindDelegate(this),this._displayer&&(this.releaseDisplayer(this._displayer),delete this._displayer,delete this.observer),delete this.listeners}},{key:"target",value:function(){return Ka?this.illuTarget:this.realTarget}},{key:"displayerTarget",value:function(){return this.illuTarget||this.realTarget}},{key:"displayer",get:function(){return this._displayer||(this._displayer=this.createDisplayer()),this._displayer}},{key:"addListener",value:function(e){var t=this.listeners;t||(t=this.listeners=[]),-1===t.indexOf(e)&&t.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1),0===t.length&&delete this.listeners}}},{key:"toString",value:function(){return this.target().toString()}},{key:"toLocaleString",value:function(){return this.target().toLocaleString()}},{key:"sideTarget",value:function(){if(qa===Qn.DoubleForward&&!Ka)return this.illuTarget}}]),e}(),no="__proxy";function ro(e){if($n.currentNode){if(Ja(e))return e.identifier;var t=e[no];if(!Ja(t))throw new Error("identifier not found");return t.identifier}if(Wi(e))return e.__proxy.identifier;throw"object"!=R(e)?new Error("can not find identifier of ".concat(R(e))):null===e?new Error("can not find identifier of null"):new Error("identifier not found")}function io(e){return e instanceof ao}!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.HangUpObject=3]="HangUpObject"}(eo||(eo={}));var ao=function(e){m(n,e);var t=y(n);function n(e,r,i,a){var o;return M(this,n),(o=t.call(this,e,r,i)).struct=a,o}return O(n,[{key:"getDebugName",value:function(){return this.struct.classReflection.name}},{key:"createDisplayer",value:function(){return new(0,this.struct.displayerNodeClass)(this)}},{key:"kind",get:function(){return eo.AkkoObject}},{key:"clazz",get:function(){return this.struct.classReflection.clazz}},{key:"updateDisplayer",value:function(e){}},{key:"reportChanged",value:function(e){l(S(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"converge",value:function(){var e=this.realTarget;if(e){var t,n={},r=E(this.struct.serializableValueProperties);try{for(r.s();!(t=r.n()).done;){var i=t.value;i in e&&(n[i]=e[i])}}catch(e){r.e(e)}finally{r.f()}Object.setPrototypeOf(n,this.struct.classReflection.clazz.prototype),this.replaceIlluTarget(n)}}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Za(this,e);this.illuTarget=n;var r,i=aa(),a=E(this.struct.serializableValueProperties);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o in t,c=o in n;c&&!s?i.addProperty(this,o,n[o]):!c&&s?i.removeProperty(this,o):c&&s&&n[o]!==t[o]&&i.setProperty(this,o,n[o])}}catch(e){a.e(e)}finally{a.f()}}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){switch(this.struct.getPropertyReadableKind(e)){case _a.ReadValue:case _a.CanNotReadPrivateValue:l(S(n.prototype),"touchKey",this).call(this,e)}}},{key:"callOutside",value:function(e,t){var n,r=this;switch(this.assertAccessible(),this.struct.getMethodCallableKind(e)){case Ga.NoEffects:var i=this.proxyRuntime.runtime,a=this.proxyRuntime.noEffectsIdGenerator,o={authorId:null===i.observerId?nn:i.observerId,mode:Fa.Outside,timestamp:Date.now(),identifierGenerator:a};n=i.runWithMagix(o,(function(){var n=r.target(),i=n[e],o=r.proxyRuntime.pushValues(a,t,!1);return i.apply(n,o)}));break;case Ga.Modifiable:if(!this.struct.classReflection.isRootClass)throw new Error("can only call modifiable methods of trigger object");n=this.proxyRuntime.rootObject.onInvokedTriggerMethod(e,t);break;case Ga.EventReceiver:throw new Error("can't invoke event receiver. you should call dispatch()");case Ga.Private:throw new Error("can't invoke private method");default:var s;(s=void 0)[e].apply(s,C(t))}return this.proxyRuntime.pullValue(n)}},{key:"setValue",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n;n[e]=t,i?r!==t&&aa().setProperty(this,e,t):aa().addProperty(this,e,t);var a=this.sideTarget();return a&&(a[e]=t),t}return n[e]=t}},{key:"postfix",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n,a=n[e]+=t;i?r!==a&&aa().setProperty(this,e,a):aa().addProperty(this,e,a);var o=this.sideTarget();return o&&(o[e]=a),a}return n[e]+=t}},{key:"prefix",value:function(e,t){var n=this.target(),r=n[e];if(this.struct.isValueProperty(e)){var i=e in n,a=n[e]+=t;i?r!==a&&aa().setProperty(this,e,a):aa().addProperty(this,e,a);var o=this.sideTarget();o&&(o[e]=a)}else n[e]+=t;return r}},{key:"removeKey",value:function(e){if(this.struct.isValueProperty(e)){var t=this.target(),n=e in t;if(n){delete t[e],aa().removeProperty(this,e);var r=this.sideTarget();r&&delete r[e]}return n}return!1}},{key:"releaseDisplayer",value:function(e){}}]),n}(to),oo=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"getDebugName",value:function(){return"Object"}},{key:"createDisplayer",value:function(){var e=new _i(this);for(var t in this.displayerTarget())Gi(e,t);return e}},{key:"updateDisplayer",value:function(e){var t=this._displayer;if(t)for(var n in e)switch(e[n].kind){case ei.Inserted:Gi(t,n);break;case ei.Removed:Yi(t,n)}}},{key:"reportChanged",value:function(e){l(S(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"clazz",get:function(){return Object}},{key:"converge",value:function(){this.realTarget&&this.replaceIlluTarget(Vi({},this.realTarget))}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Za(this,e);this.illuTarget=n;var r=aa();for(var i in n){var a=n[i];i in t?t[i]!==a&&r.setProperty(this,i,a):r.addProperty(this,i,a)}for(var o in t)o in n||r.removeProperty(this,o)}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"setValue",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n;return n[e]=t,a?i!==t&&aa().setProperty(this,e,t):aa().addProperty(this,e,t),r&&(r[e]=t),t}},{key:"prefix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&aa().setProperty(this,e,o):aa().addProperty(this,e,o),r&&(r[e]=o),o}},{key:"postfix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&aa().setProperty(this,e,o):aa().addProperty(this,e,o),r&&(r[e]=o),i}},{key:"removeKey",value:function(e){var t=this.target(),n=e in t;if(n){delete t[e];var r=this.sideTarget();aa().removeProperty(this,e),r&&delete r[e]}return n}},{key:"releaseDisplayer",value:function(e){}}]),n}(to);function so(e){return e instanceof co}var co=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"kind",get:function(){return eo.FlatObject}},{key:"covertToAkkoObjectProxyNode",value:function(e){var t=this,n=this.realTarget,r=this.illuTarget;return t.struct=this.proxyRuntime.getAkkoObjectStruct(e),t._displayer=void 0,Object.setPrototypeOf(t,ao.prototype),Object.setPrototypeOf(n,e.clazz.prototype),r&&Object.setPrototypeOf(r,e.clazz.prototype),t}}]),n}(oo),uo=function(){function e(t){M(this,e),this.index=0,this.proxy=t,this.length=t.proxyRuntime.pullValue(t.displayerTarget().length),t.assertAccessible(),t.touchKey("length")}return O(e,[{key:Symbol.iterator,value:function(){return new e(this.proxy)}},{key:"next",value:function(){if(this.index>=this.length)return{value:void 0,done:!0};var e=this.proxy.displayerTarget()[this.index],t=this.proxy.proxyRuntime.pullValue(e);return this.proxy.assertAccessible(),this.proxy.touchKey(this.index),this.index+=1,{value:t,done:!1}}}]),e}(),lo=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),r=t.call(this,e);for(var i=e.displayerTarget(),a=0;a<i.length;++a)Gi(k(r),a);return r}return O(n,[{key:"concat",value:function(){for(var e=n.unwrapToPureArray(this),t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0;a<r.length;++a)r[a]=n.unwrapToPureArray(r[a]);return Array.prototype.concat(e,r)}},{key:"every",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.every.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"filter",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.filter.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"find",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=Array.prototype.find.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}));return r.pullValue(i)}},{key:"findIndex",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.findIndex.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"forEach",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;Array.prototype.forEach.call(this.__proxy.displayerTarget(),(function(i,a){e.call(t,r.pullValue(i),a,n)}))}},{key:"indexOf",value:function(e,t){var n=e;return Wi(n)&&(n=n.__proxy),Array.prototype.indexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"lastIndexOf",value:function(e,t){var n=e;return Wi(n)&&(n=n.__proxy),Array.prototype.lastIndexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"join",value:function(e){return Array.prototype.join.call(this.__proxy.displayerTarget(),e)}},{key:"map",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.map.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"reduce",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduce.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"reduceRight",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduceRight.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"slice",value:function(e,t){for(var n=this.__proxy.proxyRuntime,r=Array.prototype.slice.call(this.__proxy.displayerTarget(),e,t),i=0;i<r.length;++i)r[i]=n.pullValue(r[i]);return r}},{key:"some",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.some.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"toString",value:function(){return Array.prototype.toString.apply(this.__proxy.displayerTarget())}},{key:"copyWithin",value:function(){n.throwImmutableError()}},{key:"fill",value:function(){n.throwImmutableError()}},{key:"pop",value:function(){n.throwImmutableError()}},{key:"push",value:function(){n.throwImmutableError()}},{key:"reverse",value:function(){n.throwImmutableError()}},{key:"shift",value:function(){n.throwImmutableError()}},{key:"splice",value:function(){n.throwImmutableError()}},{key:"unshift",value:function(){n.throwImmutableError()}},{key:"sort",value:function(){n.throwImmutableError()}},{key:"entries",value:function(){n.throwBanMethodError()}},{key:"keys",value:function(){n.throwBanMethodError()}},{key:"values",value:function(){n.throwBanMethodError()}}],[{key:"refreshLength",value:function(e,t){for(var n=t;n in e;)Yi(e,n),n+=1;if(n===t)for(n=t-1;n>=0&&!(n in e);)Gi(e,n),n-=1}},{key:"unwrapToPureArray",value:function(e){if(e instanceof n){for(var t=e.__proxy.displayerTarget().length,r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}return e}},{key:"throwImmutableError",value:function(){throw new Error("it is immutable")}},{key:"throwBanMethodError",value:function(){throw new Error("ban method")}}]),n}(_i);function ho(e){return e instanceof fo}Object.defineProperty(lo.prototype,"length",{enumerable:!1,configurable:!0,get:function(){var e=this.__proxy,t=e.proxyRuntime.pullValue(e.displayerTarget().length);return e.touchKey("length"),t}}),"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&Object.defineProperty(lo.prototype,Symbol.iterator,{enumerable:!1,configurable:!0,writable:!1,value:function(){return new uo(this.__proxy)}});var po=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"getDebugName",value:function(){return"Array"}},{key:"createDisplayer",value:function(){return new lo(this)}},{key:"kind",get:function(){return eo.Array}},{key:"clazz",get:function(){return Array}},{key:"updateDisplayer",value:function(e){var t=this._displayer,n=e.length;t&&n&&lo.refreshLength(t,n.value)}},{key:"reportChanged",value:function(e){l(S(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t){var r=e.length;for(var i in r&&t.reportChanged("length",r.value,r.kind),e){var a=e[i],o=a.kind,s=a.value;a.isIndex&&t.reportChanged(parseInt(i,10),s,o)}}}},{key:"converge",value:function(){this.realTarget&&this.replaceIlluTarget(C(this.realTarget))}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Za(this,e);this.illuTarget=n;for(var r=Math.min(t.length,n.length),i=aa(),a=0;a<r;++a)t[a]!==n[a]&&i.setProperty(this,a,n[a]);this.refreshLength(t.length,n)}},{key:"getMethod",value:function(e){return n.arrayValidMethods[e]}},{key:"getValue",value:function(e){return"number"==typeof e?this.target()[e]:"length"===e?this.target().length:void 0}},{key:"setValue",value:function(e,t){var n=this.target(),r=n.length;if("number"==typeof e){if(e>=0){var i=e in n&&n[e]!==t,a=n[e]=t;i&&aa().setProperty(this,e,t);var o=this.sideTarget();return this.refreshLength(r,n),o&&(o[e]=t),a}return t}return n[e]}},{key:"removeKey",value:function(e){return!1}},{key:"prefix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&aa().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),s}}},{key:"postfix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&aa().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),o}}},{key:"releaseDisplayer",value:function(e){}},{key:"refreshLength",value:function(e,t){if(e!==t.length){var n=this.sideTarget(),r=aa();if(e>t.length){n&&n.splice(t.length);for(var i=t.length;i<e;++i)r.removeProperty(this,i)}else for(var a=e;a<t.length;++a)n&&(n[a]=t[a]),r.addProperty(this,a,t[a]);r.setProperty(this,"length",t.length)}}}],[{key:"createArrayValidMethods",value:function(){var e,t,n;$n.addListener((function(r,i){i&&r.tools?(e=r.tools.idGenerator,t=r.coreFunctions.updater,n=r.coreFunctions.creator):(e=void 0,t=void 0,n=void 0)}));var r,i=function(t,r){return t===r?t[no]:n(r,e.generate())},a={},o=E(Li);try{var s=function(){var e=r.value,n=e.methodName,o=e.returnArray,s=e.lengthChanged,c=e.elementChanged,u=e.touchLength,l=e.pickTouchedSegment,h=Array.prototype[n],d=s||c;a[n]=function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var p=this,f=p.length,v=p[no],m=h.apply(p,r);if(d&&!La(v))throw new Error("Magix is frozen, you can't call Array.".concat(n,"()"));var g=l&&l(p,r);if(s&&v.refreshLength(f,p),g)for(var y=Math.min(p.length,g.beginIndex+g.length),b=v.sideTarget(),k=aa(),w=g.beginIndex;w<y;++w){if(c){var S=p[w];b&&(b[w]=S),k.setProperty(v,w,S)}v.touchKey(w)}return u&&v.touchKey(),d&&t(v),o?i(p,m):m}};for(o.s();!(r=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return Object.freeze(a)}}]),n}(to),fo=po;function vo(e){return e instanceof go}fo.arrayValidMethods=po.createArrayValidMethods();var mo,go=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"version",get:function(){return this._version}},{key:"objectFormatId",get:function(){return this._objectFormatId}},{key:"setHangMetadata",value:function(e){if(this._version||this._objectFormatId)throw new Error("did set version");this._version=e.version,this._objectFormatId=e.objectFormatId}},{key:"kind",get:function(){return eo.HangUpObject}}]),n}(oo);function yo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new ko(t,n).copyValue(e)}!function(e){e[e.ExportsPropertyMode=0]="ExportsPropertyMode",e[e.SerializablePropertyMode=1]="SerializablePropertyMode"}(mo||(mo={}));var bo,ko=function(){function e(t,n){M(this,e),this.mode=t,this.creator=n,this.copedObjectMap={}}return O(e,[{key:"copyValue",value:function(e){return Wi(e)?this.copyProxyNode(e.__proxy):Ja(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n){var r=e.displayerTarget();if(so(e)){var i={};for(var a in this.copedObjectMap[t]=n=i,r)i[a]=this.copyInsideValue(e.proxyRuntime,r[a])}else if(io(e)){var o=e.struct,s=this.createAkkoObject(o.classReflection.clazz);this.copedObjectMap[t]=n=s;var c,u=E(this.getPropertiesToCopy(e));try{for(u.s();!(c=u.n()).done;){var l=c.value;s[l]=this.copyInsideValue(e.proxyRuntime,o.getValueFromProxyNode(e,l))}}catch(e){u.e(e)}finally{u.f()}}else if(ho(e)){var h=r.length,d=[];this.copedObjectMap[t]=n=d;for(var p=0;p<h;++p)d[p]=this.copyInsideValue(e.proxyRuntime,r[p])}}return n}},{key:"getPropertiesToCopy",value:function(e){switch(this.mode){case 0:return e.struct.copyableProperties;case 1:return e.struct.serializableValueProperties;default:throw new Error("invalid mode ".concat(this.mode))}}},{key:"createAkkoObject",value:function(e){return this.creator?this.creator(e):{}}},{key:"copyInsideValue",value:function(e,t){return"object"!=R(t)||null===t?t:Ja(t)?this.copyProxyNode(t):Pe(t)?t.readonly?t:t.slice():e.escapeObjectFilter(t)?t:void 0}}]),e}();$n.addListener((function(e,t){bo=t&&e.tools?e.coreFunctions:null}));var wo=function(){function e(){M(this,e),this.copedObjectMap={}}return O(e,[{key:"copyValue",value:function(e){return Ja(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n)if(so(e)||vo(e)){var r=bo.creator({});for(var i in this.copedObjectMap[t]=n=r,bo.unwrapper(e)){var a=this.copyValue(bo.getter(e,i));bo.setter(n,i,a)}}else if(io(e)){var o=e.struct,s={};Object.setPrototypeOf(s,o.classReflection.clazz.prototype);var c=bo.creator(s);this.copedObjectMap[t]=n=c;var u,l=E(o.serializableValueProperties);try{for(l.s();!(u=l.n()).done;){var h=u.value,d=this.copyValue(bo.getter(e,h));bo.setter(c,h,d)}}catch(e){l.e(e)}finally{l.f()}}else{if(!ho(e))throw new Error("invalid proxy node");var p=bo.getter(e,"length"),f=bo.creator([]);this.copedObjectMap[t]=n=f;for(var v=0;v<p;++v){var m=this.copyValue(bo.getter(e,v));bo.setter(f,v,m)}}return n}}]),e}(),So=function(){function e(t,n){var r=this;M(this,e),this.didDispose=!1,this.onAkkoProxyNodeUpdated=function(e){if(r.observer)for(var t in e){var n=e[t],i=n.kind,a=n.value;r.observer.reportChanged(t,a,i)}},this.struct=t.struct,this.observerAdapter=n,this._akkoProxyNode=t,this.displayer=this.createDisplayer(t),this._akkoProxyNode.addListener(this.onAkkoProxyNodeUpdated),this.valueProperties=Object.freeze([].concat(C(this.struct.transientValueProperties),C(this.struct.serializableValueProperties)))}return O(e,[{key:"dispose",value:function(){this.didDispose||(this._akkoProxyNode.removeListener(this.onAkkoProxyNodeUpdated),this.didDispose=!0)}},{key:"akkoProxyNode",get:function(){return this._akkoProxyNode},set:function(e){var t=this;this._akkoProxyNode!==e&&(this._akkoProxyNode.removeListener(this.onAkkoProxyNodeUpdated),this.observerAdapter?this.observerAdapter.observeUpdate((function(){t.compareAndReportUpdated(t._akkoProxyNode,e),t._akkoProxyNode=e})):(this.compareAndReportUpdated(this._akkoProxyNode,e),this._akkoProxyNode=e))}},{key:"compareAndReportUpdated",value:function(e,t){if(this.observer){var n,r=e.displayerTarget(),i=t.displayerTarget(),a=E(this.valueProperties);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o in r,c=o in i;s&&!c?this.observer.reportChanged(o,void 0,ei.Removed):!s&&c?this.observer.reportChanged(o,i[o],ei.Inserted):r[o]!==i[o]&&this.observer.reportChanged(o,i[o],ei.Updated)}}catch(e){a.e(e)}finally{a.f()}this.observer.reportChanged(no,t,ei.Updated)}}},{key:"createDisplayer",value:function(e){var t=this,n=e.struct.classReflection,r=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(_i),i=function(e){Object.defineProperty(r.prototype,e,{enumerable:!1,configurable:!1,get:function(){return t.getProperty(e)},set:function(){throw new Error("cannot set property ".concat(e," which has only a getter"))}})};for(var a in n.properties)i(a);var o=function(e){r.prototype[e]=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.invokeMethod(e,r)}};for(var s in n.methods)o(s);return new r(e)}},{key:"getProperty",value:function(e){var t,n=this,r=this.akkoProxyNode.proxyRuntime;switch(this.struct.getPropertyReadableKind(e)){case _a.ReadValue:t=r.pullValue(this.akkoProxyNode.displayerTarget()[e]),this.touchKey(e);break;case _a.ReadByGetter:var i=r.runtime,a=r.noEffectsIdGenerator,o={authorId:null===i.observerId?nn:i.observerId,mode:Fa.Outside,timestamp:Date.now(),identifierGenerator:a};t=i.runWithMagix(o,(function(){return n.akkoProxyNode.target()[e]})),this.touchKey(no),t=r.pullValue(t);break;case _a.CanNotReadGetter:throw new Error("can't read property ".concat(JSON.stringify(e)," unless it has @noEffects"));case _a.CanNotReadPrivateValue:case _a.CanNotReadPrivateGetter:throw new Error("can't read private property ".concat(JSON.stringify(e)))}return t}},{key:"invokeMethod",value:function(e,t){var n=this.akkoProxyNode.callOutside(e,t);return this.touchKey(no),n}},{key:"touchKey",value:function(e){var t=this.observerAdapter;t&&(this.observer||(this.observer=t.create("AkkoDisplayerHolder")),this.observer.reportObservedKey(e))}}]),e}(),xo=null;$n.addListener((function(e,t){xo=t?e.coreFunctions:null}));var Io,Co=function(){function e(){M(this,e)}return O(e,[{key:"isValidObject",value:function(e){return io(e)}},{key:"isDisplayerObject",value:function(e){return Wi(e)}},{key:"identifier",value:function(e){return e.identifier}},{key:"kind",value:function(e){if(io(e))return Kn.AkkoObject;if(so(e))return Kn.FlatObject;if(ho(e))return Kn.Array;if(Wi(e))return Kn.Displayer;throw new Error("unrecognized proxy node")}},{key:"forEach",value:function(e,t){if(so(e)){var n=e.target();for(var r in n)t(n[r],r)}else if(ho(e))for(var i=e.target(),a=0;a<i.length;++a)t(i[a],a);else if(io(e)){var o,s=e.target(),c=E(e.struct.serializableValueProperties);try{for(c.s();!(o=c.n()).done;){var u=o.value;t(s[u],u)}}catch(e){c.e(e)}finally{c.f()}}}},{key:"createObject",value:function(e,t){return xo.creator(t,e)}},{key:"wrapDisplayer",value:function(e,t){return t.displayer}},{key:"unwrapDisplayer",value:function(e,t){return t.__proxy}},{key:"getClassReflection",value:function(e){var t=e;if(Wi(t)&&(t=t.__proxy),io(t))return t.struct.classReflection}},{key:"override",value:function(e,t,n){if(so(e)){for(var r in xo.unwrapper(e))r in t||xo.remover(e,r);for(var i in t)xo.setter(e,i,t[i])}else if(ho(e)){var a=t,o=xo.getter(e,"length");a.length>o&&xo.caller(e,"splice",[o]);for(var s=0;s<a.length;++s)xo.setter(e,s,a[s])}else if(io(e)){var c,u=e.proxyRuntime.getAkkoObjectStruct(n),l=E(u.transientValueProperties);try{for(l.s();!(c=l.n()).done;){var h=c.value;xo.remover(e,h)}}catch(e){l.e(e)}finally{l.f()}var d,p=E(u.serializableValueProperties);try{for(p.s();!(d=p.n()).done;){var f=d.value;xo.setter(e,f,t[f])}}catch(e){p.e(e)}finally{p.f()}}}},{key:"displayerPhase",value:function(e){if(Wi(e))return Hi(e);throw new Error("it isn't akko wrapped object")}},{key:"copyDisplayer",value:function(e){return yo(e)}}]),e}();function Po(e,t,n){return new co(e,t,n)}function Mo(e,t,n,r){return new ao(e,t,n,r)}function To(e,t,n){return new fo(e,t,n)}$n.addListener((function(e,t){Io=t?e.coreFunctions.creator:void 0}));var Oo=function(){function e(t,n){M(this,e),this.decorateObjectEnums=Object.freeze([rt.Object]),this.proxyRuntime=t,this.covertIdToClass=n}return O(e,[{key:"createObject",value:function(e,t){if(t===rt.HangUpObject)return function(e,t,n){return new go(e,t,n)}(this.proxyRuntime,e,{});var n=t===rt.Array?[]:{};return Io?Io(n,e):Zi(this.proxyRuntime,n,e)}},{key:"findIdentifier",value:function(e){var t=e.identifier;if(void 0===t)throw Ja(e)?new Error("can't find identifier of proxy node"):new Error("object should be proxy node");return t}},{key:"findHangUpMetadata",value:function(e){if(!vo(e))throw new Error("it's not hang up object");return e}},{key:"checkObjectEnum",value:function(e){switch(e.kind){case eo.Array:return rt.Array;case eo.AkkoObject:case eo.FlatObject:return rt.Object;case eo.HangUpObject:return rt.HangUpObject;default:throw new Error("unrecognized object")}}},{key:"keys",value:function(e){return Object.keys(e.target())}},{key:"length",value:function(e){if(ho(e))return e.target().length}},{key:"hasKey",value:function(e,t){return t in e.target()}},{key:"getValue",value:function(e,t){return e.target()[t]}},{key:"setValue",value:function(e,t,n){e.setValue(t,n)}},{key:"completeHangUpObject",value:function(e,t){vo(e)&&e.setHangMetadata(t)}},{key:"decorateObject",value:function(e,t,n,r,i){if(r&&t===nt.AssertedObject){var a=this.covertIdToClass(r.id);if(!a)throw new kt("can't find class by object format id ".concat(r.id));var o=a[fr];so(e)&&e.covertToAkkoObjectProxyNode(o)}}}]),e}();var Eo=function(){function e(t,n){M(this,e),this.assertObjectFormat=function(e){if(io(e))return e.struct.classReflection.objectFormat},this.proxyRuntime=t,this.objectAdapter=function(e,t){return new Oo(t,e.covertObjectFormatIdToClass)}(n,t),this.frameSerialization=function(e,t){var n=ai(e.rootClass);return Xn(new Ot({format:e.format,objectAdapter:t,assertObjectFormat:function(e){if(io(e))return e.struct.classReflection.objectFormat}}),n)}(n,this.objectAdapter)}return O(e,[{key:"serializeSnapshotFrame",value:function(e){return this.frameSerialization.serializeSnapshotFrame(e)}},{key:"serializeActionFrame",value:function(e,t){return this.frameSerialization.serializeActionFrame(e,t)}},{key:"deserializeSnapshotFrame",value:function(e,t,n){return this.frameSerialization.deserializeSnapshotFrame(e,t,n)}},{key:"deserializeActionFrame",value:function(e,t,n,r){var i=this;return r?this.proxyRuntime.runtime.runWithSerialization(r,(function(){return i.frameSerialization.deserializeActionFrame(e,t,n)})):this.frameSerialization.deserializeActionFrame(e,t,n)}},{key:"createSerialization",value:function(e){return new Ot({format:e,objectAdapter:this.objectAdapter,assertObjectFormat:this.assertObjectFormat})}}]),e}(),Ao=function(){function e(t,n,r){M(this,e),this.runtime=t,this.rootObject=n,this.observerAdapter=r}return O(e,[{key:"initialize",value:function(){this.holder=new So(this.rootObject,this.observerAdapter)}},{key:"initializeWithOriginRootObject",value:function(e){this.holder=e.holder,this.holder.akkoProxyNode=this.rootObject}},{key:"observerId",get:function(){return this.runtime.observerId}},{key:"displayer",get:function(){return this.holder.displayer}},{key:"target",get:function(){return this.rootObject.target()}},{key:"getRootMethod",value:function(e){return this.rootObject.getMethod(e)}},{key:"snapshotRootObject",value:function(){return this.rootObject}}]),e}(),No=function(){function e(t){M(this,e),this.params=Object.freeze(Vi({},t)),this.objectOperator=new Co}return O(e,[{key:"createProxyRuntime",value:function(e,t){return new ua(this.objectOperator,e,t,{escapeObjectFilter:this.params.escapeObjectFilter,jsxFactory:this.params.jsxFactory,observerAdapter:this.params.observerAdapter})}}]),e}();function Ro(e){if(!Wi(e))throw new Error("it isn't akko wrapped object");return qn.Rejected!==Hi(e)}function Lo(e,t){return Wi(e)?e.__proxy.displayerTarget()instanceof t:Ja(e)?e.displayerTarget()instanceof t:e instanceof t}function jo(e){var t=Do(e);if(t===Object)return-1;if(t===Array)return-2;if(void 0===t)return-3;var n=t[fr];return n?n.id:-3}function Do(e){switch(R(e)){case"function":return e;case"object":if(null!==e)return function(e){var t=e.__proxy;switch(function(e){if(io(e))return Kn.AkkoObject;if(so(e))return Kn.FlatObject;if(ho(e))return Kn.AkkoObject;if(Wi(e))return Kn.Displayer;throw new Error("unrecognized proxy node")}(t)){case Kn.FlatObject:return Object;case Kn.Array:return Array;case Kn.AkkoObject:return function(e){var t=e;if(Wi(t)&&(t=t.__proxy),io(t))return t.struct.classReflection}(t).clazz}return e.constructor}(e)}}function zo(e){return $n.currentNode?function(e){return(new wo).copyValue(e)}(e):yo(e)}var Fo=W(n("cr+I")),Bo=W(n("cr+I")),Uo=W(n("cr+I")),Vo=W(n("cr+I")),Wo=W(n("cr+I")),Ho=Object.defineProperty,_o=Object.defineProperties,Go=Object.getOwnPropertyDescriptors,Yo=Object.getOwnPropertySymbols,Xo=Object.prototype.hasOwnProperty,Qo=Object.prototype.propertyIsEnumerable,Zo=function(e,t,n){return t in e?Ho(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Ko=function(e,t){for(var n in t||(t={}))Xo.call(t,n)&&Zo(e,n,t[n]);if(Yo){var r,i=E(Yo(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Qo.call(t,n)&&Zo(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},qo=function(e,t){return _o(e,Go(t))},Jo=function(){function e(){M(this,e)}return O(e,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $o(e)}}]),e}(),$o=function(){function e(t){M(this,e),this.callbacks=Object.freeze(this.wrapCallbacks(t))}return O(e,[{key:"wrapCallbacks",value:function(t){var n,r={},i=E(e.callbackKeys);try{var a=function(){var e=n.value,i=t[e];r[e]=i||function(){throw new Error("can't call. ".concat(e," not register"))}};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return Object.freeze(r)}},{key:"convertIdToUrl",value:function(e){return this.callbacks.convertIdToUrl(e)}}]),e}();$o.callbackKeys=Object.freeze(["convertIdToUrl"]);var es=function(){function e(){M(this,e),this.paddingResolves=[]}return O(e,[{key:"hasValue",get:function(){return!this.paddingResolves}},{key:"getValueRightNow",value:function(){return this.value}},{key:"getValue",value:function(){var e=this;return this.hasValue?this.error?Promise.reject(this.error):Promise.resolve(this.value):new Promise((function(t,n){return e.paddingResolves.push({resolve:t,reject:n})}))}},{key:"catchError",value:function(e){if(!this.hasValue){var t,n=E(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.reject)(e)}}catch(e){n.e(e)}finally{n.f()}this.value=void 0,this.error=e,this.paddingResolves=null}return this}},{key:"setValue",value:function(e){if(this.hasValue)throw new Error("did set value");this.value=e,this.error=void 0;var t,n=E(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.resolve)(e)}}catch(e){n.e(e)}finally{n.f()}return this.paddingResolves=null,this}}]),e}(),ts=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,n.createMessage(e))).name=e.title,r.title=e.title,r.messages=e.messages?Object.freeze(C(e.messages)):n.emptyArray,r.statusCode=e.statusCode,r.errorCode=e.errorCode,r}return O(n,null,[{key:"createMessage",value:function(e){var t=e.title;return e.messages&&e.messages.length>0&&(t+=": "+e.messages.join("; ")),t}}]),n}(f(Error));ts.emptyArray=Object.freeze([]);var ns=function(){function e(t,n,r,i){var a=this;M(this,e),this.keyFetcherValue=new es,this.akkoVersionValue=n,t.getValue().then((function(e){return a.keyFetcherValue.setValue(e.getFetcher(r).fetch(i))})).catch((function(e){return a.keyFetcherValue.catchError(e)}))}var t,n,r;return O(e,[{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}},{key:"fetchJSON",value:(r=I(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(r=e.sent,!this.isSuccessStatus(r,n)){e.next=13;break}return e.next=9,r.text();case 9:return i=e.sent,e.abrupt("return",""===i?void 0:JSON.parse(i));case 13:return e.next=15,this.createError(r);case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBuffer",value:(n=I(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(404!==(r=e.sent).status){e.next=8;break}return e.abrupt("return",null);case 8:if(!this.isSuccessStatus(r,n)){e.next=23;break}if(!r.arrayBuffer){e.next=17;break}return e.t2=Ce,e.next=13,r.arrayBuffer();case 13:e.t3=e.sent,e.t1=(0,e.t2)(e.t3),e.next=22;break;case 17:return e.t4=Ce,e.next=20,r.buffer();case 20:e.t5=e.sent,e.t1=(0,e.t4)(e.t5);case 22:return e.abrupt("return",e.t1);case 23:return e.next=25,this.createError(r);case 25:throw e.sent;case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"createError",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.headers.get("content-type"))&&!/application\/json/i.test(n)){e.next=17;break}return e.prev=2,e.next=5,t.json();case 5:r=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",new Error("response with status "+t.status+" and parse error JSON failed: "+e.t0.message));case 11:if("object"==R(r.error)&&null!==r.error){e.next=13;break}return e.abrupt("return",new Error("response with status "+t.status+" without error object"));case 13:return i=r.error,a=i.code,o=i.title,s=i.messages,e.abrupt("return",new ts({statusCode:t.status,errorCode:a,title:o,messages:s}));case 17:return e.t1=Error,e.t2="response with status "+t.status+" with text ",e.next=21,t.text();case 21:return e.t3=e.sent,e.t4=e.t2+e.t3,e.abrupt("return",new e.t1(e.t4));case 24:case"end":return e.stop()}}),e,null,[[2,8]])}))),function(e){return t.apply(this,arguments)})},{key:"isSuccessStatus",value:function(e,t){var n=e.status;switch(t&&t.method||"get"){case"get":return 200===n||206===n;case"delete":return 204===n;default:return 201===n}}}]),e}(),rs=function(){function e(t,n){M(this,e),this.configmap=t,this.onIngoreFetchError=n,this.fetchers={},this.supportRegions=this.collectRegions(t)}return O(e,[{key:"collectRegions",value:function(e){var t={};for(var n in e)for(var r in e[n].hosts)t[r]=!0;return t}},{key:"getFetcher",value:function(e){var t=this.fetchers[e];if(!t){if(!this.supportRegions[e])throw new Error("invalid region ".concat(JSON.stringify(e)));t=this.fetchers[e]=new te({fetcher:fetch.bind(window),region:e,configmap:this.configmap,onIngoreFetchError:this.onIngoreFetchError,retryCount:2,retryLoopsCount:0})}return t}}]),e}();function is(e){if("object"==R(e)&&null!==e){for(var t in e)is(e[t]);Object.freeze(e)}return e}function as(e){if("object"!=R(e)||null===e)return e;if(e instanceof Array){for(var t=[],n=0;n<e.length;++n)t[n]=as(e[n]);return t}var r={};for(var i in e)r[i]=as(e[i]);return r}var os,ss=new(function(){function e(){M(this,e),this.node=null}var t,n;return O(e,[{key:"getAkkoAppConfigs",value:(n=I(regeneratorRuntime.mark((function e(t,n,r){var i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node&&this.node.appIdentifier===t||(i=new es,this.node=Object.freeze({appIdentifier:t,configsValue:i}),this.fetchAkkoAppConfigs(t,n,r).then((function(e){return i.setValue(is(e))})).catch((function(e){i.catchError(e),setTimeout((function(){return a.node=null}),0)}))),e.t0=as,e.next=4,this.node.configsValue.getValue();case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchAkkoAppConfigs",value:(t=I(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new rs({api:{hosts:{"*":n}}},r),a=(new es).setValue(i),o=new es,s=new ns(a,o,"*","api"),c=(0,Fo.stringify)({app:t}),e.next=3,s.fetchJSON("https://shunt-api/v5/configs/regions?".concat(c));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}());function cs(e,t,n){return ss.getAkkoAppConfigs(e,t,n)}!function(e){e[e.Ready=0]="Ready",e[e.Setuping=1]="Setuping",e[e.Fail=2]="Fail"}(os||(os={}));var us=function(){function e(t){var n=this;M(this,e),this.fetcherPhase=1,this.getAkkoFetcher=function(){var e=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 2===n.fetcherPhase&&n.setupFetcher(),e.next=3,n.fetchersHubValue.getValue();case 3:return e.abrupt("return",e.sent.getFetcher(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onIngoreFetchError=function(e){console.warn("fetch failed but ignore: ".concat(e.message))},this.params=Object.freeze(qo(Ko({},t),{shuntApiHosts:Object.freeze(C(t.shuntApiHosts))})),this.akkoVersionValue=new es,this.setupFetcher()}var t;return O(e,[{key:"create",value:function(e){return new ls(this.fetchersHubValue,this.akkoVersionValue,this.getAkkoFetcher,e)}},{key:"setupFetcher",value:(t=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.params,n=t.appIdentifier,r=t.shuntApiHosts,i=t.onInterruptConfigs,a=t.onAkkoSetupFailed,e.prev=1,this.fetchersHubValue=new es,this.fetcherPhase=1,e.next=5,cs(n,r,this.onIngoreFetchError);case 5:o=e.sent,i&&(o=i(o)),this.akkoVersionValue.setValue(o.akkoVersion),this.fetchersHubValue.setValue(new rs(o.configmap,this.onIngoreFetchError)),this.fetcherPhase=0,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.fetchersHubValue.catchError(new Error("akko setup failed: ".concat(e.t0.message))),this.fetcherPhase=2,a&&a(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return t.apply(this,arguments)})}]),e}(),ls=function(){function e(t,n,r,i){M(this,e),this.fetchersHubValue=t,this.akkoVersionValue=n,this.getAkkoFetcher=r,this.region=i}var t,n;return O(e,[{key:"fetch",value:(n=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new ns(this.fetchersHubValue,this.akkoVersionValue,this.region,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"origin",value:(t=I(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAkkoFetcher(this.region);case 2:return e.abrupt("return",e.sent.origin(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"reportSuccess",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportSuccess(e,t)}))}},{key:"reportFail",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportFail(e,t)}))}},{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}}]),e}(),hs=function(){function e(t,n){var r=this;M(this,e),this.netState=t,this.onNetStateUpdate=n,this.paddingResolver=[],this._didDispose=!1,this.onOnline=function(){r._isOnline=!0,r.onNetStateUpdate&&r.onNetStateUpdate(!0),r.handleAllPaddingResolver(!0)},this.onOffline=function(){r._isOnline=!1,r.onNetStateUpdate&&r.onNetStateUpdate(!1)},t.addListener(this.listener={onOnline:this.onOnline,onOffline:this.onOffline}),this._isOnline=t.isOnline}return O(e,[{key:"isOnline",get:function(){return this._isOnline}},{key:"didDispose",get:function(){return this._didDispose}},{key:"dispose",value:function(){try{this.handleAllPaddingResolver(!1),this.netState.removeListener(this.listener)}finally{this._didDispose=!0}}},{key:"makeSureOnline",value:function(){var e=this;return this._didDispose?Promise.resolve(!1):this._isOnline?Promise.resolve(!0):new Promise((function(t){e.paddingResolver.push(t)}))}},{key:"handleAllPaddingResolver",value:function(e){var t,n=E(this.paddingResolver.splice(0,this.paddingResolver.length));try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(e){n.e(e)}finally{n.f()}}}]),e}();var ds="undefined"!=typeof WebSocket?WebSocket:r.WebSocket;var ps=function(){function e(t,n){var r=this,i=n.logger,a=n.timeout,o=n.roomToken,s=n.webSocketQuery,c=n.callbacks;M(this,e),this.disconnectedCallbacks=[],this.actionFramesInterrupter=[],this.snapshotFrameInterrupter=null,this._connectingDuration=-1,this.onReceiveSnapshotFrame=function(e){r.snapshotFrameInterrupter=e},this.onReceiveActionFrame=function(e){r.actionFramesInterrupter?r.actionFramesInterrupter.push(e):r.callbacks.onReceivedActionFrame(e)},this.onReceiveScopeSlices=function(e){r.callbacks.onReceivedScopeSlices(function(e){for(var t=new Ht(e),n=[],r=t.readUint32(),i=0;i<r;++i){var a=t.readInt53(),o=t.readUint32();n.push(Object.freeze({beginScopeId:a,count:o}))}return Object.freeze(n)}(e))},this.onHangUp=function(){r.socket.disconnect(),r.callbacks.onKickWithReason($r.GatewayAdjust)},this.onDisconnect=function(e){var t=e.reason,n=e.message,i=r.isConnected();r._sessionBuild=void 0;var a=t===Sn.WebSocketError||t===Sn.CommunicationError;if(r.disconnectedCallback(n,a),i)switch(t){case Sn.WebSocketError:case Sn.CommunicationError:r.callbacks.onDisconnectedWithSocketError(new Error(n));break;case Sn.Normal:r.callbacks.onKickWithReason(n);break;case Sn.RemoteError:r.callbacks.onDisconnectedByServer(new Error(n))}};var u="".concat(t,"?").concat(function(e,t){var n={room:t.uuid,token:e,combinable:!0,sessionToken:t.sessionToken,akkoVersion:t.akkoVersion,clientVersion:t.clientVersion,markWritable:t.markWritable,access:t.access};for(var r in n)void 0===n[r]&&delete n[r];return(0,Bo.stringify)(n)}(o,s)),l=new ds(u);this.logger=i,this.timeout=a,this.uuid=s.uuid,this.libraryDescriptionSerialization=new gi,this.socket=Si.createSocket(l,i,{onDisconnect:this.onDisconnect}),this.socket.on("snapshot",this.onReceiveSnapshotFrame),this.socket.on("action",this.onReceiveActionFrame),this.socket.on("allocate-scope",this.onReceiveScopeSlices),this.socket.on("hang-up",this.onHangUp),this.callbacks=Object.freeze(Ko({},c))}var t,n;return O(e,[{key:"connectingDuration",get:function(){return this._connectingDuration}},{key:"setAccessUpdaterSerialization",value:function(e){this.accessUpdaterSerialization=e}},{key:"bindPingPongNode",value:function(e){e.bindSocket(this.socket)}},{key:"sessionBuild",get:function(){if(!this._sessionBuild)throw new Error("not connected");return this._sessionBuild}},{key:"sendActionFrame",value:function(e){this.socket.emit("action",e)}},{key:"isConnected",value:function(){return!!this._sessionBuild}},{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var r=function(){var t=e.disconnectedCallbacks.indexOf(a);-1!==t&&e.disconnectedCallbacks.splice(t,1),null!==i&&(clearTimeout(i),i=null),e.socket.off("session-build",o)},i=setTimeout((function(){r(),n(new Error("receive session-build event timeout"))}),e.timeout),a=function(e,i){r(),i?t(e):n(new Error("connect failed: ".concat(e)))};e.disconnectedCallbacks.push(a);var o=function(n){r();var i=e.snapshotFrameInterrupter,a=e.actionFramesInterrupter;e._sessionBuild=function(e){var t=new Ht(e),n=t.readString(),r=t.readString(),i=t.readString();return Object.freeze({session:n,sessionToken:r,slice:i})}(n),e.snapshotFrameInterrupter=null,e.actionFramesInterrupter=null,t({snapshot:i,actionFrames:a})};e.socket.on("session-build",o),e.socket.on("library-description",(function t(n){var r=e.libraryDescriptionSerialization.deserialize(n);e.callbacks.onReceivedLibraryDescription(r),e.socket.off("library-description",t)})),e.socket.waitToConnected().then((function(t){var n=t.duration;return e._connectingDuration=n})).catch((function(t){e.logger.warn(t.message),a(t.message,!0)}))}))}},{key:"disconnect",value:function(){return this.disconnectedCallback("disconnect",!1),this.socket.disconnect()}},{key:"disconnectWithError",value:function(e){return this.disconnectedCallback(e.message,!1),this.socket.disconnectWithErrorDescription({message:e.message})}},{key:"updateToWritable",value:(n=I(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={kind:ti.Writable,userPayload:t,connectedPayload:n},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(r)),e.next=4,this.interruptEvent("allocate-user",[wi.WritableAccessForbidden,wi.StuffedOfWritableUsers,wi.WrongWritablePhase]);case 4:if(void 0===(i=e.sent).errorCode){e.next=12;break}e.t0=i.errorCode,e.next=e.t0===wi.WritableAccessForbidden?9:e.t0===wi.StuffedOfWritableUsers?10:e.t0===wi.WrongWritablePhase?11:12;break;case 9:throw new Error("can't update to writable. you don't have permission");case 10:throw new Error("room is stuffed of writable users");case 11:throw new Error("it's wrong writable phase");case 12:return e.abrupt("return",void 0!==i.target?vi(i.target):null);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"updateToReadonly",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={kind:ti.Readonly,payload:t},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(n)),e.next=4,this.interruptEvent("release-user",[wi.NoUserToRelease,wi.WrongWritablePhase]);case 4:if(void 0===(r=e.sent).errorCode){e.next=11;break}e.t0=r.errorCode,e.next=e.t0===wi.NoUserToRelease?9:e.t0===wi.WrongWritablePhase?10:11;break;case 9:throw new Error("room don't have user to release");case 10:throw new Error("it's wrong writable phase");case 11:return e.abrupt("return",void 0!==r.target);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disconnectedCallback",value:function(e,t){var n,r=E(this.disconnectedCallbacks.splice(0));try{for(r.s();!(n=r.n()).done;){(0,n.value)(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"interruptEvent",value:function(e,t){var n=this;return new Promise((function(r){var i=function(){var t=n.disconnectedCallbacks.indexOf(a);-1!==t&&n.disconnectedCallbacks.splice(t,1),n.socket.off(e,o),n.socket.off("error",s)},a=function(){i(),r({})};n.disconnectedCallbacks.push(a);var o=function(e){i(),r({target:e})},s=function(e){-1!==t.indexOf(e)&&(i(),r({errorCode:e}))};n.socket.on(e,o),n.socket.on("error",s)}))}}]),e}(),fs=function(){function e(){M(this,e),this.switchOn=!0}return O(e,[{key:"wrapCallbacks",value:function(e){var t=this,n={},r=function(r){var i=e[r];n[r]="function"==typeof i?function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.switchOn)return i.apply(n,r)}:i};for(var i in e)r(i);return Object.freeze(n)}}]),e}(),vs=Object.freeze([1e3,1e3,1e3,3e3,3e3,5e3,5e3]);function ms(e){return new Promise((function(t){return setTimeout(t,e)}))}var gs=function(){function e(t,n,r){var i=this;M(this,e),this._didDispose=!1,this.connectionTask=null,this.operator=null,this.connectionNode=null,this.onNetStateUpdate=function(e){i._didDispose||(e?i.connectionTask&&i.startConnectionTask():i.operator&&(i.operator.cancel(),i.operator=null))},this.logger=t,this.fetcher=n,this.netStatePaddingNode=r&&new hs(r,this.onNetStateUpdate)}var t;return O(e,[{key:"dispose",value:function(){this._didDispose||(this._didDispose=!0,this.operator&&this.operator.cancel(),this.connectionTask=null,this.operator=null,this.netStatePaddingNode&&this.netStatePaddingNode.dispose())}},{key:"connect",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._didDispose){e.next=2;break}throw new Error("did dispose");case 2:if(!this.connectionTask){e.next=4;break}throw new Error("is connecting");case 4:if(this.connectionNode&&(this.connectionNode.filter.switchOn=!1,this.connectionNode=null),e.t0=this.netStatePaddingNode,!e.t0){e.next=10;break}return e.next=9,this.netStatePaddingNode.makeSureOnline();case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}throw new Error("offline");case 12:return n=new Promise((function(e,n){var i=new fs;r.connectionTask={resolve:e,reject:n,filter:i,params:qo(Ko({},t),{callbacks:i.wrapCallbacks(t.callbacks)})}})),this.startConnectionTask(),e.prev=14,e.next=17,n;case 17:return e.abrupt("return",e.sent);case 18:return e.prev=18,this.connectionTask=null,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[14,,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"startConnectionTask",value:function(){var e=this,t=new ys(this.logger,this.fetcher),n=this.connectionTask,r=n.params,i=n.filter,a=n.resolve,o=n.reject;this.operator=t,this.operator.connect(r).then((function(n){n&&t===e.operator&&(a(n),e.operator=null,e.connectionNode={filter:i,connection:n.connection})})).catch((function(n){t===e.operator&&(o(n),e.operator=null)}))}}]),e}(),ys=function(){function e(t,n){M(this,e),this.logger=t,this.fetcher=n,this.connection=null,this.isCancel=!1}var t;return O(e,[{key:"connect",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",r=0;case 2:if(!(r<vs.length+1)){e.next=33;break}return e.next=5,this.fetcher.origin("wss","realtime");case 5:return i=e.sent,a=Date.now(),this.connection=new ps(i,t),o=Date.now(),e.next=11,this.connection.connect();case 11:if(s=e.sent,!this.isCancel){e.next=19;break}if(this.fetcher.reportSuccess("realtime",Date.now()-a),e.t0=s&&this.connection,!e.t0){e.next=18;break}return e.next=18,this.connection.disconnectWithError(new Error("cancel connect"));case 18:return e.abrupt("return",null);case 19:if("object"!=R(s)){e.next=21;break}return e.abrupt("return",(this.fetcher.reportSuccess("realtime",Date.now()-a),{connection:this.connection,snapshot:s.snapshot,actionFrames:s.actionFrames,retryCount:r}));case 21:if(this.fetcher.reportFail("realtime",Date.now()-a),n=s,this.connection=null,c=vs[r],e.t1=void 0!==c&&o+c-Date.now()>0,!e.t1){e.next=28;break}return e.next=27,ms(c);case 27:e.t1=this.isCancel;case 28:if(!e.t1){e.next=30;break}return e.abrupt("return",null);case 30:++r,e.next=2;break;case 33:throw new Error("connect fail after multiple retries: "+n);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"cancel",value:function(){var e=this;this.connection&&(this.connection.disconnectWithError(new Error("cancel connect")).catch((function(t){return e.logger.error(t)})),this.connection=null),this.isCancel=!0}}]),e}();function bs(e){var t=ri(e);if(!t)throw new Error("can't find library from ".concat(e.name,". it's not root class"));return t}var ks=function(){};function ws(e){return Ss.apply(this,arguments)}function Ss(){return(Ss=I(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Is(t),e.next=3,n.connect();case 3:return r=e.sent,e.abrupt("return",{session:n,snapshot:r.snapshot,actionFrames:r.actionFrames,connection:r.connection,retryCount:r.retryCount});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xs,Is=function(){function e(t){var n=this;M(this,e),this.connectingResult=null,this._connection=null,this._libraryNode=null,this.onDisconnectedByServer=function(e){n._connection=null,n._libraryNode=null,n.callbacks.onDisconnectedByServer&&n.callbacks.onDisconnectedByServer(e)},this.onKickWithReason=function(e){n._connection=null,n._libraryNode=null,n.reconnectionOptions.disableReconnect||e!==$r.GatewayAdjust&&e!==$r.RoomZombie?n.callbacks.onKickWithReason&&n.callbacks.onKickWithReason(e):n.startReconnect(new Error("room became zombie"))},this.onDisconnectedWithSocketError=function(){var e=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._connection=null,n._libraryNode=null,!n.reconnectionOptions.disableReconnect){e.next=6;break}n.callbacks.onDisconnectedWithSocketError&&n.callbacks.onDisconnectedWithSocketError(t),e.next=8;break;case 6:return e.next=8,n.startReconnect(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.logger=t.logger,this.uuid=t.uuid,this.roomToken=t.roomToken,this.timeout=t.timeout,this.markWritable=t.markWritable,this.clientVersion=t.clientVersion,this.reconnectionOptions=t.reconnectionOptions,this.access=t.access,this.objectOperator=t.objectOperator,this.libraryNodeFetcher=t.libraryNodeFetcher,this.connectionBuilder=new gs(t.logger,t.fetcher,t.netState),this.callbacks=Object.freeze(Ko({},t.callbacks))}var t,n;return O(e,[{key:"session",get:function(){return this.sessionBuild.session}},{key:"slice",get:function(){return this.sessionBuild.slice}},{key:"connection",get:function(){return this._connection}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"dispose",value:function(){this.connectionBuilder.dispose()}},{key:"connect",value:(n=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=2;break}throw new Error("WebSocketSession is connecting");case 2:return t=new es,n=this.connectingResult=new es,e.prev=3,e.next=6,this.connectionBuilder.connect({logger:this.logger,roomToken:this.roomToken,timeout:this.timeout,webSocketQuery:{uuid:this.uuid,akkoVersion:Ge,clientVersion:this.clientVersion,markWritable:this.markWritable,access:this.access,sessionToken:this.sessionBuild&&this.sessionBuild.sessionToken},callbacks:{onReceivedLibraryDescription:this.createLibraryDescriptionReceiver(t),onReceivedActionFrame:this.callbacks.onReceivedActionFrame||ks,onReceivedScopeSlices:this.callbacks.onReceivedScopeSlices||ks,onDisconnectedByServer:this.onDisconnectedByServer,onKickWithReason:this.onKickWithReason,onDisconnectedWithSocketError:this.onDisconnectedWithSocketError}});case 6:return r=e.sent,this.sessionBuild&&(i=r.connection.sessionBuild,a=i.session,o=i.slice,this.callbacks.onSessionUpdate&&this.sessionBuild.session!==a&&this.callbacks.onSessionUpdate(a),this.callbacks.onSliceUpdate&&this.sessionBuild.slice!==o&&this.callbacks.onSliceUpdate(o)),this._connection=r.connection,e.next=11,t.getValue();case 11:return this._libraryNode=e.sent,this.sessionBuild=r.connection.sessionBuild,this._connection.setAccessUpdaterSerialization(new mi(this.objectOperator,bs(this._libraryNode.libraryClass))),this.connectingResult=null,n.setValue(r),e.abrupt("return",r);case 19:throw e.prev=19,e.t0=e.catch(3),t.catchError(e.t0),n.catchError(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){this._connection&&(this._connection.disconnect(),this._connection=null,this._libraryNode=null),this.startReconnect(e)}},{key:"createLibraryDescriptionReceiver",value:function(e){var t=this;return function(){var n=I(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=e,n.next=4,t.libraryNodeFetcher(r);case 4:n.t1=n.sent,n.t0.setValue.call(n.t0,n.t1),n.next=11;break;case 8:n.prev=8,n.t2=n.catch(0),e.catchError(n.t2);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()}},{key:"startReconnect",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=5;break}return e.next=3,this.connectingResult.getValue();case 3:e.next=0;break;case 5:return e.prev=5,n=this.callbacks,r=n.onBeginReconnect,i=n.onReconnected,r&&Promise.resolve().then((function(){return r(t)})),e.next=10,this.connect();case 10:a=e.sent,i&&Promise.resolve().then((function(){return i(a)})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),this.callbacks.onDisconnectedWithSocketError&&this.callbacks.onDisconnectedWithSocketError(e.t0);case 17:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Cs=Object.freeze({disableReconnect:!1});!function(e){e[e.Success=0]="Success",e[e.Break=1]="Break"}(xs||(xs={}));var Ps=function(){function e(t){var n=this;M(this,e),this.nextId=0,this.socket=null,this.pingProgress=null,this.promiseSleep=null,this.deltaTime=void 0,this.latestAdjustedTimestamp=0,this.isFirstAdjustedTime=!0,this.onPong=function(e){var t=bi(e),r=t.id,i=t.timestamp;if(n.pingProgress){var a=n.pingProgress,o=a.id,s=a.padding,c=a.timer,u=a.timestamp;if(o===r){clearTimeout(c);var l,h={remoteTimestamp:i,shouldBreak:!1,sendAt:u,receivedAt:Date.now()},d=E(s);try{for(d.s();!(l=d.n()).done;){(0,l.value.resolve)(h)}}catch(e){d.e(e)}finally{d.f()}n.pingProgress=null}}},this.onPingFailed=t}var t,n;return O(e,[{key:"calibrationTimestamp",get:function(){if(void 0===this.deltaTime)return Date.now();var e=Math.max(this.latestAdjustedTimestamp,Date.now()+this.deltaTime);return this.latestAdjustedTimestamp=e,e}},{key:"bindSocket",value:function(e){this.socket&&this.unbindSocket(),this.socket=e,this.socket.on("pong",this.onPong),this.handleStartPingLoop().catch(this.onPingFailed)}},{key:"unbindSocket",value:function(){if(this.socket&&(this.socket.off("pong",this.onPong),this.socket=null),this.promiseSleep&&(clearTimeout(this.promiseSleep.sleepTimer),this.promiseSleep.resolve(1),this.promiseSleep=null),this.pingProgress){var e,t={shouldBreak:!0,remoteTimestamp:0,sendAt:0,receivedAt:0},n=E(this.pingProgress.padding);try{for(n.s();!(e=n.n()).done;){(0,e.value.resolve)(t)}}catch(e){n.e(e)}finally{n.f()}this.pingProgress=null}}},{key:"handleStartPingLoop",value:(n=I(regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,i=0,t.next=4,r.doProgress(r.onPingFailed,I(regeneratorRuntime.mark((function e(){var t,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.startPing();case 2:if(t=e.sent,a=t.shouldBreak,o=t.remoteTimestamp,s=t.sendAt,c=t.receivedAt,!a){e.next=9;break}return e.abrupt("return",1);case 9:return u=c-s,e.abrupt("return",(n+=o+u/2-c,i+=1,r.isFirstAdjustedTime&&r.updateDeltaTime(Math.floor(n/i)),0));case 11:case"end":return e.stop()}}),e)}))));case 4:if(a=t.sent,t.t0=1===a,t.t0){t.next=12;break}return r.isFirstAdjustedTime?r.isFirstAdjustedTime=!1:i>=(e.processTimeIntervalList.length+1)/2&&r.updateDeltaTime(Math.floor(n/i)),t.next=10,r.sleep(r.withFloatRate(e.processInterval));case 10:a=t.sent,t.t0=1===a;case 12:if(!t.t0){t.next=14;break}return t.abrupt("return","break");case 14:case"end":return t.stop()}}),t)}));case 1:if(!this.socket){t.next=8;break}return t.delegateYield(n(),"t0",3);case 3:if("break"!==t.t0){t.next=6;break}return t.abrupt("break",8);case 6:t.next=1;break;case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"updateDeltaTime",value:function(e){this.deltaTime=e}},{key:"doProgress",value:(t=I(regeneratorRuntime.mark((function t(n,r){var i,a,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,t.prev=1,t.next=4,r();case 4:i=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),n(t.t0);case 10:if(0!==i){t.next=43;break}a=E(e.processTimeIntervalList),t.prev=12,a.s();case 14:if((o=a.n()).done){t.next=35;break}return s=o.value,t.prev=16,t.next=19,this.sleep(this.withFloatRate(s));case 19:if(i=t.sent,t.t1=1===i,t.t1){t.next=26;break}return t.next=24,r();case 24:i=t.sent,t.t1=1===i;case 26:if(!t.t1){t.next=28;break}return t.abrupt("break",35);case 28:t.next=33;break;case 30:t.prev=30,t.t2=t.catch(16),n(t.t2);case 33:t.next=14;break;case 35:t.next=40;break;case 37:t.prev=37,t.t3=t.catch(12),a.e(t.t3);case 40:return t.prev=40,a.f(),t.finish(40);case 43:return t.abrupt("return",i);case 44:case"end":return t.stop()}}),t,this,[[1,7],[12,37,40,43],[16,30]])}))),function(e,n){return t.apply(this,arguments)})},{key:"startPing",value:function(){var t,n,r=this;if(this.pingProgress)t=this.pingProgress.id,n=this.pingProgress.padding;else{var i=Date.now(),a=setTimeout((function(){return r.onPongTimeout(t)}),e.pongTimeout);t=this.getNextId(),n=[],this.pingProgress={id:t,timer:a,timestamp:i,padding:n},this.socket.emit("ping",yi({id:t,timestamp:i}))}return new Promise((function(e,t){n.push({resolve:e,reject:t})}))}},{key:"onPongTimeout",value:function(e){if(this.pingProgress){var t=this.pingProgress,n=t.id,r=t.padding;if(n===e){var i,a=new Error("pong timeout"),o=E(r);try{for(o.s();!(i=o.n()).done;){(0,i.value.reject)(a)}}catch(e){o.e(e)}finally{o.f()}this.pingProgress=null}}}},{key:"getNextId",value:function(){this.nextId>e.maxId&&(this.nextId=0);var t=this.nextId;return this.nextId+=1,t}},{key:"withFloatRate",value:function(t){var n=1-e.timeFloatRate+2*e.timeFloatRate*Math.random();return Math.floor(n*t)}},{key:"sleep",value:function(e){var t=this;if(this.promiseSleep)throw new Error("did call sleep");return new Promise((function(n){var r=setTimeout((function(){t.promiseSleep=null,n(0)}),e);t.promiseSleep={resolve:n,sleepTimer:r}}))}}]),e}();Ps.maxId=Math.pow(2,32)-1,Ps.pongTimeout=5e3,Ps.timeFloatRate=.35,Ps.processInterval=3e5,Ps.processTimeIntervalList=Object.freeze([5e3,7e3,12e3,15e3]);var Ms,Ts,Os=function(){function e(t){var n=this;M(this,e),this.invoker=t,this.animationFrameId=null,this.shouldInvokeNextFrame=!1,this.blockInvoke=!1,this.fireTick=function(){if(n.shouldInvokeNextFrame)try{n.invoker()}catch(e){console.error(e)}n.shouldInvokeNextFrame=!1,n.blockInvoke=!1,n.animationFrameId=null}}return O(e,[{key:"invoke",value:function(){if(this.blockInvoke)this.shouldInvokeNextFrame=!0;else{try{this.invoker()}catch(e){console.error(e)}null===this.animationFrameId&&(this.animationFrameId=window.requestAnimationFrame(this.fireTick)),this.blockInvoke=!0}}}]),e}();!function(e){e.Playing="playing",e.Pausing="pausing",e.PausingAndWaiting="pausingAndWaiting",e.Waiting="waiting",e.Ended="ended"}(Ms||(Ms={})),function(e){e[e.AutoBlockNewFrames=0]="AutoBlockNewFrames",e[e.DoNotBlockNewFrames=1]="DoNotBlockNewFrames"}(Ts||(Ts={}));var Es,As=function(){function e(){M(this,e),this.blockMode=1,this.queue=[],this.blockIndex=this.queue.length}return O(e,[{key:"hasFrames",get:function(){return this.queue.length>0}},{key:"hasAccessibleFrames",get:function(){return this.blockIndex>0}},{key:"hasBlockedFrames",get:function(){return this.queue.length>this.blockIndex}},{key:"accessibleLength",get:function(){return this.blockIndex}},{key:"rearFrame",get:function(){return this.frameAt(0)}},{key:"latestFrameIncludesBlocked",get:function(){var e;return null==(e=this.queue[this.queue.length-1])?void 0:e.proto}},{key:"blockedFrame",get:function(){var e;return null==(e=this.queue[this.blockIndex])?void 0:e.proto}},{key:"blockedReceivedAt",get:function(){var e=this.queue[this.blockIndex];return e?e.receivedAt:-1}},{key:"timeInterval",get:function(){if(this.blockIndex>0){var e=this.queue[this.blockIndex-1],t=this.queue[0];return e.proto.timestamp-t.proto.timestamp}return 0}},{key:"timeIntervalBefore",value:function(e){var t,n=0,r=null==(t=this.queue[0])?void 0:t.proto.timestamp;if(void 0!==r){for(var i=-1,a=this.blockIndex-1;a>=0;--a){var o=this.queue[a];if(o.proto.timestamp<=e){i=o.proto.timestamp;break}}-1!==i&&(n=i-r)}return n}},{key:"frameAt",value:function(e){if(e<this.blockIndex)return this.queue[e].proto}},{key:"push",value:function(e){var t=Date.now();1===this.blockMode&&(this.blockIndex+=e.length);var n,r=E(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.queue.push({proto:i,receivedAt:t})}}catch(e){r.e(e)}finally{r.f()}}},{key:"shift",value:function(){var e;if(this.frameAt(0))return this.blockIndex-=1,null==(e=this.queue.shift())?void 0:e.proto}},{key:"unblockOneFrame",value:function(){this.blockIndex<this.queue.length&&(this.blockIndex+=1)}}]),e}();!function(e){e.Realtime="realtime",e.Reconstruction="reconstruction"}(Es||(Es={}));var Ns=function(){function e(t){var n=this;M(this,e),this.framesQueue=new As,this.isPlaying=!1,this._didCompletePushFrames=!1,this.didCompletePlaying=!1,this.handleTickEvent=function(){try{n.onTick()}finally{n.shouldTickNextFrame()&&n.tickLimiter.invoke(),n.phaseNode.touch()}},this.currentPhase=function(){return n.didCompletePlaying?Ms.Ended:n._didCompletePushFrames||n.framesQueue.hasAccessibleFrames?n.isPlaying?Ms.Playing:Ms.Pausing:n.isPlaying?Ms.Waiting:Ms.PausingAndWaiting},this.onPhaseChanged=function(e,t){t===Ms.Playing&&e!==Ms.Playing?n.onPlayingStop():t!==Ms.Playing&&e===Ms.Playing&&n.onPlayingContinue(),n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.mode=t.mode,this.callbacks=Object.freeze(Ko({},t.callbacks));var r=t.enableAnimationFrame,i=t.frameInterval,a=void 0===i?17:i,o=t.remainLowTimeInterval,s=void 0===o?12e3:o;if(r){var c=new Os(this.handleTickEvent);this.tickLimiter=new We(a,(function(){return c.invoke()}))}else this.tickLimiter=new We(a,this.handleTickEvent);this.remainLowTimeInterval=s,this.phaseNode=new Wr({getCurrentPhase:this.currentPhase,onPhaseChanged:this.onPhaseChanged})}return O(e,[{key:"didCompletePushFrames",get:function(){return this._didCompletePushFrames}},{key:"completePlaying",value:function(){this.didCompletePlaying=!0,this.phaseNode.touch(),this.tickLimiter.cancel()}},{key:"frameInterval",get:function(){return this.tickLimiter.limitDuration},set:function(e){this.tickLimiter.limitDuration=e}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"shouldTickNextFrame",value:function(){return!this.didCompletePlaying&&(!!this.willTickEveryFrames||!(!this.isPlaying||!this.framesQueue.hasFrames))}},{key:"pushFrames",value:function(e){this.framesQueue.push(e),e.length>0&&this.isPlaying&&this.tickLimiter.invoke(),this.phaseNode.touch()}},{key:"play",value:function(){!this.isPlaying&&this.phaseNode.phase!==Ms.Ended&&(this.isPlaying=!0,this.framesQueue.hasAccessibleFrames&&this.tickLimiter.invoke(),this.phaseNode.touch())}},{key:"pause",value:function(){this.isPlaying&&(this.isPlaying=!1,this.tickLimiter.cancel(),this.phaseNode.touch())}},{key:"completePushFrames",value:function(){this._didCompletePushFrames=!0,this.framesQueue.hasAccessibleFrames||(this.didCompletePlaying=!0,this.tickLimiter.cancel()),this.phaseNode.touch()}}]),e}(),Rs=function(){function e(t,n){M(this,e),this.lastTimestamp=0,this.targetValue=t,this._momentValue=t,this.halfLifeInterval=n}return O(e,[{key:"value",get:function(){return this.targetValue},set:function(e){this.targetValue!==e&&(this.targetValue!==this._momentValue&&this.refreshMomentValue(),this.targetValue=e)}},{key:"momentValue",get:function(){return this.targetValue!==this._momentValue&&this.refreshMomentValue(),this._momentValue}},{key:"refreshMomentValue",value:function(){var t,n=Date.now(),r=n-this.lastTimestamp;if(r>this.halfLifeInterval*e.convergenceTimes)t=this.targetValue;else{var i=Math.pow(.5,r/this.halfLifeInterval);t=this._momentValue*i+this.targetValue*(1-i),Math.abs(t-this.targetValue)<e.minNumber&&(t=this.targetValue)}this._momentValue=t,this.lastTimestamp=n}}]),e}();Rs.convergenceTimes=6,Rs.minNumber=.01;var Ls=Object.freeze([Object.freeze({duration:1200,rate:1}),Object.freeze({duration:1e3,rate:.75}),Object.freeze({duration:3e3,rate:.5}),Object.freeze({duration:5e3,rate:.25})]);var js,Ds=function(){var e,t=0,n=E(Ls);try{for(n.s();!(e=n.n()).done;){t+=e.value.duration}}catch(e){n.e(e)}finally{n.f()}return t}(),zs=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).latestTimestamp=null,r.syncDelta=null,r.framesQueue.blockMode=Ts.AutoBlockNewFrames,r.frameDelayGradient=new Rs(e.frameDelay||0,1200),r}return O(n,[{key:"frameDelay",get:function(){return this.frameDelayGradient.value},set:function(e){this.frameDelayGradient.value=e}},{key:"isPlaybackSpeedModifiable",get:function(){return!1}},{key:"playbackSpeed",get:function(){return 1},set:function(e){}},{key:"willTickEveryFrames",get:function(){return!1}},{key:"syncBlockTimestamp",value:function(e){var t=e-Date.now();this.syncDelta?this.syncDelta.value=t:this.syncDelta=new Rs(t,1200)}},{key:"stopBlockTimestamp",value:function(){this.syncDelta=null}},{key:"onPlayingContinue",value:function(){}},{key:"onPlayingStop",value:function(){}},{key:"onTick",value:function(){var e=Date.now(),t=[];if(this.unblockFramesIfNeed(e),this.fillOverIntervalFrames(e,t),this.fillShouldPlayFrames(e,t),this.playFrames(t),this.callbacks.onBufferRemainLow&&this.latestTimestamp&&!this.didCompletePushFrames){var n=0;if(this.framesQueue.hasAccessibleFrames)n=this.framesQueue.latestFrameIncludesBlocked.timestamp-this.latestTimestamp.ack;n<this.remainLowTimeInterval&&this.callbacks.onBufferRemainLow()}}},{key:"unblockFramesIfNeed",value:function(e){if(this.syncDelta)for(var t=e+this.syncDelta.momentValue;this.framesQueue.hasBlockedFrames&&this.framesQueue.blockedFrame.timestamp<=t;)this.framesQueue.unblockOneFrame();else for(;this.framesQueue.hasBlockedFrames;){if(!(e>=this.framesQueue.blockedReceivedAt+this.frameDelayGradient.momentValue))break;this.framesQueue.unblockOneFrame()}}},{key:"fillOverIntervalFrames",value:function(e,t){for(;this.framesQueue.timeInterval>Ds;)t.push(this.framesQueue.shift());t.length>0&&this.updateLatestTimestamp(e,t[t.length-1])}},{key:"fillShouldPlayFrames",value:function(e,t){for(var n=function(e){var t,n=e,r=E(Ls);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(n<=i.duration)return i.rate;n-=i.duration}}catch(e){r.e(e)}finally{r.f()}throw new Error("durationTime is too large:"+n)}(this.framesQueue.timeIntervalBefore(e));this.framesQueue.hasAccessibleFrames;){var r=this.framesQueue.rearFrame,i=!1;if(this.latestTimestamp){var a=r.timestamp-this.latestTimestamp.ack,o=this.latestTimestamp.device+a*n;i=e+this.frameInterval>=o}else i=!0;if(!i)break;t.push(this.framesQueue.shift()),this.updateLatestTimestamp(e,r)}}},{key:"playFrames",value:function(e){if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(e){this.logger.error(e)}}},{key:"updateLatestTimestamp",value:function(e,t){var n=t.timestamp;this.latestTimestamp?(this.latestTimestamp.ack=n,this.latestTimestamp.device=e):this.latestTimestamp={ack:n,device:e}}}]),n}(Ns),Fs=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).frameDelay=0,r._playbackSpeed=1,r.endFrameTimestamp=e.endFrameTimestamp,r.anchor={deviceTimestamp:Date.now(),playerTimestamp:e.initFrameTimestamp},r}return O(n,[{key:"syncBlockTimestamp",value:function(e){}},{key:"stopBlockTimestamp",value:function(){}},{key:"play",value:function(){l(S(n.prototype),"play",this).call(this);var e=this.callbacks.onBufferRemainLow;e&&this.isBufferRemainLow&&Promise.resolve().then(e).catch((function(e){return console.error(e)}))}},{key:"isPlaybackSpeedModifiable",get:function(){return!0}},{key:"playbackSpeed",get:function(){return this._playbackSpeed},set:function(e){if(e<0)throw new Error("invalid playback speed ".concat(e,". it shouldn't be nagative number"));if(Number.isNaN(e)||e===1/0)throw new Error("invalid playback speed. it can not be ".concat(e));this._playbackSpeed!==e&&(this.phase===Ms.Playing&&this.refreshAnchor(this._playbackSpeed),this._playbackSpeed=e)}},{key:"willTickEveryFrames",get:function(){return!0}},{key:"onPlayingContinue",value:function(){this.refreshAnchor(0)}},{key:"onPlayingStop",value:function(){this.refreshAnchor(this._playbackSpeed)}},{key:"onTick",value:function(){for(var e=[],t=this.playbackSpeed*(Date.now()-this.anchor.deviceTimestamp+this.frameInterval),n=this.anchor.playerTimestamp+t;this.framesQueue.hasAccessibleFrames&&this.framesQueue.rearFrame.timestamp<=n;)e.push(this.framesQueue.shift());if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(r){this.logger.error(r)}if(this.callbacks.onTick)if(e.length>0){var r=e[e.length-1],i=Math.max(this.anchor.playerTimestamp,r.timestamp);this.callbacks.onTick(i,!1)}else this.callbacks.onTick(n,!0);this.callbacks.onBufferRemainLow&&!this.didCompletePushFrames&&this.isBufferRemainLow&&this.callbacks.onBufferRemainLow(),this.didCompletePushFrames&&0===e.length&&void 0!==this.endFrameTimestamp&&n>=this.endFrameTimestamp&&this.completePlaying()}},{key:"refreshAnchor",value:function(e){var t=Date.now(),n=e*(t-this.anchor.deviceTimestamp);this.anchor={deviceTimestamp:t,playerTimestamp:this.anchor.playerTimestamp+n}}},{key:"isBufferRemainLow",get:function(){return this.framesQueue.timeInterval<this.remainLowTimeInterval}}]),n}(Ns),Bs=new(function(){function e(){M(this,e)}return O(e,[{key:"create",value:function(e){switch(e.mode){case Es.Realtime:return new zs(e);case Es.Reconstruction:return new Fs(e);default:throw new Error("invalid mode ".concat(e.mode))}}}]),e}()),Us=function(){function e(t){M(this,e),this.latestReceivedFrameId=-1,this.didAssertedCount=0,this.latestReceivedFrameId=t}return O(e,[{key:"assertReceivedFrameId",value:function(e){var t=this.latestReceivedFrameId+1;if(e!==t)throw new Error("Magix want frameId ".concat(t,", instead of ").concat(e," (did asserted ").concat(this.didAssertedCount," frames)"));this.latestReceivedFrameId=e,this.didAssertedCount+=1}}]),e}(),Vs=function(){function e(t){var n=this;M(this,e),this.latestTimestamp=null,this.receivedActionFramePicker=function(e){n.frameIdAsserter.assertReceivedFrameId(e.frameId),n.playerBuffer.pushFrames([e])},this.onPlayActionFrames=function(e){n.onFrameReceivedInterval&&e.length>0&&n.onFrameReceivedInterval(n.getFrameReceivedInterval(e));var t,r=[],i=E(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.push(a.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}try{n.image.appendActionFrames(r)}catch(a){if(!n.onClientCrashWithError)throw a;n.onClientCrashWithError(a)}},this.connection=t.connection,this.image=t.imageFactory.createWithSnapshot({logger:t.logger,library:t.library,snapshotFrame:t.snapshot,actionFrames:C(t.initializeActionFrames),includesFrameHash:!1,ignoreHashChecking:!0,roomUUID:t.connection.uuid,toolsExtra:t.toolsExtra,originalImage:t.originalMagixSession&&t.originalMagixSession.image,callbacks:{onModified:t.callbacks.onModified,onPhaseChanged:t.callbacks.onImagePhaseChanged,onGeneratedActionFrame:t.callbacks.onGeneratedActionFrame,onCatchErrorWhenAppendFrame:t.callbacks.onCatchErrorWhenAppendFrame,onReceivedRttReport:t.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:t.callbacks.onIllusionQueueLengthChanged,onEventFire:t.callbacks.onEventFire,onClientCrashWithError:t.callbacks.onClientCrashWithError}}),this.frameIdAsserter=new Us(this.image.frameId),this.playerBuffer=Bs.create({logger:t.logger,mode:Es.Realtime,frameDelay:t.timeDelay,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.image.timestamp,callbacks:{onPlayActionFrames:this.onPlayActionFrames}}),this.onFrameReceivedInterval=t.callbacks.onFrameReceivedInterval,this.onClientCrashWithError=t.callbacks.onClientCrashWithError,this.playerBuffer.play()}return O(e,[{key:"imagePhase",get:function(){return this.image.phase}},{key:"timestamp",get:function(){return this.image.timestamp}},{key:"trigger",get:function(){return this.image.trigger}},{key:"receivedScopeSlices",value:function(e){this.image.appendScopeSlices(e)}},{key:"dispatch",value:function(e,t){this.image.dispatch(e,t)}},{key:"updateTimeDelay",value:function(e){this.playerBuffer.frameDelay=e}},{key:"syncBlockTimestamp",value:function(e){this.playerBuffer.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.playerBuffer.stopBlockTimestamp()}},{key:"setModifiable",value:function(e){this.image.modifiable=e}},{key:"setAllocatedUser",value:function(e){return this.image.setAllocatedUser(e)}},{key:"removeAllocatedUser",value:function(){return this.image.removeAllocatedUser()}},{key:"destroy",value:function(){this.image.destroy()}},{key:"getFrameReceivedInterval",value:function(e){var t,n=Date.now(),r=0,i=0,a=E(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(this.latestTimestamp){var s=n-this.latestTimestamp.recevied,c=o.timestamp-this.latestTimestamp.arbitrated;this.latestTimestamp.recevied=n,this.latestTimestamp.arbitrated=o.timestamp,r+=Math.abs(s-c),i+=1}else this.latestTimestamp={recevied:n,arbitrated:o.timestamp}}}catch(e){a.e(e)}finally{a.f()}var u=0;return i>0&&(u=r/i),u}}]),e}(),Ws=function(){function e(t,n,r){M(this,e),this.userPayload=t,this.onSelfUserIdUpdate=n,this.onConvertToWritable=r,this._selfUserId=void 0,this.invokerBlock=Promise.resolve(),this.isConnectedSessionWritable=!1,this.connectedSession=null}var t;return O(e,[{key:"selfUserId",get:function(){return this._selfUserId}},{key:"setConnectedMagixSession",value:function(e){this.connectedSession!==e&&(!this.connectedSession&&e&&this.paddingAndWaitSession&&(this.paddingAndWaitSession(e),this.paddingAndWaitSession=void 0),this.connectedSession=e,this.isConnectedSessionWritable=!1)}},{key:"setWritable",value:function(e,t){return this.invokerBlock=this.convertTo(this.invokerBlock,e,t)}},{key:"convertTo",value:(t=I(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(this.isConnectedSessionWritable!==n){e.next=4;break}return e.abrupt("return");case 4:this.updateObserverId(void 0),i=null;case 6:return e.next=8,this.waitAndGetConnectedSession();case 8:if(a=e.sent,this.isConnectedSessionWritable!==n){e.next=11;break}return e.abrupt("break",31);case 11:if(!n){e.next=21;break}return e.next=14,a.connection.updateToWritable(this.userPayload,r);case 14:if(i=e.sent){e.next=17;break}return e.abrupt("continue",29);case 17:return e.next=19,a.setAllocatedUser(i);case 19:e.next=27;break;case 21:return e.next=23,a.connection.updateToReadonly(r);case 23:if(e.sent){e.next=25;break}return e.abrupt("continue",29);case 25:return e.next=27,a.removeAllocatedUser();case 27:return this.isConnectedSessionWritable=n,e.abrupt("break",31);case 29:e.next=6;break;case 31:i&&this.updateObserverId(i.userId),this.onConvertToWritable&&this.onConvertToWritable(!!i);case 32:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"waitAndGetConnectedSession",value:function(){var e=this;return this.connectedSession?Promise.resolve(this.connectedSession):new Promise((function(t){return e.paddingAndWaitSession=t}))}},{key:"updateObserverId",value:function(e){this._selfUserId!==e&&(this._selfUserId=e,this.onSelfUserIdUpdate&&this.onSelfUserIdUpdate(e))}}]),e}(),Hs="NETLESSROOM_".length;function _s(e){if(!/^NETLESSROOM_.+/.test(e)){if(/^WHITE.+/.test(e))return"writable";throw new Error("invalid room token: ".concat(JSON.stringify(e)))}var t=e.substring(Hs),n=(0,Uo.parse)(function(e){return atob(e.replace(/_/g,"/").replace(/-/g,"+"))}(t)),r=parseFloat("".concat(n.role));if(Number.isNaN(r)||!Number.isSafeInteger(r))throw new Error("invalid room token with wrong role: ".concat(JSON.stringify(e)));switch(r){case 0:case 1:return"writable";case 2:return"readonly";default:throw new Error("find unrecognized role from roomToken: ".concat(r))}}!function(e){e[e.Admin=0]="Admin",e[e.Writer=1]="Writer",e[e.Reader=2]="Reader"}(js||(js={}));var Gs=function(){function e(t){var n=this;M(this,e),this.actionFramePickersList=[],this._phase=Ys.Ready,this._modifiable=!0,this._timeDelay=0,this.switchWritable=!1,this.switchWritableTaskId=0,this.isReconnecting=!1,this.beginReconnectAt=0,this.onReceivedActionFrame=function(e){try{var t=new Gn(e);if(n.magixSession){if(n.actionFramePickersList.length>0){var r,i=E(n.cleanActionFramesBufferList());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.magixSession.receivedActionFramePicker(a)}}catch(e){i.e(e)}finally{i.f()}}n.magixSession.receivedActionFramePicker(t)}else n.actionFramePickersList.push(t)}catch(t){n.logger.error("found error when receive action frame: "+t.message),n.socketSession.reconnectWithError(t)}},this.onReceivedScopeSlices=function(e){try{n.magixSession&&n.magixSession.receivedScopeSlices(e)}catch(e){n.logger.error("found error when receive scope slices: "+e.message),n.socketSession.reconnectWithError(e)}},this.onBeginReconnect=function(e){var t=n._phase===Ys.Connecting;n.beginReconnectAt=Date.now(),t||(n.callbacks.onReconnectWithError?n.callbacks.onReconnectWithError(e):n.logger.error(e)),n.switchWritableTaskId+=1,n.magixSession.destroy(),n.pingPongNode.unbindSocket(),t||n.changePhase(Ys.Reconnecting),n.isReconnecting=!0,n.authorState.setConnectedMagixSession(null)},this.onReconnected=function(){var e=I(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.connection,i=t.snapshot,a=t.actionFrames,o=t.retryCount,n.buildMagixSession(r,i,a),s=n._phase===Ys.Connecting,c=n.switchWritableTaskId,e.t0=n.switchWritable,!e.t0){e.next=7;break}return e.next=7,n.authorState.setWritable(!0,n.settingWritablePayload);case 7:c===n.switchWritableTaskId&&(s||(n.changePhase(Ys.Connected),n.onModified()),n.isReconnecting=!1,n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(null),n.reconnectionResultReceiver=null),n.callbacks.onReconnected&&!s&&n.callbacks.onReconnected({retryCount:o,buildWebSocketDuration:r.connectingDuration,buildMagixDuration:Date.now()-n.beginReconnectAt}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onGeneratedActionFrame=function(e){try{n.socketSession.connection.sendActionFrame(e)}catch(e){n.callbacks.onReceivedWarning&&n.callbacks.onReceivedWarning(e.message)}},this.onSelfUserIdUpdate=function(e){n.callbacks.onSelfUserIdUpdate&&n._phase!==Ys.Ready&&n._phase!==Ys.Connecting&&n.callbacks.onSelfUserIdUpdate(e)},this.onModified=function(){n.callbacks.onModified&&n._phase!==Ys.Ready&&n._phase!==Ys.Connecting&&(n.animationFrameTicker?n.animationFrameTicker.invoke():n.callbacks.onModified())},this.onEventFire=function(e){n.callbacks.onEventFire&&n.callbacks.onEventFire(ur(e,ar.Dispatched))},this.onClientCrashWithError=function(e){n._phase===Ys.Connected&&n.socketSession.reconnectWithError(e)},this.onFrameReceivedInterval=function(t){n.callbacks.onFrameReceivedInterval&&(n.callbacks.onFrameReceivedInterval(t),n.receivedIntervalResetter.refreshAndInvokeAfterInterval(e.receivedIntervalResetterCleanInterval))},this.onDisconnectWithError=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==Ys.Disconnected){var t=n._phase;n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(Ys.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(e),n.reconnectionResultReceiver=null),t===Ys.Connecting?n.errorWhenConnecting=e:n.callbacks.onDisconnectWithError&&n.callbacks.onDisconnectWithError(e)}},this.onKickedWithReason=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==Ys.Disconnected){var t=n._phase,r=new Error("kicked by server when connecting: ".concat(e));n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(Ys.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(r),n.reconnectionResultReceiver=null),t===Ys.Connecting&&(n.errorWhenConnecting=r),n.callbacks.onKickedWithReason&&n.callbacks.onKickedWithReason(e)}},this.logger=t.logger,this.imageFactory=t.imageFactory,this.libraryNodeFetcher=t.libraryNodeFetcher,this.fetcherFactory=t.fetcherFactory,this.enableAnimationFrame=t.enableAnimationFrame,this.reconnectionOptions=t.reconnectionOptions,this.toolsExtra=t.toolsExtra,this.netState=t.netState,this.clientVersion=t.clientVersion,this.callbacks=Mr(t.callbacks),this.callbacks.onModified&&t.enableAnimationFrame&&(this.animationFrameTicker=new Os(this.callbacks.onModified)),this.pingPongNode=new Ps(this.logger.warn),this.authorState=new Ws(t.userPayload,this.onSelfUserIdUpdate,this.onModified),this.receivedIntervalResetter=new Ve((function(){n.callbacks.onFrameReceivedInterval&&n.callbacks.onFrameReceivedInterval(0)}))}var t,n;return O(e,[{key:"modifiable",get:function(){return this._modifiable}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.pingPongNode.calibrationTimestamp}},{key:"timeDelay",get:function(){return this._timeDelay},set:function(e){this._timeDelay=e,this.magixSession&&this.magixSession.updateTimeDelay(e)}},{key:"session",get:function(){return this.socketSession&&this.socketSession.session}},{key:"slice",get:function(){return this.socketSession&&this.socketSession.slice}},{key:"changePhase",value:function(e){this._phase!==e&&(this._phase=e,this.callbacks.onPhaseChanged&&this.callbacks.onPhaseChanged(e))}},{key:"selfUserId",get:function(){return this.authorState.selfUserId}},{key:"isWritable",get:function(){return void 0!==this.authorState.selfUserId}},{key:"imagePhase",get:function(){if(!this.magixSession)throw new Error("image phase not exist when Magix's phase is ".concat(this.phase));return this.magixSession.imagePhase}},{key:"trigger",get:function(){if(!this.magixSession)throw new Error("trigger object not exist when Magix's phase is ".concat(this.phase));return this.magixSession.trigger}},{key:"syncBlockTimestamp",value:function(e){var t;null==(t=this.magixSession)||t.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){var e;null==(e=this.magixSession)||e.stopBlockTimestamp()}},{key:"setWritable",value:function(e,t){return this._phase===Ys.Connected||this._phase===Ys.Reconnecting?(this.switchWritable=e,this.settingWritablePayload=e?t:void 0,this.authorState.setWritable(e,t)):Promise.reject(new Error("can't only set writable when connected or reconnecting"))}},{key:"connect",value:(n=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Date.now(),this.phase===Ys.Ready){e.next=3;break}throw new Error("can't connect when Magix's phase is ".concat(this.phase));case 3:return this.changePhase(Ys.Connecting),e.prev=4,e.next=7,ws({logger:this.logger,fetcher:this.fetcherFactory.create(t.region),uuid:t.uuid,roomToken:t.roomToken,timeout:45e3,markWritable:t.isWritable,clientVersion:this.clientVersion,access:_s(t.roomToken),netState:this.netState,reconnectionOptions:this.reconnectionOptions,objectOperator:this.imageFactory.proxyManager.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onBeginReconnect:this.onBeginReconnect,onReconnected:this.onReconnected,onSliceUpdate:this.callbacks.onSliceChanged,onSessionUpdate:this.callbacks.onSessionChanged,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 7:if(r=e.sent,i=r.session,a=r.connection,o=r.snapshot,s=r.actionFrames,c=r.retryCount,this.socketSession=i,this.settingWritablePayload=t.connectedPayload,this.buildMagixSession(a,o,s),e.t0=t.isWritable,!e.t0){e.next=21;break}return e.next=20,this.authorState.setWritable(!0,t.connectedPayload);case 20:this.switchWritable=!0;case 21:if(!this.isReconnecting){e.next=29;break}return e.next=24,new Promise((function(e){l.reconnectionResultReceiver=e}));case 24:if(!(u=e.sent)){e.next=27;break}throw u;case 27:e.next=31;break;case 29:if(this._phase===Ys.Connecting){e.next=31;break}throw this.errorWhenConnecting?this.errorWhenConnecting:new Error("magix connect fail with invalid phase ".concat(this._phase));case 31:return e.abrupt("return",(this.changePhase(Ys.Connected),{libraryNode:i.libraryNode,statistics:{retryCount:c,buildWebSocketDuration:i.connection.connectingDuration,buildMagixDuration:Date.now()-n}}));case 34:throw e.prev=34,e.t1=e.catch(4),this.cleanActionFramesBufferList(),this.changePhase(Ys.Disconnected),this.pingPongNode.unbindSocket(),e.t1;case 37:case"end":return e.stop()}}),e,this,[[4,34]])}))),function(e){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){if(this._phase!==Ys.Reconnecting){if(this._phase!==Ys.Connected)throw new Error("can't reconnect when magix's phase is ".concat(this._phase));this.socketSession.reconnectWithError(e)}}},{key:"buildMagixSession",value:function(e,t,n){var r=this;this.magixSession&&this.magixSession.destroy();var i=this.magixSession=new Vs({logger:this.logger,library:bs(this.socketSession.libraryNode.libraryClass),connection:e,snapshot:t,initializeActionFrames:n,imageFactory:this.imageFactory,enableAnimationFrame:this.enableAnimationFrame,originalMagixSession:this.magixSession,timeDelay:this._timeDelay,toolsExtra:this.toolsExtra,callbacks:{onImagePhaseChanged:function(e){return r.onImagePhaseChanged(i,e)},onGeneratedActionFrame:this.onGeneratedActionFrame,onModified:this.onModified,onEventFire:this.onEventFire,onClientCrashWithError:this.onClientCrashWithError,onFrameReceivedInterval:this.onFrameReceivedInterval,onReceivedRttReport:this.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:this.callbacks.onIllusionQueueLengthChanged,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame||function(e,t){return r.logger.error(t)}}});e.bindPingPongNode(this.pingPongNode),this.magixSession.setModifiable(this._modifiable),this.authorState.setConnectedMagixSession(this.magixSession)}},{key:"disconnect",value:(t=I(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReconnecting=!1,this.phase!==Ys.Reconnecting){e.next=4;break}this.socketSession.dispose(),this.pingPongNode.unbindSocket(),this.changePhase(Ys.Disconnected),e.next=15;break;case 4:if(this.phase!==Ys.Connected){e.next=14;break}return this.pingPongNode.unbindSocket(),this.changePhase(Ys.Disconnecting),e.prev=6,e.next=9,this.socketSession.connection.disconnect();case 9:return e.prev=9,this.changePhase(Ys.Disconnected),e.finish(9);case 12:e.next=15;break;case 14:throw new Error("can't disconnect when Magix's phase is ".concat(this.phase));case 15:case"end":return e.stop()}}),e,this,[[6,,9,12]])}))),function(){return t.apply(this,arguments)})},{key:"dispatch",value:function(e,t){if(this.phase!==Ys.Connected)throw new Error("can't dispatch event when Magix's phase is ".concat(this.phase));this.magixSession.dispatch(e,t)}},{key:"onImagePhaseChanged",value:function(e,t){this.callbacks.onImagePhaseChanged&&this.magixSession===e&&this.callbacks.onImagePhaseChanged(t)}},{key:"cleanActionFramesBufferList",value:function(){return this.actionFramePickersList.splice(0,this.actionFramePickersList.length)}}]),e}();Gs.receivedIntervalResetterCleanInterval=700;var Ys,Xs=function(){function e(t,n,r,i,a,o){M(this,e),this.fetcherFactory=t,this.imageFactory=n,this.reconnectionOptions=r,this.netState=i,this.clientVersion=a,this.magixConfiguration=Object.freeze(Ko({},o))}return O(e,[{key:"createMagix",value:function(e,t){return new Gs({logger:t.logger,fetcherFactory:this.fetcherFactory,libraryNodeFetcher:t.libraryNodeFetcher,imageFactory:this.imageFactory,toolsExtra:e,enableAnimationFrame:this.magixConfiguration.enableAnimationFrame,reconnectionOptions:this.reconnectionOptions,netState:this.netState,userPayload:t.userPayload,clientVersion:this.clientVersion,callbacks:t.callbacks||{}})}}]),e}();function Qs(e){return Zs.apply(this,arguments)}function Zs(){return(Zs=I(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,i=0;case 2:if(!(i<n)){e.next=15;break}return e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),r=e.t0;case 12:++i,e.next=2;break;case 15:throw r;case 16:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}!function(e){e.Ready="ready",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(Ys||(Ys={}));var Ks=function(){function e(t){var n=this;M(this,e),this.isDownloading=!1,this.didDestroy=!1,this.onPlayActionFrames=function(e){var t,r=[],i=E(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.sequenceInitializer,s=a.framePicker;o&&(r.length>0&&(n.image.appendActionFrames(r),r=[]),n.image=n.createImage(o,n.image),n._libIdentifier=o.libIdentifier,n._libraryNode=o.libraryNode,n.playingSliceIndex+=1,n.callbacks.onSliceChanged&&n.callbacks.onSliceChanged()),s&&r.push(s.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}r.length>0&&n.image.appendActionFrames(r)},this.onBufferRemainLow=function(){n.isDownloading||n.loadActionFrames()},this.onPlayerBufferPhaseChanged=function(e){n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.imageFactory=t.imageFactory,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.fetchingSliceIndex=t.beginSliceIndex,this.playingSliceIndex=t.beginSliceIndex,this.callbacks=t.callbacks,this.isFirstSlice=!0,this.image=this.createImage(t.sequenceInitializer,t.originalReconstructorLine&&t.originalReconstructorLine.image),this.latestFetchingFrameId=this.image.frameId,this.latestPlayingFrameId=this.image.frameId,this.beginTimestamp=void 0===t.initFrameTimestamp?this.image.timestamp:t.initFrameTimestamp,this._libIdentifier=t.sequenceInitializer.libIdentifier,this._libraryNode=t.sequenceInitializer.libraryNode,this.playerBuffer=Bs.create({logger:t.logger,mode:Es.Reconstruction,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.beginTimestamp,endFrameTimestamp:this.sliceChunk.beginTimestamp+this.sliceChunk.duration,callbacks:{onBufferRemainLow:this.onBufferRemainLow,onPlayActionFrames:this.onPlayActionFrames,onPhaseChanged:this.onPlayerBufferPhaseChanged,onTick:t.callbacks.onTick}}),this.playerBuffer.playbackSpeed=t.playbackSpeed}var t,n;return O(e,[{key:"trigger",get:function(){return this.image.trigger}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"playbackSpeed",get:function(){return this.playerBuffer.playbackSpeed},set:function(e){this.playerBuffer.playbackSpeed=e}},{key:"createImage",value:function(e,t){var n=e.snapshot,r=e.actionFrames,i=e.akkoSerVersion,a=e.libraryNode,o=this.imageFactory.createWithSnapshot({logger:this.logger,library:bs(a.libraryClass),snapshotFrame:n,actionFrames:r,originalImage:t,toolsExtra:this.toolsExtra,roomUUID:this.sliceChunk.roomUUID,includesFrameHash:!1,ignoreHashChecking:!0,snapshotDeserializerVersion:i,actionDeserializerVersion:i,callbacks:{onModified:this.callbacks.onModified,onEventFire:this.callbacks.onEventFire,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}});return o.modifiable=!1,o}},{key:"slice",get:function(){return this.sliceChunk.sliceAt(this.playingSliceIndex)}},{key:"sliceIndex",get:function(){return this.playingSliceIndex}},{key:"play",value:function(){this.playerBuffer.play()}},{key:"pause",value:function(){this.playerBuffer.pause()}},{key:"setup",value:function(){var e=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;this.beginTimestamp<e?this.loadActionFrames():this.playerBuffer.completePushFrames()}},{key:"destroy",value:function(){this.didDestroy||(this.playerBuffer.pause(),this.image.destroy(),this.didDestroy=!0)}},{key:"phase",get:function(){return this.playerBuffer.phase}},{key:"isRemainFramesToFetch",value:function(){return this.fetchingSliceIndex<this.sliceChunk.slicesCount}},{key:"loadActionFrames",value:function(){var e=this;this.fillActionFramesIntoBuffer().catch((function(t){return e.logger.error(t)}))}},{key:"fillActionFramesIntoBuffer",value:(n=I(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRemainFramesToFetch()){e.next=18;break}return e.prev=1,this.isDownloading=!0,e.next=5,this.fetchFrames();case 5:t=e.sent,n=this.sliceChunk.beginTimestamp+this.sliceChunk.duration,r=this.removeTimestampOverFrames(t,n),(i=t[t.length-1])&&(this.latestPlayingFrameId=i.frameId),this.shouldPushEndSpaceHolderFrame(t,r,n)&&t.push({frameId:this.latestPlayingFrameId+1,timestamp:n}),t.length>0&&this.playerBuffer.pushFrames(t),this.isRemainFramesToFetch()||this.playerBuffer.completePushFrames(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.callbacks.onCatchErrorWhenFetchBuffer&&this.callbacks.onCatchErrorWhenFetchBuffer(e.t0);case 15:return e.prev=15,this.isDownloading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))),function(){return n.apply(this,arguments)})},{key:"shouldPushEndSpaceHolderFrame",value:function(e,t,n){var r=e[e.length-1];return(t||!this.isRemainFramesToFetch())&&(!r||r.timestamp<n)}},{key:"fetchFrames",value:(t=I(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s,c,u,l,d,p,f,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.sliceChunk.sliceAt(this.fetchingSliceIndex)){t.next=2;break}return t.abrupt("return",[]);case 2:if(!((r=n.framesCount-this.latestFetchingFrameId)>0)){t.next=4;break}return t.abrupt("break",7);case 4:this.latestFetchingFrameId=0,this.latestPlayingFrameId=0,this.fetchingSliceIndex+=1,this.isFirstSlice=!1;case 5:t.next=0;break;case 7:return i=Math.min(r,e.fetchFramesCountOnce),a=0===this.latestFetchingFrameId&&!this.isFirstSlice,t.next=11,Promise.all([Qs((function(){return v.sequenceFetcher.fetchFramePickers(n,v.latestFetchingFrameId,i)})),a?Qs((function(){return v.sequenceFetcher.initializeWithFrameId(n,v.latestFetchingFrameId)})):Promise.resolve(void 0)]);case 11:o=t.sent,s=h(o,2),c=s[0],u=s[1],l=[],d=E(c);try{for(d.s();!(p=d.n()).done;)f=p.value,this.latestFetchingFrameId=f.frameId,l.push({frameId:f.frameId,timestamp:f.timestamp,framePicker:f})}catch(e){d.e(e)}finally{d.f()}return t.abrupt("return",(u&&(l[0].sequenceInitializer=u),l));case 19:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"removeTimestampOverFrames",value:function(e,t){var n=e.findIndex((function(e){return e.timestamp>t}));return-1!==n&&(e.splice(n,e.length-n),!0)}}]),e}();Ks.fetchFramesCountOnce=600;var qs,Js=function(){function e(t){M(this,e),this.sliceChunk=t.sliceChunk,this.imageFactory=t.imageFactory,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.enableAnimationFrame=t.enableAnimationFrame}var t,n;return O(e,[{key:"createWithFrameId",value:(n=I(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithFrameId(n),s=o.sliceIndex,c=o.frameId,u=this.sliceChunk.sliceAt(s),e.next=6,this.sequenceFetcher.initializeWithFrameId(u,c);case 6:return l=e.sent,e.abrupt("return",new Ks({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp,sequenceInitializer:l,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"createWithProgressTime",value:(t=I(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithTimestamp(n),s=o.sliceIndex,c=o.timestamp,u=this.sliceChunk.sliceAt(s),l=c+u.beginTimestamp,e.next=7,this.sequenceFetcher.initializeWithTimestamp(u,l);case 7:return h=e.sent,e.abrupt("return",new Ks({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp+n,sequenceInitializer:h,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,a){return t.apply(this,arguments)})}]),e}();!function(e){e[e.FrameId=0]="FrameId",e[e.ProgressTime=1]="ProgressTime"}(qs||(qs={}));var $s=function(){function e(t){M(this,e),this.isRunningLoop=!1,this.task=null,this.id=0,this.callbacks=Object.freeze(Ko({},t))}var t;return O(e,[{key:"currentTaskId",get:function(){return this.id}},{key:"isSeeking",get:function(){return this.isRunningLoop}},{key:"stopSeeking",value:function(){this.id+=1}},{key:"seekToFrameId",value:function(e){(!this.task||0!==this.task.mode||this.task.value!==e)&&(this.task={id:this.id+=1,mode:0,value:e},this.startTaskLoop().catch((function(e){return console.error(e)})))}},{key:"seekToProgressTime",value:function(e){(!this.task||1!==this.task.mode||this.task.value!==e)&&(this.task={id:this.id+=1,mode:1,value:e},this.startTaskLoop().catch((function(e){return console.error(e)})))}},{key:"startTaskLoop",value:(t=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRunningLoop){e.next=23;break}e.prev=1,this.isRunningLoop=!0,this.callbacks.updateIsSeeking();case 3:if(!this.task){e.next=20;break}t=this.task,n=t.id,r=t.mode,i=t.value,a=void 0,e.t0=r,e.next=0===e.t0?8:1===e.t0?12:16;break;case 8:return e.next=10,this.callbacks.startSeekingToFrameId(n,i);case 10:return a=e.sent,e.abrupt("break",17);case 12:return e.next=14,this.callbacks.startSeekingToProgressTime(n,i);case 14:return a=e.sent,e.abrupt("break",17);case 16:throw new Error("invalid mode ".concat(r));case 17:this.id===n?(this.task=null,this.callbacks.afterSeeking(a)):this.callbacks.cancelSeeking(a);case 18:e.next=3;break;case 20:return e.prev=20,this.isRunningLoop=!1,this.callbacks.updateIsSeeking(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[1,,20,23]])}))),function(){return t.apply(this,arguments)})}]),e}(),ec=function(){function e(t){var n=this;M(this,e),this._progressTime=0,this._playbackSpeed=1,this.isPlaying=!1,this.isMaskPhaseUpdating=!1,this.didStop=!1,this.currentLine=void 0,this.startSeekingToFrameId=function(){var e=I(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.framesCount),a=function(e){return n.lineFactory.createWithFrameId(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.startSeekingToProgressTime=function(){var e=I(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.duration),Number.isSafeInteger(i)||(i=Math.floor(i)),a=function(e){return n.lineFactory.createWithProgressTime(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.afterSeeking=function(e){try{n.isMaskPhaseUpdating=!0,e.setup()}finally{n.isMaskPhaseUpdating=!1}n.changeCurrentLine(e)},this.cancelSeeking=function(e){e.destroy()},this.onLineSliceChanged=function(){n.currentLine&&(n.sliceStateUpdater.refreshReconstructorLine(n.currentLine),n.callbacks.onModified&&n.callbacks.onModified(),n.onTick(n.currentLine.beginTimestamp))},this.currentIsPlayable=function(){if(n.didStop||!n.currentLine||n.seekingNode.isSeeking)return!1;switch(n.currentLine.phase){case Ms.Playing:case Ms.Pausing:return!0;case Ms.PausingAndWaiting:case Ms.Waiting:case Ms.Ended:default:return!1}},this.currentPhase=function(){if(n.didStop)return nc.Stopped;if(!n.currentLine)return nc.WaitingFirstFrame;if(n.seekingNode.isSeeking)return nc.Seeking;switch(n.currentLine.phase){case Ms.Playing:return nc.Playing;case Ms.Pausing:case Ms.PausingAndWaiting:return nc.Pause;case Ms.Waiting:return nc.Buffering;case Ms.Ended:return nc.Ended;default:throw new Error("invalid phase ".concat(n.currentLine.phase))}},this.touchPhaseChanged=function(){n.isMaskPhaseUpdating||(n.phaseNode.touch(),n.isPlayableNode.touch())},this.onTick=function(e){var t=Math.min(e-n.beginTimestamp,n.sliceChunk.duration);n._progressTime=t,n.callbacks.onProgressTimeChanged&&n.callbacks.onProgressTimeChanged(t)},this.onCatchError=function(e){n.didStop||(n.stop(),n.callbacks.onStoppedWithError&&n.callbacks.onStoppedWithError(e))},this.onEventFire=function(e){n.callbacks.onEventFire&&n.callbacks.onEventFire(ur(e,ar.Dispatched))},this.logger=t.logger,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.callbacks=Mr(t.callbacks),this.sliceStateUpdater=t.sliceStateUpdater,this.sliceStateUpdater.onSliceChanged=this.callbacks.onSliceChanged,this.sliceStateUpdater.onLibraryNodeChanged=this.callbacks.onLibraryNodeChanged,this.seekingNode=new $s({startSeekingToFrameId:this.startSeekingToFrameId,startSeekingToProgressTime:this.startSeekingToProgressTime,afterSeeking:this.afterSeeking,cancelSeeking:this.cancelSeeking,updateIsSeeking:this.touchPhaseChanged}),this.isPlayableNode=new Wr({phase:!1,onPhaseChanged:t.callbacks.onIsPlayableChanged,getCurrentPhase:this.currentIsPlayable}),this.phaseNode=new Wr({phase:nc.WaitingFirstFrame,onPhaseChanged:t.callbacks.onPhaseChanged,getCurrentPhase:this.currentPhase}),this.lineFactory=new Js({sliceChunk:t.sliceChunk,imageFactory:t.imageFactory,sequenceFetcher:t.sequenceFetcher,toolsExtra:t.toolsExtra,enableAnimationFrame:t.enableAnimationFrame})}var t;return O(e,[{key:"trigger",get:function(){if(!this.currentLine)throw new Error("trigger object not exist when Reconstructor's phase is ".concat(this.phase));return this.currentLine.trigger}},{key:"isPlayable",get:function(){return this.isPlayableNode.phase}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"progressTime",get:function(){return this._progressTime}},{key:"slice",get:function(){return this.sliceStateUpdater.slice}},{key:"sliceIndex",get:function(){return this.sliceStateUpdater.sliceIndex}},{key:"libIdentifier",get:function(){return this.sliceStateUpdater.libIdentifier}},{key:"libraryNode",get:function(){return this.sliceStateUpdater.libraryNode}},{key:"roomUUID",get:function(){return this.sliceChunk.roomUUID}},{key:"duration",get:function(){return this.sliceChunk.duration}},{key:"framesCount",get:function(){return this.sliceChunk.framesCount}},{key:"beginTimestamp",get:function(){return this.sliceChunk.beginTimestamp}},{key:"playbackSpeed",get:function(){return this.currentLine?this.currentLine.playbackSpeed:this._playbackSpeed},set:function(e){this._playbackSpeed=e,this.currentLine&&(this.currentLine.playbackSpeed=e)}},{key:"play",value:function(){if(this.assertNotStop(),this.phaseNode.phase!==nc.Ended){var e=this.isPlaying;this.isPlaying=!0,!e&&!this.seekingNode.isSeeking&&(this.currentLine?this.currentLine.play():this.seekToProgressTime(0)),this.touchPhaseChanged()}}},{key:"pause",value:function(){this.assertNotStop(),this.isPlaying&&!this.seekingNode.isSeeking&&this.currentLine&&this.currentLine.pause(),this.isPlaying=!1,this.touchPhaseChanged()}},{key:"stop",value:function(){this.assertNotStop(),this.seekingNode.stopSeeking(),this.currentLine&&(this.currentLine.destroy(),this.currentLine=void 0),this.didStop=!0,this.touchPhaseChanged()}},{key:"seekToFrameId",value:function(e){this.assertNotStop(),this.seekingNode.seekToFrameId(e)}},{key:"seekToProgressTime",value:function(e){this.assertNotStop(),this.seekingNode.seekToProgressTime(e)}},{key:"startSeekingTask",value:(t=I(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=Ko({},this.wrapCallbacksWithTaskChecking(t,{onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame,onCatchErrorWhenFetchBuffer:this.onCatchError,onModified:this.callbacks.onModified,onSliceChanged:this.onLineSliceChanged,onEventFire:this.onEventFire,onTick:this.onTick,onPhaseChanged:this.touchPhaseChanged})),e.next=4,n(r);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),this.onCatchError(e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,n){return t.apply(this,arguments)})},{key:"changeCurrentLine",value:function(e){this.currentLine&&this.currentLine.destroy(),this.currentLine=e,this.sliceStateUpdater.refreshReconstructorLine(e),this.isPlaying&&e.play(),this.callbacks.onModified&&this.callbacks.onModified(),this.onTick(e.beginTimestamp)}},{key:"wrapCallbacksWithTaskChecking",value:function(e,t){var n=this,r={},i=function(i){var a=t[i];a&&(r[i]=function(){if(e===n.seekingNode.currentTaskId)return a.apply(void 0,arguments)})};for(var a in t)i(a);return r}},{key:"assertNotStop",value:function(){if(this.didStop)throw new Error("Reconstructor did stop")}}]),e}();function tc(e,t,n){var r=Math.min(e,n),i=Math.max(e,n),a=t;return t<r?a=r:t>i&&(a=i),a}var nc,rc=function(){function e(t){var n=this;M(this,e),this.fetchLibraryNode=function(){var e=I(regeneratorRuntime.mark((function e(t,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.previousLibraryNode||n.previousLibraryNode.libIdentifier!==r){e.next=2;break}return e.abrupt("return",n.previousLibraryNode.libraryNode);case 2:return e.next=4,n.libraryNodeFetcher({appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,libIdentifier:r});case 4:return i=e.sent,e.abrupt("return",(n.previousLibraryNode=Object.freeze({libIdentifier:r,libraryNode:i}),i));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.logger=t.logger,this.fetcher=t.fetcher,this.roomToken=t.roomToken,this.libraryNodeFetcher=t.libraryNodeFetcher}var t,n,r,i,a,o,s,c,u;return O(e,[{key:"initializeWithTimestamp",value:(u=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithTimestamp(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=h(i,2),o=a[0],s=a[1],e.abrupt("return",qo(Ko({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"initializeWithFrameId",value:(c=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithFrameId(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=h(i,2),o=a[0],s=a[1],e.abrupt("return",qo(Ko({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"sequenceImageInitializerWithTimestamp",value:(s=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=tc(t.beginTimestamp,n,t.beginTimestamp+t.duration),e.next=3,this.fetcher.fetch("persistence");case 3:return i=e.sent,a=(0,Wo.stringify)({timestamp:r}),o="https://persistence/pv/rooms/".concat(t.roomUUID,"/slices/").concat(t.uuid,"/snapshots?").concat(a),e.next=8,i.fetchJSON(o,{method:"get",headers:{"content-type":"application/json",token:this.roomToken}});case 8:return(s=e.sent)||(this.logger.warn("cannot find snapshot that timestamp=".concat(r," and slice=").concat(t.uuid)),s={frameId:0,timestamp:t.beginTimestamp}),e.next=12,this.fetchFrameRouterPicker(t,s.frameId);case 12:for(c=e.sent,u=0,l=0;l<c.framesCount&&c.timestampAt(l)<=n;l++)u+=1;return e.next=17,this.fetchSnapshot(t,s.frameId);case 17:if(h=e.sent,0!==u){e.next=22;break}e.t0=[],e.next=25;break;case 22:return e.next=24,this.fetchFramePickers(t,s.frameId,u);case 24:e.t0=e.sent;case 25:return d=e.t0,e.abrupt("return",{snapshot:h.frameBuffer,actionFrames:d.map((function(e){return e.frameBuffer})),akkoSerVersion:Tt(t.akkoVersion)});case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"sequenceImageInitializerWithFrameId",value:(o=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=tc(0,n,t.framesCount-1),e.next=3,this.fetchSnapshot(t,r);case 3:if(i=e.sent,0!=(a=r-i.frameId)){e.next=7;break}return e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:[],akkoSerVersion:Tt(t.akkoVersion)});case 7:return e.next=9,this.fetchFramePickers(t,i.frameId,a);case 9:return o=e.sent,e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:o.map((function(e){return e.frameBuffer})),akkoSerVersion:Tt(t.akkoVersion)});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"fetchFramePickers",value:(a=I(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return i=e.sent,a=i.fetcher,o=i.url,e.next=7,ic.pick(a,o,n,r);case 7:return s=e.sent,e.next=10,this.fetchBody(t,"framesBody",s.offset,s.length);case 10:c=e.sent,u=[],l=0;case 13:if(!(l<s.framesCount)){e.next=22;break}if(h=s.offsetAt(l)-s.offset,d=s.lengthAt(l),!(c.byteLength<h+d)){e.next=17;break}return e.abrupt("break",22);case 17:p=c.slice(h,d),f=new Gn(p),u.push(f);case 19:++l,e.next=13;break;case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"fetchSnapshot",value:(i=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"snapshotsRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.floor(n/t.snapshotIdInterval),e.next=8,ic.pick(i,a,o,1);case 8:if(0!==(s=e.sent).framesCount){e.next=11;break}throw new Error("can't find snapshot with frameId ".concat(n));case 11:return c=s.offsetAt(0),u=s.lengthAt(0),e.next=15,this.fetchBody(t,"snapshotsBody",c,u);case 15:return l=e.sent,e.abrupt("return",new Gn(l));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetchFrameRouterPicker",value:(r=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.min(t.framesCount-n,t.snapshotIdInterval-1),e.abrupt("return",ic.pick(i,a,n,o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBody",value:(n=I(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,n);case 2:return a=e.sent,o=a.fetcher,s=a.url,e.next=7,o.fetchBuffer(s,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(r,"-").concat(r+i)}});case 7:if(c=e.sent){e.next=10;break}throw new Error("can't find \"".concat(s,'"'));case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getAssetsFetcherAndURL",value:(t=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.uuid,i=t.roomUUID,a=t.token,e.t0=n,e.next="framesBody"===e.t0?4:"framesRouter"===e.t0?6:"snapshotsBody"===e.t0?8:"snapshotsRouter"===e.t0?10:12;break;case 4:return o="frames.body",e.abrupt("break",12);case 6:return o="frames.router",e.abrupt("break",12);case 8:return o="snapshots.body",e.abrupt("break",12);case 10:return o="snapshots.router",e.abrupt("break",12);case 12:return a?(s="assets-auth",c=a[n]):s="assets",u="https://".concat(s,"/").concat(i,"/").concat(r,"/").concat(o),c&&(u+="?auth_key="+c),e.next=17,this.fetcher.fetch(s);case 17:return e.t1=e.sent,e.t2=u,e.abrupt("return",{fetcher:e.t1,url:e.t2});case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),ic=function(){function e(t,n){M(this,e),this.buffer=t,this.framesCount=n,this.framesCount>0?this.offset=this.offsetAt(0):this.offset=Number.NaN}var t;return O(e,[{key:"length",get:function(){if(void 0===this._length){this._length=0;for(var e=0;e<this.framesCount;++e)this._length+=this.lengthAt(e)}return this._length}},{key:"timestampAt",value:function(e){var t=24*e+0;return this.buffer.getUint64(t)}},{key:"offsetAt",value:function(e){var t=24*e+8;return this.buffer.getUint64(t)}},{key:"lengthAt",value:function(e){var t=24*e+16;return this.buffer.getUint64(t)}}],[{key:"pick",value:(t=I(regeneratorRuntime.mark((function t(n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i*(o=24),c=(i+a)*o-1,t.next=5,n.fetchBuffer(r,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(s,"-").concat(c)}});case 5:return(u=t.sent)||(u=Ie(0)),l=Math.floor(u.byteLength/o),t.abrupt("return",new e(u,l));case 9:case"end":return t.stop()}}),t)}))),function(e,n,r,i){return t.apply(this,arguments)})}]),e}(),ac=function(){function e(t){M(this,e),this.slices=Object.freeze(C(t.slices).sort((function(e,t){return e.beginTimestamp-t.beginTimestamp}))),this.beginAt=t.beginAt,this.endAt=t.endAt,this.roomUUID=this.getRoomUUID(),this.framesCount=this.getFramesCount()}return O(e,[{key:"getRoomUUID",value:function(){for(var e=this.slices[0].roomUUID,t=1;t<this.slices.length;++t)if(e!==this.slices[t].roomUUID)throw new Error("all slices should have the same roomUUID");return e}},{key:"getFramesCount",value:function(){var e,t=0,n=E(this.slices);try{for(n.s();!(e=n.n()).done;){t+=e.value.framesCount}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"beginTimestamp",get:function(){return this.beginAt}},{key:"duration",get:function(){return this.endAt-this.beginAt}},{key:"slicesCount",get:function(){return this.slices.length}},{key:"sliceAt",value:function(e){return this.slices[e]}},{key:"getFrameDescriptionWithFrameId",value:function(e){for(var t=e,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.framesCount)break;t-=i.framesCount}return{frameId:t,sliceIndex:n}}},{key:"getFrameDescriptionWithTimestamp",value:function(e){for(var t=e+this.beginAt,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.beginTimestamp+i.duration)break}return{sliceIndex:n,timestamp:Math.max(0,t-this.slices[n].beginTimestamp)}}}]),e}(),oc=function(){function e(t){var n=this;M(this,e),this._libraryNodeFetcher=t,this.libraryNodeFetcher=function(e){return n._libraryNode&&n._libIdentifier===e.libIdentifier?Promise.resolve(n._libraryNode):n._libraryNodeFetcher(e)}}return O(e,[{key:"sliceIndex",get:function(){return this._sliceIndex}},{key:"slice",get:function(){return this._slice}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"refreshReconstructorLine",value:function(e){(e.libIdentifier!==this._libIdentifier||e.libraryNode!==this._libraryNode)&&(this._libIdentifier=e.libIdentifier,this._libraryNode=e.libraryNode,this.onLibraryNodeChanged&&this.onLibraryNodeChanged(this._libIdentifier,this._libraryNode)),e.sliceIndex!==this._sliceIndex&&(this._sliceIndex=e.sliceIndex,this._slice=e.slice,this.onSliceChanged&&this.onSliceChanged(this._slice,this._sliceIndex))}}]),e}(),sc=function(){function e(t,n,r,i){M(this,e),this.fetcherFactory=t,this.imageFactory=n,this.clientVersion=r,this.enableAnimationFrame=i}var t,n,r;return O(e,[{key:"createReconstructor",value:(r=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rangeQuery,i=new oc(n.libraryNodeFetcher),a=new rc({logger:n.logger,roomToken:n.roomToken,fetcher:this.fetcherFactory.create(r.region),libraryNodeFetcher:i.libraryNodeFetcher}),e.next=5,this.fetchSliceChunk(r);case 5:if(o=e.sent){e.next=8;break}throw new Error("couldn't find any matching slices");case 8:return e.abrupt("return",new ec({logger:n.logger,sliceChunk:o,imageFactory:this.imageFactory,sequenceFetcher:a,sliceStateUpdater:i,toolsExtra:t,enableAnimationFrame:this.enableAnimationFrame,callbacks:n.callbacks||{}}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"searchSlices",value:(n=I(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSliceChunk(t);case 2:if(n=e.sent,r=[],n)for(i=0;i<n.slicesCount;++i)r.push(n.sliceAt(i));return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchSliceChunk",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,p,f,v,m=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcherFactory.create(t.region).fetch("persistence");case 2:if(n=e.sent,void 0===t.slice){e.next=14;break}return i={clientVersion:this.clientVersion},a="https://persistence/pv/rooms/".concat(t.room,"/slices/").concat(t.slice,"?").concat((0,Vo.stringify)(i)),e.next=8,n.fetchJSON(a,{headers:{"content-type":"application/json",token:t.roomToken}});case 8:if(o=e.sent,void 0===t.room||t.room===o.roomUUID){e.next=11;break}throw new Error("slice ".concat(o.uuid," is not belongs to room ").concat(t.room));case 11:r=[o],e.next=22;break;case 14:if(void 0===t.room){e.next=21;break}return s=t.beginTimestamp,c=void 0!==t.beginTimestamp&&void 0!==t.duration?t.beginTimestamp+t.duration:void 0,u={beginAt:s,endAt:c,clientVersion:this.clientVersion},l="https://persistence/pv/rooms/".concat(t.room,"/slices?").concat((0,Vo.stringify)(u)),e.next=18,n.fetchJSON(l,{headers:{"content-type":"application/json",token:t.roomToken}});case 18:r=e.sent,e.next=22;break;case 21:throw new Error("expect either room or slice");case 22:if(!((r=r.map((function(e){return m.fillSliceLibIdentifier(e)}))).length>0)){e.next=31;break}void 0===(h=t.beginTimestamp)&&(h=Math.min.apply(Math,C(r.map((function(e){return e.beginTimestamp}))))),d=t.duration?h+t.duration:Math.max.apply(Math,C(r.map((function(e){return e.beginTimestamp+e.duration})))),p=E(r);try{for(p.s();!(f=p.n()).done;)v=f.value,Object.freeze(v)}catch(e){p.e(e)}finally{p.f()}return e.abrupt("return",(r=r.filter((function(e){var t=e.beginTimestamp;return e.beginTimestamp+e.duration>=h&&t<=d})),new ac({beginAt:h,endAt:d,slices:r})));case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"fillSliceLibIdentifier",value:function(e){var t,n=h(e.libIdentifier.replace(/\.\w+$/im,"").split("-"),2),r=n[0],i=n[1];if(r&&i)try{if(_e.compare(_e.parse(i),_e.parse("2.7.0"))<0)switch(r){case"2.0.0":t="2.0.0-2.7.9.0f385eb562396be49fb451e80c1d85fa";break;case"2.1.0":t="2.1.0-2.8.0.fb7b9e324522d815ee4e40990d061a0b"}}catch(e){console.warn(e)}return t?qo(Ko({},e),{libIdentifier:t}):e}}]),e}();!function(e){e.WaitingFirstFrame="waitingFirstFrame",e.Playing="playing",e.Pause="pause",e.Stopped="stopped",e.Ended="ended",e.Buffering="buffering",e.Seeking="seeking"}(nc||(nc={}));var cc=function(){function e(t){M(this,e);var n=t.onAkkoSetupFailed,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new No(e)}({escapeObjectFilter:t.escapeObjectFilter,jsxFactory:t.jsxFactory,observerAdapter:t.observerAdapter});if(this.imageFactory=new Ri(r),this.convertIdToUrl=t.convertIdToUrl,t.shuntApiHosts){var i=new us({appIdentifier:t.appIdentifier,shuntApiHosts:t.shuntApiHosts,onInterruptConfigs:t.configsInterrupter,onAkkoSetupFailed:function(e){console.error("akko setup failed: ".concat(e.stack||e.message)),n&&n(e)}}),a=!!t.enableAnimationFrame,o={enableAnimationFrame:a},s=function(e){return!1===e?{disableReconnect:!0}:Ko(Ko({},Cs),e)}(t.reconnectionOptions);this.magixFactory=new Xs(i,this.imageFactory,s,t.netStateAdapter,t.clientVersion,o),this.playerFactory=new sc(i,this.imageFactory,t.clientVersion,a)}}var t;return O(e,[{key:"createMagix",value:function(e){if(!this.magixFactory)throw new Error("expect shuntApiHosts");var t=(new Jo).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.magixFactory.createMagix(n,e)}},{key:"createReconstructor",value:function(e){if(!this.playerFactory)throw new Error("expect shuntApiHosts");var t=(new Jo).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.playerFactory.createReconstructor(n,e)}},{key:"searchSlices",value:(t=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerFactory){e.next=2;break}throw new Error("expect shuntApiHosts");case 2:return e.next=4,this.playerFactory.searchSlices(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),uc=function(){function e(t,n,r,i,a,o,s,c){var u=this;M(this,e),this.fetcher=t,this.methodNameToIdMap=n,this.objectOperator=r,this.libraryNodeFetcher=i,this.actionFrameHelper=a,this.includesFrameHash=o,this.logger=s,this.delegate=c,this.illusionQueue=[],this.frameGenerator=null,this.connectedTimestamp=0,this.isDisconnected=!1,this.onReceivedScopeSlices=function(e){u.frameGenerator&&u.frameGenerator.appendScopeSlices(e)},this.onReceivedActionFrame=function(e){if(u.frameGenerator){var t=new Gn(e),n=t.authorId;if(u.frameGenerator.author.userId===n){var r=u.takeIllusionFrame(t.originalFrameId);r&&u.delegate.reportRTT(u,t.timestamp-r.timestamp)}}},this.onKickedWithReason=function(e){u.onDisconnectWithError(new Error("kick by server with reason "+JSON.stringify(e)))},this.onDisconnectWithError=function(e){u.isDisconnected=!0,u.delegate.reportSessionDisconnected(u,e,Date.now()-u.connectedTimestamp)}}var t,n;return O(e,[{key:"connect",value:(n=I(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Date.now(),e.next=3,ws({uuid:t,fetcher:this.fetcher,roomToken:n,timeout:45e3,clientVersion:"2.6.4",logger:this.logger,markWritable:!0,access:"writable",reconnectionOptions:{disableReconnect:!0},objectOperator:this.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 3:if(a=e.sent,o=a.session,s=a.connection,c=0,e.t0=r,!e.t0){e.next=13;break}return c=Date.now(),e.next=12,this.getIllusionFrameGenerator(s);case 12:this.frameGenerator=e.sent;case 13:this.socketSession=o,this.connectedTimestamp=Date.now(),r&&this.delegate.reportBecomeWritableInterval(this,this.connectedTimestamp-c),this.delegate.reportConnectionInterval(this,this.connectedTimestamp-i);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"isWritable",get:function(){return!!this.frameGenerator}},{key:"uuid",get:function(){return this.socketSession.uuid}},{key:"getIllusionFrameGenerator",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.updateToWritable(null,null);case 2:if(n=e.sent){e.next=5;break}throw new Error("can't become writable");case 5:return r=new ki(n.initializeSlices),i=new xi(n.userId,r,1),e.abrupt("return",new Pi(i,this.actionFrameHelper,this.includesFrameHash));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"invokeMethod",value:function(e,t){if(this.assertDisconnected(),!this.frameGenerator)throw new Error("it's not writable");var n=this.methodNameToIdMap[e],r=Date.now();if(void 0===n)throw new Error("can't find callable method "+JSON.stringify(e));var i=this.frameGenerator.author.allocateIdentifierGenerator(),a=this.frameGenerator.createInvokerFrame(n,t,r,i);this.handleGeneratedFrame(a)}},{key:"dispatchEvent",value:function(e,t){if(this.assertDisconnected(),!this.frameGenerator)throw new Error("it's not writable");var n=Date.now(),r=this.frameGenerator.author.allocateIdentifierGenerator(),i=this.frameGenerator.createEventFrame(e,t,n,r);this.handleGeneratedFrame(i)}},{key:"handleGeneratedFrame",value:function(e){var t=new Gn(e);this.illusionQueue.push({frameId:t.frameId,timestamp:t.timestamp}),this.illusionQueue.length>1200&&this.illusionQueue.shift(),this.socketSession.connection&&this.socketSession.connection.sendActionFrame(e)}},{key:"disconnect",value:function(){this.assertDisconnected(),this.isDisconnected=!0,this.socketSession.dispose()}},{key:"assertDisconnected",value:function(){if(this.isDisconnected)throw new Error("was disconnected")}},{key:"takeIllusionFrame",value:function(e){for(var t=0;t<this.illusionQueue.length;++t){var n=this.illusionQueue[t];if(n.frameId===e)return this.illusionQueue.splice(t,1),n}}}]),e}(),lc=function(){function e(t){var n=this;M(this,e),this.fetchLibraryNode=function(){var e=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.library.appIdentifier===t.appIdentifier){e.next=2;break}throw new Error("invalid appIdentifier ".concat(n.library.appIdentifier,", wanna ").concat(t.appIdentifier));case 2:if(n.library.appVersion===t.appVersion){e.next=4;break}throw new Error("invalid appVersion ".concat(n.library.appVersion,", wanna ").concat(t.appVersion));case 4:if(n.library.appHash===t.appHash){e.next=6;break}throw new Error("invalid appHash ".concat(n.library.appHash,", wanna ").concat(t.appHash));case 6:return e.abrupt("return",{libraryClass:n.library.rootClass,appVersion:n.library.akkoVersion});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.library=t.library,this.methodNameToIdMap=this.createMethodNameToIdMap(t.library),this.actionFrameHelper=new Ii(t.library,t.proxyRuntime.objectOperator,t.proxyRuntime.frameHandler,Ct.V1),this.objectOperator=t.proxyRuntime.objectOperator,this.includesFrameHash=t.includesFrameHash,this.logger=t.logger,this.fetcher=new us({appIdentifier:t.appIdentifier,shuntApiHosts:t.shuntApiHosts}).create(t.region)}var t;return O(e,[{key:"create",value:(t=I(regeneratorRuntime.mark((function e(t,n,r,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new uc(this.fetcher,this.methodNameToIdMap,this.objectOperator,this.fetchLibraryNode,this.actionFrameHelper,this.includesFrameHash,this.logger,i),e.next=3,a.connect(t,n,r);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"createMethodNameToIdMap",value:function(e){for(var t={},n=ai(e.rootClass),r=0;r<n.methodNames.length;++r)t[n.methodNames[r]]=r;return t}}]),e}(),hc={};V(hc,{AnimationMode:function(){return Uh},Boundless:function(){return Hh},BoundlessEventKind:function(){return Oc},CNode:function(){return qu},CameraTransformation:function(){return Bh},CanvasPaitingMode:function(){return Fh},CanvasRenderMode:function(){return Hu},CanvasRenderState:function(){return zh},ComponentKind:function(){return Dh},DeviceType:function(){return Ah},LayoutKind:function(){return Vh},LayoutRenderMode:function(){return Wh},RectangleAdapterMode:function(){return jh},RectangleTesting:function(){return eh},RenderLayoutMode:function(){return Ec},creatHTMLRenderEngine:function(){return nl},createCanvasRenderEngine:function(){return Qu},createComponentDefinition:function(){return _h},distance:function(){return Xh},isCanvasRenderEngine:function(){return Zu},isHTMLRenderEngine:function(){return rl},midpoint:function(){return Gh},unitVector:function(){return Yh}});var dc=W(n("aaBP")),pc=Object.defineProperty,fc=Object.defineProperties,vc=Object.getOwnPropertyDescriptors,mc=Object.getOwnPropertySymbols,gc=Object.prototype.hasOwnProperty,yc=Object.prototype.propertyIsEnumerable,bc=function(e,t,n){return t in e?pc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},kc=function(e,t){for(var n in t||(t={}))gc.call(t,n)&&bc(e,n,t[n]);if(mc){var r,i=E(mc(t));try{for(i.s();!(r=i.n()).done;){n=r.value;yc.call(t,n)&&bc(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},wc=Object.freeze({debug:0,info:1,warn:2,error:3}),Sc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.prefix,r=t.levelMask;M(this,e),this.prefix=n,this.levelMaskIndex=wc[r||"info"]}return O(e,[{key:"log",value:function(e,t,n){wc[t]>=this.levelMaskIndex&&(this.prefix?console[t](this.prefix,n):console[t](n))}},{key:"commit",value:function(){}},{key:"isSupportedEvents",value:function(e){return!0}}]),e}();function xc(e){var t={};for(var n in e){var r=e[n];void 0!==r&&(t[n]=r)}return t}function Ic(e,t,n){if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));return function e(t,n,r){var i={debug:Cc(t,"debug",n,r),info:Cc(t,"info",n,r),warn:Cc(t,"warn",n,r),error:Cc(t,"error",n,r),withContext:function(i){return e(t,n,{context:kc(kc({},r.context),i)})}};return Object.defineProperty(i,"context",{enumerable:!1,set:function(e){return r.context=e},get:function(){return r.context}}),Object.freeze(i)}(e,t,n?{context:xc(n)}:{})}function Cc(e,t,n,r){return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0;s<a.length;++s)a[s]=Mc(a[s]);var c=Pc(r),u=a.join(" ");e.log(n,t,u,c)}}function Pc(e){var t;if(e.context)for(var n in t||(t={}),e.context)t[n]=e.context[n];return Object.freeze(t)}function Mc(e){if(e instanceof Error){var t="Error: "+e.message+"\n";return"string"==typeof e.stack?t+e.stack.replace(t,""):t}try{return"".concat(e)}catch(t){return"[".concat(R(e)," ").concat(JSON.stringify(t.message),"]")}}function Tc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=Object.freeze(xc(n));return Object.freeze({commit:function(n){e.commit(t,kc(kc({},r),n))}})}var Oc,Ec,Ac=function(){function t(e,n){M(this,t),this.argusEvents=function e(t){if("object"!=R(t)||null===t)return t;if(t instanceof Array){var n,r=[],i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(e(a))}}catch(e){i.e(e)}finally{i.f()}return Object.freeze(r)}var o={};for(var s in t)o[s]=e(t[s]);return Object.freeze(o)}(e),this.vid=n}return O(t,[{key:"encode",value:function(t,n){var r=function(e,t){return fc(e,vc(t))}(kc({},n),{vid:this.vid,lts:Date.now(),clientIP:"__#CLIENT_IP#__"}),a=this.argusEvents[t],o=a.eventID,s=a.proto,c=s.verify(r);if(c)throw new Error(c);var u=s.create(r),l=function(t){if("object"==(void 0===i?"undefined":R(i))&&i+""=="[object process]")return e.from(t).toString("base64");for(var n,r="",a=0,o=t.length;a<o;)n=t.subarray(a,Math.min(a+32768,o)),r+=String.fromCharCode.apply(null,n),a+=32768;return btoa(r)}(s.encode(u).finish()),h="whiteBoard",d=Math.floor(Date.now()/1e3),p=(0,dc.hash)("payload=".concat(l,"&src=").concat(h,"&ts=").concat(d));return{id:o,src:h,payload:l,qos:1===this.vid?101:1,ts:d,sign:p}}}]),t}(),Nc=function(){function e(){M(this,e),this.queue=[]}return O(e,[{key:"append",value:function(e){this.queue.push(e)}},{key:"next",get:function(){return this.queue[0]}},{key:"done",value:function(){this.queue.shift()}},{key:"length",get:function(){return this.queue.length}}]),e}(),Rc=W(n("q1tI")),Lc=W(n("q1tI")),jc=W(n("q1tI")),Dc=W(n("q1tI")),zc=W(n("q1tI")),Fc=W(n("jpn6")),Bc=W(n("q1tI")),Uc=W(n("q1tI")),Vc=W(n("q1tI")),Wc=W(n("i8i4")),Hc=W(n("q1tI")),_c=W(n("q1tI")),Gc=W(n("lOZ2")),Yc=Object.defineProperty,Xc=Object.defineProperties,Qc=Object.getOwnPropertyDescriptors,Zc=Object.getOwnPropertySymbols,Kc=Object.prototype.hasOwnProperty,qc=Object.prototype.propertyIsEnumerable,Jc=function(e,t,n){return t in e?Yc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},$c=function(e,t){for(var n in t||(t={}))Kc.call(t,n)&&Jc(e,n,t[n]);if(Zc){var r,i=E(Zc(t));try{for(i.s();!(r=i.n()).done;){n=r.value;qc.call(t,n)&&Jc(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},eu=function(e,t){return Xc(e,Qc(t))};!function(e){e.MouseDown="MouseDown",e.MouseMove="MouseMove",e.MouseUp="MouseUp",e.MouseLeave="MouseLeave",e.MouseWheel="MouseWheel",e.TouchStart="TouchStart",e.TouchMove="TouchMove",e.TouchEnd="TouchEnd",e.TouchCancel="TouchCancel",e.SortedTouchStart="SortedTouchStart",e.SortedTouchMove="SortedTouchMove",e.SortedTouchEnd="SortedTouchEnd",e.SortedTouchCancel="SortedTouchCancel",e.KeyDown="KeyDown",e.KeyUp="KeyUp"}(Oc||(Oc={})),function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(Ec||(Ec={}));var tu,nu=function(){function e(t){M(this,e),this.definitions={},this.id="".concat(e.nextId),this.orderIndex=t,e.nextId+=1}return O(e,[{key:"addDefinition",value:function(e){this.definitions[e.id]=e}}]),e}();nu.nextId=0,function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.Safari=2]="Safari",e[e.IE=3]="IE",e[e.Other=4]="Other",e[e.Unkown=5]="Unkown"}(tu||(tu={}));var ru=new(function(){function e(){M(this,e),this.kind=5}return O(e,[{key:"getContext",value:function(e){var t=e.getContext("2d");switch(t.imageSmoothingEnabled=!1,this.kind){case 0:t.mozImageSmoothingEnabled=!1;break;case 1:t.oImageSmoothingEnabled=!1;break;case 2:t.webkitImageSmoothingEnabled=!1;break;case 3:t.msImageSmoothingEnabled=!1;break;case 5:void 0!==t.mozImageSmoothingEnabled?(t.mozImageSmoothingEnabled=!1,this.kind=0):void 0!==t.oImageSmoothingEnabled?(t.oImageSmoothingEnabled=!1,this.kind=1):void 0!==t.webkitImageSmoothingEnabled?(t.webkitImageSmoothingEnabled=!1,this.kind=2):void 0!==t.msImageSmoothingEnabled&&(t.msImageSmoothingEnabled=!1,this.kind=3)}return t}}]),e}());function iu(e){return ru.getContext(e)}var au,ou=function(){function e(){M(this,e),this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}return O(e,[{key:"recordPaintFloat",value:function(){this.paintFloatCount+=1}},{key:"recordGenerateCache",value:function(){this.generateCacheCount+=1}},{key:"recordPaintCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.paintCacheCount+=e}},{key:"recordFuseCache",value:function(){this.fuseCacheCount+=1}},{key:"recordFuse",value:function(e){this.fuseCount+=e}},{key:"recordSplit",value:function(){this.splitCount+=1}},{key:"clear",value:function(){this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}},{key:"print",value:function(){console.log("\n========="),console.log("paintFloatCount",this.paintFloatCount),console.log("generateCacheCount",this.generateCacheCount),console.log("paintCacheCount",this.paintCacheCount),console.log("fuseCacheCount",this.fuseCacheCount),console.log("fuseCount",this.fuseCount),console.log("splitCount",this.splitCount),this.clear()}}]),e}(),su=Object.freeze({forEach:function(){return!1}});!function(e){e[e.Fusion=0]="Fusion",e[e.Rejection=1]="Rejection"}(au||(au={}));var cu=function(){function e(t,n,r){var i=this;M(this,e),this.cells={},this.forEach=function(t){if(0===i.mode)for(var n in i.cells){var r=i.cells[n],a=r.row,o=r.column;if(t(a,o))return!0}return i.range.forEach((function(n,r){var a=e.key(n,r);return!(i.cells[a]||!t(n,r))}))},this.mode=t,this.range=n;var a,o=E(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=e.key(s.row,s.column);this.cells[c]=s}}catch(e){o.e(e)}finally{o.f()}}return O(e,null,[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}(),uu=function(){function e(t,n,r,i){var a=this;M(this,e),this.row0=t,this.row1=n,this.column0=r,this.column1=i,this.forEach=function(e){for(var t=a.row0,n=a.row1,r=a.column0,i=a.column1,o=t;o<n;++o)for(var s=r;s<i;++s)if(e(o,s))return!0;return!1}}return O(e,[{key:"toString",value:function(){return"[row0=".concat(this.row0," row1=").concat(this.row1," column0=").concat(this.column0," column1=").concat(this.column1,"]")}},{key:"excludeForEach",value:function(e){var t=this.row0,n=this.row1,r=this.column0,i=this.column1,a=t,o=this.clamp(t,e.row0,n),s=this.clamp(t,e.row1,n),c=n,u=r,l=this.clamp(r,e.column0,i),h=this.clamp(r,e.column1,i),d=i;return{forEach:function(e){for(var t=a;t<o;++t)for(var n=r;n<i;++n)if(e(t,n))return!0;for(var p=s;p<c;++p)for(var f=r;f<i;++f)if(e(p,f))return!0;for(var v=o;v<s;++v)for(var m=u;m<l;++m)if(e(v,m))return!0;for(var g=o;g<s;++g)for(var y=h;y<d;++y)if(e(g,y))return!0;return!1}}}},{key:"clamp",value:function(e,t,n){var r=t;return r<e?r=e:r>n&&(r=n),r}},{key:"rowsCount",get:function(){return this.row1-this.row0}},{key:"columnsCount",get:function(){return this.column1-this.column0}},{key:"includes",value:function(e,t){return this.row0<=e&&e<this.row1&&this.column0<=t&&t<this.column1}},{key:"includesRange",value:function(e){var t=e.row0,n=e.row1,r=e.column0,i=e.column1;return this.row0<=t&&n<=this.row1&&this.column0<=r&&i<=this.column1}},{key:"merge",value:function(t,n,r){for(var i=new e(Math.floor(this.row0/t),Math.ceil(this.row1/t),Math.floor(this.column0/n),Math.ceil(this.column1/n)),a=i.row0,o=i.row1,s=i.column0,c=i.column1,u=a;u<o;++u)for(var l=s;l<c;++l){var h=!1,d=u*t,p=(u+1)*t,f=l*n,v=(l+1)*n;d<this.row0&&(d=this.row0,h=!0),p>this.row1&&(p=this.row1,h=!0),f<this.column0&&(f=this.column0,h=!0),v>this.column1&&(v=this.column1,h=!0);var m=new e(d,p,f,v);m.rowsCount>0&&m.columnsCount>0&&r(u,l,m,h)}return i}},{key:"fork",value:function(t,n,r){for(var i=this.row0,a=this.row1,o=this.column0,s=this.column1,c=i;c<a;++c)for(var u=o;u<s;++u)r(c,u,new e(c*t,(c+1)*t,u*n,(u+1)*n));return new e(this.row0*t,this.row1*t,this.column0*n,this.column1*n)}}],[{key:"rectToRange",value:function(t,n){var r=t.originX,i=t.originY,a=t.width,o=t.height,s=n.width,c=n.height,u=Math.floor(i/c),l=Math.floor(r/s);return new e(u,Math.floor((i+o)/c)+1,l,Math.floor((r+a)/s)+1)}},{key:"cellToRect",value:function(e,t,n){var r=n.width,i=n.height;return{originX:t*r,originY:e*i,width:r,height:i}}},{key:"calcIntersection",value:function(t,n){var r=Math.max(t.row0,n.row0),i=Math.min(t.row1,n.row1),a=Math.max(t.column0,n.column0),o=Math.min(t.column1,n.column1);return r<i&&a<o?new e(r,i,a,o):null}},{key:"calcDiff",value:function(e,t){var n=this.calcIntersection(e,t);return{addedRange:e.excludeForEach(t),removedRange:t.excludeForEach(e),keepRange:n?{forEach:n.forEach}:su}}},{key:"isEquals",value:function(e,t){return e.row0===t.row0&&e.row1===t.row1&&e.column0===t.column0&&e.column1===t.column1}}]),e}(),lu=function(){function e(){M(this,e),this.nodes={}}return O(e,[{key:"get",value:function(t,n){var r,i=e.key(t,n);return null==(r=this.nodes[i])?void 0:r.element}},{key:"set",value:function(t,n,r){var i=e.key(t,n);return this.nodes[i]=Object.freeze({element:r,row:t,column:n,key:i}),r}},{key:"delete",value:function(t,n){var r=e.key(t,n),i=this.nodes[r];if(i)return delete this.nodes[r],i.element}},{key:"fill",value:function(e){var t=e.nodes;for(var n in t)this.nodes[n]=t[n]}},{key:"clear",value:function(e){if(e)for(var t in this.nodes)e(this.nodes[t].element);this.nodes={}}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.element,n.row,n.column)}}}],[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}();function hu(e,t){if(R(e)!=R(t))return!1;if("object"!=R(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var n in e){if(!(n in t))return!1;if(!hu(e[n],t[n]))return!1}for(var r in t)if(!(r in e))return!1;return!0}if(e.constructor===Array){var i=e,a=t;if(i.length!==a.length)return!1;for(var o=0;o<i.length;++o)if(!hu(e[o],t[o]))return!1;return!0}return!0}var du=function(){function e(t){M(this,e),this.visibleNodes={},this.rate=t.rate,this.bucketUnitSize=Object.freeze($c({},t.bucketUnitSize)),this.favorBucketsCount=t.favorBucketsCount,this.tree=t.tree,this.visions=t.visions,this.bucketFactory=t.bucketFactory,this.onLeafNodeVisible=t.onLeafNodeVisible,this.onLeafNodeInvisible=t.onLeafNodeInvisible,this.visionCover=this.calcVisionCover(t.visionRectangle),this._projectiveSize=this.calcProjectiveSize(this.visionCover,t.scale),this.buckets=new lu,this.searchAndFillVisibleNodes(this.visionCover.range,this._projectiveSize,this.visionCover.unitSize)}return O(e,[{key:"projectiveSize",get:function(){return this._projectiveSize}},{key:"unitSize",get:function(){return this.visionCover.unitSize}},{key:"range",get:function(){return this.visionCover.range}},{key:"forEachBuckets",value:function(e){this.buckets.forEach(e)}},{key:"bucket",value:function(e,t){return this.buckets.get(e,t)}},{key:"update",value:function(e){var t=this;this.refreshVisibleNodes(e.diff);var n=this.updateVision(e),r=n.addedRange,i=n.keepRange,a=n.updatedProjectiveSize,o=$c({},e.updateSet);i.forEach((function(n,r){var i=t.buckets.get(n,r),a=t.appendDiffAndCollectMovedLeaves(n,r,i,e);Object.assign(o,a)})),r.forEach((function(e,n){var r=t.buckets.get(e,n).collectLeaves();Object.assign(o,r)})),i.forEach((function(n,r){var i=t.buckets.get(n,r);i.handleUpdatedLeaves(o),i.fuseChunksWithNeighbours(),i.increaseChunksLife(),a&&i.updateProjectiveSize(a,e.refresh)})),e.shouldUpdateAll&&this.forEachBuckets((function(e){return e.notifyGlobalUpdate()})),this.callbackLeavesVisible(e)}},{key:"refreshVisibleNodes",value:function(e){var t=e.addedSet,n=e.removedSet;for(var r in t)this.visibleNodes[r]=t[r];for(var i in n)delete this.visibleNodes[i]}},{key:"updateVision",value:function(t){var n=su,r=this.visionCover.range,i=null;if(t.visionRectangle){var a=this.calcVisionCover(t.visionRectangle,this.visionCover.exponent),o=this.calcProjectiveSize(a,t.scale);if(!e.isVisionCoversEquals(a,this.visionCover)){var s=this.forkOrMegeAndGetRangeDiff(a,o);this.searchAndFillVisibleNodes(s.addedRange,o,a.unitSize),this.visionCover=a,n=s.addedRange,r=s.keepRange}hu(o,this._projectiveSize)||(this._projectiveSize=o,i=o)}return{addedRange:n,keepRange:r,updatedProjectiveSize:i}}},{key:"forkOrMegeAndGetRangeDiff",value:function(e,t){var n,r=this,i=e.exponent-this.visionCover.exponent;if(i>0){var a=Math.pow(this.rate,i),o=new lu,s=[],c=this.visionCover.range.merge(a,a,(function(n,i,a,c){if(e.range.includes(n,i))if(c)s.push({row:n,column:i});else{var u=r.bucketFactory.merge(r.buckets,{range:a,unitSize:e.unitSize,projectiveSize:t});o.set(n,i,u)}}));if(n=uu.calcDiff(e.range,c),s.length>0){var u=function(e,t){return new cu(au.Fusion,e,t)}(n.addedRange,s),l=function(e,t){return new cu(au.Rejection,e,t)}(n.keepRange,s);n=eu($c({},n),{addedRange:u,keepRange:l})}this.buckets.forEach((function(e){return e.dispose()})),this.buckets=o}else if(i<0){var h=Math.pow(this.rate,Math.abs(i)),d=new lu,p=this.visionCover.range.fork(h,h,(function(n,i,a){var o=uu.calcIntersection(a,e.range),s=r.buckets.get(n,i);if(o&&s){var c=r.bucketFactory.fork(s,{range:o,unitSize:e.unitSize,projectiveSize:t});d.fill(c)}}));n=uu.calcDiff(e.range,p),this.buckets.forEach((function(e){return e.dispose()})),this.buckets=d}else(n=uu.calcDiff(e.range,this.visionCover.range)).removedRange.forEach((function(e,t){var n;null==(n=r.buckets.delete(e,t))||n.dispose()}));return n}},{key:"searchAndFillVisibleNodes",value:function(e,t,n){var r=this,i=null;e.forEach((function(e,a){if(!i)for(var o in i={},r.visibleNodes){var s=r.rangeOfLeafNode(r.visibleNodes[o],n);s&&(i[o]=s)}var c=uu.cellToRect(e,a,n),u=r.bucketFactory.build(r.tree,c,t,(function(t){var n=i[t.id];return!(!n||!n.includes(e,a))}));r.buckets.set(e,a,u)}))}},{key:"appendDiffAndCollectMovedLeaves",value:function(e,t,n,r){var i=r.diff,a=r.moveSet,o=i.addedSet,s=this.visionCover.unitSize,c=[],u=[],l=[];for(var h in o){var d=this.rangeOfLeafNode(o[h],s);d&&!d.includes(e,t)&&c.push(h)}var p={};for(var f in a){var v=a[f],m=this.rangeOfLeafNode(v,s);if(m){var g=n.has(f),y=m.includes(e,t);g&&y?p[f]=v:g&&!y?l.push(v):!g&&y&&u.push(v)}}return(c.length>0||u.length>0||l.length>0)&&(i=i.decorate({maskAdded:c,insertToAdded:u,insertToRemoved:l})),n.appendDiff(i),p}},{key:"callbackLeavesVisible",value:function(e){var t=e.diff,n=t.addedSet,r=t.removedSet;for(var i in n)this.onLeafNodeVisible(n[i]);for(var a in r)this.onLeafNodeInvisible(r[a])}},{key:"calcVisionCover",value:function(t,n){var r=t.width*t.height;0===r&&(r=1);var i=this.rate,a=this.favorBucketsCount,o=this.bucketUnitSize,s=o.width*o.height,c=Math.log(r/(a*s))/(2*Math.log(i));if(void 0===n)c=Math.ceil(c);else{var u=n+e.ExponentBuffer,l=n-1-e.ExponentBuffer;c=c>u||c<l?Math.ceil(c):n}var h=Math.pow(i,c),d=Object.freeze({width:o.width*h,height:o.height*h}),p=uu.rectToRange(t,d);return Object.freeze({exponent:c,range:p,unitSize:d})}},{key:"calcProjectiveSize",value:function(e,t){var n=e.unitSize,r=n.width,i=n.height;return Object.freeze({width:Math.ceil(r*t),height:Math.ceil(i*t)})}},{key:"rangeOfLeafNode",value:function(e,t){var n=this.visions.vision(e.id);return n?uu.rectToRange(n.sceneRect,t):null}}],[{key:"isVisionCoversEquals",value:function(e,t){return e.exponent===t.exponent&&e.unitSize.width===t.unitSize.width&&e.unitSize.height===t.unitSize.height&&uu.isEquals(e.range,t.range)}}]),e}();du.ExponentBuffer=.25;var pu=function(){function e(t,n,r,i,a,o){var s=this;M(this,e),this.touch=function(){s.onRepaint(s.leaf.value)},this.screen=t,this.visions=n,this.id=r.id,this.leaf=r,this.fixedSize=i,this.render=a,this.onRepaint=o}return O(e,[{key:"refreshPayload",value:function(){this.render.updatePayload(this.leaf.value.payload)}},{key:"updateContext",value:function(e){this.render.updateContext(e)}},{key:"paint",value:function(e,t,n){var r=this.leaf.value,i=this.visions.vision(this.leaf.id),a=this.createPaintParams(e,i,r,t,n),o=i.screenRect.originX,s=i.screenRect.originY;if(n&&(o-=n.originX,s-=n.originY),e.translate(o,s),this.fixedSize){var c=i.scale;1!==c&&e.scale(c,c)}this.render.paint(a)}},{key:"createPaintParams",value:function(e,t,n,r,i){var a,o,s,c=t.screenRect,u=this.touch,l=this.createTailor(t,i);if(this.fixedSize){s=1,o={width:n.width,height:n.height};var h=t.scale,d=t.margin,p=c.width/h-o.width,f=c.height/h-o.height,v=p/(d.left+d.right),m=f/(d.top+d.bottom);a={left:d.left*v,right:d.right*v,top:d.top*m,bottom:d.bottom*m}}else s=t.scale,a=t.margin,o={width:c.width-a.left-a.right,height:c.height-a.top-a.bottom};var g={context:e,margin:a,scale:s,size:o,tailor:l,paintingMode:r,touch:u,screen:this.screen},y=this.createFakeScreenRect(o,l);return g.screenSize=y,g.screenRect=y,g}},{key:"createTailor",value:function(e,t){var n=e.tailor,r=n.left,i=n.top,a=n.right,o=n.bottom;if(t){var s=e.screenRect,c=s.originX,u=s.originY,l=c+s.width,h=u+s.height,d=c+r,p=u+i,f=l-a,v=h-o;r=(d=Math.max(d,t.originX))-c,i=(p=Math.max(p,t.originY))-u,a=l-(f=Math.min(f,t.originX+t.width)),o=h-(v=Math.min(v,t.originY+t.width))}if(this.fixedSize){var m=e.scale;r/=m,i/=m,a/=m,o/=m}return{left:r,top:i,right:a,bottom:o}}},{key:"createFakeScreenRect",value:function(e,t){var n=t.left,r=t.top;return{originX:n,originY:r,width:e.width-t.right-n,height:e.height-t.bottom-r}}}]),e}(),fu=function(){function e(t){M(this,e),this.nodes=null,this.id="".concat(e.nextId+=1),this.life=0,this.context=t}return O(e,[{key:"isFloat",get:function(){var t;return this.life<e.fuseThreshold&&1===(null==(t=this.nodes)?void 0:t.length)}},{key:"onFuse",value:function(e,t){}},{key:"onSplit",value:function(){}},{key:"onRemoved",value:function(){}},{key:Symbol.iterator,value:function(){return new vu(this.getNodes())}},{key:"previousChunk",get:function(){var e,t;return(null==(t=null==(e=this.getNodes()[0])?void 0:e.previousNode)?void 0:t.value)||null}},{key:"nextChunk",get:function(){var e,t,n=this.getNodes();return(null==(t=null==(e=n[n.length-1])?void 0:e.nextNode)?void 0:t.value)||null}},{key:"isFuseable",get:function(){return this.life>=e.fuseThreshold}},{key:"getSampleNode",value:function(){return this.nodes&&this.nodes.length>0?this.nodes[0]:null}},{key:"initWithNode",value:function(e){if(this.nodes)throw new Error("it is not init chunk");return this.nodes=[e],e.value=this,this}},{key:"initWithShadowList",value:function(e){if(this.nodes)throw new Error("it is not init chunk");this.nodes=[];var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.nodes.push(r),r.value=this}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"increaseLife",value:function(){var t=this;this.life<e.fuseThreshold&&this.watchIsFloatUpdate((function(){t.life+=1}))}},{key:"cutOff",value:function(e,t){var n=this;return this.watchIsFloatUpdate((function(){var r=n.getNodes(),i=r.indexOf(e),a=r.indexOf(t);if(-1===i)throw new Error("cannot find begin node id=".concat(e.id," to cut off"));if(-1===a)throw new Error("cannot find end node id=".concat(e.id," to cut off"));var o=r.splice(a),s=n.createChunkWithNodes(o),c=r.splice(0,i+1);return{left:n.createChunkWithNodes(c),right:s,becomeBlank:0===r.length}}))}},{key:"split",value:function(e){var t=this;return this.watchIsFloatUpdate((function(){var n=t.getNodes(),r=n.indexOf(e),i=null,a=null;if(-1===r)throw new Error("cannot find node id=".concat(e.id," to split"));if(r<n.length-1){var o=n.splice(r+1);i=t.createChunkWithNodes(o)}if(r>0){var s=n.splice(0,r);a=t.createChunkWithNodes(s)}return t.onSplit(),{left:a,right:i}}))}},{key:"createChunkWithNodes",value:function(e){var t=this.context.create();t.nodes=e;var n,r=E(e);try{for(r.s();!(n=r.n()).done;){n.value.value=t}}catch(e){r.e(e)}finally{r.f()}return t.isFloat&&t.context.bind(t,e[0].related),t}},{key:"fuseNeighboursBeforeMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.previousChunk)?void 0:e.isFuseable);)this.unshift(e),t.unshift(e);return t}},{key:"fuseNeighboursAfterMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.nextChunk)?void 0:e.isFuseable);)this.push(e),t.push(e);return t}},{key:"unshift",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).unshift.apply(n,C(t));var r,i=E(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"push",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).push.apply(n,C(t));var r,i=E(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"resetLife",value:function(){this.life=0}},{key:"dispose",value:function(){this.isFloat&&this.context.unbind(this,this.nodes[0].related),this.nodes=null,this.life=0,this.onRemoved()}},{key:"getNodes",value:function(){return this.nodes||(this.nodes=[]),this.nodes}},{key:"watchIsFloatUpdate",value:function(e){var t=this.isFloat,n=this.nodes&&this.nodes[0].related,r=e(),i=this.isFloat;return!t&&i?this.context.bind(this,this.nodes[0].related):t&&!i&&this.context.unbind(this,n),r}}],[{key:"fuseEachNeighbours",value:function(e){var t=[],n={};for(var r in e)n[r]||function(){n[r]=!0;var i=e[r];i.isFuseable&&i.watchIsFloatUpdate((function(){var e=i.fuseNeighboursBeforeMe(),r=i.fuseNeighboursAfterMe();(e.length>0||r.length>0)&&(i.life=0,i.onFuse(e,r));var a,o=E(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.id]=!0,t.push(s)}}catch(e){o.e(e)}finally{o.f()}var c,u=E(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;n[l.id]=!0,t.push(l)}}catch(e){u.e(e)}finally{u.f()}}))}();return t}}]),e}();fu.fuseThreshold=5,fu.nextId=0;var vu=function(){function e(t){M(this,e),this.nodes=t,this.index=0}return O(e,[{key:"next",value:function(){var e;return this.index<this.nodes.length?(e={value:this.nodes[this.index],done:!1},this.index+=1):e={value:void 0,done:!0},e}}]),e}();function mu(e){for(var t in e)return!0;return!1}var gu=function(){function e(t){M(this,e),this.addedSet={},this.sortedSet={},this.removedSet={},this.id="".concat(e.nextId),this.releaser=t,e.nextId+=1}return O(e,[{key:"fetchDiff",value:function(){var e=new yu(this.addedSet,this.sortedSet,this.removedSet);return this.addedSet={},this.sortedSet={},this.removedSet={},e}},{key:"release",value:function(){this.releaser(this.id)}},{key:"markAdded",value:function(e){this.addedSet[e.id]=e,delete this.sortedSet[e.id],delete this.removedSet[e.id]}},{key:"markSorted",value:function(e){this.addedSet[e.id]||(this.sortedSet[e.id]=e)}},{key:"markRemoved",value:function(e){this.removedSet[e.id]=e,delete this.addedSet[e.id],delete this.sortedSet[e.id]}}]),e}();gu.nextId=0;var yu=function(){function e(t,n,r){M(this,e),this.addedSet=t,this.sortedSet=n,this.removedSet=r}return O(e,[{key:"isBlank",get:function(){return!mu(this.addedSet)&&!mu(this.sortedSet)&&!mu(this.removedSet)}},{key:"decorate",value:function(t){var n=t.insertToAdded,r=t.insertToRemoved,i=t.maskAdded,a=null,o=null;if(n&&n.length>0){a=$c({},this.addedSet);var s,c=E(n);try{for(c.s();!(s=c.n()).done;){var u=s.value;a[u.id]=u}}catch(e){c.e(e)}finally{c.f()}}if(i&&i.length>0){a=a||$c({},this.addedSet);var l,h=E(i);try{for(h.s();!(l=h.n()).done;){delete a[l.value]}}catch(e){h.e(e)}finally{h.f()}}if(r&&r.length>0){o=$c({},this.removedSet);var d,p=E(r);try{for(p.s();!(d=p.n()).done;){var f=d.value;o[f.id]=f}}catch(e){p.e(e)}finally{p.f()}}return a=a||this.addedSet,o=o||this.removedSet,new e(a,this.sortedSet,o)}}],[{key:"createInsertDiff",value:function(t){var n,r={},i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]=a}}catch(e){i.e(e)}finally{i.f()}return new e(r,{},{})}}]),e}(),bu=function(){function e(t){M(this,e);var n,r={},i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]={leaf:a,nex:null}}}catch(e){i.e(e)}finally{i.f()}this.nodes=r,this.leaves=t}return O(e,[{key:"sort",value:function(){for(var e in this.leaves.splice(0),this.nodes){var t=this.nodes[e],n=this.findNextNode(t);n&&(t.nex=n,delete this.nodes[n.leaf.id])}for(var r in this.nodes)for(var i=this.nodes[r];i;)this.leaves.push(i.leaf),i=i.nex;return this.leaves}},{key:"findNextNode",value:function(e){for(var t=e.leaf.nexLeaf();t;){var n=this.nodes[t.id];if(n)return n;t=t.nexLeaf()}return null}}]),e}(),ku=function(){function e(t,n){M(this,e),this.par=null,this.pre=null,this.nex=null,this.tree=t,this.value=n,this.id=String(e.nextId),e.nextId+=1}return O(e,[{key:"parent",get:function(){return this.par}},{key:"assertBlank",value:function(e){if(this.assertBelongsTo(e),this.par||this.pre||this.nex)throw new Error("node is not empty")}},{key:"assertAddedTo",value:function(e){if(this.assertBelongsTo(e),this.isFreeNode())throw new Error("this node did not add to any tree")}},{key:"assertBelongsTo",value:function(e){if(this.tree!==e)throw new Error("this node is belongs to another tree")}},{key:"isFreeNode",value:function(){return null===this.par}},{key:"preLeaf",value:function(){return this.pre?this.pre.lastLeaf():this.par?this.par.preLeaf():null}},{key:"nexLeaf",value:function(){return this.nex?this.nex.firstLeaf():this.par?this.par.nexLeaf():null}}]),e}();ku.nextId=0;var wu=function(e){m(n,e);var t=y(n);function n(e,r){return M(this,n),t.call(this,e,r)}return O(n,[{key:"firstLeaf",value:function(){return this}},{key:"lastLeaf",value:function(){return this}}]),n}(ku),Su=function(e){m(n,e);var t=y(n);function n(e,r){var i,a;M(this,n),(a=t.call(this,e,r)).fir=null,a.las=null,a.forEachLeaves=function(e){for(var t=a.fir;t;)t instanceof wu?e(t):t.forEachLeaves(e),t=t.nex};var o=(c(i={},Symbol.iterator,(function(){return new Iu(k(a))})),c(i,"forEach",a.forEachLeaves),i);return a.leaves=Object.freeze(o),a}return O(n,[{key:Symbol.iterator,value:function(){return new xu(this.fir)}},{key:"nodes",get:function(){for(var e=[],t=this.fir;t;)e.push(t),t=t.nex;return e}},{key:"assertBlank",value:function(e){if(l(S(n.prototype),"assertBlank",this).call(this,e),this.fir||this.las)throw new Error("node is not empty")}},{key:"firstLeaf",value:function(){for(var e=this.fir;e;){var t=e.firstLeaf();if(t)return t;e=e.nex}return null}},{key:"lastLeaf",value:function(){for(var e=this.las;e;){var t=e.lastLeaf();if(t)return t;e=e.pre}return null}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"isFreeNode",value:function(){return l(S(n.prototype),"isFreeNode",this).call(this)&&this!==this.tree.root}}]),n}(ku),xu=function(){function e(t){M(this,e),this.node=t}return O(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),Iu=function(){function e(t){M(this,e),this.node=t.firstLeaf(),this.lastLeaf=t.lastLeaf()}return O(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node===this.lastLeaf?this.node=null:this.node=this.node.nexLeaf()):e={value:void 0,done:!0},e}}]),e}(),Cu=function(){function e(t){M(this,e),this.bufferMap={},this._root=new Su(this),t&&t(this)}return O(e,[{key:"root",get:function(){return this._root}},{key:"createDiffBuffer",value:function(){var e=this,t=new gu((function(t){return delete e.bufferMap[t]}));return this.bufferMap[t.id]=t,t}},{key:"wrapLeaf",value:function(e){return new wu(this,e)}},{key:"wrapGroup",value:function(e){return new Su(this,e)}},{key:Symbol.iterator,value:function(){return this._root.leaves[Symbol.iterator]()}},{key:"forEach",value:function(e){return this._root.leaves.forEach(e)}},{key:"append",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertBlank(this),r.assertAddedTo(this),this.appendTo(n,r),this.markAdded(n)}},{key:"addAfter",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add after root");this.addAfterTo(n,r),this.markAdded(n)}},{key:"addBefore",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add before root");this.addBeforeTo(n,r),this.markAdded(n)}},{key:"remove",value:function(e){var t=e;t.assertAddedTo(this),this.removeFrom(t),this.markRemoved(t)}},{key:"moveAppend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.appendTo(n,r),this.markSorted(n)}},{key:"moveAfter",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addAfterTo(n,r),this.markSorted(n)}},{key:"moveBefore",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addBeforeTo(n,r),this.markSorted(n)}},{key:"appendTo",value:function(e,t){e.par=t,t.las?(e.pre=t.las,t.las.nex=e,t.las=e):(t.fir=e,t.las=e)}},{key:"addAfterTo",value:function(e,t){var n=t.nex,r=t.par;if(!r)throw new Error("cannot add after root");e.pre=t,e.nex=n,e.par=r,t.nex=e,n&&(n.pre=e),r.las===t&&(r.las=e)}},{key:"addBeforeTo",value:function(e,t){var n=t.pre,r=t.par;if(!r)throw new Error("cannot add before root");e.nex=t,e.pre=n,e.par=r,t.pre=e,n&&(n.nex=e),r.fir===t&&(r.fir=e)}},{key:"removeFrom",value:function(e){var t=e.pre,n=e.nex,r=e.par;if(!r)throw new Error("cannot remove root");t&&(t.nex=n),n&&(n.pre=t),r.fir===e&&(r.fir=n),r.las===e&&(r.las=t),e.par=null,e.pre=null,e.nex=null}},{key:"sortLeaves",value:function(e){return e.length<=1?e:new bu(e).sort()}},{key:"sort",value:function(e,t){var n=e;n.assertAddedTo(this);var r=n.nodes,i=C(r).sort(t);this.rebuildList(n,i),this.checkAndMarkSorted(r,i)}},{key:"rebuildList",value:function(e,t){t.length>0&&(e.fir=t[0],e.las=t[t.length-1]);for(var n=null,r=0;r<t.length;++r){var i=t[r];n&&(n.nex=i),i.pre=n,n=i}n&&(n.nex=null)}},{key:"checkAndMarkSorted",value:function(e,t){for(var n={},r={},i=0;i<e.length;++i){var a=e[i];n[a.id]=i,r[a.id]=a}var o,s=[],c=null,u=0,l=-1,h=E(t);try{for(h.s();!(o=h.n()).done;){var d=n[o.value.id];if(c)d>c[c.length-1]?c.push(d):(s.push(c),c.length>u&&(u=c.length,l=s.length-1),c=[d]);else c=[d]}}catch(e){h.e(e)}finally{h.f()}if(c&&(s.push(c),c.length>u&&(u=c.length,l=s.length-1)),-1!==l){var p,f=s[l],v=E(f);try{for(v.s();!(p=v.n()).done;){delete r[e[p.value].id]}}catch(e){v.e(e)}finally{v.f()}for(var m=f[0],g=f[f.length-1],y=l-1;y>=0;y--){var b=s[y];if(b[b.length-1]<m){m=b[0];var k,w=E(b);try{for(w.s();!(k=w.n()).done;){delete r[e[k.value].id]}}catch(e){w.e(e)}finally{w.f()}}}for(var S=l+1;S<s.length;S++){var x=s[S];if(x[0]>g){g=x[x.length-1];var I,C=E(x);try{for(C.s();!(I=C.n()).done;){delete r[e[I.value].id]}}catch(e){C.e(e)}finally{C.f()}}}}for(var P in r)this.markSorted(r[P])}},{key:"markAdded",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof wu)n.markAdded(e);else{var r,i=E(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markAdded(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markSorted",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof wu)n.markSorted(e);else{var r,i=E(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markSorted(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markRemoved",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof wu)n.markRemoved(e);else{var r,i=E(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markRemoved(a)}}catch(e){i.e(e)}finally{i.f()}}}}}]),e}(),Pu=function(){function e(t){M(this,e),this.pre=null,this.nex=null,this.id=t.id,this.related=t}return O(e,[{key:"previousNode",get:function(){return this.pre}},{key:"nextNode",get:function(){return this.nex}}]),e}(),Mu=function(){function e(t){M(this,e),this.nodesSet={},this._length=0,this.fir=null,this.las=null,this.valueInitializer=t}return O(e,[{key:"length",get:function(){return this._length}},{key:"firstNode",get:function(){return this.fir}},{key:"node",value:function(e){return this.nodesSet[e]||null}},{key:"findNode",value:function(e){for(var t=this.fir;t&&!e(t);)t=t.nex;return t}},{key:Symbol.iterator,value:function(){return new Tu(this.fir)}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"appendDiff",value:function(e){var t=[],n=[],r=[];for(var i in e.removedSet){var a=this.nodesSet[i];a&&(this.removeNode(a),delete this.nodesSet[i],t.push(a),this._length-=1)}for(var o in e.sortedSet){var s=this.nodesSet[o];s&&!e.addedSet[o]&&(this.removeNode(s),r.push(s))}for(var c in e.addedSet)if(!this.nodesSet[c]){var u=e.addedSet[c],l=new Pu(u);l.value=this.valueInitializer(l),this.nodesSet[c]=l,n.push(l),this._length+=1}for(var h=0,d=n;h<d.length;h++){var p=d[h];this.addNode(p)}for(var f=0,v=r;f<v.length;f++){var m=v[f];this.addNode(m)}return{removedNodes:t,addedNodes:n,sortedNodes:r}}},{key:"filter",value:function(t){var n,r=new e(this.valueInitializer),i=E(this);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t(a)){var o=a.related,s=a.value,c=new Pu(o);c.value=s,r.appendNode(c)}}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"removeNode",value:function(e){var t=e.pre,n=e.nex;t&&(t.nex=n),n&&(n.pre=t),this.fir===e&&(this.fir=n),this.las===e&&(this.las=t),e.pre=null,e.nex=null}},{key:"appendNode",value:function(e){this.las?(e.pre=this.las,this.las.nex=e,this.las=e):(this.fir=e,this.las=e),this.nodesSet[e.id]=e,this._length+=1}},{key:"addNode",value:function(e){var t=this.findPreNode(e),n=this.findNexNode(e);t?(t.nex=e,e.pre=t):this.fir=e,n?(n.pre=e,e.nex=n):this.las=e}},{key:"findPreNode",value:function(e){for(var t=e.related.preLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.preLeaf()}return null}},{key:"findNexNode",value:function(e){for(var t=e.related.nexLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.nexLeaf()}return null}}],[{key:"create",value:function(t){var n,r=new e(t.valueInitializer),i=t.initLeafFilter||e.alwaysTrue,a=E(t.tree);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(i(o)){var s=new Pu(o);s.value=r.valueInitializer(s),r.appendNode(s)}}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"alwaysTrue",value:function(){return!0}},{key:"merge",value:function(t){if(t.length>0){var n,r=new e(t[0].valueInitializer),i=r.nodesSet,a=E(t);try{for(a.s();!(n=a.n()).done;){var o,s=E(n.value);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=c.id,l=c.related,h=c.value;if(!i[u]){var d=new Pu(l);d.value=h,i[u]=d,r._length+=1,r.addNode(d)}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}return r}return null}}]),e}(),Tu=function(){function e(t){M(this,e),this.node=t}return O(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),Ou=function(){function e(t){M(this,e),this.visions=t}return O(e,[{key:"build",value:function(e,t,n,r){var i,a=this.canvasPool,o=this.chunkContext,s=Mu.create({tree:e,initLeafFilter:null!=r?r:function(){return!1},valueInitializer:function(){return null}});if(r&&s.length>0){var u=o.create().initWithShadowList(s);i=c({},u.id,u),u.isFloat&&o.bind(u,u.getSampleNode().related)}return this.create({canvasPool:a,rectangle:t,chunks:i,projectiveSize:n,shadowList:s,chunkContext:o})}},{key:"merge",value:function(e,t){var n=t.range,r=t.unitSize,i=t.projectiveSize,a=[];n.forEach((function(t,n){a.push(e.get(t,n).shadowList)}));var o=this.canvasPool,s=this.chunkContext,c=Mu.merge(a),u={};if(c.length>0){var l=s.create().initWithShadowList(c);u[l.id]=l,l.isFloat&&s.bind(l,l.getSampleNode().related)}var h=n.row0*n.rowsCount,d=n.column0*n.columnsCount,p=uu.cellToRect(h,d,r);return this.create({canvasPool:o,rectangle:p,shadowList:c,chunks:u,projectiveSize:i,chunkContext:s})}},{key:"fork",value:function(e,t){var n=this,r=t.range,i=t.unitSize,a=t.projectiveSize,o=this.canvasPool,s=this.chunkContext,c={},u=new lu;return e.shadowList.forEach((function(e){var t=n.visions.vision(e.related.id);if(t){var r=uu.rectToRange(t.sceneRect,i);c[e.id]=r}})),r.forEach((function(t,r){var l=e.shadowList.filter((function(e){var n;return!!(null==(n=c[e.id])?void 0:n.includes(t,r))})),h={};if(l.length>0){var d=s.create().initWithShadowList(l);h[d.id]=d,s.bind(d,d.getSampleNode().related)}u.set(t,r,n.create({canvasPool:o,shadowList:l,chunks:h,projectiveSize:a,chunkContext:s,rectangle:uu.cellToRect(t,r,i)}))})),u}}]),e}(),Eu=function(){function e(t){M(this,e),this.id="".concat(e.nextId+=1),this.chunkContext=t.chunkContext,this.rectangle=t.rectangle,this._projectiveSize=t.projectiveSize,this.shadowList=t.shadowList,this.chunks=t.chunks||{}}return O(e,[{key:"onProjectiveSizeUpdate",value:function(e,t){}},{key:"projectiveSize",get:function(){return this._projectiveSize}},{key:"firstChunk",get:function(){var e=this.shadowList.firstNode;return e?e.value:null}},{key:Symbol.iterator,value:function(){return new Au(this.firstChunk)}},{key:"has",value:function(e){return null!==this.shadowList.node(e)}},{key:"findChunk",value:function(e){var t=null,n=this.shadowList.node(e.id);return n&&(t=this.findChunkByNode(n)),t}},{key:"collectLeaves",value:function(){var e={};for(var t in this.chunks){var n,r=E(this.chunks[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value;e[i.id]=i.related}}catch(e){r.e(e)}finally{r.f()}}return e}},{key:"appendDiff",value:function(e){this.handleUpdatedLeaves(e.sortedSet);var t,n=this.shadowList.appendDiff(e),r=n.removedNodes,i=n.addedNodes,a=E(r);try{for(a.s();!(t=a.n()).done;){var o=t.value;this.removeNode(o)}}catch(e){a.e(e)}finally{a.f()}var s,c=E(i);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.addNode(u)}}catch(e){c.e(e)}finally{c.f()}}},{key:"removeNode",value:function(e){var t=this.findChunkByNode(e);if(t){var n=this.chunkContext,r=t.split(e),i=r.left,a=r.right;i&&(this.chunks[i.id]=i,i.isFloat&&n.bind(i,i.getSampleNode().related)),a&&(this.chunks[a.id]=a,a.isFloat&&n.bind(a,a.getSampleNode().related)),delete this.chunks[t.id],t.dispose()}}},{key:"addNode",value:function(e){var t=this.chunkContext,n=this.previousNode(e),r=null==n?void 0:n.value,i=this.nextNode(e),a=null==i?void 0:i.value;if(r&&r===a){var o=r,s=o.cutOff(n,i),c=s.left,u=s.right,l=s.becomeBlank;this.chunks[c.id]=c,this.chunks[u.id]=u,c.isFloat&&t.bind(c,c.getSampleNode().related),u.isFloat&&t.bind(u,u.getSampleNode().related),l?(delete this.chunks[o.id],o.dispose()):o.resetLife()}var h=this.chunkContext.create().initWithNode(e);this.chunks[h.id]=h,t.bind(h,h.getSampleNode().related)}},{key:"previousNode",value:function(e){for(var t=e.previousNode;t&&!t.value;)t=t.previousNode;return t}},{key:"nextNode",value:function(e){for(var t=e.nextNode;t&&!t.value;)t=t.nextNode;return t}},{key:"findChunkByNode",value:function(e){var t=e.value,n=null;if(t&&(n=this.chunks[t.id])!==t)throw new Error("invalid node");return n}},{key:"handleUpdatedLeaves",value:function(e){for(var t in e){var n=this.shadowList.node(t);if(null==n?void 0:n.value){var r=n.value,i=r.split(n),a=i.left,o=i.right,s=this.chunkContext;a&&(this.chunks[a.id]=a,a.isFloat&&s.bind(a,a.getSampleNode().related)),o&&(this.chunks[o.id]=o,o.isFloat&&s.bind(o,o.getSampleNode().related)),r.resetLife()}}}},{key:"fuseChunksWithNeighbours",value:function(){var e,t=this.chunks,n=E(fu.fuseEachNeighbours(t));try{for(n.s();!(e=n.n()).done;){var r=e.value;delete t[r.id],r.dispose()}}catch(e){n.e(e)}finally{n.f()}}},{key:"increaseChunksLife",value:function(){var e=this.chunks;for(var t in e)e[t].increaseLife()}},{key:"updateProjectiveSize",value:function(e,t){this._projectiveSize=e,this.onProjectiveSizeUpdate(e,t)}},{key:"dispose",value:function(){var e,t={},n=E(this.shadowList);try{for(n.s();!(e=n.n()).done;){var r=e.value.value;r&&(t[r.id]=r)}}catch(e){n.e(e)}finally{n.f()}for(var i in t)t[i].dispose()}},{key:"notifyGlobalUpdate",value:function(){}}]),e}();Eu.nextId=0;var Au=function(){function e(t){M(this,e),this.chunk=t}return O(e,[{key:"next",value:function(){var e,t;return this.chunk?(t={value:this.chunk,done:!1},this.chunk=null!=(e=this.chunk.nextChunk)?e:null):t={value:void 0,done:!0},t}}]),e}(),Nu=function(){function e(t){M(this,e),this.nodes={},this.factory=t}return O(e,[{key:"create",value:function(){return this.factory(this)}},{key:"forEachCandidateFloatNodes",value:function(e){for(var t in this.nodes)e(this.nodes[t].leaf)}},{key:"bind",value:function(e,t){var n=this.nodes[t.id];n||(n=this.nodes[t.id]={leaf:t,chunks:{}}),n.chunks[e.id]=e}},{key:"unbind",value:function(e,t){var n=this.nodes[t.id];if(n){var r=n.chunks;delete r[e.id],mu(r)||delete this.nodes[t.id]}}}]),e}(),Ru=function(){function e(){M(this,e),this.refManager=new Lu,this.pool=[]}return O(e,[{key:"pull",value:function(){var e;if(0===this.pool.length){var t=document.createElement("canvas");e={canvas:t,context:iu(t),size:{width:0,height:0}}}else e=this.pool.pop();return e}},{key:"push",value:function(e){this.pool.push(e)}},{key:"clear",value:function(){this.pool=[]}}]),e}(),Lu=function(){function e(){M(this,e),this.refs={},this._length=0}return O(e,[{key:"has",value:function(e){return e in this.refs}},{key:"set",value:function(e,t){if(!this.has(e)){var n={id:e,value:t,prev:this.tail};this.tail?(this.tail.next=n,this.tail=n):this.head=this.tail=n,this.refs[e]=n,this._length+=1}}},{key:"delete",value:function(e){if(this.has(e)){var t=this.refs[e],n=t.prev,r=t.next;n?n.next=r:this.head=r,r?r.prev=n:this.tail=n,delete this.refs[e],this._length-=1}}},{key:"shift",value:function(){var e=this.head;if(e)return this.delete(e.id),e.value}},{key:"length",get:function(){return this._length}}]),e}(),ju=function(){function e(t){M(this,e),this.canvasPool=t,this.id="".concat(e.id+=1),this.value=null}return O(e,[{key:"get",value:function(){return this.value}},{key:"allocate",value:function(t){if(this.value)throw new Error("can not call allocate on non empty canvasRef!");var n;if(this.canvasPool.refManager.length<e.MaxRefsSize)n=this.canvasPool.pull();else{var r=this.canvasPool.refManager.shift();n=r.value,r.value=null}this.value=n,this.canvasPool.refManager.set(this.id,this);var i=n,a=i.canvas,o=i.context,s=n.size=t,c=s.width,u=s.height;return a.width=c+1,a.height=u+1,o.resetTransform(),n}},{key:"clear",value:function(){this.canvasPool.refManager.delete(this.id),this.value&&(this.canvasPool.push(this.value),this.value=null)}},{key:"isEmpty",value:function(){return null==this.value}},{key:"isSizeEquals",value:function(e){return!!this.value&&hu(this.value.size,e)}}]),e}();ju.MaxRefsSize=256,ju.id=0;var Du=function(e){m(n,e);var t=y(n);function n(e,r,i,a){var o;return M(this,n),(o=t.call(this,i)).ratio=1,o.cacheSize=n.initCacheSize,o.didCacheSizeUpdated=!1,o.projectiveRect=n.initProjectiveReact,o.painter=e,o.statistical=a,o.canvasPool=r,o.canvasRef=new ju(r),o}return O(n,[{key:"onSplit",value:function(){var e;this.canvasRef.clear(),null==(e=this.statistical)||e.recordSplit()}},{key:"onRemoved",value:function(){this.canvasRef.clear()}},{key:"updateProjectiveRect",value:function(e){this.projectiveRect=e}},{key:"updateCacheInfo",value:function(e,t,n){this.ratio=e,hu(this.cacheSize,t)||(this.cacheSize=t,this.didCacheSizeUpdated=!0),n&&this.didCacheSizeUpdated&&(this.canvasRef.clear(),this.didCacheSizeUpdated=!1)}},{key:"onGlobalUpdate",value:function(){this.canvasRef.clear()}},{key:"paint",value:function(e){var t,n,r,i=this.canvasRef.get();if(i)r=i.canvas;else{var a=this.canvasRef.allocate(this.cacheSize),o=a.context,s=a.canvas;o.scale(this.ratio,this.ratio),this.paintNodes(o,this,Fh.GenerateCache),null==(t=this.statistical)||t.recordGenerateCache(),r=s}if(this.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(r,0,0);else{var c=this.cacheSize,u=c.width,l=c.height;e.drawImage(r,0,0,u+1,l+1)}null==(n=this.statistical)||n.recordPaintCache()}},{key:"onFuse",value:function(e,t){var n;if(!this.canvasRef.isEmpty()||this.hasAnyCache(e)||this.hasAnyCache(t)){var r,i=[].concat(C(e),[this],C(t)),a=i[0],o=i.slice(1);a.canvasRef.isSizeEquals(this.cacheSize)?r=a.canvasRef:(r=this.mergeChunk(new ju(this.canvasPool),a),this.canvasRef.clear());var s,c=E(o);try{for(c.s();!(s=c.n()).done;){var u=s.value;r=this.mergeChunk(r,u)}}catch(e){c.e(e)}finally{c.f()}this.canvasRef=r}null==(n=this.statistical)||n.recordFuse(e.length+1+t.length)}},{key:"hasAnyCache",value:function(e){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){if(!t.value.canvasRef.isEmpty())return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"mergeChunk",value:function(e,t){var n,r,i;if(e.isEmpty()?i=e.allocate(this.cacheSize).context:i=e.get().context,t.canvasRef.isEmpty()){var a=this.paintNodes(i,t,Fh.GenerateCache);null==(n=this.statistical)||n.recordPaintCache(a)}else{i.resetTransform();var o=t.canvasRef.get().canvas;if(t.canvasRef.isSizeEquals(this.cacheSize))i.drawImage(o,0,0);else{var s=this.cacheSize,c=s.width,u=s.height;i.drawImage(o,0,0,c+1,u+1)}null==(r=this.statistical)||r.recordFuseCache()}return e}},{key:"paintNodes",value:function(e,t,n){var r,i,a=0,o=E(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;e.resetTransform(),e.scale(this.ratio,this.ratio),null==(r=this.painter(s.id))||r.paint(e,n,this.projectiveRect),a+=1}}catch(e){o.e(e)}finally{o.f()}return a}}]),n}(fu);Du.initCacheSize=Object.freeze({width:1,height:1}),Du.initProjectiveReact=Object.freeze({originX:0,originY:0,width:1,height:1});var zu=function(e){m(n,e);var t=y(n);function n(e,r,i,a){var o;return M(this,n),(o=t.call(this,r)).canvasPool=i,o.chunkContext=new Nu((function(t){return new Du(e,i,t,a)})),o}return O(n,[{key:"create",value:function(e){return new Fu(e)}}]),n}(Ou),Fu=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).ratio=1,r.cacheSize=Object.freeze({width:e.projectiveSize.width,height:e.projectiveSize.height}),r.projectiveRect=Object.freeze($c({originX:0,originY:0},e.projectiveSize)),r}return O(n,[{key:"updatePaintInfo",value:function(e,t,n,r){this.projectiveRect=Object.freeze(eu($c({},this.projectiveRect),{originX:e,originY:t})),this.ratio=n,this.cacheSize=Object.freeze({width:this.projectiveSize.width*n,height:this.projectiveSize.height*n}),this.updateCacheInfo(this.ratio,this.cacheSize,r),this.updateProjectiveRect(this.projectiveRect)}},{key:"onProjectiveSizeUpdate",value:function(e,t){this.projectiveRect=Object.freeze($c($c({},this.projectiveRect),e)),this.cacheSize=Object.freeze({width:this.projectiveSize.width*this.ratio,height:this.projectiveSize.height*this.ratio}),this.updateCacheInfo(this.ratio,this.cacheSize,t),this.updateProjectiveRect(this.projectiveRect)}},{key:"updateCacheInfo",value:function(e,t,n){var r,i=E(this);try{for(i.s();!(r=i.n()).done;){r.value.updateCacheInfo(e,t,n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"updateProjectiveRect",value:function(e){var t,n=E(this);try{for(n.s();!(t=n.n()).done;){t.value.updateProjectiveRect(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"notifyGlobalUpdate",value:function(){var e,t=E(this);try{for(t.s();!(e=t.n()).done;){e.value.onGlobalUpdate()}}catch(e){t.e(e)}finally{t.f()}}},{key:"paint",value:function(e,t,n){for(var r,i=n||this[Symbol.iterator]();!(r=i.next()).done;){var a=r.value;if(t(a))return{iterator:i,floatChunk:a};a.paint(e)}return{iterator:i,floatChunk:null}}}]),n}(Eu),Bu=function(){function e(t){var n=this,r=t.grid,i=t.chunkContext,a=t.visions,o=t.floatLeafPainter,s=t.bucketPainter;M(this,e),this.pendingByFloats={},this.paintableBucketsQueue=[],this.isFloatChunk=function(e){return e.id in n.chunkToFloatMap},this.grid=r,this.visions=a,this.floatLeafPainter=o,this.paintBucket=s,this.chunkToFloatMap=this.searchChunkToFloat(i)}return O(e,[{key:"searchChunkToFloat",value:function(e){var t=this,n={};return e.forEachCandidateFloatNodes((function(e){var r=e,i=t.searchCoverBuckets(r);if(i){var a={},o=!0,s=null;for(var c in i){var u=i[c].findChunk(r);if(!u||!u.isFloat){o=!1;break}s||(s={leaf:r,info:{untouched:i,pending:{}}}),a[u.id]=s}o&&s&&Object.assign(n,a)}})),n}},{key:"searchCoverBuckets",value:function(e){var t=this,n=this.visions.vision(e.id);if(!n)return null;var r=uu.rectToRange(n.sceneRect,this.grid.unitSize),i=uu.calcIntersection(r,this.grid.range);if(!i)return null;var a={};return i.forEach((function(e,n){var r=t.grid.bucket(e,n);r&&(a[r.id]=r)})),mu(a)?a:null}},{key:"collectBuckets",value:function(){var e=this;this.grid.forEachBuckets((function(t,n,r){e.startToPaintBucket({bucket:t,row:n,column:r})}))}},{key:"runLoopToPaintAll",value:function(){for(;this.paintableBucketsQueue.length>0;)this.startToPaintBucket(this.paintableBucketsQueue.pop());mu(this.pendingByFloats)&&this.printPendingFloatNodesWarn()}},{key:"printPendingFloatNodesWarn",value:function(){for(var e in console.warn("found pending float nodes were never paint"),this.pendingByFloats){var t=this.pendingByFloats[e],n=t.untouched,r=t.pending,i=Object.keys(n).join(", "),a=Object.keys(r).join(", ");console.warn("float ".concat(e," is waiting ").concat(i," to touch, and is padding buckets ").concat(a))}}},{key:"startToPaintBucket",value:function(e){var t=e.bucket,n=e.row,r=e.column,i=e.iterator,a=this.paintBucket(t,n,r,this.isFloatChunk,i),o=a.iterator,s=a.floatChunk;if(s){var c=this.pendingByFloatInfo(s);if(c){var u=c.untouched,l=c.pending,h=s.getSampleNode();delete u[t.id],l[t.id]={bucket:t,row:n,column:r,iterator:o},mu(u)||this.startToPaintFloatNode(h,l)}}}},{key:"pendingByFloatInfo",value:function(e){var t=this.chunkToFloatMap[e.id];return t?t.info:null}},{key:"startToPaintFloatNode",value:function(e,t){for(var n in this.floatLeafPainter(e.related),delete this.pendingByFloats[e.id],t){var r=t[n];this.paintableBucketsQueue.unshift(r)}}}],[{key:"paintBuckets",value:function(t){var n=new e(t);n.collectBuckets(),n.runLoopToPaintAll()}}]),e}(),Uu=function(){function e(t){var n=this;M(this,e),this.painters={},this.canvasPool=new Ru,this.onLeafNodeVisible=function(e){var t=e.value,r=n.getRenderConstructor(t.definition);if(r){var i=new r(t,n.context),a=new pu(n.screen,n.visions,e,n.fixedSize,i,n.onRepaint);n.painters[e.id]=a}},this.onLeafNodeInvisible=function(e){delete n.painters[e.id]},this.fixedSize=t.fixedSize,this.willPrintGrid=!!t.willPrintGrid,this.onRepaint=t.onRepaint,this.getRenderConstructor=t.getRenderConstructor,this.screen=t.screen,this.visions=t.visions,this.camera=this.screen.camera,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.context=t.context,this.statistical=t.statistical,this.visionRectangle=this.createVisionRectangle(this.camera,this.screenSize),this.bucketFactory=new zu((function(e){return n.painters[e]}),this.visions,this.canvasPool,this.statistical),this.grid=new du({tree:t.tree,visions:t.visions,bucketFactory:this.bucketFactory,visionRectangle:this.visionRectangle,scale:this.camera.scale,rate:t.rate,bucketUnitSize:t.bucketUnitSize,favorBucketsCount:t.favorBucketsCount,onLeafNodeVisible:this.onLeafNodeVisible,onLeafNodeInvisible:this.onLeafNodeInvisible});var r,i=E(t.tree);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.onLeafNodeVisible(a)}}catch(e){i.e(e)}finally{i.f()}}return O(e,[{key:"dispose",value:function(){this.canvasPool.clear()}},{key:"update",value:function(e){var t,n,r=!1,i=!1;if(e.context){for(var a in this.painters)this.painters[a].updateContext(e.context);this.context=e.context,r=!0}for(var o in e.camera&&(this.camera=e.camera,i=!0),e.screenSize&&(this.screenSize=e.screenSize,i=!0),e.updateSet)null==(t=this.painters[o])||t.refreshPayload();i&&(this.visionRectangle=n=this.createVisionRectangle(this.camera,this.screenSize)),this.grid.update({shouldUpdateAll:r,visionRectangle:n,scale:this.camera.scale,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:e.refresh})}},{key:"createVisionRectangle",value:function(e,t){var n,r,i,a;return 0===e.scale?(n=0,r=0,i=0,a=0):(i=t.width/e.scale,a=t.height/e.scale,n=e.centerX-i/2,r=e.centerY-a/2),Object.freeze({originX:n,originY:r,width:i,height:a})}},{key:"paint",value:function(e,t,n){var r=this;Bu.paintBuckets({visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext,floatLeafPainter:function(n){var i,a=n.id,o=r.painters[a];e.resetTransform(),e.scale(t,t),o.paint(e,Fh.Directly),null==(i=r.statistical)||i.recordPaintFloat()},bucketPainter:function(i,a,o,s,c){var u=r.toScreenPoint(a,o,r.grid.unitSize),l=u.x,h=u.y;return e.resetTransform(),e.translate(l*t,h*t),i.updatePaintInfo(l,h,t,n),i.paint(e,s,c)}}),this.willPrintGrid&&(e.resetTransform(),e.scale(t,t),this.paintGrid(e))}},{key:"paintGrid",value:function(e){var t=this,n=this.grid,r=n.range,i=n.unitSize;e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.5)",r.forEach((function(n,r){var a=t.toScreenPoint(n,r,i),o=a.x,s=a.y,c=Math.ceil(i.width*t.camera.scale),u=Math.ceil(i.height*t.camera.scale);e.strokeRect(o,s,c,u)}))}},{key:"toScreenPoint",value:function(e,t,n){var r=t*n.width,i=e*n.height;return{x:(r-this.camera.centerX)*this.camera.scale+this.screenSize.width/2,y:(i-this.camera.centerY)*this.camera.scale+this.screenSize.height/2}}}]),e}(),Vu=new(function(){function e(){M(this,e),"undefined"==typeof performance?this.fetch=this.fetchByMilliseconds:this.fetch=this.fetchByMicroseconds}return O(e,[{key:"fetchByMilliseconds",value:function(){return 1e3*Date.now()}},{key:"fetchByMicroseconds",value:function(){return Math.floor(1e3*performance.now())}}]),e}());function Wu(){return Vu.fetch()}var Hu,_u=function(){function e(t){var n=this;M(this,e),this.setLayoutRenderSize=null,this.ratio=1,this.canvasPair=null,this.canvasIndex=1,this.refresh=!0,this.onRepaint=function(e){n.screen.scene.reportComponentUpdate(e,wh.PropertiesUpdated)},this.renderMode=t.renderMode,this.engine=t.engine,this.screen=t.screen,this.onRenderDuration=t.onRenderDuration,this.statistical=t.willPrintStatistical?new ou:void 0,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.painter=new Uu({tree:t.tree,fixedSize:t.fixedSize,screen:t.screen,visions:t.visions,context:this.screen.context,statistical:this.statistical,getRenderConstructor:t.getRenderConstructor,onRepaint:this.onRepaint,rate:2,favorBucketsCount:12,bucketUnitSize:Object.freeze({width:256,height:256})}),this.className=t.className,this.style=t.style}return O(e,[{key:"willInterruptEvent",value:function(){return!1}},{key:"findComponentWithTarget",value:function(){}},{key:"update",value:function(e){var t,n,r=Wu();switch(this.setLayoutRenderSize&&e.screenSize&&(this.screenSize.width!==e.screenSize.width||this.screenSize.height!==e.screenSize.height)&&(this.setLayoutRenderSize(e.screenSize),this.canvasPair&&this.updateSize(this.canvasPair,e.screenSize)),e.screenSize&&(this.screenSize=e.screenSize),this.renderMode){case Hu.HighQuality:this.refresh=!0;break;case Hu.PerformanceWhileTransition:this.refresh=!e.isTransition}this.painter.update({context:e.context,camera:e.camera,screenSize:e.screenSize,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:this.refresh}),this.canvasPair?(this.paint(),null==(t=this.statistical)||t.print(),this.onRenderDuration&&this.onRenderDuration(Wu()-r)):null==(n=this.statistical)||n.clear()}},{key:"setCanvas",value:function(e){e&&this.canvasPair!==e&&(this.updateSize(e,this.screenSize),this.updateVisibility(e),this.ratio=Math.max(this.getRatioWithContext(iu(e.canvas1)),this.getRatioWithContext(iu(e.canvas2)))),this.canvasPair=e,e&&this.paint()}},{key:"updateVisibility",value:function(e){var t=e.canvas1,n=e.canvas2;switch(this.canvasIndex){case 1:t.style.visibility="visible",n.style.visibility="hidden";break;case 2:t.style.visibility="hidden",n.style.visibility="visible"}}},{key:"updateSize",value:function(e,t){if(!e.canvas1.getContext("2d")||!e.canvas2.getContext("2d"))throw new Error("cannot find 2d context from canvas");var n=this.ratio*t.width,r=this.ratio*t.height;e.canvas1.width=n,e.canvas1.height=r,e.canvas2.width=n,e.canvas2.height=r}},{key:"paint",value:function(){var e=this,t=this.getNextCanvasContext();t?(this.painter.paint(t,this.ratio,this.refresh),Promise.resolve().then((function(){e.updateToNextBuffering()})).catch((function(e){return console.error(e)}))):console.warn("cannot find context 2d of canvas")}},{key:"getNextCanvasContext",value:function(){var e=this.getNextCanvas(),t=null;return e&&((t=iu(e)).resetTransform(),t.clearRect(0,0,e.width,e.height)),t}},{key:"getNextCanvas",value:function(){var e=null;if(this.canvasPair){var t=this.canvasPair,n=t.canvas1;e=[t.canvas2,n][this.canvasIndex-1]}return e}},{key:"updateToNextBuffering",value:function(){if(this.canvasPair){switch(this.canvasIndex){case 1:this.canvasIndex=2;break;case 2:this.canvasIndex=1}this.updateVisibility(this.canvasPair)}}},{key:"getRatioWithContext",value:function(e){var t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)}},{key:"dispose",value:function(){this.painter.dispose()}},{key:"getRender",value:function(){var e=this;return function(t){m(r,t);var n=y(r);function r(t){var i;return M(this,r),(i=n.call(this,t)).canvas1=null,i.canvas2=null,i.onSetCanvas1Ref=function(e){i.canvas1=e,i.refreshRenderer()},i.onSetCanvas2Ref=function(e){i.canvas2=e,i.refreshRenderer()},i.state=$c({},e.screenSize),e.setLayoutRenderSize=function(e){return i.setState(e)},i}return O(r,[{key:"componentWillUnmount",value:function(){e.setLayoutRenderSize=null,e.dispose()}},{key:"refreshRenderer",value:function(){this.canvas1&&this.canvas2?e.setCanvas(Object.freeze({canvas1:this.canvas1,canvas2:this.canvas2})):e.setCanvas(null)}},{key:"render",value:function(){var t=this.state,n=t.width,r=t.height,i=eu($c({},e.style),{width:n,height:r,position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:e.engine.orderIndex});return[(0,Rc.createElement)("canvas",{key:"canvas1",className:e.className,ref:this.onSetCanvas1Ref,style:i}),(0,Rc.createElement)("canvas",{key:"canvas2",className:e.className,ref:this.onSetCanvas2Ref,style:i})]}}]),r}(Rc.Component)}}]),e}();function Gu(e,t){return void 0===e?t:e}function Yu(e,t){return"number"==typeof e?e:t}!function(e){e[e.HighQuality=0]="HighQuality",e[e.PerformanceWhileTransition=1]="PerformanceWhileTransition"}(Hu||(Hu={}));var Xu=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e.orderIndex)).constructors={},r.getRenderConstructor=function(e){return r.constructors[e.id]},r.fixedSize=e.fixedSize,r.renderMode=Gu(e.renderMode,0),r}return O(n,[{key:"bind",value:function(e,t){if(!(e instanceof Eh))throw new Error("it is not ComponentDefinition");if(this.constructors[e.id])throw new Error("define duplicated ComponentDefinition");this.constructors[e.id]=t,e.addEngine(this,{isVisible:t.isVisible}),this.addDefinition(e)}},{key:"createRenderLayout",value:function(e){return new _u({engine:this,screen:e.screen,tree:e.tree,visions:e.visions,fixedSize:this.fixedSize,renderMode:this.renderMode,getRenderConstructor:this.getRenderConstructor,onRenderDuration:e.onRenderDuration})}}]),n}(nu);function Qu(e){return new Xu(e)}function Zu(e){return e instanceof Xu}var Ku=function(){function e(t){var n=this;M(this,e),this.setCNodeElement=function(e,t){var r=e.treeNode.id,i=n.shadowList.node(r);i&&(i.value=t)},this.engine=t.engine,this.renderComponent=t.renderComponent,this.screen=t.screen,this.fixedSize=t.fixedSize,this.className=t.className,this.style=t.style,this.visions=t.visions,this.leafFilter=t.leafFilter,this.mode=t.mode,this.camera=t.initCamera||this.screen.camera,this.context=this.screen.context,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.shadowList=Mu.create({tree:t.tree,valueInitializer:function(){return null},initLeafFilter:function(e){return n.visions.includes(e.id)&&t.leafFilter(e)}})}return O(e,[{key:"willInterruptEvent",value:function(e,t,n){var r=this.findComponentWithTarget(n);if(r){var i=this.engine.getDefinitionNode(r.definition);if(i)return i.willInterruptEvent(e,r,t)}return!1}},{key:"findComponentWithTarget",value:function(e){var t=this.shadowList.findNode((function(t){var n=t.value;return!(!n||e!==n&&!n.contains(e))}));if(t){var n=t.related;if(n.value)return n.value}}},{key:"update",value:function(e){var t=this.shadowList.appendDiff(e.diff),n=!1;e.camera&&(this.camera=e.camera,n=!0),e.screenSize&&(this.screenSize=e.screenSize,n=!0),e.context&&(this.context=e.context,n=!0),(mu(e.updateSet)||mu(e.moveSet)||t.addedNodes.length>0||t.removedNodes.length>0||t.sortedNodes.length>0)&&(n=!0),this.setState&&n&&this.setState(this.getRenderLayoutState())}},{key:"getRender",value:function(){var e=this,t=this.renderComponent;return function(n){m(i,n);var r=y(i);function i(t){var n;return M(this,i),(n=r.call(this,t)).state=e.getRenderLayoutState(),e.setState=function(e){return n.setState(e)},n}return O(i,[{key:"componentWillUnmount",value:function(){e.setState=void 0}},{key:"render",value:function(){var n=this.state,r=n.camera,i=n.screenSize,a=n.context;return(0,Lc.createElement)(t,{engine:e.engine,screen:e.screen,mode:e.mode,visions:e.visions,leafFilter:e.leafFilter,camera:r,screenSize:i,context:a,fixedSize:e.fixedSize,className:e.className,style:e.style,onCNodeRef:e.setCNodeElement})}}]),i}(Lc.Component)}},{key:"getRenderLayoutState",value:function(){return{camera:this.camera,screenSize:this.screenSize,context:this.context}}}]),e}(),qu=function(e){m(n,e);var t=y(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props,r=n.onRef,i=n.context;r&&r(t);var a=i;a&&a.onRef(a.component,t)},e}return O(n,[{key:"render",value:function(){var e=this.props,t=e.context,n=e.children,r=e.fixedMode,i=e.style,a=t;if(a){var o=a.vision,s=a.component,c=a.margin,u=o.screenRect,l=u.originX,h=u.originY,d="absolute";if(r){var p=a.screen.bounding;l+=p.left,h+=p.top,d="fixed"}var f="translate(".concat(l,"px,").concat(h,"px) scale(").concat(a.scale,",").concat(a.scale,")"),v=$c({WebkitTransform:f,transform:f,WebkitTransformOrigin:"0px 0px 0px",transformOrigin:"0px 0px 0px",position:d,overflow:"visible",width:a.size.width+a.margin.left+a.margin.right,height:a.size.height+a.margin.top+a.margin.bottom,margin:0,paddingLeft:c.left,paddingRight:c.right,paddingTop:c.top,paddingBottom:c.bottom,zIndex:s.orderIndex},i),m=$c({},this.props);return delete m.context,delete m.fixedMode,delete m.onRef,(0,Dc.createElement)("div",eu($c({},m),{style:v,ref:this.onRef}),n)}return(0,Dc.createElement)(Dc.Fragment,null,n)}}]),n}(Dc.Component),Ju=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Ec.Preview)return e.previewURL}},{key:"getPositionInfo",value:function(e,t,n){var r,i,a,o=this.props.fixedSize;return a=e.absoluteCoordinates?1:n,o?(i={left:t.margin.left/a,right:t.margin.right/a,top:t.margin.top/a,bottom:t.margin.bottom/a},r={width:e.width,height:e.height}):(i=t.margin,r={width:t.screenRect.width-i.left-i.right,height:t.screenRect.height-i.top-i.bottom}),{margin:i,size:r,origin:{x:t.screenRect.originX,y:t.screenRect.originY},cnodeScale:a}}},{key:"renderPreview",value:function(e,t,n,r){var i=this.props,a=i.screen,o=i.onCNodeRef,s=this.getPositionInfo(e,t,r),c=s.margin,u=s.size,l={vision:t,component:e,screen:a,onRef:o,margin:c,size:u,scale:s.cnodeScale};return(0,jc.createElement)(qu,{key:e.id,context:l},(0,jc.createElement)("img",{src:n,alt:"",width:u.width,height:u.height}))}},{key:"renderLeafNode",value:function(e,t,n,r){var i=e.definition,a=this.props,o=a.engine,s=a.context,c=a.screen,u=a.onCNodeRef,l=o.getDefinitionNode(i);if(l){var h=this.getPositionInfo(e,t,r),d=h.margin,p=h.size,f=h.origin,v=h.cnodeScale,m=l.render,g={vision:t,component:e,margin:d,size:p,scale:v,screen:c,onRef:u};return(0,jc.createElement)(m,{key:e.id,id:e.id,cnode:g,screen:c,payload:e.payload,context:s,size:p,origin:f,margin:d,scale:n,layout:o.orderIndex})}return null}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.style,o=n.className,s=n.engine,c=n.fixedSize;return r.forEach((function(n,r){if(i(n)){var a=n.value,o=e.getPreviewURL(a),s=c?r.scale:1;if(o)t.push(e.renderPreview(a,r,o,s));else{var u=c?1:r.scale,l=e.renderLeafNode(a,r,u,s);t.push(l)}}})),(0,jc.createElement)("div",{className:o,style:eu($c({},a),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(jc.Component),$u=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.origin,r=t.size,i=t.zIndex,a=t.margin,o=t.payload,s=t.context;return n.x!==e.origin.x||n.y!==e.origin.y||r.width!==e.size.width||r.height!==e.size.height||i!==e.zIndex||a.left!==e.margin.left||a.right!==e.margin.right||a.top!==e.margin.top||a.bottom!==e.margin.bottom||o!==e.payload||s!==e.context}},{key:"render",value:function(){var e=this.props,t=e.render,n=e.screen,r=e.engine,i=e.component,a=e.context,o=e.origin,s=e.zIndex,c=e.size,u=e.margin,l=e.payload,h="translate(".concat(o.x,"px,").concat(o.y,"px)");return(0,zc.createElement)("g",{style:{transform:h,zIndex:s,WebkitTransform:h}},(0,zc.createElement)(t,{id:i.id,screen:n,payload:l,context:a,size:c,origin:o,margin:u,scale:1,layout:r.orderIndex}))}}]),n}(zc.Component),el=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Ec.Preview)return e.previewURL}},{key:"createViewBox",value:function(){var e=this.props,t=e.screenSize,n=e.camera,r=n.scale,i=n.centerX,a=n.centerY,o=t.width/r,s=t.height/r;return Number.isNaN(o)&&(o=0),Number.isNaN(s)&&(s=0),"".concat(i-o/2," ").concat(a-s/2," ").concat(o," ").concat(s)}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.className,o=n.screen,s=n.engine,c=n.context,u=n.style;return r.forEach((function(n,r){if(i(n)){var a=n.value,u=s.getDefinitionNode(a.definition);if(u){var l=e.getPreviewURL(a),h={x:a.originX,y:a.originY},d={width:a.width,height:a.height};if(l)t.push((0,zc.createElement)("image",{key:a.id,x:h.x,y:h.y,width:d.width,height:d.height,xlinkHref:l}));else{var p=r.margin,f=a.orderIndex;t.push((0,zc.createElement)($u,{key:a.id,screen:o,engine:s,render:u.render,context:c,component:a,margin:p,size:d,zIndex:f,origin:h,payload:a.payload}))}}}})),(0,zc.createElement)("svg",{className:a,fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:this.createViewBox(),preserveAspectRatio:"xMidYMid",style:eu($c({},u),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(zc.Component),tl=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e.orderIndex)).definitionNodes={},r.fixedSize=e.fixedSize,r.isSVG=e.isSVG,r.className=e.className,r.style=e.style&&Object.freeze($c({},e.style)),r}return O(n,[{key:"getDefinitionNode",value:function(e){return this.definitionNodes[e.id]}},{key:"bind",value:function(e){var t=this;return function(n){if(!(e instanceof Eh))throw new Error("it is not ComponentDefinition");if(t.definitionNodes[e.id])throw new Error("define duplicated ComponentDefinition");var r;if("boolean"==typeof n.willInterruptEvent){var i=n.willInterruptEvent;r=function(){return i}}else r=n.willInterruptEvent?n.willInterruptEvent.bind(n):function(){return!1};return t.definitionNodes[e.id]=Object.freeze({willInterruptEvent:r,render:n}),e.addEngine(t,{isVisible:n.isVisible}),t.addDefinition(e),n}}},{key:"createRenderLayout",value:function(e){var t;return t=this.isSVG?el:Ju,new Ku({engine:this,screen:e.screen,mode:e.mode,initCamera:e.initCamera,tree:e.tree,visions:e.visions,leafFilter:e.leafFilter,renderComponent:t,fixedSize:this.fixedSize,className:this.className,style:this.style})}}]),n}(nu);function nl(e){return new tl(e)}function rl(e){return e instanceof tl}var il=function(){function e(){M(this,e),this.nodes={}}return O(e,[{key:"includes",value:function(e){return e in this.nodes}},{key:"leaf",value:function(e){var t=this.nodes[e];return t?t.leaf:null}},{key:"vision",value:function(e){var t=this.nodes[e];return t?t.vision:null}},{key:"bindVision",value:function(e,t){var n=e.id,r=this.nodes[n];r?r.vision=t:this.nodes[n]={leaf:e,vision:t}}},{key:"unbindVision",value:function(e){delete this.nodes[e]}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.leaf,n.vision)}}},{key:"clean",value:function(){this.nodes={}}}]),e}(),al=function(){function e(t){var n=this;M(this,e),this.binder=t,this.isLeftButtonPressed=!1,this.onMouseDown=function(e){if(0===e.button&&(n.checkMouseDidUp(e),n.isLeftButtonPressed=!0,!n.binder.willInterruptMouseOrTouchEvent(e,e.target))){var t=n.binder.eventPosition(e),r={kind:Oc.MouseDown,nativeEvent:e,isOnScreen:!0,pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseMove=function(e){if(0===e.button){n.checkMouseDidUp(e);var t=n.binder.eventPosition(e),r={kind:Oc.MouseMove,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseLeave=function(e){if(0===e.button&&(n.checkMouseDidUp(e),e.target===n.binder.divElement)){var t=n.binder.eventPosition(e),r={kind:Oc.MouseLeave,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseUp=function(e){0===e.button&&(n.isLeftButtonPressed=!1,n.fireMouseUpEvent(e))}}return O(e,[{key:"checkMouseDidUp",value:function(e){var t=0!==e.which;this.isLeftButtonPressed&&!t&&this.fireMouseUpEvent(e)}},{key:"fireMouseUpEvent",value:function(e){var t=this.binder.eventPosition(e),n={kind:Oc.MouseUp,nativeEvent:e,isOnScreen:this.binder.isEventFiredOnElement(e.target,this.binder.divElement),pointOnScreen:t,pointOnScene:this.binder.toPointInScene(t.x,t.y)};this.binder.fireEvent(n)}}]),e}(),ol=function(){function e(t){var n=this;M(this,e),this.binder=t,this.latestScale=1,this.onMouseWheel=function(e){if(!n.binder.willInterruptMouseOrTouchEvent(e,e.target)){var t=n.binder.eventPosition(e),r=e.deltaX,i=e.deltaY,a=Math.sqrt(r*r+i*i),o=0,s=0;"Windows"===n.binder.getOS()&&(a=-a),r+i<0&&(a=-a),n.isMacTouchpadTwoFingerZoom(e)?a=.5*-a:n.isMacTouchpadTwoFingerScroll(e)?(o=-r,s=-i,a=0):a*=.035;var c={kind:Oc.MouseWheel,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),offsetPoint:{x:o,y:s},scale:n.adjustScale(a),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(c)}e.preventDefault()},this.onGestureStart=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||(e.preventDefault(),n.latestScale=1)},this.onGestureChange=function(t){if(!n.binder.willInterruptMouseOrTouchEvent(t,t.target)){t.preventDefault();var r=(t.scale/n.latestScale-1)*e.safariScaleNumber,i={x:t.layerX,y:t.layerY},a={kind:Oc.MouseWheel,nativeEvent:t,isOnScreen:n.binder.isEventFiredOnElement(t.target,n.binder.divElement),offsetPoint:{x:0,y:0},scale:n.adjustScale(r),pointOnScreen:i,pointOnScene:n.binder.toPointInScene(i.x,i.y)};n.binder.fireEvent(a)}},this.onGestureEnd=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||e.preventDefault()},this.isMacTouchpadTwoFingerZoom=function(e){return-1!==navigator.platform.indexOf("Mac")&&e.ctrlKey},this.isMacTouchpadTwoFingerScroll=function(e){return-1!==navigator.platform.indexOf("Mac")&&(e.wheelDelta%120!=0||0!==e.movementX||0!==e.deltaX)}}return O(e,[{key:"adjustScale",value:function(t){return Math.max(t,e.minScaleStep)*e.scaleRate}}]),e}();ol.safariScaleNumber=10,ol.minScaleStep=-40,ol.scaleRate=.02;var sl,cl=function(){function e(t){var n=this;M(this,e),this.binder=t,this.onTouchStart=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();for(var i=[],a=0;a<e.changedTouches.length;++a){var o=e.changedTouches.item(a);if(!n.binder.willInterruptMouseOrTouchEvent(e,o.target)){var s="".concat(o.identifier),c=n.binder.eventPosition(o);i.push({identifier:s,pointOnScreen:c,pointOnScene:n.binder.toPointInScene(c.x,c.y)})}}if(i.length>0){var u={kind:Oc.TouchStart,nativeEvent:e,touches:i};n.binder.fireEvent(u)}},this.onTouchMove=function(e){e.cancelable&&e.preventDefault();for(var t=[],r=0;r<e.changedTouches.length;++r){var i=e.changedTouches.item(r),a="".concat(i.identifier),o=n.binder.eventPosition(i);t.push({identifier:a,pointOnScreen:o,pointOnScene:n.binder.toPointInScene(o.x,o.y)})}if(t.length>0){var s={kind:Oc.TouchMove,nativeEvent:e,touches:t};n.binder.fireEvent(s)}},this.onTouchEnd=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();var i=n.cleanAcceptedTouchesByTouchEvent(e);if(i.length>0){var a={kind:Oc.TouchEnd,nativeEvent:e,touches:i};n.binder.fireEvent(a)}},this.onTouchCancel=function(e){e.cancelable&&e.preventDefault();var t=n.cleanAcceptedTouchesByTouchEvent(e);if(t.length>0){var r={kind:Oc.TouchCancel,nativeEvent:e,touches:t};n.binder.fireEvent(r)}}}return O(e,[{key:"cleanAcceptedTouchesByTouchEvent",value:function(e){for(var t=[],n=0;n<e.changedTouches.length;++n){var r=e.changedTouches.item(n),i="".concat(r.identifier),a=this.binder.eventPosition(r);t.push({identifier:i,pointOnScreen:a,pointOnScene:this.binder.toPointInScene(a.x,a.y)})}return t}}]),e}(),ul=function e(t){var n=this;M(this,e),this.binder=t,this.onKeyDown=function(e){if(!n.binder.willInterruptKeyboardEvent(e,e.target)){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:Oc.KeyDown,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},this.onKeyUp=function(e){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:Oc.KeyUp,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},ll=function(){function e(t,n,r){M(this,e),this.mouseEventHandler=new al(this),this.touchEventHandler=new cl(this),this.wheelEventHandler=new ol(this),this.keyboardEventHandler=new ul(this),this.divElement=n,this.eventParamMap=this.createEventParamMap(t),this.delegate=r,this.addListeners()}return O(e,[{key:"createEventParamMap",value:function(e){var t={};switch(e){case Ah.Desktop:t=eu($c({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body}});break;case Ah.Touch:t=eu($c({},t),{touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break;case Ah.Surface:t=eu($c({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body},touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}})}return Object.freeze(t)}},{key:"addListeners",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).addEventListener(e,n,!0)}}},{key:"release",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).removeEventListener(e,n,!0)}}},{key:"fireEvent",value:function(e){this.delegate.fireEvent(e)}},{key:"getOS",value:function(){var e=window.navigator,t=e.userAgent,n=e.platform,r="";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?r="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?r="Windows":/Android/.test(t)?r="Android":!r&&/Linux/.test(n)&&(r="Linux"),r}},{key:"toPointInScene",value:function(e,t){return this.delegate.toPointInScene(e,t)}},{key:"willInterruptMouseOrTouchEvent",value:function(e,t){return!!t&&(!this.isEventFiredOnElement(t,this.divElement)||this.delegate.willInterruptEvent(e,t))}},{key:"willInterruptKeyboardEvent",value:function(e,t){return!!t&&(!!this.delegate.willInterruptEvent(e,t)||t!==document.body&&!this.isEventFiredOnElement(t,this.divElement))}},{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}},{key:"eventPosition",value:function(e){var t=this.divElement.getBoundingClientRect(),n=t.left,r=t.top;return{x:Math.floor(e.clientX)-n,y:Math.floor(e.clientY)-r}}}]),e}(),hl=function(){function e(){M(this,e),this.listeners=[]}return O(e,[{key:"dispatch",value:function(e){var t,n=E(this.listeners);try{for(n.s();!(t=n.n()).done;){var r=t.value;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addListener",value:function(e){-1===this.listeners.indexOf(e)&&this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"removeAllListeners",value:function(){this.listeners.splice(0)}}]),e}();!function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End",e[e.Other=3]="Other"}(sl||(sl={}));var dl=function(){function e(t,n){M(this,e),this._disable=!1,this.onCancelEvent=t,this.adapterNodes=Object.freeze(n.map((function(e){var t={},n={};return e.setEventDescriptionStateGetter&&e.setEventDescriptionStateGetter((function(e){var r=t[e];if(r)return{payload:r,isCanceled:!!n[e]}})),{adapter:e,payloads:t,canceledMap:n}})))}return O(e,[{key:"disable",get:function(){return this._disable},set:function(e){this._disable!==e&&(this._disable=e,e&&this.cancel())}},{key:"cancel",value:function(){var e,t=E(this.adapterNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.adapter,i=n.payloads,a=n.canceledMap,o={},s=!1;for(var c in i)c in a||(o[c]=i[c],a[c]=!0,s=!0);if(s){var u=r.createCancelEvent(o);u&&this.onCancelEvent(u)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"interruptEvent",value:function(e){var t=this.adapterNodes.find((function(t){return t.adapter.isEventAccessible(e)}));if(t){var n,r=t.adapter,i=t.canceledMap,a=r.takeEventDescription(e),o=[],s=E(a?"number"==typeof a.length?a:[a]:[]);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(3===c.phase)o.push(c);else{var u=this.handleAndCheckIgnoreEventDescription(t,c),l=i[c.identifier];!u&&!l&&o.push(c)}}}catch(e){s.e(e)}finally{s.f()}return!this._disable&&o.length>0?r.convertToEvent(e,o):null}return e}},{key:"handleAndCheckIgnoreEventDescription",value:function(e,t){var n=e.payloads,r=e.canceledMap,i=t.identifier,a=t.phase,o=t.payload;switch(a){case 0:return i in n||(n[i]=o,this._disable&&(r[i]=!0),!1);case 1:return!(i in n)||(n[i]=o,!1);case 2:if(i in n){var s=!!r[i];return delete n[i],delete r[i],s}return!0;default:return!0}}}]),e}(),pl=function(){function e(){M(this,e),this.currentIdentifier=0}return O(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===Oc.MouseDown||e.kind===Oc.MouseMove||e.kind===Oc.MouseUp||e.kind===Oc.MouseLeave}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,isOnScreen:n.isOnScreen,pointOnScreen:n.pointOnScreen,pointOnScene:n.pointOnScene}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:Oc.MouseUp,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"takeEventDescription",value:function(e){e.kind===Oc.MouseDown&&(this.currentIdentifier+=1);var t,n="".concat(this.currentIdentifier);switch(e.kind===Oc.MouseUp&&(this.currentIdentifier+=1),e.kind){case Oc.MouseDown:t=sl.Start;break;case Oc.MouseMove:case Oc.MouseLeave:var r=this.getDescriptionState(n);if(r){if(r.isCanceled)return null;t=sl.Update}else{if(!e.isOnScreen)return null;t=sl.Other}break;case Oc.MouseUp:t=sl.End;break;default:return null}return{identifier:n,phase:t,payload:{isOnScreen:e.isOnScreen,pointOnScreen:e.pointOnScreen,pointOnScene:e.pointOnScene}}}}]),e}(),fl=function(){function e(){M(this,e)}return O(e,[{key:"isEventAccessible",value:function(e){return e.kind===Oc.TouchStart||e.kind===Oc.TouchMove||e.kind===Oc.TouchEnd||e.kind===Oc.TouchCancel}},{key:"convertToEvent",value:function(e,t){var n,r=[],i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.payload;r.push($c({identifier:o},s))}}catch(e){i.e(e)}finally{i.f()}return{kind:e.kind,nativeEvent:e.nativeEvent,touches:r}}},{key:"createCancelEvent",value:function(e){var t=[];for(var n in e)t.push($c({identifier:n},e[n]));return{kind:Oc.TouchCancel,touches:t}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case Oc.TouchStart:t=sl.Start;break;case Oc.TouchMove:t=sl.Update;break;case Oc.TouchEnd:case Oc.TouchCancel:t=sl.End;break;default:return null}var n,r=[],i=E(e.touches);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.pointOnScene,c=a.pointOnScreen;r.push({identifier:o,phase:t,payload:{pointOnScene:s,pointOnScreen:c}})}}catch(e){i.e(e)}finally{i.f()}return r}}]),e}(),vl=function(){function e(){M(this,e)}return O(e,[{key:"isEventAccessible",value:function(e){return e.kind===Oc.SortedTouchStart||e.kind===Oc.SortedTouchMove||e.kind===Oc.SortedTouchEnd||e.kind===Oc.SortedTouchCancel}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0],r=n.identifier,i=n.payload;return{kind:e.kind,nativeEvent:e.nativeEvent,identifier:r,pointOnScene:i.pointOnScene,pointOnScreen:i.pointOnScreen}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=n;var r=e[t],i=r.pointOnScene,a=r.pointOnScreen;return{kind:Oc.SortedTouchCancel,identifier:t,pointOnScene:i,pointOnScreen:a}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case Oc.SortedTouchStart:t=sl.Start;break;case Oc.SortedTouchMove:t=sl.Update;break;case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:t=sl.End;break;default:return null}return[{identifier:e.identifier,phase:t,payload:{pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen}}]}}]),e}(),ml=function(){function e(){M(this,e)}return O(e,[{key:"isEventAccessible",value:function(e){return e.kind===Oc.KeyUp||e.kind===Oc.KeyDown}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:Oc.KeyUp,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"takeEventDescription",value:function(e){var t,n;if(null==(t=e.nativeEvent)?void 0:t.metaKey)n=sl.Other;else switch(e.kind){case Oc.KeyDown:n=sl.Start;break;case Oc.KeyUp:n=sl.End;break;default:return null}return{identifier:e.key,phase:n,payload:{key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}}}]),e}(),gl=function(){function e(){M(this,e),this.currentIdentifier=0}return O(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===Oc.MouseWheel}},{key:"takeEventDescription",value:function(e){var t="".concat(this.currentIdentifier);this.getDescriptionState(t),this.currentIdentifier+=1;var n={isOnScreen:e.isOnScreen,pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen,offsetPoint:e.offsetPoint,scale:e.scale};return{identifier:t,phase:sl.Other,payload:n}}},{key:"convertToEvent",value:function(e,t){return e}},{key:"createCancelEvent",value:function(e){return null}}]),e}();function yl(e){return new dl(e,[new pl,new fl,new vl,new ml,new gl])}var bl,kl=function(){function e(t,n){var r=this;M(this,e),this.eventDispatcher=new hl,this.binder=null,this.fireEvent=function(e){var t=r.continuityNode.interruptEvent(e);t&&r.eventDispatcher.dispatch(t)},this.screen=t,this.eventInterrupter=n,this.continuityNode=yl((function(e){return r.eventDispatcher.dispatch(e)}))}return O(e,[{key:"bindDivElement",value:function(e){e!==(this.binder?this.binder.divElement:null)&&(this.binder&&this.binder.release(),this.binder=e?new ll(this.screen.deviceType,e,this):null)}},{key:"disable",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"toPointInScene",value:function(e,t){return this.screen.convertPointToScene(e,t)}},{key:"willInterruptEvent",value:function(e,t){return!(this.disable||!this.eventInterrupter(e))||!!t&&this.screen.willInterruptEvent(e,t)}},{key:"addListener",value:function(e){this.eventDispatcher.addListener(e)}},{key:"removeListener",value:function(e){this.eventDispatcher.removeListener(e)}}]),e}(),wl=function(){function e(t){var n=this;M(this,e),this.invoker=t,this.timer=null,this.invokeWhenTimeout=function(){n.timer=null,n.invoker()}}return O(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}(),Sl=function(){function e(t){var n=this;M(this,e),this.onPushedBoundlessEvent=t,this.operationBuffer=[],this.willBlockOperation=!1,this.flushingOperationBufferTimer=null,this.flushOperationBuffer=function(){if(n.operationBuffer){var e,t=E(n.operationBuffer);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}n.operationBuffer.splice(0,n.operationBuffer.length),n.willBlockOperation=!1}n.flushingOperationBufferTimer=null}}return O(e,[{key:"unknownIsMultiFingers",get:function(){return this.willBlockOperation}},{key:"startOperation",value:function(){this.willBlockOperation=!0,this.flushingOperationBufferTimer=setTimeout(this.flushOperationBuffer,300)}},{key:"assertMultiFingers",value:function(){this.operationBuffer.splice(0,this.operationBuffer.length),this.willBlockOperation=!1,null!==this.flushingOperationBufferTimer&&(clearTimeout(this.flushingOperationBufferTimer),this.flushingOperationBufferTimer=null)}},{key:"assertSingleFinger",value:function(){null!==this.flushingOperationBufferTimer&&clearTimeout(this.flushingOperationBufferTimer),this.flushOperationBuffer()}},{key:"pushBoundlessEvent",value:function(e){var t=this;this.willBlockOperation?this.operationBuffer.push((function(){return t.onPushedBoundlessEvent(e)})):this.onPushedBoundlessEvent(e)}}]),e}(),xl=function(){function e(){M(this,e),this.pressedTouches={},this.emptyResolves=[],this.pressedTouchesCount=0}return O(e,[{key:"receiveTouchStartOrMoveEvent",value:function(e){var t,n=E(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.identifier in this.pressedTouches||(this.pressedTouchesCount+=1),this.pressedTouches[r.identifier]=r}}catch(e){n.e(e)}finally{n.f()}}},{key:"receiveTouchEndOrCancelEvent",value:function(e){var t,n=E(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier in this.pressedTouches&&(this.pressedTouchesCount-=1,delete this.pressedTouches[r.identifier],0===this.pressedTouchesCount)){var i,a=E(this.emptyResolves.splice(0));try{for(a.s();!(i=a.n()).done;){(0,i.value)()}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"waitUntilNoPressedTouches",value:function(){var e=this;return 0===this.pressedTouchesCount?Promise.resolve():new Promise((function(t){return e.emptyResolves.push(t)}))}}]),e}();!function(e){e[e.None=0]="None",e[e.Event=1]="Event",e[e.Camera=2]="Camera",e[e.Cancel=3]="Cancel"}(bl||(bl={}));var Il=function(){function e(t){M(this,e),this.pressedTouches=new xl,this.state=0,this.pinchTouches=null,this.previousTouchesCount=0,this.firstPressedTouch=null,this.firstPressedTouchBeginX=0,this.firstPressedTouchBeginY=0,this.blocker=new Sl(t.onReceivedSortedTouchEvent),this.callbacks=Object.freeze($c({},t))}return O(e,[{key:"pushTouchEvent",value:function(e){switch(e.kind){case Oc.TouchStart:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchStartEvent(e);break;case Oc.TouchMove:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchMoveEvent(e);break;case Oc.TouchEnd:case Oc.TouchCancel:this.pressedTouches.receiveTouchEndOrCancelEvent(e),this.pushTouchEndOrCancelEvent(e)}}},{key:"cancel",value:function(){var e=this;0!==this.state&&3!==this.state&&(this.state=3,this.pressedTouches.waitUntilNoPressedTouches().then((function(){e.state=0})).catch((function(e){return console.error(e)})))}},{key:"pushTouchStartEvent",value:function(e){var t=e.touches;switch(this.state){case 0:this.blocker.startOperation(),1===t.length?(this.state=1,this.firstPressedTouchBeginX=t[0].pointOnScreen.x,this.firstPressedTouchBeginY=t[0].pointOnScreen.y,this.firstPressedTouch={identifier:t[0].identifier,x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY},this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,0))):(this.state=2,this.pinchTouches=t.map((function(e){return{identifier:e.identifier,x:e.pointOnScreen.x,y:e.pointOnScreen.y}})),this.handleTouchEvents(this.pinchTouches));break;case 1:this.pinchTouches=[{identifier:this.firstPressedTouch.identifier,x:this.firstPressedTouch.x,y:this.firstPressedTouch.y}],this.blocker.unknownIsMultiFingers&&(this.blocker.assertMultiFingers(),this.firstPressedTouch=null),this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches),this.state=2;break;case 2:this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchMoveEvent",value:function(e){var t=this,n=e.touches;switch(this.refreshFirstPressedTouch(n),this.state){case 1:var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,r));break;case 2:var i,a=E(this.pinchTouches);try{var o=function(){var e=i.value,t=n.find((function(t){return t.identifier===e.identifier}));t&&(e.x=t.pointOnScreen.x,e.y=t.pointOnScreen.y)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchEndOrCancelEvent",value:function(e){var t=this,n=e.touches;if(this.firstPressedTouch&&3!==this.state){var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));-1!==r&&(this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,r)),this.firstPressedTouch=null)}switch(this.state){case 1:this.blocker.assertSingleFinger(),this.completeOperation();break;case 2:this.blocker.assertMultiFingers();var i,a=E(n);try{var o=function(){var e=i.value,n=t.pinchTouches.findIndex((function(t){return t.identifier===e.identifier}));-1!==n&&t.pinchTouches.splice(n,1)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.firstPressedTouch&&1===this.pinchTouches.length?(this.state=1,this.handleTouchEvents([]),this.pinchTouches=null):0===this.pinchTouches.length?(this.handleTouchEvents(this.pinchTouches),this.pinchTouches=null,this.completeOperation()):this.handleTouchEvents(this.pinchTouches)}}},{key:"handleTouchEvents",value:function(e){try{0===this.previousTouchesCount&&e.length>0&&this.callbacks.onBeginTransformCamera(e),this.previousTouchesCount>0&&0===e.length?this.callbacks.onAfterTransformCamera():this.callbacks.onTransformCamera(e)}finally{this.previousTouchesCount=e.length}}},{key:"pushToPinchTouches",value:function(e){var t=this;if(this.pinchTouches){var n,r=E(e);try{var i=function(){var e=n.value;t.pinchTouches.some((function(t){return t.identifier===e.identifier}))||t.pinchTouches.push({x:e.pointOnScreen.x,y:e.pointOnScreen.y,identifier:e.identifier})};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}}},{key:"refreshFirstPressedTouch",value:function(e){if(this.firstPressedTouch){var t,n=E(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier===this.firstPressedTouch.identifier){this.firstPressedTouch.x=r.pointOnScreen.x,this.firstPressedTouch.y=r.pointOnScreen.y;break}}}catch(e){n.e(e)}finally{n.f()}if(this.blocker.unknownIsMultiFingers){var i=this.firstPressedTouch.x-this.firstPressedTouchBeginX,a=this.firstPressedTouch.y-this.firstPressedTouchBeginY;i*i+a*a>=9&&this.blocker.assertSingleFinger()}}}},{key:"completeOperation",value:function(){this.state=0,this.blocker.unknownIsMultiFingers&&this.blocker.assertMultiFingers(),this.callbacks.onCompleteGroupOfEvents()}},{key:"covertToSortedTouchEvent",value:function(e,t){var n,r=e.touches[t],i=r.identifier,a=r.pointOnScreen,o=r.pointOnScene;switch(e.kind){case Oc.TouchStart:n=Oc.SortedTouchStart;break;case Oc.TouchMove:n=Oc.SortedTouchMove;break;case Oc.TouchEnd:n=Oc.SortedTouchEnd;break;case Oc.TouchCancel:n=Oc.SortedTouchCancel;break;default:throw new Error("unexpected kind ".concat(e.kind))}return{identifier:i,nativeEvent:e.nativeEvent,kind:n,pointOnScreen:a,pointOnScene:o}}}]),e}();function Cl(e,t,n,r){if(t===1/0||r===1/0)return{center:0,scale:1/0};var i=t/r;return Number.isNaN(i)&&(i=1),{center:n-e,scale:i}}var Pl=function(){function e(t){M(this,e),this.originBorder=t,this.currentBorder=t,this._transform=Object.freeze({deltaX:0,deltaY:0,scale:1})}return O(e,[{key:"transform",get:function(){return this._transform}},{key:"adaptOriginBorder",get:function(){return this._adaptOriginBorder}},{key:"setCurrentBorder",value:function(e){this.currentBorder=e;var t=Cl(this.originBorder.centerX,this.originBorder.width,this.currentBorder.centerX,this.currentBorder.width),n=t.center,r=t.scale,i=Cl(this.originBorder.centerY,this.originBorder.height,this.currentBorder.centerY,this.currentBorder.height),a=i.center,o=i.scale,s=Math.min(r,o);s===1/0&&(s=1),this._transform=Object.freeze({deltaX:n,deltaY:a,scale:s}),this._adaptOriginBorder=Object.freeze({damping:e.damping,centerX:e.centerX-n,centerY:e.centerY-a,width:e.width*s,height:e.height*s,maxScale:e.maxScale/s,minScale:e.minScale/s})}}]),e}(),Ml=function(){function e(){M(this,e),this.eccentricityRate=1,this.centroidXOffset=0,this.centroidYOffset=0,this.beginCentroidX=0,this.beginCentroidY=0,this.centroidX=0,this.centroidY=0,this._scale=1,this.isHanding=!1,this.previousTouchesCount=0}return O(e,[{key:"beginCentroid",get:function(){return this.isHanding?{x:this.beginCentroidX,y:this.beginCentroidY}:e.zeroPoint}},{key:"centroid",get:function(){return this.isHanding?{x:this.centroidX,y:this.centroidY}:e.zeroPoint}},{key:"scale",get:function(){return this.isHanding?this._scale:1}},{key:"handleTouches",value:function(e){var t=this.findTouchesExpression(e);this.isHanding?(this.previousTouchesCount!==e.length&&(this.centroidXOffset=this.centroidX-t.centroidX,this.centroidYOffset=this.centroidY-t.centroidY,this.eccentricityRate=this._scale/t.eccentricity,this.previousTouchesCount=e.length),this.centroidX=t.centroidX+this.centroidXOffset,this.centroidY=t.centroidY+this.centroidYOffset,this._scale=t.eccentricity*this.eccentricityRate):(this.centroidXOffset=0,this.centroidYOffset=0,this.eccentricityRate=1/t.eccentricity,this.beginCentroidX=t.centroidX,this.beginCentroidY=t.centroidY,this.centroidX=t.centroidX,this.centroidY=t.centroidY,this._scale=1,this.previousTouchesCount=e.length,this.isHanding=!0)}},{key:"findTouchesExpression",value:function(e){var t,n=0,r=0,i=E(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.x,s=a.y;n+=o,r+=s}}catch(e){i.e(e)}finally{i.f()}var c,u=n/e.length,l=r/e.length,h=0,d=E(e);try{for(d.s();!(c=d.n()).done;){var p=c.value,f=p.x,v=p.y,m=f-u,g=v-l;h+=Math.sqrt(m*m+g*g)}}catch(e){d.e(e)}finally{d.f()}return 0===h&&(h=1),{eccentricity:h,centroidX:u,centroidY:l}}}]),e}();Ml.zeroPoint=Object.freeze({x:0,y:0});var Tl=function(){function e(t){M(this,e),this.border={centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.scaleStart=0,this.scaleEnd=Number.POSITIVE_INFINITY,this.screenSize=t}return O(e,[{key:"findClosestValidCamera",value:function(e){var t=this.findClosestValidScale(e.scale),n=e.centerX,r=e.centerY;if(this.pinPoint&&e.scale!==t){var i=n-this.pinPoint.x,a=r-this.pinPoint.y,o=t/e.scale;n=this.pinPoint.x+i/o,r=this.pinPoint.y+a/o}return{centerX:n=this.findClosestValidCenter(n,t,this.screenSize.width,this.border.centerX,this.border.width),centerY:r=this.findClosestValidCenter(r,t,this.screenSize.height,this.border.centerY,this.border.height),scale:t}}},{key:"findClosestValidScale",value:function(e){var t=e;return this.scaleStart>t?t=this.scaleStart:this.scaleEnd<t&&(t=this.scaleEnd),t}},{key:"findClosestValidCenter",value:function(e,t,n,r,i){var a=e;if(t<=n/i)a=r;else{var o=n/t/2,s=i/2,c=r-s+o,u=r+s-o;a<c?a=c:a>u&&(a=u)}return a}}]),e}();function Ol(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}}function El(e,t,n){var r=e.x-t.width/2,i=e.y-t.height/2;return{x:n.centerX+r/n.scale,y:n.centerY+i/n.scale}}var Al=function(){function e(t){M(this,e),this.pincher=null,this.damping=0,this.camera=null,this.lastValidCamera=null,this.domain=new Tl(t)}return O(e,[{key:"isHandingPinch",get:function(){return!!this.pincher}},{key:"screenSize",get:function(){return this.domain.screenSize},set:function(e){this.domain.screenSize=e}},{key:"setCameraBorder",value:function(e){this.damping=e.damping,this.domain.scaleStart=e.minScale,this.domain.scaleEnd=e.maxScale,this.domain.border.centerX=e.centerX,this.domain.border.centerY=e.centerY,this.domain.border.width=e.width,this.domain.border.height=e.height}},{key:"beginWithCamera",value:function(e){this.pincher=new Ml,this.camera=e}},{key:"handleTouchesAndGetCameraMoving",value:function(e){this.pincher.handleTouches(e);var t=this.pincher.centroid,n=this.currentTargetCamera();return this.transformToCombinedCamera(n,t)}},{key:"transformToCombinedCamera",value:function(e,t){var n=this.domain.screenSize,r=El(t,n,e);this.domain.pinPoint=r;var i,a=this.domain.findClosestValidCamera(e);if(this.lastValidCamera=a,0===this.damping)i=e;else if(1===this.damping)i=a;else if(function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.scale===t.scale}(e,a))i=e;else{var o=El(t,n,a);i=this.viewCamera(r,o,e,a,this.damping)}return{valid:a,view:i}}},{key:"completeAndGetValidCamera",value:function(){var e=this.lastValidCamera;return this.pincher=null,this.camera=null,this.lastValidCamera=null,e}},{key:"currentTargetCamera",value:function(){var e=this.camera,t=this.pincher,n=this.domain.screenSize,r=e.scale*t.scale,i=Ol(t.beginCentroid,n),a=Ol(t.centroid,n),o=i.x/e.scale-a.x/r,s=i.y/e.scale-a.y/r;return{centerX:e.centerX+o,centerY:e.centerY+s,scale:r}}},{key:"viewCamera",value:function(e,t,n,r,i){var a=Xh(n.centerX,n.centerY,e.x,e.y),o=Gh(n.scale,r.scale,i),s=a*n.scale/o,c=Gh(e.x,t.x,i),u=Gh(e.y,t.y,i),l=Yh(Gh(n.centerX,r.centerX,i)-c,Gh(n.centerY,r.centerY,i)-u);return{centerX:c+s*l.x,centerY:u+s*l.y,scale:o}}}]),e}(),Nl=function(){function e(t){M(this,e),this._isActive=!1,this._key=void 0,this.previousPressEvent=null,this.cameraman=t.cameraman,this.activeDispatch=t.activeDispatch}return O(e,[{key:"active",get:function(){return this._isActive},set:function(e){this._isActive=e}},{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"willInterruptEvent",value:function(e){return this.active&&!!e&&(e.kind===Oc.SortedTouchMove||e.kind===Oc.MouseMove)}},{key:"moveCameraByEvent",value:function(e){if(e&&this.previousPressEvent&&this.isMouseOrSortedTouch(this.previousPressEvent)&&this.isMouseOrSortedTouch(e)){var t=e.pointOnScreen.x-this.previousPressEvent.pointOnScreen.x,n=e.pointOnScreen.y-this.previousPressEvent.pointOnScreen.y,r=this.cameraman.screen.camera,i=r.centerX,a=r.centerY,o=r.scale,s={centerX:i-t/o,centerY:a-n/o,scale:o,animationMode:Uh.Immediately,boundCamera:!0};this.cameraman.transformCamera(s)}}},{key:"handlePreviousEvent",value:function(e){this.needUpdatePrevious(e)?this.previousPressEvent=e:this.needReleasePrevious(e)&&(this.previousPressEvent=null)}},{key:"isKeyEvent",value:function(e){return!!e.nativeEvent&&e.nativeEvent instanceof KeyboardEvent&&e.nativeEvent.key===this.key}},{key:"handleKeyEvent",value:function(e){var t=this.active;e.kind===Oc.KeyDown&&!0!==t?this.active=!0:e.kind===Oc.KeyUp&&!1!==t&&(this.active=!1),t!==this.active&&this.activeDispatch(this.active)}},{key:"isMouseOrSortedTouch",value:function(e){var t=e.kind;return t===Oc.MouseDown||t===Oc.MouseUp||t===Oc.MouseLeave||t===Oc.MouseMove||t===Oc.SortedTouchStart||t===Oc.SortedTouchMove||t===Oc.SortedTouchEnd||t===Oc.SortedTouchCancel}},{key:"needUpdatePrevious",value:function(e){return!(!e||(!this.previousPressEvent||e.kind!==Oc.MouseMove&&e.kind!==Oc.SortedTouchMove)&&e.kind!==Oc.MouseDown&&e.kind!==Oc.SortedTouchStart)}},{key:"needReleasePrevious",value:function(e){return!!e&&(e.kind===Oc.MouseUp||e.kind===Oc.SortedTouchEnd||e.kind===Oc.SortedTouchCancel)}}]),e}(),Rl=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};M(this,e),this.disableCameraTransform=!1,this.boundlessEventDispatcher=new hl,this.transformationEventDispatcher=new hl,this.handToolActiveEventDispatcher=new hl,this.transformer=null,this.border=Object.freeze({damping:.75,centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY,minScale:0,maxScale:Number.POSITIVE_INFINITY}),this.moveToCamera=null,this.didRelease=!1,this.isPaddingCameraOperations=!1,this.paddingCameraOperation=null,this.onBoundlessEvent=function(e){switch(r.screen.deviceType){case Ah.Surface:r.handleBoundlessEventWhenItIsSurface(e);break;case Ah.Desktop:r.handleBoundlessEventWhenItIsDesktop(e);break;case Ah.Touch:r.handleBoundlessEventWhenItIsTouch(e)}},this.onScreenUpdatedListener=function(e){var t=e.camera,n=e.width,i=e.height,a=r.cameraView.screenSize;if(a.width!==n||a.height!==i){r.cameraView.screenSize=Object.freeze({width:n,height:i});var o=r.cameraView.transformToCombinedCamera(r.screen.camera,{x:n/2,y:i/2}).valid;(t.centerX!==o.centerX||t.centerY!==o.centerY||t.scale!==o.scale)&&r.screen.transformCamera(eu($c({},o),{animationMode:Uh.Immediately}))}},this.dispatchBoundlessEvent=function(e){var t=r.continuityNode.interruptEvent(e);r.handTool.willInterruptEvent(t)?r.handTool.moveCameraByEvent(t):t&&r.boundlessEventDispatcher.dispatch(t),r.handTool.handlePreviousEvent(t)},this.onAfterMouseWheel=function(){r.transformationEventDispatcher.dispatch(Bh.End),r.screen.setTransition(!1)},this.onBeginTransformCamera=function(e){r.disableCameraTransform||(r.isPaddingCameraOperations=!0,r.transformationEventDispatcher.dispatch(Bh.Begin),r.cameraView.beginWithCamera(r.screen.camera),r.transformer=new Pl(r.border),r.onTransformCamera(e))},this.onTransformCamera=function(e){if(!r.disableCameraTransform){var t=r.cameraView.handleTouchesAndGetCameraMoving(e),n=eu($c({},r.cameraAppendBorderTransform(t.view)),{animationMode:Uh.Immediately});r.moveToCamera=t.view,r.screen.setCameraTransfrom(n,!0)}},this.onAfterTransformCamera=function(){if(!r.disableCameraTransform){var e=r.cameraView.completeAndGetValidCamera();r.isPaddingCameraOperations=!1,r.moveToCamera=r.cameraAppendBorderTransform(e),r.cameraView.setCameraBorder(r.border),r.paddingCameraOperation&&(r.paddingCameraOperation(),r.paddingCameraOperation=null),r.transformer=null,r.transformationEventDispatcher.dispatch(Bh.End)}},this.onCompleteGroupOfEvents=function(){if(r.moveToCamera){var e=r.screen.camera;if(r.moveToCamera.centerX!==e.centerX||r.moveToCamera.centerY!==e.centerY||r.moveToCamera.scale!==e.scale){var t=eu($c({},r.moveToCamera),{animationMode:Uh.Continuous});r.screen.setCameraTransfrom(t,!1)}else r.screen.setTransition(!1);r.moveToCamera=null}},this.onContinuityNodeCancel=function(e){r.boundlessEventDispatcher.dispatch(e),r.sorter&&r.sorter.cancel()},this.screen=t,this.eventProxy=n,this.afterWheelDelayer=new wl(this.onAfterMouseWheel),this.continuityNode=yl(this.onContinuityNodeCancel),this.cameraView=new Al({width:t.width,height:t.height}),this.handTool=new Nl({cameraman:this,activeDispatch:function(e){return r.handToolActiveEventDispatcher.dispatch(e)}}),this.setCameraBorder(i),(t.deviceType===Ah.Touch||t.deviceType===Ah.Surface)&&(this.sorter=new Il({onBeginTransformCamera:this.onBeginTransformCamera,onTransformCamera:this.onTransformCamera,onAfterTransformCamera:this.onAfterTransformCamera,onCompleteGroupOfEvents:this.onCompleteGroupOfEvents,onReceivedSortedTouchEvent:this.dispatchBoundlessEvent})),n.addListener(this.onBoundlessEvent),t.addScreenUpdatedListener(this.onScreenUpdatedListener)}return O(e,[{key:"handToolActive",get:function(){return this.handTool.active},set:function(e){this.handTool.active=e}},{key:"handToolKey",get:function(){return this.handTool.key},set:function(e){this.handTool.key=e}},{key:"cameraBorder",get:function(){return this.border}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"setCameraBorder",value:function(e){var t=this.border,n=this.border=Object.freeze($c($c({},this.border),e));if(!function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.damping===t.damping&&e.width===t.width&&e.height===t.height&&e.minScale===t.minScale&&e.maxScale===t.maxScale}(t,n)){var r;this.transformer?((r=this.transformer).setCurrentBorder(n),n=r.adaptOriginBorder):(r=new Pl(t)).setCurrentBorder(n),this.cameraView.setCameraBorder(n);var i=this.moveToCamera||this.screen.camera,a=r.transform;(0!==a.deltaX||0!==a.deltaY||1!==a.scale)&&this.screen.transformCamera({animationMode:Uh.Immediately,centerX:i.centerX+a.deltaX,centerY:i.centerY+a.deltaY,scale:i.scale*a.scale})}return this.border}},{key:"disableBoundlessEvent",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"transformCamera",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.executeTransformCamera(e)}:this.executeTransformCamera(e)}},{key:"executeTransformCamera",value:function(e){var t=e;if(t.boundCamera){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale,o={centerX:Gu(t.centerX,r),centerY:Gu(t.centerY,i),scale:Gu(t.scale,a)},s=this.cameraView.screenSize,c=s.width,u=s.height,l=this.cameraView.transformToCombinedCamera(o,{x:c/2,y:u/2}).valid;(l.centerX!==o.centerX||l.centerY!==o.centerY||l.scale!==o.scale)&&(t=eu($c({},t),{centerX:l.centerX,centerY:l.centerY,scale:l.scale}))}this.screen.transformCamera(t)}},{key:"adaptRectangle",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.screen.adaptRectangle(e)}:this.screen.adaptRectangle(e)}},{key:"release",value:function(){this.didRelease||(this.sorter&&this.sorter.cancel(),this.eventProxy.removeListener(this.onBoundlessEvent),this.screen.removeScreenUpdatedListener(this.onScreenUpdatedListener),this.afterWheelDelayer.cancel(),this.didRelease=!0)}},{key:"handleBoundlessEventWhenItIsDesktop",value:function(e){switch(e.kind){case Oc.MouseWheel:this.onMouseWheel(e);break;case Oc.TouchStart:case Oc.TouchMove:case Oc.TouchEnd:case Oc.TouchCancel:break;case Oc.KeyDown:case Oc.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsTouch",value:function(e){switch(e.kind){case Oc.TouchStart:case Oc.TouchMove:case Oc.TouchEnd:case Oc.TouchCancel:this.sorter.pushTouchEvent(e);break;case Oc.MouseDown:case Oc.MouseUp:case Oc.MouseMove:case Oc.MouseLeave:break;case Oc.KeyDown:case Oc.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsSurface",value:function(e){switch(e.kind){case Oc.MouseWheel:this.onMouseWheel(e);break;case Oc.TouchStart:case Oc.TouchMove:case Oc.TouchEnd:case Oc.TouchCancel:this.sorter.pushTouchEvent(e);break;case Oc.MouseDown:case Oc.MouseUp:case Oc.MouseMove:case Oc.MouseLeave:default:this.dispatchBoundlessEvent(e)}}},{key:"onMouseWheel",value:function(t){if(!this.disableCameraTransform){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale;if(0!==t.scale){var o=1+t.scale,s=t.pointOnScreen.x,c=t.pointOnScreen.y,u=(1-1/o)/a;r+=u*(s-this.screen.width/2),i+=u*(c-this.screen.height/2),a*=o}r-=t.offsetPoint.x/a,i-=t.offsetPoint.y/a;var l=this.cameraView.transformToCombinedCamera({centerX:r,centerY:i,scale:a},t.pointOnScreen),h=eu($c({},this.cameraAppendBorderTransform(l.valid)),{animationMode:Uh.Immediately});this.transformationEventDispatcher.dispatch(Bh.Begin),this.afterWheelDelayer.refreshAndInvokeAfterInterval(e.RefreshTimeoutOnDesktop),this.screen.setCameraTransfrom(h,!0)}}},{key:"cameraAppendBorderTransform",value:function(e){if(this.transformer){var t=this.transformer.transform;return Object.freeze({centerX:e.centerX+t.deltaX,centerY:e.centerY+t.deltaY,scale:e.scale*t.scale})}return e}},{key:"addHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.addListener(e)}},{key:"removeHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.removeListener(e)}},{key:"addCameraTransformationListener",value:function(e){this.transformationEventDispatcher.addListener(e)}},{key:"removeCameraTransformationListener",value:function(e){this.transformationEventDispatcher.removeListener(e)}},{key:"addBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.addListener(e)}},{key:"removeBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.removeListener(e)}}]),e}();function Ll(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function jl(e,t){-1===e.indexOf(t)&&e.push(t)}Rl.RefreshTimeoutOnDesktop=200;var Dl=function(){function e(){var t=this;M(this,e),this.animationPriorities=[],this.animations={},this.afterAnimationsInvokers=[],this.animationId=null,this.isInAnimationFrame=!1,this.onAnimationFrame=function(){try{t.isInAnimationFrame=!0;var e,n=E(t.animationPriorities);try{for(n.s();!(e=n.n()).done;)for(var r=e.value,i=0,a=C(t.animations[r]);i<a.length;i++){(0,a[i])()}}catch(e){n.e(e)}finally{n.f()}for(var o=0,s=C(t.afterAnimationsInvokers);o<s.length;o++){(0,s[o])()}t.animationPriorities.length>0?t.animationId=window.requestAnimationFrame(t.onAnimationFrame):t.animationId=null}finally{t.isInAnimationFrame=!1}}}return O(e,[{key:"addAnimation",value:function(e,t){var n=this.animations[e],r=!1;n||(n=this.animations[e]=[],this.animationPriorities.push(e),this.animationPriorities.sort(),r=1===this.animationPriorities.length),jl(n,t),r&&null===this.animationId&&(this.animationId=window.requestAnimationFrame(this.onAnimationFrame))}},{key:"removeAnimation",value:function(e,t){var n=this.animations[e];n&&(Ll(n,t),0===n.length&&(delete this.animations[e],Ll(this.animationPriorities,e),0===this.animationPriorities.length&&!this.isInAnimationFrame&&null!==this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=null)))}},{key:"addAfterAnimationsInvoker",value:function(e){jl(this.afterAnimationsInvokers,e)}},{key:"removeAfterAnimationsInvoker",value:function(e){Ll(this.afterAnimationsInvokers,e)}}]),e}(),zl=function(){function e(){M(this,e)}return O(e,[{key:"createAnimationGroup",value:function(){return new Fl}},{key:"createAnimation",value:function(e,t){return new Bl(e,t)}},{key:"createAnimationFrameInvoker",value:function(e){return new Vl(e)}},{key:"createAfterAnimationsInvoker",value:function(e){return new Ul(e)}}]),e}();zl.animationFrames=new Dl;var Fl=function(){function e(){M(this,e),this.children=[]}return O(e,[{key:"createAnimation",value:function(e,t){var n=this,r=new Bl(e,t,(function(e){return Ll(n.children,e)}));return this.children.push(r),r}},{key:"createAfterAnimationsInvoker",value:function(e){var t=this,n=new Ul(e,(function(e){return Ll(t.children,e)}));return this.children.push(n),n}},{key:"release",value:function(){var e,t=E(this.children.splice(0));try{for(t.s();!(e=t.n()).done;){e.value.release()}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),Bl=function(){function e(t,n,r){var i=this;M(this,e),this.priority=t,this.onRefresh=n,this.onRelease=r,this.onAnimationFrame=function(){Hl(i,i.onRefresh)},zl.animationFrames.addAnimation(this.priority,this.onAnimationFrame)}return O(e,[{key:"release",value:function(){zl.animationFrames.removeAnimation(this.priority,this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),Ul=function(){function e(t,n){var r=this;M(this,e),this.onRefresh=t,this.onRelease=n,this.onAnimationFrame=function(){Hl(r,r.onRefresh)},zl.animationFrames.addAfterAnimationsInvoker(this.onAnimationFrame)}return O(e,[{key:"release",value:function(){zl.animationFrames.removeAfterAnimationsInvoker(this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),Vl=function(){function e(t){var n=this;M(this,e),this.priority=t,this.nextHandler=null,this.banAnimationChange=!1,this.onAnimationFrame=function(){if(n.nextHandler){var e=n.nextHandler;n.nextHandler=null;try{n.banAnimationChange=!0,Hl(n,e)}finally{n.banAnimationChange=!1}null===n.nextHandler&&zl.animationFrames.removeAnimation(n.priority,n.onAnimationFrame)}}}return O(e,[{key:"invoke",value:function(e){!this.banAnimationChange&&!this.nextHandler&&zl.animationFrames.addAnimation(this.priority,this.onAnimationFrame),this.nextHandler=e}},{key:"release",value:function(){!this.banAnimationChange&&this.nextHandler&&(this.nextHandler=null,zl.animationFrames.removeAnimation(this.priority,this.onAnimationFrame))}}]),e}(),Wl=new zl;function Hl(e,t){try{t(e)}catch(e){console.error(e)}}function _l(e){var t=Math.abs(e),n=1/(1+t/2),r=n*Math.exp(-t*t-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(n*(.27886807+n*(n*(1.48851587+n*(.17087277*n-.82215223))-1.13520398))-.18628806)))));return e>=0?r:2-r}function Gl(e,t){return new Ql(e,t)}function Yl(e,t){return Gl(t/e,1/e)}var Xl,Ql=function(){function e(t,n){M(this,e),this.mean=t,this.variance=n,this.standardDeviation=Math.sqrt(n)}return O(e,[{key:"pdf",value:function(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t}},{key:"cdf",value:function(e){return.5*_l(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))}},{key:"ppf",value:function(e){return this.mean-this.standardDeviation*Math.sqrt(2)*function(e){if(e>=2)return-100;if(e<=0)return 100;for(var t=e<1?e:2-e,n=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),i=0;i<2;i++){var a=_l(r)-t;r+=a/(1.1283791670955126*Math.exp(-r*r)-r*a)}return e<1?r:-r}(2*e)}},{key:"mul",value:function(e){if("number"==typeof e)return this.scale(e);var t=1/this.variance,n=1/e.variance;return Yl(t+n,t*this.mean+n*e.mean)}},{key:"div",value:function(e){if("number"==typeof e)return this.scale(1/e);var t=1/this.variance,n=1/e.variance;return Yl(t-n,t*this.mean-n*e.mean)}},{key:"add",value:function(e){return Gl(this.mean+e.mean,this.variance+e.variance)}},{key:"sub",value:function(e){return Gl(this.mean-e.mean,this.variance+e.variance)}},{key:"scale",value:function(e){return Gl(this.mean*e,this.variance*e*e)}}]),e}(),Zl=function(){function e(){M(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.configurations=Object.freeze(n.map((function(e){return Object.freeze($c({},e))})))}return O(e,[{key:"create",value:function(e,t,n){return new Kl(e,C(this.configurations),t,n)}}]),e}(),Kl=function(){function e(t,n,r,i){var a=this;M(this,e),this.priority=t,this._point=r,this.onPointUpdate=i,this.completeTick=!1,this.playingAnimation=null,this.updateIdealPoint=function(t){e.setPoint(a.idealPoint,t),!a.playingAnimation&&a.shouldContinueMoving()&&(a.playingAnimation=Wl.createAnimation(a.priority,a.onTick)),a.completeTick=!1},this.onTick=function(){if(a.completeTick)a.stop();else{a.executePhysicalSimulate();var e=!a.shouldContinueMoving();a.onPointUpdate&&a.onPointUpdate(a._point,e),e&&(a.completeTick=!0)}};var o=h(n.splice(0,1),1)[0];this.configuration=o,this._point=C(r),this.idealPoint=C(r),this.velocity=r.map((function(){return 0})),n.length>0&&(this.guider=new e(this.priority,n,r,this.updateIdealPoint));var s=this.configuration.pedesisSpeedMean,c=this.configuration.pedesisSpeedVariance;this.gaussian=0!==s&&0!==c?Gl(s,c):null,this.noPedesisRadius=(s+Math.sqrt(c))*e.noPedesisRadiusRate}return O(e,[{key:"point",get:function(){return this._point}},{key:"isPlayingAnimation",get:function(){return!!this.playingAnimation}},{key:"moveRightNow",value:function(t){this.guider&&this.guider.moveRightNow(t),e.setPoint(this.idealPoint,t),e.setPoint(this._point,t),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"moveTo",value:function(e){this.guider?this.guider.moveTo(e):this.updateIdealPoint(e)}},{key:"moveToAndChangeCoordinate",value:function(e,t){for(var n=0;n<this._point.length;++n)this._point[n]+=e[n];this.guider?this.guider.moveToAndChangeCoordinate(e,t):this.updateIdealPoint(t)}},{key:"stop",value:function(){e.setPoint(this.idealPoint,this._point),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"executePhysicalSimulate",value:function(){for(var e=this.squareDistanceToIdealPoint(),t=this.velocityDamping(e),n=e>this.noPedesisRadius*this.noPedesisRadius,r=0;r<this._point.length;++r){var i=this.idealPoint[r]-this._point[r],a=this.configuration.kDistance*i;if(this.velocity[r]+=a,n&&this.gaussian){var o=this.gaussian.ppf(Math.random());Math.random()>=.5&&(o=-o),this.velocity[r]+=o}this._point[r]+=this.velocity[r],this.velocity[r]*=1-t}}},{key:"velocityDamping",value:function(e){for(var t=0,n=0;n<this.velocity.length;++n)t+=this.velocity[n]*this.velocity[n];var r=this.configuration,i=r.heavyDampingRadius,a=r.heavyDampingSpeed;return t<a*a||e>i*i?this.configuration.velocityDamping:Math.min(1,t*this.configuration.velocityDamping)}},{key:"squareDistanceToIdealPoint",value:function(){for(var e=0,t=0;t<this.velocity.length;++t){var n=this.idealPoint[t]-this._point[t];e+=n*n}return e}},{key:"shouldContinueMoving",value:function(){for(var e=0;e<this._point.length;++e)if(Math.abs(this._point[e]-this.idealPoint[e])>this.configuration.matchingDistance||Math.abs(this.velocity[e])>this.configuration.zeroSpeed)return!0;return!1}}],[{key:"setPoint",value:function(e,t){for(var n=0;n<e.length;++n)e[n]=n in t?t[n]:0}},{key:"setPointZero",value:function(e){for(var t=0;t<e.length;++t)e[t]=0}}]),e}();Kl.noPedesisRadiusRate=2.7,function(e){e[e.ComponentMoving=0]="ComponentMoving",e[e.CameraMoving=1]="CameraMoving",e[e.Rendering=2]="Rendering"}(Xl||(Xl={}));var ql=function(){function e(t,n){var r=this;M(this,e),this.referPoint=[],this._isTransition=!1;var i=n&&function(e,t){var i=r.convertPointToCamera(e,t),a=r._isTransition||!t;n(i,a)};this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring=e.spaceSpringFactory.create(Xl.CameraMoving,[0,0,0],i)}return O(e,[{key:"isTransition",get:function(){return this._isTransition}},{key:"convertPointToCamera",value:function(t,n){return n?{centerX:this.referPoint[0],centerY:this.referPoint[1],scale:this.referPoint[2]/e.kScale}:{centerX:this.referPoint[0]+t[0],centerY:this.referPoint[1]+t[1],scale:(this.referPoint[2]+t[2])/e.kScale}}},{key:"moveTo",value:function(t,n){var r=[this.referPoint[0]-t.centerX,this.referPoint[1]-t.centerY,this.referPoint[2]-t.scale*e.kScale];this._isTransition=n,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveToAndChangeCoordinate(r,[0,0,0])}},{key:"moveToRightNow",value:function(t,n){this._isTransition=n,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveRightNow([0,0,0])}}]),e}();function Jl(e,t){var n,r=t,i=E(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=(0,Uc.createElement)(a,null,r)}}catch(e){i.e(e)}finally{i.f()}return r}function $l(e){var t,n={},r=E(e.engines);try{var i=function(){var r=t.value;n[r.id]=r.createRenderLayout({screen:e.screen,tree:e.tree,mode:e.mode,initCamera:e.initCamera,visions:e.visions,leafFilter:function(e){return e.value.isVisible(r)},onRenderDuration:e.onRenderDuration})};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return n}ql.kScale=700,ql.spaceSpringFactory=new Zl({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0});var eh,th=function(){function e(t){M(this,e),this.className=t.screen.className,this.layouts=Object.freeze($l({tree:t.tree,screen:t.screen,initCamera:t.initCamera,visions:t.visions,engines:t.engines,onRenderDuration:t.onRenderDuration,mode:Ec.Preview}))}return O(e,[{key:"render",value:function(e){var t=[];for(var n in this.layouts){var r=this.layouts[n].getRender();t.push((0,Bc.createElement)(r,{key:n}))}return Jl(e,(0,Bc.createElement)("div",{className:this.className,style:{width:"100%",height:"100%",position:"relative"}},t))}}]),e}();function nh(e,t,n,r){var i=t,a=n,o=r,s=e>a;if(s){var c=e,u=i;a,a=c,i=o,o=u}return i<a?eh.Result.Disjoint:i<o?eh.Result.Cross:s?eh.Result.IncludeByRectangle:eh.Result.IncludeRectangle}!function(e){var t;(t=e.Result||(e.Result={}))[t.Disjoint=0]="Disjoint",t[t.Cross=1]="Cross",t[t.IncludeRectangle=2]="IncludeRectangle",t[t.IncludeByRectangle=3]="IncludeByRectangle",e.testPoint=function(e,t,n,r,i,a){return i>=e&&i<=e+n&&a>=t&&a<=t+r},e.testRectangle=function(e,t,n,r,i,a,o,s){var c=nh(e,e+n,i,i+o),u=nh(t,t+r,a,a+s);return 0===c||0===u?0:1===c||1===u?1:2===c&&2===u?2:3===c&&3===u?3:1},e.iterate=function(e,t,n,r,i){i(e,t),i(e+n,t),i(e+n,t+r),i(e,t+r)},e.allPoints=function(e,t,n,r){return[{x:e,y:t},{x:e+n,y:t},{x:e+n,y:t+r},{x:e,y:t+r}]}}(eh||(eh={}));var rh=function(){function e(t){M(this,e),this.component=null,this.componentState={className:t.screen.className},this.layouts=Object.freeze($l({tree:t.tree,screen:t.screen,engines:t.engines,visions:t.visions,onRenderDuration:t.onRenderDuration,mode:Ec.Normal})),this.logger=t.screen.scene.logger,this.renderClass=this.createRender()}return O(e,[{key:"setState",value:function(e){var t;this.componentState=$c({},e),null==(t=this.component)||t.setState(e)}},{key:"renderLayouts",get:function(){return this.layouts}},{key:"getRender",value:function(){return this.renderClass}},{key:"createRender",value:function(){var e=this;return function(t){m(r,t);var n=y(r);function r(t){var i;return M(this,r),(i=n.call(this,t)).state=$c({},e.componentState),e.component=k(i),i}return O(r,[{key:"componentWillUnmount",value:function(){e.component=null}},{key:"render",value:function(){var t=[],n=this.state,r=n.className,i=n.style,a=eu($c({},i),{width:"100%",height:"100%",position:"relative"});for(var o in e.layouts)t.push((0,Hc.createElement)(ih,{key:o,logger:e.logger,layout:e.layouts[o]}));return(0,Hc.createElement)("div",{className:r,style:a},t)}}]),r}(Hc.Component)}}]),e}(),ih=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).state={error:void 0},r}return O(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.layout,r=this.state.error;return n!==e.layout||r!==t.error}},{key:"componentDidCatch",value:function(e,t){var n=this.props,r=n.layout;n.logger.error("boundless layout ".concat(r.engine.id," render catch error:"),e," stack: ",t.componentStack)}},{key:"render",value:function(){var e=this.props.layout;if(this.state.error)return null;var t=e.getRender();return(0,Hc.createElement)(t,null)}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{error:e}}}]),n}(Hc.Component),ah=function(){function e(t,n,r,i,a){M(this,e);var o={},s=function(e){var r=t.renderLayouts[e],i={};n.forEach((function(e){e.value.isVisible(r.engine)&&(i[e.id]=!0)})),o[e]=Object.seal({layout:r,visibleSet:i})};for(var c in t.renderLayouts)s(c);this.camera=i,this.screenSize=a,this.context=r,this.engineNodes=Object.freeze(o)}return O(e,[{key:"flush",value:function(e){var t,n,r;for(var i in hu(this.camera,e.camera)||(t=this.camera=e.camera),hu(this.screenSize,e.screenSize)||(n=this.screenSize=e.screenSize),this.context!==e.context&&(r=this.context=e.context),this.engineNodes)this.flushEngine(this.engineNodes[i],e,r,t,n)}},{key:"flushEngine",value:function(e,t,n,r,i){var a=e.visibleSet,o=e.layout.engine,s=t.testSet,c=t.updateSet,u=t.moveSet,l=t.isTransition,h=t.diff,d=h.addedSet,p=h.removedSet,f=[],v=[],m=[];for(var g in d)d[g].value.isVisible(o)?a[g]=!0:m.push(g);for(var y in s){var b=s[y],k=b.treeNode,w=b.isVisible(o),S=y in a;S&&!w?(v.push(k),delete a[y]):!S&&w&&(f.push(k),a[y]=!0)}for(var x in p)delete a[x];var I=t.diff.decorate({insertToAdded:f,insertToRemoved:v,maskAdded:m}),C={},P={};for(var M in c)M in a&&(C[M]=c[M].treeNode);for(var T in u)T in a&&(P[T]=u[T].treeNode);e.layout.update({context:n,camera:r,screenSize:i,isTransition:l,diff:I,updateSet:C,moveSet:P})}}]),e}(),oh=function(){function e(t){var n=this;M(this,e),this.frameInvoker=Wl.createAnimationFrameInvoker(Xl.Rendering),this.didReceiveTransitionFalse=!1,this.onFrameInvoke=function(){var e=!n.didReceiveTransitionFalse;n.didReceiveTransitionFalse=!1,n.frameHandler(e)},this.frameHandler=t}return O(e,[{key:"release",value:function(){this.frameInvoker.release()}},{key:"fire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(this.didReceiveTransitionFalse=!0),this.frameInvoker.invoke(this.onFrameInvoke)}}]),e}();function sh(e,t,n,r){var i=hh(t);lh(e.treeNode,i,n,r)}function ch(e,t,n,r){switch(e.kind){case Dh.Component:var i=e,a=uh(i.treeNode.parent,t);if(a){var o=fh(e,a);o?n(i,o):r(i)}break;case Dh.Group:var s=e.treeNode,c=uh(s,t);c&&lh(s,c,n,r)}}function uh(e,t){for(var n=[],r=e;r.parent;)n.push(r),r=r.parent;for(var i=hh(t),a=n.length-1;a>=0;a--){var o=n[a].value,s=fh(o,i);if(!s){i=null;break}i=ph(i,s,o)}return i}function lh(e,t,n,r){var i,a=E(e);try{for(a.s();!(i=a.n()).done;){var o=i.value.value,s=fh(o,t);switch(o.kind){case Dh.Component:var c=o;s?n(c,s):r(c);break;case Dh.Group:if(s){var u=o;lh(u.treeNode,ph(t,s,u),n,r)}}}}catch(e){a.e(e)}finally{a.f()}}function hh(e){var t=e.camera,n=e.width,r=e.height;return{scene:{dx:0,dy:0,scale:1},screen:{dx:-(t.centerX-n/t.scale/2)*t.scale,dy:-(t.centerY-r/t.scale/2)*t.scale,scale:t.scale},rect:{originX:0,originY:0,width:n,height:r},tailor:{left:0,right:0,top:0,bottom:0},absolute:dh(n,r)}}function dh(e,t){var n={scene:{dx:0,dy:0,scale:1},screen:{dx:e/2,dy:t/2,scale:1},rect:{originX:0,originY:0,width:e,height:t},tailor:{left:0,right:0,top:0,bottom:0},absolute:null};return n.absolute=n,n}function ph(e,t,n){var r=t.sceneRect,i=t.screenRect,a=t.tailor;return{scene:{dx:r.originX,dy:r.originY,scale:e.scene.scale*n.scale},screen:{dx:i.originX,dy:i.originY,scale:e.screen.scale*n.scale},rect:i,tailor:a,absolute:e.absolute}}function fh(e,t){if(e.kind===Dh.Component&&!e.isVisible())return null;var n=t;e.absoluteCoordinates&&(n=n.absolute);var r=n,i=r.scene,a=r.screen,o=a.scale,s=a.dx,c=a.dy,u=function(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left*t+r.left,a=n.top*t+r.top,o=n.right*t+r.right,s=n.bottom*t+r.bottom;return Object.freeze({left:i,right:o,top:a,bottom:s})}(e,o),l=e.originX*o+s-u.left,h=e.originY*o+c-u.top,d=e.width*o+u.left+u.right,p=e.height*o+u.top+u.bottom,f=n.rect,v=n.tailor,m=f.originX+v.left-l,g=f.originY+v.top-h,y=l+d-(f.originX+f.width-v.right),b=h+p-(f.originY+f.height-v.bottom);if(!e.disableVisionTrim&&(m>=d||y>=d||m+y>=d||g>=p||b>=p||g+b>=p))return null;var k={left:m,top:g,right:y,bottom:b},w={originX:l,originY:h,width:d,height:p},S=vh(e,o);return{margin:u,scale:o,tailor:k,sceneRect:{originX:e.originX+i.dx-S.left,originY:e.originY+i.dy-S.top,width:e.width*i.scale+S.left+S.right,height:e.height*i.scale+S.top+S.bottom},screenRect:w}}function vh(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left+r.left/t,a=n.top+r.top/t,o=n.right+r.right/t,s=n.bottom+r.bottom/t;return Object.freeze({left:i,right:o,top:a,bottom:s})}function mh(e,t,n){sh(t,n,(function(t,n){e.bindVision(t.treeNode,n)}),(function(){}))}var gh=function(){function e(t){var n=this;M(this,e),this.isCameraUpdated=!1,this.toTestAppearSet={},this.toTestVisibleSet={},this.toUpdateSet={},this.toSortSet={},this.toMoveSet={},this.toShowSet={},this.toHideSet={},this.onScreenUpdate=function(e){hu(n.screenState,e)||(n.isCameraUpdated=!0,n.screenState=e,n.refreshFrameNode.fire(e.isTransition))},this.onGroupSorted=function(e){n.toSortSet[e.treeNode.id]=e,n.refreshFrameNode.fire()},this.onComponentUpdate=function(e){var t=e.node;switch(e.behavior){case wh.Removed:delete n.toTestAppearSet[t.treeNode.id],delete n.toUpdateSet[t.treeNode.id],delete n.toTestVisibleSet[t.treeNode.id];break;case wh.Added:case wh.AppearUpdated:n.toTestAppearSet[t.treeNode.id]=t;break;case wh.VisibleUpdated:t instanceof Nh&&(n.toTestVisibleSet[t.treeNode.id]=t);break;case wh.PropertiesUpdated:t instanceof Nh&&(n.toUpdateSet[t.treeNode.id]=t)}n.refreshFrameNode.fire()},this.handleFrame=function(e){try{n.sortAllGroups();var t=n.diffBuffer.fetchDiff();n.testComponents(t);var r=n.commitVisibleAndDecorateDiff(t);n.notify(r,e),n.cleanSet()}catch(t){n.logger.error(t)}},this.refreshComponent=function(e,t){var r=e.treeNode.id,i=n.visions.leaf(r),a=n.visions.vision(r);if(a){var o=a.sceneRect,s=i.value;(!hu(o,t.sceneRect)||!hu(s.parallaxMargin,e.parallaxMargin)||!hu(s.sceneMargin,e.sceneMargin))&&(n.toMoveSet[r]={component:e,vision:t})}else n.toShowSet[r]={component:e,vision:t};i&&n.visions.bindVision(i,t)},this.removeComponent=function(e){var t=e.treeNode;n.visions.includes(t.id)&&(n.toHideSet[t.id]=e),n.visions.unbindVision(t.id)},this.screen=t.screen,this.visions=t.visions,this.logger=this.screen.scene.logger,this.tree=this.screen.scene.tree,this.diffBuffer=this.tree.createDiffBuffer(),this.screenState={width:this.screen.width,height:this.screen.height,camera:Object.freeze($c({},this.screen.camera)),visionRectangle:this.screen.visionRectangle,isTransition:!1},mh(this.visions,this.screen.scene,this.screenState),this.renderer=new rh({screen:this.screen,engines:t.engines,tree:this.tree,visions:this.visions,onRenderDuration:t.onRenderDuration});var r=this.screen,i=r.context,a=r.camera;this.notifier=new ah(this.renderer,this.visions,i,a,Object.freeze({width:this.screen.width,height:this.screen.height})),this.refreshFrameNode=new oh(this.handleFrame),this.screen.addScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.addGroupSortedListener(this.onGroupSorted),this.screen.scene.addComponentUpdateListener(this.onComponentUpdate)}return O(e,[{key:"willInterruptEvent",value:function(e,t){for(var n in this.renderer.renderLayouts)if(this.renderer.renderLayouts[n].willInterruptEvent(this.screen,e,t))return!0;return!1}},{key:"findComponentWithTarget",value:function(e){for(var t in this.renderer.renderLayouts){var n=this.renderer.renderLayouts[t],r=n.findComponentWithTarget(e);if(r)return{component:r,engine:n.engine}}}},{key:"forEachVisibleComponent",value:function(e){var t,n=E(this.tree);try{for(n.s();!(t=n.n()).done;){e(t.value.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"release",value:function(){this.refreshFrameNode.release(),this.diffBuffer.release(),this.screen.removeScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.removeGroupSortedListener(this.onGroupSorted),this.screen.scene.removeComponentUpdateListener(this.onComponentUpdate)}},{key:"refreshScreenContext",value:function(){this.refreshFrameNode.fire()}},{key:"sortAllGroups",value:function(){for(var e in this.toSortSet)this.toSortSet[e].sortIfNeed()}},{key:"testComponents",value:function(e){for(var t in e.removedSet)this.visions.includes(t)&&(this.toHideSet[t]=e.removedSet[t].value);if(this.isCameraUpdated)sh(this.screen.scene,this.screenState,this.refreshComponent,this.removeComponent),this.isCameraUpdated=!1;else for(var n in this.toTestAppearSet){var r=this.toTestAppearSet[n];r.treeNode.parent&&ch(r,this.screenState,this.refreshComponent,this.removeComponent)}}},{key:"commitVisibleAndDecorateDiff",value:function(e){var t=[],n=[],r=[];for(var i in this.toShowSet){var a=this.toShowSet[i],o=a.vision,s=a.component.treeNode;e.addedSet[i]||t.push(s),this.visions.bindVision(s,o)}for(var c in this.toMoveSet){var u=this.toMoveSet[c],l=u.vision,h=u.component.treeNode;this.visions.bindVision(h,l)}for(var d in this.toHideSet){var p=this.toHideSet[d].treeNode;e.removedSet[d]||n.push(p),this.visions.unbindVision(d)}for(var f in e.addedSet)this.visions.includes(f)||r.push(f);return e.decorate({insertToAdded:t,insertToRemoved:n,maskAdded:r})}},{key:"notify",value:function(e,t){var n={};for(var r in this.toMoveSet)n[r]=this.toMoveSet[r].component;for(var i in this.toUpdateSet)this.visions.includes(i)||delete this.toUpdateSet[i];for(var a in this.toTestVisibleSet)this.visions.includes(a)||delete this.toTestVisibleSet[a];this.notifier.flush({context:this.screen.context,camera:this.screenState.camera,diff:e,isTransition:t,moveSet:n,testSet:this.toTestVisibleSet,updateSet:this.toUpdateSet,screenSize:Object.freeze({width:this.screen.width,height:this.screen.height})})}},{key:"cleanSet",value:function(){this.toTestVisibleSet={},this.toUpdateSet={},mu(this.toTestAppearSet)&&(this.toTestAppearSet={}),mu(this.toSortSet)&&(this.toSortSet={}),mu(this.toMoveSet)&&(this.toMoveSet={}),mu(this.toShowSet)&&(this.toShowSet={}),mu(this.toHideSet)&&(this.toHideSet={})}}]),e}(),yh=function(){function e(t){M(this,e),this.context=null,this.screen=t.screen,this.engines=t.engines,this.onRenderDuration=t.onRenderDuration,this.visions=new il,this._wrappedComponents=Object.freeze(C(t.wrappedComponents))}return O(e,[{key:"hitTest",value:function(e,t){var n=this,r=[];if(this.context){var i=t/this.screen.camera.scale;this.context.visibleTestNode.forEachVisibleComponent((function(t){n.isHitComponent(t,e,i)&&r.push(t.id)}))}return r.reverse()}},{key:"findComponentWithTarget",value:function(e){if(this.context)return this.context.visibleTestNode.findComponentWithTarget(e)}},{key:"willInterruptEvent",value:function(e,t){return!!this.context&&this.context.visibleTestNode.willInterruptEvent(e,t)}},{key:"refreshScreenRendererState",value:function(e){var t;null==(t=this.context)||t.visibleTestNode.renderer.setState(e)}},{key:"refreshScreenContext",value:function(){this.context&&this.context.visibleTestNode.refreshScreenContext()}},{key:"isHitComponent",value:function(e,t,n){var r=t.x,i=t.y,a=vh(e,this.screen.camera.scale),o=Math.max(a.left,n),s=Math.max(a.right,n),c=Math.max(a.top,n),u=Math.max(a.bottom,n),l=e.originX-o,h=e.originY-c,d=e.width+o+s,p=e.height+c+u;return!!eh.testPoint(l,h,d,p,r,i)&&e.definition.hitTest(this.screen,e,r,i,n)}},{key:"divElement",get:function(){return this.context&&this.context.divElement},set:function(e){e!==(this.context&&this.context.divElement)&&(this.context&&(this.context.visibleTestNode.release(),(0,Wc.unmountComponentAtNode)(this.context.divElement)),e?this.context=Object.freeze({divElement:e,visibleTestNode:new gh({screen:this.screen,engines:this.engines,visions:this.visions,onRenderDuration:this.onRenderDuration})}):(this.visions.clean(),this.context=null),this.refreshScreenRender())}},{key:"wrappedComponents",get:function(){return this._wrappedComponents},set:function(e){this._wrappedComponents!==e&&(this._wrappedComponents=Object.freeze(C(e)),this.refreshScreenRender())}},{key:"refreshScreenRender",value:function(){if(this.context){var e=(0,Vc.createElement)(this.context.visibleTestNode.renderer.getRender()),t=Jl(this._wrappedComponents,e);(0,Wc.render)(t,this.context.divElement)}}}]),e}(),bh=function(){function e(t){var n=this;M(this,e),this.screenUpdatedDispatcher=new hl,this.cameraUpdatedDispatcher=new hl,this.renderErrorCatchedDispatcher=new hl,this.sizeUpdatedDispatcher=new hl,this.centerX=0,this.centerY=0,this.scale=1,this.adaptedRectangle=null,this.dispatchUpdatedEvent=function(e,t){var r=n.convertVisionRectangle(e,n._width,n._height);n.screenUpdatedDispatcher.dispatch({width:n._width,height:n._height,camera:e,visionRectangle:r,isTransition:t}),n.cameraUpdatedDispatcher.dispatch(e)},this.onResize=function(e){var t=e[0];if(t){var r=t.contentRect,i=r.width,a=r.height;n.refreshSize(i,a)}},this.deviceType=t.scene.deviceType,this.scene=t.scene,this._className=t.className,this._style=t.style,this._context=t.context,this._width=t.width,this._height=t.height,this.cameraAnimation=new ql(this.camera,this.dispatchUpdatedEvent),this.eventInterrupter=t.eventInterrupter,this.onRenderDuration=t.onRenderDuration,this.updater=new yh({screen:this,engines:t.engines,wrappedComponents:t.wrappedComponents,onRenderDuration:t.onRenderDuration}),t.autoResize&&(this.resizeObserver=new Fc.default(this.onResize))}return O(e,[{key:"className",get:function(){return this._className},set:function(e){this._className!==e&&(this._className=e,this.updater.refreshScreenRendererState({className:e}))}},{key:"style",get:function(){return this._style},set:function(e){this._style!==e&&(this._style=e,this.updater.refreshScreenRendererState({style:e}))}},{key:"wrappedComponents",get:function(){return this.updater.wrappedComponents},set:function(e){this.updater.wrappedComponents=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){return this.updater.divElement},set:function(e){var t=this.updater.divElement;if(t!==e){if(this.resizeObserver&&t&&this.resizeObserver.unobserve(t),this.updater.divElement=e,e){var n=e.clientWidth,r=e.clientHeight;this.refreshSize(n,r),this.resizeObserver&&this.resizeObserver.observe(e)}this._eventProxy&&this._eventProxy.bindDivElement(e)}}},{key:"eventProxy",get:function(){return this._eventProxy||(this._eventProxy=new kl(this,this.eventInterrupter),this._eventProxy.bindDivElement(this.divElement)),this._eventProxy}},{key:"context",get:function(){return this._context},set:function(e){this._context!==e&&(this._context=e,this.updater.refreshScreenContext())}},{key:"bounding",get:function(){if(this.divElement){var e=this.divElement.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}}return{left:0,right:0,top:0,bottom:0,width:0,height:0}}},{key:"bindCameraman",value:function(e){return new Rl(this,this.eventProxy,e)}},{key:"convertPointToScreen",value:function(e,t){return{x:(e-this.centerX)*this.scale+this._width/2,y:(t-this.centerY)*this.scale+this._height/2}}},{key:"convertPointToScene",value:function(e,t){return{x:(e-this._width/2)/this.scale+this.centerX,y:(t-this._height/2)/this.scale+this.centerY}}},{key:"cameraWithAdaptRectangle",value:function(e,t){var n=e.originX+e.width/2,r=e.originY+e.height/2,i=this._width/e.width,a=this._height/e.height;switch((Number.isNaN(i)||i<=0)&&(i=1),(Number.isNaN(a)||a<=0)&&(a=1),t){case jh.Centering:return{centerX:n,centerY:r,scale:Math.min(i,a)};case jh.Tailor:return{centerX:n,centerY:r,scale:Math.max(i,a)};default:throw new Error("invalid adapter mode ".concat(t))}}},{key:"adaptRectangle",value:function(e){if(0===e.width||0===e.height)this.transformCamera({animationMode:e.animationMode,centerX:e.originX+e.width/2,centerY:e.originY+e.height/2,scale:1});else{var t=eu($c({},this.cameraWithAdaptRectangle(e,e.adapterMode)),{animationMode:e.animationMode});this.setCameraTransfrom(t,!1),this.adaptedRectangle=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height,adapterMode:e.adapterMode})}}},{key:"transformCamera",value:function(e){this.adaptedRectangle=null,this.setCameraTransfrom(e,!1)}},{key:"setTransition",value:function(e){e!==this.cameraAnimation.isTransition&&this.updateCameraAnimation(this.camera,Uh.Immediately,e)}},{key:"setCameraTransfrom",value:function(e,t){var n=Yu(e.centerX,this.centerX),r=Yu(e.centerY,this.centerY),i=Yu(e.scale,this.scale);(n!==this.centerX||r!==this.centerY||i!==this.scale||t!==this.cameraAnimation.isTransition)&&(this.centerX=n,this.centerY=r,this.scale=i,this.updateCameraAnimation(this.camera,e.animationMode,t))}},{key:"updateCameraAnimation",value:function(e,t,n){switch(t){case Uh.Immediately:this.dispatchUpdatedEvent(e,n),this.cameraAnimation.moveToRightNow(e,n);break;case Uh.Continuous:this.cameraAnimation.moveTo(e,n)}}},{key:"camera",get:function(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}}},{key:"visionRectangle",get:function(){return this.convertVisionRectangle(this.camera,this._width,this._height)}},{key:"willInterruptEvent",value:function(e,t){return this.updater.willInterruptEvent(e,t)}},{key:"convertVisionRectangle",value:function(e,t,n){var r=t/e.scale,i=n/e.scale;return{originX:e.centerX-r/2,originY:e.centerY-i/2,width:r,height:i}}},{key:"hitTest",value:function(e,t,n){return this.updater.hitTest(this.convertPointToScene(e,t),n)}},{key:"findComponentWithTarget",value:function(e){return this.updater.findComponentWithTarget(e)}},{key:"renderScreenshot",value:function(e){var t=Gu(e.camera,Object.freeze(this.camera)),n=Gu(e.width,this._width),r=Gu(e.height,this._height),i=new il;return mh(i,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,n,r)}),new th({visions:i,tree:this.scene.tree,screen:this,initCamera:t,engines:this.updater.engines,onRenderDuration:this.onRenderDuration}).render(this.updater.wrappedComponents)}},{key:"resize",value:function(){if(this.divElement&&!this.resizeObserver){var e=this.divElement;this.refreshSize(e.clientWidth,e.clientHeight)}}},{key:"refreshSize",value:function(e,t){var n;this._width===e&&this._height===t||(this._width=e,this._height=t,n=this.adaptedRectangle?this.cameraWithAdaptRectangle(this.adaptedRectangle,this.adaptedRectangle.adapterMode):this.camera,this.setCameraTransfrom(eu($c({},n),{animationMode:Uh.Immediately}),!1),this.dispatchUpdatedEvent(n,!1),this.sizeUpdatedDispatcher.dispatch({width:e,height:t}))}},{key:"addCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.addListener(e)}},{key:"removeCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.removeListener(e)}},{key:"addRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.addListener(e)}},{key:"removeRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.removeListener(e)}},{key:"addSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.addListener(e)}},{key:"removeSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.removeListener(e)}},{key:"addScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.addListener(e)}},{key:"removeScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.removeListener(e)}},{key:"layoutComponentWithTarget",value:function(e){var t=this.findComponentWithTarget(e);if(t)return{componentId:t.component.id,layout:t.engine.orderIndex}}}]),e}();function kh(e,t,n){var r=t,i=e.orderIndex,a=function(e){m(a,e);var n=y(a);function a(){return M(this,a),n.apply(this,arguments)}return O(a,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.margin,a=e.origin,o=e.size,s=e.scale,c=e.payload,u=e.context,l=e.cnode;return(0,_c.createElement)(r,{id:t,layout:i,margin:n,origin:a,size:o,scale:s,payload:c,context:u,cnode:l})}}],[{key:"willInterruptEvent",value:function(e,n,r){return"function"==typeof t.willInterruptEvent?t.willInterruptEvent(e,n,i,r):"boolean"==typeof t.willInterruptEvent&&t.willInterruptEvent}}]),a}(_c.Component);return a.isVisible=n,a}var wh,Sh=function(){function e(t){M(this,e),this.definitionNodes=[];var n,r={},i={},a=E(C(t).sort((function(e,t){return e.layout-t.layout})));try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this.createEngine(o);o.renderMode===Wh.Screen&&(i[s.id]=!0),r[s.id]=s}}catch(e){a.e(e)}finally{a.f()}this.engines=Object.freeze($c({},r)),this.absoluteCoordinatesSet=Object.freeze($c({},i))}return O(e,[{key:"createEngine",value:function(e){var t,n=e.layout,r=e.kind,i=e.renderMode,a=e.className,o=e.style;switch(r){case Vh.HTML:case Vh.SVG:t=nl({orderIndex:n,fixedSize:i===Wh.AbsoluteSize,isSVG:r===Vh.SVG,className:a,style:o});break;case Vh.CANVAS:t=Qu({orderIndex:n,fixedSize:!0});break;default:throw new Error("invalid kind ".concat(r))}return t}},{key:"adaptComponentConstructor",value:function(e){if(e.definition)return e;var t=e,n=this.findDefinitionNode(t).definition,r=this.checkIsAbsoluteCoordinates(t);return{id:t.id,definition:n,originX:t.originX,originY:t.originY,width:t.width,height:t.height,parallaxMargin:t.parallaxMargin,sceneMargin:t.sceneMargin,disableVisionTrim:t.disableVisionTrim,absoluteCoordinates:r,payload:t.payload,orderIndex:t.orderIndex}}},{key:"checkIsAbsoluteCoordinates",value:function(e){for(var t in e.render.layouts){var n=this.findEngineWithLayout(parseInt(t,10));if(n)return!!this.absoluteCoordinatesSet[n.id]}return!1}},{key:"findDefinitionNode",value:function(e){var t,n=null,r=E(this.definitionNodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.render===e.render){n=i;break}}}catch(e){r.e(e)}finally{r.f()}return n||(n=Object.freeze({definition:this.createDefinition(e),render:e.render,painter:e.painter}),this.definitionNodes.push(n)),n}},{key:"createDefinition",value:function(e){var t,n=e.render,r=new Eh({name:n.name||"ComponentDefinition",hitTest:null==(t=n.hitTest)?void 0:t.bind(n)});for(var i in n.layouts){var a=this.findEngineWithLayout(parseInt(i,10)),o=n.layouts[i].isVisible;a instanceof tl&&a.bind(r)(kh(a,n,o))}return r}},{key:"findEngineWithLayout",value:function(e){for(var t in this.engines)if(this.engines[t].orderIndex===e)return this.engines[t];return null}}]),e}();!function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.VisibleUpdated=2]="VisibleUpdated",e[e.AppearUpdated=3]="AppearUpdated",e[e.PropertiesUpdated=4]="PropertiesUpdated"}(wh||(wh={}));var xh=Object.freeze({left:0,right:0,top:0,bottom:0}),Ih=new Zl({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0}),Ch=function(){function e(t,n,r){var i=this;M(this,e),this.onRemovedDispatcher=new hl,this.onRectangleUpdatedDispatcher=new hl,this.onRectanglePointUpdate=function(){i.reporter.update(i,wh.AppearUpdated),i.onRectangleUpdatedDispatcher.dispatch(i)},this.reporter=t,this.id=n.id||(0,Gc.v4)().replace(/-/g,""),this.treeNode=r,this._parallaxMargin=Mh(n.parallaxMargin),this._sceneMargin=Mh(n.sceneMargin),this.disableVisionTrim=!!n.disableVisionTrim,this.absoluteCoordinates=!!n.absoluteCoordinates,this._orderIndex=n.orderIndex,this.rectangleTarget={originX:Ph(n.originX),originY:Ph(n.originY),width:Ph(n.width),height:Ph(n.height)};var a=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];this.rectangleAnimation=Ih.create(Xl.ComponentMoving,a,this.onRectanglePointUpdate)}return O(e,[{key:"originX",get:function(){return this.rectangleAnimation.point[0]}},{key:"originY",get:function(){return this.rectangleAnimation.point[1]}},{key:"width",get:function(){return this.rectangleAnimation.point[2]}},{key:"height",get:function(){return this.rectangleAnimation.point[3]}},{key:"parallaxMargin",get:function(){return this._parallaxMargin}},{key:"sceneMargin",get:function(){return this._sceneMargin}},{key:"orderIndex",get:function(){return this._orderIndex},set:function(e){if(e!==this._orderIndex){var t=this.treeNode.parent.value;this._orderIndex=e,t.reportChildOrderUpdate()}}},{key:"moveTo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uh.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.syncRectangleTarget(n))}},{key:"resize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uh.Immediately;(this.rectangleTarget.width!==e||this.rectangleTarget.height!==t)&&(this.rectangleTarget.width=e,this.rectangleTarget.height=t,this.syncRectangleTarget(n))}},{key:"setRectangle",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Uh.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t||this.rectangleTarget.width!==n||this.rectangleTarget.height!==r)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.rectangleTarget.width=n,this.rectangleTarget.height=r,this.syncRectangleTarget(i))}},{key:"syncRectangleTarget",value:function(e){var t=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];switch(e){case Uh.Immediately:this.rectangleAnimation.moveRightNow(t),this.reporter.update(this,wh.AppearUpdated);break;case Uh.Continuous:this.rectangleAnimation.moveTo(t)}}},{key:"setParallaxMargin",value:function(e){Th(this._parallaxMargin,e)||(this._parallaxMargin=Mh(e),this.reporter.update(this,wh.AppearUpdated))}},{key:"setSceneMargin",value:function(e){Th(this._sceneMargin,e)||(this._sceneMargin=Mh(e),this.reporter.update(this,wh.AppearUpdated))}},{key:"release",value:function(){this.rectangleAnimation.stop(),this.onRemovedDispatcher.dispatch(this)}},{key:"addRemovedListener",value:function(e){this.onRemovedDispatcher.addListener(e)}},{key:"removeRemovedListener",value:function(e){this.onRemovedDispatcher.removeListener(e)}},{key:"addRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.addListener(e)}},{key:"removeRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.removeListener(e)}}]),e}();function Ph(e){return"number"==typeof e?e:0}function Mh(e){return void 0===e||0===e?xh:"number"==typeof e?Object.freeze({left:e,right:e,top:e,bottom:e}):Object.freeze($c({},e))}function Th(e,t){return void 0===t?0===e.top&&0===e.left&&0===e.right&&0===e.bottom:"number"==typeof t?e.top===t&&e.left===t&&e.right===t&&e.bottom===t:e.top===t.top&&e.left===t.left&&e.right===t.right&&e.bottom===t.bottom}var Oh=function(e){m(n,e);var t=y(n);function n(e,r,i,a){var o;return M(this,n),(o=t.call(this,e,a,i)).group=new Rh(e,r,i),o._scale=Gu(a.scale,1),o}return O(n,[{key:"kind",get:function(){return Dh.Group}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e)}},{key:"components",get:function(){return this.group.components}},{key:"removeComponent",value:function(e){return this.group.removeComponent(e)}},{key:"reportChildOrderUpdate",value:function(){this.group.reportChildOrderUpdate()}},{key:"addComponent",value:function(e){return this.group.addComponent(e)}},{key:"addComponentGroup",value:function(e){return this.group.addComponentGroup(e)}}]),n}(Ch),Eh=function(){function e(t){if(M(this,e),this.engineNodes={},this.enginesCache=null,this.id="".concat(e.nextId),this.name=t.name,e.nextId+=1,"boolean"==typeof t.hitTest){var n=t.hitTest;this.hitTest=function(){return n}}else t.hitTest?this.hitTest=t.hitTest:this.hitTest=function(){return!0}}return O(e,[{key:"engines",get:function(){if(!this.enginesCache){var e=[],t=[];for(var n in this.engineNodes){var r=this.engineNodes[n].engine;void 0===r.orderIndex?t.push(r):e.push(r)}e.sort((function(e,t){return e.orderIndex-t.orderIndex})),this.enginesCache=Object.freeze([].concat(e,t))}return this.enginesCache}},{key:"addEngine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.enginesCache)throw new Error("definition is frozon. you can only do it before bind with screen");if(!(e instanceof nu))throw new Error("it is not RenderEngine");this.engineNodes[e.id]=Object.freeze({engine:e,options:Object.freeze({isVisible:Gu(t.isVisible,!0)})})}},{key:"options",value:function(e){var t;return null==(t=this.engineNodes[e.id])?void 0:t.options}}]),e}();Eh.nextId=0;var Ah,Nh=function(e){m(n,e);var t=y(n);function n(e,r,i){var a;if(M(this,n),(a=t.call(this,e,r,i)).visibleMap={},a.visibleCount=0,!(r.definition instanceof Eh))throw new Error("it is not ComponentDefinition");a.definition=r.definition,a._payload=r.payload;var o,s=E(a.definition.engines);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=a.definition.options(c).isVisible;u&&(a.visibleCount+=1),a.visibleMap[c.id]=u}}catch(e){s.e(e)}finally{s.f()}return a}return O(n,[{key:"kind",get:function(){return Dh.Component}},{key:"payload",get:function(){return this._payload},set:function(e){e!==this._payload&&(this._payload=e,this.reporter.update(this,wh.PropertiesUpdated))}},{key:"isVisible",value:function(e){return"number"==typeof e?this.visibleMap[e]||!1:e?this.visibleMap[e.id]||!1:this.visibleCount>0}},{key:"setVisible",value:function(e,t){var n;if(n="number"==typeof e?"".concat(e):e.id,void 0!==this.visibleMap[n]&&this.visibleMap[n]!==t){var r=0===this.visibleCount;this.visibleMap[n]=t,t?this.visibleCount+=1:this.visibleCount-=1,r===(0===this.visibleCount)?this.reporter.update(this,wh.VisibleUpdated):this.reporter.update(this,wh.AppearUpdated)}}}]),n}(Ch),Rh=function(){function e(t,n,r){M(this,e),this.shouldSort=!1,this.reporter=t,this.tree=n,this.treeNode=r}return O(e,[{key:"components",get:function(){this.sortIfNeed();var e,t=[],n=E(this.treeNode);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.value)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"reportChildOrderUpdate",value:function(){this.shouldSort=!0,this.reporter.sortGroup(this)}},{key:"sortIfNeed",value:function(){this.shouldSort&&(this.shouldSort=!1,this.tree.sort(this.treeNode,(function(e,t){var n=e.value.orderIndex,r=t.value.orderIndex;return void 0!==n&&void 0!==r?n-r:void 0!==n?-1:void 0!==r?1:e.id.localeCompare(t.id)})))}},{key:"removeComponent",value:function(e){return this.treeNode===e.treeNode.parent&&(this.tree.remove(e.treeNode),this.reporter.update(e,wh.Removed),e.release(),!0)}},{key:"addComponent",value:function(e){var t=this.tree.wrapLeaf(),n=new Nh(this.reporter,e,t);return this.addNode(t,n)}},{key:"addComponentGroup",value:function(e){var t=this.tree.wrapGroup(),n=new Oh(this.reporter,this.tree,t,e);return this.addNode(t,n)}},{key:"addNode",value:function(e,t){return e.value=t,this.tree.append(e,this.treeNode),this.reporter.update(t,wh.Added),t}}]),e}(),Lh=function(e){m(n,e);var t=y(n);function n(e,r,i,a,o){var s;return M(this,n),(s=t.call(this,a,o,o.root)).componentUpdateDispatcher=new hl,s.groupSortedDispatcher=new hl,s.deviceType=e,s.logger=r,s.legacy=i,s}return O(n,[{key:"createScreen",value:function(e){return new bh({scene:this,context:e.context,className:e.className,autoResize:!!e.autoResize,width:Yu(e.width,0),height:Yu(e.height,0),engines:this.collectEngines(e),eventInterrupter:e.eventInterrupter||function(){return!1},wrappedComponents:e.wrappedComponents||[],onRenderDuration:e.onRenderDuration})}},{key:"collectEngines",value:function(e){var t;if(e.engines){t={};var n,r=E(e.engines);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i instanceof nu))throw new Error("it is not RenderEngine");t[i.id]=i}}catch(e){r.e(e)}finally{r.f()}}else t=this.legacy.engines;var a=[],o=[];for(var s in t){var c=t[s];void 0===c.orderIndex?o.push(c):a.push(c)}return Object.freeze([].concat(a,o))}},{key:"getEngineWithLegacyLayout",value:function(e){for(var t in this.legacy.engines){var n=this.legacy.engines[t];if(n.orderIndex===e)return n}}},{key:"addComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.addListener(e)}},{key:"removeComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.removeListener(e)}},{key:"reportComponentUpdate",value:function(e,t){this.componentUpdateDispatcher.dispatch({node:e,behavior:t})}},{key:"addGroupSortedListener",value:function(e){this.groupSortedDispatcher.addListener(e)}},{key:"removeGroupSortedListener",value:function(e){this.groupSortedDispatcher.removeListener(e)}}],[{key:"create",value:function(e,t,r){var i,a=new Cu,o={update:function(e,t){return i.reportComponentUpdate(e,t)},sortGroup:function(e){return i.groupSortedDispatcher.dispatch(e)}};return i=new n(e,t,r,o,a),a.root.value=i,i}}]),n}(Rh);!function(e){e.Desktop="desktop",e.Touch="touch",e.Surface="surface"}(Ah||(Ah={}));var jh,Dh,zh,Fh,Bh,Uh,Vh,Wh,Hh=function(){function e(t){M(this,e),this.deviceType=t}return O(e,[{key:"createScene",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.createDefaultLogger();return Lh.create(this.deviceType,t,new Sh([]))}},{key:"createSceneWithLegacyLayoutDescriptions",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.createDefaultLogger();return Lh.create(this.deviceType,n,new Sh(t))}}],[{key:"createDefaultLogger",value:function(){return Ic(new Sc)}}]),e}();function _h(e){return new Eh(e)}function Gh(e,t,n){return e+(t-e)*n}function Yh(e,t){var n=Math.sqrt(e*e+t*t);return 0===n?{x:1,y:0}:{x:e/n,y:t/n}}function Xh(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}!function(e){e.Centering="centering",e.Tailor="tailor"}(jh||(jh={})),function(e){e[e.Group=0]="Group",e[e.Component=1]="Component"}(Dh||(Dh={})),function(e){e[e.Unchanged=0]="Unchanged",e[e.Overlay=1]="Overlay",e[e.Changed=2]="Changed"}(zh||(zh={})),function(e){e[e.Directly=0]="Directly",e[e.GenerateCache=1]="GenerateCache",e[e.Overlay=2]="Overlay",e[e.OverlayOnCache=3]="OverlayOnCache"}(Fh||(Fh={})),function(e){e.Begin="Begin",e.End="End"}(Bh||(Bh={})),function(e){e.Continuous="continuous",e.Immediately="immediately"}(Uh||(Uh={})),function(e){e[e.HTML=0]="HTML",e[e.SVG=1]="SVG",e[e.CANVAS=2]="CANVAS"}(Vh||(Vh={})),function(e){e[e.AbsoluteSize=0]="AbsoluteSize",e[e.RelativeSize=1]="RelativeSize",e[e.Screen=2]="Screen"}(Wh||(Wh={}));var Qh=W(n("Pzfo")),Zh=W(n("NbXW")),Kh=W(n("q1tI")),qh={};V(qh,{EmuToPt:function(){return Pv},EmuToPx:function(){return Mv},RenderMode:function(){return jy},Slide:function(){return By},disabelAutoPlayKey:function(){return zy},loadPPT:function(){return Pb},mainSequenceEventSourceId:function(){return Ry},playLastStepKey:function(){return Fy},previewPPT:function(){return Db},sequenceIndexesKey:function(){return Dy},toNumber:function(){return Rv},toPt:function(){return Av}});var Jh,$h,ed=W(n("q1tI")),td=W(n("uhBA")),nd=W(n("q1tI")),rd=W(n("aSns")),id=W(n("6aUW")),ad=W(n("q1tI")),od=W(n("q1tI")),sd=W(n("q1tI")),cd=W(n("q1tI")),ud=W(n("q1tI")),ld=W(n("/OGU")),hd=Object.defineProperty,dd=Object.defineProperties,pd=Object.getOwnPropertyDescriptors,fd=Object.getOwnPropertySymbols,vd=Object.prototype.hasOwnProperty,md=Object.prototype.propertyIsEnumerable,gd=function(e,t,n){return t in e?hd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},yd=function(e,t){for(var n in t||(t={}))vd.call(t,n)&&gd(e,n,t[n]);if(fd){var r,i=E(fd(t));try{for(i.s();!(r=i.n()).done;){n=r.value;md.call(t,n)&&gd(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},bd=function(e,t){return dd(e,pd(t))};($h=Jh||(Jh={}))[$h.Cmd=1]="Cmd",$h[$h.State=2]="State";var kd=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i;M(this,e),this.players=[],this._playerID=n,this.players=r,this.effectType=a,this.repeat=Math.max.apply(Math,C(r.map((function(e){return e.repeat}))).concat([1])),this.duration=Math.max.apply(Math,C(r.map((function(e){return e.duration}))).concat([0])),this.delay=r.length>0?Math.min.apply(Math,C(r.map((function(e){return e.delay})))):0}return O(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"progressTime",get:function(){return Math.max.apply(Math,C(this.players.map((function(e){return e.progressTime}))||0))}},{key:"isPlaying",get:function(){return this.players.some((function(e){return e.isPlaying}))}},{key:"isComplete",get:function(){return this.players.every((function(e){return e.isComplete}))}},{key:"play",value:function(){this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"seek",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.seek(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].seek(e)}},{key:"onFrame",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.onFrame(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(e)}},{key:"reset",value:function(){for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}},{key:"stop",value:function(){this.players.forEach((function(e){return e.stop()}))}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}}]),e}(),wd=function(){return(wd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Sd(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}var xd=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},Id=function(e){return e%1?Number(e.toFixed(5)):e},Cd=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,Pd={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},Md=wd(wd({},Pd),{transform:xd(0,1)}),Td=wd(wd({},Pd),{default:1}),Od=function(e){return{test:function(t){return"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},Ed=Od("deg"),Ad=Od("%"),Nd=Od("px"),Rd=wd(wd({},Ad),{parse:function(e){return Ad.parse(e)/100},transform:function(e){return Ad.transform(100*e)}}),Ld=xd(0,255),jd=function(e){return void 0!==e.red},Dd=function(e){return void 0!==e.hue},zd=function(e){return function(t){if("string"!=typeof t)return t;for(var n={},r=(a=t,a.substring(a.indexOf("(")+1,a.lastIndexOf(")"))).replace(/(,|\/)/g," ").split(/ \s*/),i=0;i<4;i++)n[e[i]]=void 0!==r[i]?parseFloat(r[i]):1;var a;return n}},Fd=wd(wd({},Pd),{transform:function(e){return Math.round(Ld(e))}});function Bd(e,t){return e.startsWith(t)&&Cd.test(e)}var Ud,Vd={test:function(e){return"string"==typeof e?Bd(e,"rgb"):jd(e)},parse:zd(["red","green","blue","alpha"]),transform:function(e){var t,n,r=e.red,i=e.green,a=e.blue,o=e.alpha,s=void 0===o?1:o;return"rgba("+(t={red:Fd.transform(r),green:Fd.transform(i),blue:Fd.transform(a),alpha:Id(Md.transform(s))}).red+", "+t.green+", "+t.blue+", "+(void 0===(n=t.alpha)?1:n)+")"}},Wd={test:function(e){return"string"==typeof e?Bd(e,"hsl"):Dd(e)},parse:zd(["hue","saturation","lightness","alpha"]),transform:function(e){var t,n,r=e.hue,i=e.saturation,a=e.lightness,o=e.alpha,s=void 0===o?1:o;return"hsla("+(t={hue:Math.round(r),saturation:Ad.transform(Id(i)),lightness:Ad.transform(Id(a)),alpha:Id(Md.transform(s))}).hue+", "+t.saturation+", "+t.lightness+", "+(void 0===(n=t.alpha)?1:n)+")"}},Hd=wd(wd({},Vd),{test:function(e){return"string"==typeof e&&Bd(e,"#")},parse:function(e){var t="",n="",r="";return e.length>4?(t=e.substr(1,2),n=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),n=e.substr(2,1),r=e.substr(3,1),t+=t,n+=n,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:1}}}),_d={test:function(e){return"string"==typeof e&&Cd.test(e)||jd(e)||Dd(e)},parse:function(e){return Vd.test(e)?Vd.parse(e):Wd.test(e)?Wd.parse(e):Hd.test(e)?Hd.parse(e):e},transform:function(e){return jd(e)?Vd.transform(e):Dd(e)?Wd.transform(e):e}},Gd=function(e){return e},Yd=(Ud=function(e,t,n){return Math.min(Math.max(n,e),t)},function(e,t,n){return void 0!==n?Ud(e,t,n):function(n){return Ud(e,t,n)}});Yd(0,1);var Xd="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},Qd="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout((function(){return e(Xd())}),16.666666666666668)},Zd=!0,Kd=!1,qd=!1,Jd={delta:0,timestamp:0},$d=["read","update","preRender","render","postRender"],ep=$d.reduce((function(e,t){var n,r,i,a,o,s,c;return e[t]=(n=function(){return Kd=!0},r=[],i=[],a=0,o=!1,s=new WeakSet,c={schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var c=n&&o,u=c?r:i;return t&&s.add(e),-1===u.indexOf(e)&&(u.push(e),c&&o&&(a=r.length)),e},cancel:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1),s.delete(e)},process:function(e){var t;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(var u=0;u<a;u++){var l=r[u];l(e),s.has(l)&&(c.schedule(l),n())}o=!1}}),e}),{}),tp=$d.reduce((function(e,t){var n=ep[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),Kd||ap(),n.schedule(e,t,r)},e}),{}),np=$d.reduce((function(e,t){return e[t]=ep[t].cancel,e}),{}),rp=function(e){return ep[e].process(Jd)},ip=function e(t){Kd=!1,Jd.delta=Zd?16.666666666666668:Math.max(Math.min(t-Jd.timestamp,40),1),Jd.timestamp=t,qd=!0,$d.forEach(rp),qd=!1,Kd&&(Zd=!1,Qd(e))},ap=function(){Kd=!0,Zd=!0,qd||Qd(ip)},op=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i,o=t.repeat,s=t.rewind,c=void 0!==s&&s,u=t.reverse,l=void 0!==u&&u,h=t.delay,d=void 0===h?0:h;M(this,e),this.players=[],this.progressTime=0,this.loopCount=0,this.elapsed=0,this._playerID=n,this.players=r,this.effectType=a,this.roundDuration=Math.max.apply(Math,C(r.map((function(e){return e.duration}))).concat([0])),this.repeat=null!=o?Math.max(1,o):Math.max.apply(Math,C(r.map((function(e){return e.repeat}))).concat([1])),this.rewind=c,this.reverse=l,this.delay=d,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat}return O(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par-plus[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.frameProcess=tp.update((function(t){var n=t.delta;if(e.progressTime+=n,!(e.progressTime<=e.delay)&&(e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration)){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(np.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this.progressTime;this.progressTime=Yd(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].seek(r);else t<e&&this.players.forEach((function(e){return e.seek(r)}))}},{key:"onFrame",value:function(e){var t=this.progressTime;this.progressTime=Yd(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].onFrame(r);else t<e&&this.players.forEach((function(e){return e.onFrame(r)}))}},{key:"reset",value:function(){if(this.progressTime>0){this.pause(),this.loopCount=0,this.elapsed=0,this.progressTime=0;for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=this;if(this.reverse&&this.loopCount%2!=0)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(this.roundDuration-this.elapsed);else this.players.forEach((function(t){return t.onFrame(e.elapsed)}))}}]),e}(),sp=function(){function e(t){var n,r,i=t.playerID,a=t.players,o=t.effectType,s=void 0===o?"clickEffect":o;M(this,e),this.players=[],this.index=0,this.progressTime=0,this._playerIndex=0,this.elapsed=0,this._playerID=i,this.players=a,this.effectType=s,this.duration=a.reduce((function(e,t){return e+t.duration}),0),this.delay=null!=(r=null==(n=this.players[0])?void 0:n.delay)?r:0,this.blocks=[],this.indexBlocks=[];for(var c=0;c<this.players.length;c++)0!==c&&"clickEffect"!==this.players[c].effectType||this.blocks.push(c),this.indexBlocks.push(this.blocks.length-1)}return O(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="seq[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"length",get:function(){return this.blocks.length}},{key:"currentPlayer",get:function(){return this.players[this._playerIndex]}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.index>=this.blocks.length}},{key:"repeat",get:function(){var e,t;return null!=(t=null==(e=this.currentPlayer)?void 0:e.repeat)?t:1}},{key:"play",value:function(){var e=this;!this.currentPlayer||this.isPlaying||this.isComplete||(this.currentPlayer.play(),this.frameProcess=tp.update((function(t){var n,r=t.delta,i=e.currentPlayer;if(i){if(e.elapsed+=r,e.progressTime+=r,i.isPlaying||i.play(),e.elapsed>i.duration){e._playerIndex<e.players.length&&(e._playerIndex+=1,e.elapsed=0,e.index=null!=(n=e.indexBlocks[e._playerIndex])?n:e.blocks.length);var a=e.players[e._playerIndex];if(a&&"clickEffect"!==a.effectType)return void a.play();e.stopTimer()}}else e.stopTimer()}),!0))}},{key:"pause",value:function(){var e;null==(e=this.currentPlayer)||e.pause(),this.stopTimer()}},{key:"seek",value:function(e){var t,n;if(e>this.duration){this.pause();for(var r=this._playerIndex;r<this.players.length;r++){var i=this.players[r];i.seek(i.duration)}this.progressTime=this.duration,this.elapsed=0,this._playerIndex=this.players.length,this.index=this.blocks.length}this.progressTime=Yd(0,this.duration,e),this.elapsed=this.progressTime;for(var a=0;a<this.players.length;){var o=this.players[a];if(this.elapsed<=o.duration)break;this.elapsed-=o.duration,a++}if(this._playerIndex<a){for(var s=this._playerIndex;s<a;s++){var c=this.players[s];!Number.isFinite(c.repeat)&&c.isPlaying||c.seek(c.duration)}null==(t=this.players[a])||t.seek(this.elapsed)}else if(this._playerIndex>a)for(var u=this.safePlayerIndex(this._playerIndex);u>=a;u--){var l=this.players[u];u===a?(l.pause(),l.seek(this.elapsed)):l.reset()}this._playerIndex=a,this.index=null!=(n=this.indexBlocks[this._playerIndex])?n:this.blocks.length}},{key:"onFrame",value:function(e){throw new Error("onFrame not implemented in seq player")}},{key:"reset",value:function(){if(this.progressTime>0&&this.players.length>0)for(var e=this.safePlayerIndex(this._playerIndex);e>=0;e--)this.players[e].reset();this._playerIndex=0,this.index=0,this.progressTime=0,this.elapsed=0}},{key:"stop",value:function(){this.pause(),this.seek(this.duration+1)}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}},{key:"seekIndex",value:function(e){var t;this.seekPlayerIndex(null!=(t=this.blocks[e])?t:this.players.length)}},{key:"next",value:function(){this.elapsed>0&&this.seekIndex(this.index+1),this.play()}},{key:"back",value:function(){this.pause(),this.progressTime<=0||(this.seekIndex(this.elapsed>0?this.index:this.index-1),this.pause())}},{key:"stopTimer",value:function(){this.frameProcess&&(np.update(this.frameProcess),this.frameProcess=void 0)}},{key:"safePlayerIndex",value:function(e){return Math.min(e,this.players.length-1)}},{key:"seekPlayerIndex",value:function(e){var t;if(e=Yd(0,this.players.length,e),this._playerIndex<e)for(var n=this._playerIndex;n<e;n++)this.players[n].stopFinite();else for(var r=this.safePlayerIndex(this._playerIndex);r>=e;r--)this.players[r].reset();this.progressTime=this.getProgressTimeByPlayerIndex(e),this._playerIndex=e,this.index=null!=(t=this.indexBlocks[e])?t:this.blocks.length,this.elapsed=0}},{key:"getProgressTimeByPlayerIndex",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.players[n].duration;return t}}]),e}();function cp(e,t,n){return(t-e)*n+e}var up={exports:{}},lp={exports:{}},hp=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},dp=Array.prototype.concat,pp=Array.prototype.slice,fp=lp.exports=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];hp(i)?t=dp.call(t,pp.call(i)):t.push(i)}return t};fp.wrap=function(e){return function(){return e(fp(arguments))}};var vp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},mp=lp.exports,gp={};for(var yp in vp)vp.hasOwnProperty(yp)&&(gp[vp[yp]]=yp);var bp=up.exports={to:{},get:{}};function kp(e,t,n){return Math.min(Math.max(t,e),n)}function wp(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}bp.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=bp.get.hsl(e),n="hsl";break;case"hwb":t=bp.get.hwb(e),n="hwb";break;default:t=bp.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},bp.get.rgb=function(e){if(!e)return null;var t,n,r,i=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],n=0;n<3;n++){var a=2*n;i[n]=parseInt(t.slice(a,a+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],n=0;n<3;n++)i[n]=parseInt(t[n]+t[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)i[n]=parseInt(t[n+1],0);t[4]&&(i[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(i=vp[t[1]])?(i[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(i[3]=parseFloat(t[4]))}for(n=0;n<3;n++)i[n]=kp(i[n],0,255);return i[3]=kp(i[3],0,1),i},bp.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,kp(parseFloat(t[2]),0,100),kp(parseFloat(t[3]),0,100),kp(isNaN(n)?1:n,0,1)]}return null},bp.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,kp(parseFloat(t[2]),0,100),kp(parseFloat(t[3]),0,100),kp(isNaN(n)?1:n,0,1)]}return null},bp.to.hex=function(){var e=mp(arguments);return"#"+wp(e[0])+wp(e[1])+wp(e[2])+(e[3]<1?wp(Math.round(255*e[3])):"")},bp.to.rgb=function(){var e=mp(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},bp.to.rgb.percent=function(){var e=mp(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+r+"%)":"rgba("+t+"%, "+n+"%, "+r+"%, "+e[3]+")"},bp.to.hsl=function(){var e=mp(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},bp.to.hwb=function(){var e=mp(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},bp.to.keyword=function(e){return gp[e.slice(0,3)]};var Sp,xp,Ip=up.exports;(xp=Sp||(Sp={}))[xp.RGB=0]="RGB",xp[xp.HSL=1]="HSL";var Cp=function(){function e(t){M(this,e),this.animBox=t,this.$=1}return O(e,[{key:"snapshot",get:function(){if(!this._snapshot){var e=this;this._snapshot={$ppt_x:this.animBox.initState.ppt_x,$ppt_y:this.animBox.initState.ppt_y,$ppt_w:this.animBox.initState.ppt_w,$ppt_h:this.animBox.initState.ppt_h,ppt_x:Number(e.animBox.currentState.ppt_x),ppt_y:Number(e.animBox.currentState.ppt_y),ppt_w:Number(e.animBox.currentState.ppt_w),ppt_h:Number(e.animBox.currentState.ppt_h),get $(){return e.$}}}return this._snapshot}}]),e}(),Pp=function(){function e(t,n){M(this,e),this.expr=t,this.scope=n}return O(e,[{key:"valueOf",value:function(){var e;return null!=(e=this.value)?e:this.evaluate(1)}},{key:"evaluate",value:function(e){this.scope.$=e;try{return this.value=this.formula.evaluate(this.scope.snapshot),this.value}catch(t){return console.error(t),e}}},{key:"formula",get:function(){if(!this._formula)try{this._formula=(0,ld.compile)(this.expr.replace(/#/g,"$"))}catch(e){console.error(e),this._formula={evaluate:function(e){return e}}}return this._formula}}]),e}(),Mp=Object.prototype.hasOwnProperty;function Tp(e,t){return Mp.call(e,t)}function Op(e){return e instanceof Pp||"number"==typeof e&&!Number.isNaN(e)}function Ep(e){return e/12700+"pt"}var Ap=function(){function e(t){if(M(this,e),"string"==typeof t){var n=Ip.get(t);if(n){var r=n.model,i=n.value;switch(r){case"hsl":return this.model=Sp.HSL,void(this._hslCache={h:i[0],s:i[1],l:i[2],a:i[3]});case"rgb":return this.model=Sp.RGB,void(this._rgbCache={r:i[0],g:i[1],b:i[2],a:i[3]})}}}else{if(function(e){return!!(e&&Tp(e,"r")&&Tp(e,"g")&&Tp(e,"b")&&Tp(e,"a"))}(t))return this.model=Sp.RGB,this._rgbCache=t,void(this._hslCache=void 0);if(function(e){return!!(e&&Tp(e,"h")&&Tp(e,"s")&&Tp(e,"l")&&Tp(e,"a"))}(t))return this.model=Sp.HSL,this._hslCache=t,void(this._rgbCache=void 0)}throw new TypeError("[Animatic] incorrect color: ".concat(t))}return O(e,[{key:"rgb",get:function(){if(!this._rgbCache){if(!this._hslCache)throw new Error("[Animatic] No color available");this._rgbCache=this.hslToRgb(this._hslCache)}return this._rgbCache}},{key:"hsl",get:function(){if(!this._hslCache){if(!this._rgbCache)throw new Error("[Animatic] No color available");this._hslCache=this.rbgToHsl(this._rgbCache)}return this._hslCache}},{key:"toString",value:function(){if(this.model===Sp.HSL){var e=this.hsl,t=e.h,n=e.s,r=e.l,i=e.a;return"hsla(".concat(t,",").concat(n,",").concat(r,",").concat(i,")")}var a=this.rgb,o=a.r,s=a.g,c=a.b,u=a.a;return"rgba(".concat(o,",").concat(s,",").concat(c,",").concat(u,")")}},{key:"lighten",value:function(t){var n=this.hsl;return new e(bd(yd({},n),{l:Yd(0,100,n.l*(1+t))}))}},{key:"darken",value:function(t){var n=this.hsl;return new e(bd(yd({},n),{l:Yd(0,100,n.l*(1-t))}))}},{key:"alpha",value:function(t){var n=this.model===Sp.HSL?this.hsl:this.rgb;if(null==t)return n.a;var r=Yd(0,1,t);return r===n.a?this:new e(bd(yd({},n),{a:r}))}},{key:"rbgToHsl",value:function(e){var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=a-i,s=0;a===i?s=0:t===a?s=(n-r)/o:n===a?s=2+(r-t)/o:r===a&&(s=4+(t-n)/o),(s=Math.min(60*s,360))<0&&(s+=360);var c=(i+a)/2;return{h:s,s:100*(a===i?0:c<=.5?o/(a+i):o/(2-a-i)),l:100*c,a:e.a}}},{key:"hslToRgb",value:function(e){var t=e.s/100,n=e.l/100;if(0===t){var r=255*n;return{r:r,g:r,b:r,a:e.a}}for(var i,a,o,s=e.h/360,c=2*n-(i=n<.5?n*(1+t):n+t-n*t),u=[0,0,0],l=0;l<3;l++)(a=s+1/3*-(l-1))<0&&a++,a>1&&a--,o=6*a<1?c+6*(i-c)*a:2*a<1?i:3*a<2?c+(i-c)*(2/3-a)*6:c,u[l]=255*o;return{r:u[0],g:u[1],b:u[2],a:e.a}}}]),e}();function Np(e,t,n){if(e.model===Sp.HSL||t.model===Sp.HSL){var r=e.hsl,i=t.hsl;return new Ap({h:cp(r.h,i.h,n),s:cp(r.s,i.s,n),l:cp(r.l,i.l,n),a:cp(r.a,i.a,n)})}var a=e.rgb,o=t.rgb;return new Ap({r:Rp(a.r,o.r,n),g:Rp(a.g,o.g,n),b:Rp(a.b,o.b,n),a:cp(a.a,o.a,n)})}function Rp(e,t,n){var r=e*e,i=t*t;return Math.sqrt(Math.max(0,n*(i-r)+r))}function Lp(e,t){var n=Object.keys(t),r=n.reduce((function(n,r){switch(r){case"visible":var i=e[r],a=t[r];n[r]=function(e){return e<=0?i:a};break;case"fillcolor":var o=e[r],s=t[r];if(!o||!s)throw new Error("Mismatch color animation (Key: ".concat(r,", From: ").concat(o,", To: ").concat(s,")"));n[r]=function(e){return Np(o,s,e)};break;default:var c=e[r],u=t[r];if(!Op(c)||!Op(u))throw new Error("Mismatch number animation (Key: ".concat(r,", From: ").concat(c,", To: ").concat(u,")"));n[r]=function(e){return cp(c,u,e)}}return n}),{});return function(e){return n.reduce((function(t,n){var i,a=null==(i=r[n])?void 0:i.call(r,e);return null!=a&&(t[n]=a),t}),{})}}function jp(e,t){var n;return function(r){return n||(n=Lp(e(),t)),n(r)}}var Dp=function(){function e(t){var n=t.animBox,r=t.eventSource,i=t.playerID,a=t.effectType,o=void 0===a?"clickEffect":a,s=t.duration,c=t.transform,u=t.ease,l=void 0===u?Gd:u,h=t.repeat,d=void 0===h?0:h,p=t.rewind,f=void 0!==p&&p,v=t.reverse,m=void 0!==v&&v,g=t.delay,y=void 0===g?0:g,b=t.by,k=void 0!==b&&b;M(this,e),this.progressTime=0,this.loopCount=0,this.fvTime=0,this.elapsed=0,this.animBox=n,this.eventSource=r,this.playerID=i,this.effectType=o,this.roundDuration=s,this.ease=l,this.repeat=Math.max(1,d),this.rewind=f,this.reverse=m,this.delay=y,this.by=k,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat,this.transform=function(e,t){return function(n){return t(e(n))}}(l,null!=c?c:this.noopTransform)}return O(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.preAnimationState||(this.preAnimationState=yd({},this.animBox.currentPureState)),this.frameProcess=tp.update((function(t){var n=t.delta;if(e.progressTime+=n,e.progressTime<=e.delay)e.fvTime=0;else if(e.fvTime<=0&&(e.fvTime=Date.now()),e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(np.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this;this.preAnimationState||(this.preAnimationState=yd({},this.animBox.currentPureState)),e<=0&&(this.fvTime=0),this.progressTime=Yd(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1),tp.update((function(){return t.update()}),!1,!1)}},{key:"onFrame",value:function(e){if(e<=0){if(this.progressTime<=0)return;this.fvTime=0}if(!(e>=this.duration&&this.progressTime>=this.duration)){if(this.preAnimationState||(this.preAnimationState=yd({},this.animBox.currentPureState)),this.progressTime=Yd(0,this.duration,e),this.progressTime<=this.delay)return this.loopCount=0,this.elapsed=0,void(this.by&&this.update());this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.reverse?this.elapsed=(this.progressTime-this.delay)%this.roundDuration:this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1,this.update()}}},{key:"reset",value:function(){var e=this;this.progressTime>0&&(this.pause(),this.loopCount=0,this.fvTime=0,this.elapsed=0,this.progressTime=0),this.preAnimationState&&tp.update((function(){e.preAnimationState&&(e.animBox.resetState(e.playerID,e.preAnimationState),e.preAnimationState=void 0)}),!1,!1)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=Yd(0,1,this.elapsed/this.roundDuration),t=this.transform(this.reverse&&this.loopCount%2!=0?1-e:e);null!=t&&this.animBox.handleStateEvent({type:Jh.State,playerID:this.playerID,srcID:this.eventSource,by:this.by,fvTime:this.fvTime,value:t})}},{key:"noopTransform",value:function(){return{}}}]),e}(),zp=function(){function e(t){var n=t.cmd,r=t.animBox,i=t.eventSource,a=t.playerID,o=t.effectType,s=void 0===o?"clickEffect":o,c=t.rewind,u=void 0!==c&&c,l=t.delay,h=void 0===l?0:l;M(this,e),this.repeat=1,this.progressTime=0,this.fvTime=0,this.cmd=n,this.animBox=r,this.eventSource=i,this.playerID=a,this.effectType=s,this.rewind=u,this.delay=h,this.duration=this.delay+1}return O(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;if(!this.isPlaying&&!this.isComplete)return 1===this.duration?(this.progressTime=1,void tp.update((function(){return e.sendEvent()}),!1,!1)):void(this.frameProcess=tp.update((function(t){var n=t.delta;e.progressTime+=n,e.progressTime<=e.delay?e.fvTime=0:(e.fvTime<=0&&(e.fvTime=Date.now()),e.sendEvent(),e.pause())}),!0))}},{key:"pause",value:function(){this.frameProcess&&(np.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){e<=0&&(this.fvTime=0),this.progressTime=Yd(0,this.duration,e),e<=0&&"pause"!==this.cmd.name&&"stop"!==this.cmd.name&&this.animBox.handleCmdEvent({type:Jh.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:Date.now(),value:{name:"pause"}})}},{key:"onFrame",value:function(e){e<=0&&(this.fvTime=0,this.progressTime<=0)||e>=this.duration&&this.progressTime>=this.duration||(this.progressTime=Yd(0,this.duration,e),this.progressTime>=this.delay&&this.sendEvent())}},{key:"reset",value:function(){this.progressTime>0&&(this.pause(),this.fvTime=0,this.progressTime=0)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"sendEvent",value:function(){this.animBox.handleCmdEvent({type:Jh.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:this.fvTime,value:this.cmd})}}]),e}();function Fp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;if(e.model===Sp.HSL&&e.model===t.model){var r=e.hsl,i=t.hsl,a=r.h,o=i.h;return new Ap({h:a+n*(o>a&&o-a>180?o-(a+360):o<a&&a-o>180?o+360-a:o-a),s:r.s+n*(i.s-r.s),l:r.l+n*(i.l-r.l),a:r.a*n+i.a*(1-n)})}var s=e.rgb,c=t.rgb,u=2*n-1,l=s.a-c.a,h=((u*l==-1?u:(u+l)/(1+u*l))+1)/2,d=1-h;return new Ap({r:h*s.r+d*c.r,g:h*s.g+d*c.g,b:h*s.b+d*c.b,a:s.a*n+c.a*(1-n)})}var Bp,Up=new Ap({r:0,g:0,b:0,a:0}),Vp=0,Wp="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),n=Math.max(0,16.7-(t-Vp));Vp=t+n,setTimeout((function(){return e(Vp)}),n)},Hp=1/60*1e3,_p=!0,Gp=!1,Yp=!1,Xp={delta:0,timestamp:0},Qp=["read","update","preRender","render","postRender"],Zp=function(e){return Gp=e},Kp=Qp.reduce((function(e,t){var n,r,i,a,o,s,c,u,l;return e[t]=(n=Zp,r=[],i=[],a=0,o=!1,s=0,c=new WeakSet,u=new WeakSet,l={cancel:function(e){var t=i.indexOf(e);c.add(e),-1!==t&&i.splice(t,1)},process:function(e){var t,h;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(s=0;s<a;s++)(h=r[s])(e),!0!==u.has(h)||c.has(h)||(l.schedule(h),n(!0));o=!1},schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var s=n&&o,l=s?r:i;c.delete(e),t&&u.add(e),-1===l.indexOf(e)&&(l.push(e),s&&(a=r.length))}}),e}),{}),qp=Qp.reduce((function(e,t){var n=Kp[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),Gp||ef(),n.schedule(e,t,r),e},e}),{}),Jp=function(e){return Kp[e].process(Xp)},$p=function e(t){Gp=!1,Xp.delta=_p?Hp:Math.max(Math.min(t-Xp.timestamp,40),1),_p||(Hp=Xp.delta),Xp.timestamp=t,Yp=!0,Qp.forEach(Jp),Yp=!1,Gp&&(_p=!1,Wp(e))},ef=function(){Gp=!0,_p=!0,Yp||Wp($p)},tf=function(e){var t=e.onRead,n=e.onRender,r=e.uncachedValues,i=void 0===r?new Set:r,a=e.useCache,o=void 0===a||a;return function(e){void 0===e&&(e={});var r=Sd(e,[]),a={},s=[],c=!1;function u(e,t){e.startsWith("--")&&(r.hasCSSVariable=!0);var n=a[e];a[e]=t,a[e]!==n&&(-1===s.indexOf(e)&&s.push(e),c||(c=!0,qp.render(l.render)))}var l={get:function(e,n){return void 0===n&&(n=!1),n||!o||i.has(e)||void 0===a[e]?t(e,r):a[e]},set:function(e,t){if("string"==typeof e)u(e,t);else for(var n in e)u(n,e[n]);return this},render:function(e){return void 0===e&&(e=!1),(c||!0===e)&&(n(a,r,s),c=!1,s.length=0),this}};return l}},nf=/([a-z])([A-Z])/g,rf=function(e){return e.replace(nf,"$1-$2").toLowerCase()},af=new Map,of=new Map,sf=["Webkit","Moz","O","ms",""],cf=sf.length,uf="undefined"!=typeof document,lf=function(e,t){return of.set(e,rf(t))},hf=function(e,t){void 0===t&&(t=!1);var n,r=t?of:af;return r.has(e)||(uf?function(e){Bp=Bp||document.createElement("div");for(var t=0;t<cf;t++){var n=sf[t],r=""===n,i=r?e:n+e.charAt(0).toUpperCase()+e.slice(1);if(i in Bp.style||r){if(r&&"clipPath"===e&&of.has(e))return;af.set(e,i),lf(e,(r?"":"-")+rf(i))}}}(e):lf(n=e,n)),r.get(e)||e},df=["","X","Y","Z"],pf=["translate","scale","rotate","skew","transformPerspective"].reduce((function(e,t){return df.reduce((function(e,n){return e.push(t+n),e}),e)}),["x","y","z"]),ff=pf.reduce((function(e,t){return e[t]=!0,e}),{});function vf(e){return!0===ff[e]}function mf(e,t){return pf.indexOf(e)-pf.indexOf(t)}var gf=new Set(["originX","originY","originZ"]);function yf(e){return gf.has(e)}var bf=wd(wd({},Pd),{transform:Math.round}),kf={color:_d,backgroundColor:_d,outlineColor:_d,fill:_d,stroke:_d,borderColor:_d,borderTopColor:_d,borderRightColor:_d,borderBottomColor:_d,borderLeftColor:_d,borderWidth:Nd,borderTopWidth:Nd,borderRightWidth:Nd,borderBottomWidth:Nd,borderLeftWidth:Nd,borderRadius:Nd,radius:Nd,borderTopLeftRadius:Nd,borderTopRightRadius:Nd,borderBottomRightRadius:Nd,borderBottomLeftRadius:Nd,width:Nd,maxWidth:Nd,height:Nd,maxHeight:Nd,size:Nd,top:Nd,right:Nd,bottom:Nd,left:Nd,padding:Nd,paddingTop:Nd,paddingRight:Nd,paddingBottom:Nd,paddingLeft:Nd,margin:Nd,marginTop:Nd,marginRight:Nd,marginBottom:Nd,marginLeft:Nd,rotate:Ed,rotateX:Ed,rotateY:Ed,rotateZ:Ed,scale:Td,scaleX:Td,scaleY:Td,scaleZ:Td,skew:Ed,skewX:Ed,skewY:Ed,distance:Nd,translateX:Nd,translateY:Nd,translateZ:Nd,x:Nd,y:Nd,z:Nd,perspective:Nd,opacity:Md,originX:Rd,originY:Rd,originZ:Nd,zIndex:bf,fillOpacity:Md,strokeOpacity:Md,numOctaves:bf},wf=function(e){return kf[e]},Sf=function(e,t){return t&&"number"==typeof e?t.transform(e):e},xf=new Set(["scrollLeft","scrollTop"]),If=new Set(["scrollLeft","scrollTop","transform"]),Cf={x:"translateX",y:"translateY",z:"translateZ"};function Pf(e){return"function"==typeof e}function Mf(e){var t=void 0===e?{}:e,n=t.enableHardwareAcceleration,r=void 0===n||n,i=t.isDashCase,a=void 0===i||i,o=t.allowTransformNone,s=void 0===o||o,c={},u={},l={},h=[];return function(e){return h.length=0,function(e,t,n,r,i,a,o,s){void 0===t&&(t=!0),void 0===n&&(n={}),void 0===r&&(r={}),void 0===i&&(i={}),void 0===a&&(a=[]),void 0===o&&(o=!1),void 0===s&&(s=!0);var c=!0,u=!1,l=!1;for(var h in e){var d=e[h],p=wf(h),f=Sf(d,p);vf(h)?(u=!0,r[h]=f,a.push(h),c&&(p.default&&d!==p.default||!p.default&&0!==d)&&(c=!1)):yf(h)?(i[h]=f,l=!0):If.has(h)&&Pf(f)||(n[hf(h,o)]=f)}(u||"function"==typeof e.transform)&&(n.transform=function(e,t,n,r,i,a){void 0===a&&(a=!0);var o="",s=!1;n.sort(mf);for(var c=n.length,u=0;u<c;u++){var l=n[u];o+=(Cf[l]||l)+"("+t[l]+") ",s="z"===l||s}return!s&&i?o+="translateZ(0)":o=o.trim(),Pf(e.transform)?o=e.transform(t,r?"":o):a&&r&&(o="none"),o}(e,r,a,c,t,s)),l&&(n.transformOrigin=(i.originX||"50%")+" "+(i.originY||"50%")+" "+(i.originZ||0))}(e,r,c,u,l,h,a,s),c}}var Tf=tf({onRead:function(e,t){var n=t.element,r=t.preparseOutput,i=wf(e);if(vf(e))return i&&i.default||0;if(xf.has(e))return n[e];var a=window.getComputedStyle(n,null).getPropertyValue(hf(e,!0))||0;return r&&i&&i.test(a)&&i.parse?i.parse(a):a},onRender:function(e,t,n){var r=t.element,i=t.buildStyles,a=t.hasCSSVariable;if(Object.assign(r.style,i(e)),a)for(var o=n.length,s=0;s<o;s++){var c=n[s];c.startsWith("--")&&r.style.setProperty(c,e[c])}-1!==n.indexOf("scrollLeft")&&(r.scrollLeft=e.scrollLeft),-1!==n.indexOf("scrollTop")&&(r.scrollTop=e.scrollTop)},uncachedValues:xf}),Of=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),Ef=function(e,t){return Nd.transform(e*t)},Af={x:0,y:0,width:0,height:0};function Nf(e,t,n){return"string"==typeof e?e:Nd.transform(t+n*e)}var Rf={enableHardwareAcceleration:!1,isDashCase:!1};function Lf(e,t,n){void 0===n&&(n=!0);var r={style:{}},i=Mf(Rf);return function(a){return function(e,t,n,r,i,a){void 0===t&&(t=Af),void 0===r&&(r=Mf(Rf)),void 0===i&&(i={style:{}}),void 0===a&&(a=!0);var o,s,c=e.attrX,u=e.attrY,l=e.originX,h=e.originY,d=e.pathLength,p=e.pathSpacing,f=void 0===p?1:p,v=e.pathOffset,m=void 0===v?0:v,g=r(Sd(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]));for(var y in g)"transform"===y?i.style.transform=g[y]:i[a&&!Of.has(y)?rf(y):y]=g[y];return(void 0!==l||void 0!==h||g.transform)&&(i.style.transformOrigin=(s=void 0!==h?h:.5,Nf(void 0!==l?l:.5,(o=t).x,o.width)+" "+Nf(s,o.y,o.height))),void 0!==c&&(i.x=c),void 0!==u&&(i.y=u),void 0!==n&&void 0!==d&&(i[a?"stroke-dashoffset":"strokeDashoffset"]=Ef(-m,n),i[a?"stroke-dasharray":"strokeDasharray"]=Ef(d,n)+" "+Ef(f,n)),i}(a,e,t,i,r,n)}}var jf,Df,zf=tf({onRead:function(e,t){var n=t.element;if(vf(e=Of.has(e)?e:rf(e))){var r=wf(e);return r&&r.default||0}return n.getAttribute(e)},onRender:function(e,t){var n=t.element,r=(0,t.buildAttrs)(e);for(var i in r)"style"===i?Object.assign(n.style,r.style):n.setAttribute(i,r[i])}}),Ff=tf({useCache:!1,onRead:function(e){return"scrollTop"===e?window.pageYOffset:window.pageXOffset},onRender:function(e){var t=e.scrollTop,n=void 0===t?0:t,r=e.scrollLeft,i=void 0===r?0:r;return window.scrollTo(i,n)}}),Bf=new WeakMap;function Uf(e,t){return n="string"==typeof e?document.querySelector(e):e,r=t,Bf.has(n)?Bf.get(n):function(e,t){var n,r,i,a,o;return e===window?n=Ff(e):(o=e)instanceof HTMLElement||"function"==typeof o.click?n=function(e,t){void 0===t&&(t={});var n=t.enableHardwareAcceleration,r=t.allowTransformNone,i=Sd(t,["enableHardwareAcceleration","allowTransformNone"]);return Tf(wd({element:e,buildStyles:Mf({enableHardwareAcceleration:n,allowTransformNone:r}),preparseOutput:!0},i))}(e,t):function(e){return e instanceof SVGElement||"ownerSVGElement"in e}(e)&&(i=function(e){try{return"function"==typeof(t=e).getBBox?t.getBBox():t.getBoundingClientRect()}catch(t){return{x:0,y:0,width:0,height:0}}var t}(r=e),a=function(e){return"path"===e.tagName}(r)&&r.getTotalLength?r.getTotalLength():void 0,n=zf({element:r,buildAttrs:Lf(i,a)})),Bf.set(e,n),n}(n,r);var n,r}function Vf(e){switch(e){case"rotate":case"scaleX":case"scaleY":case"fillcolor":return!0;default:return!1}}(Df=jf||(jf={})).Paragraph="anim-p",Df.Text="anim-t";var Wf=function(){function e(t){var n=this,r=t.target,i=t.pIndex,a=t.tIndex,o=t.constants,s=t.initState,c=void 0===s?{}:s,u=t.applyStyles;M(this,e),this.handleStateEvent=function(e){var t=e.playerID,r=e.by,i=e.value,a=Object.keys(i).filter((function(e){return null!=i[e]}));if(r){var o=n.byStates.get(t);o||(o={},n.byStates.set(t,o));var s,c=E(a);try{for(c.s();!(s=c.n()).done;){var u=s.value;Vf(u)?(o[u]=i[u],n.currentState[u]=n.currentPureState[u]):(n.currentState[u]=i[u],n.currentPureState[u]=i[u])}}catch(e){c.e(e)}finally{c.f()}}else{n.lastStateEvent=e;var l,h=E(a);try{for(h.s();!(l=h.n()).done;){var d=l.value;n.currentState[d]=i[d],n.currentPureState[d]=i[d]}}catch(e){h.e(e)}finally{h.f()}}var p,f=E(n.byStates.values());try{for(f.s();!(p=f.n()).done;){var v,m=p.value,g=E(a);try{for(g.s();!(v=g.n()).done;){var y=v.value;n.mergeByStates(y,m)}}catch(e){g.e(e)}finally{g.f()}}}catch(e){f.e(e)}finally{f.f()}n.applyStyles(n.convertStyles(n.currentState))},this.handleCmdEvent=function(e){n.lastCmdEvent=e,"playFrom"===e.value.name?null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:1,stop:0},"*"):"playSF"===e.value.name?null==window||window.postMessage({type:"_playSoundEffect",targetID:n.target,soundEffectId:e.value.value},"*"):null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:0,stop:1},"*")},this.byStates=new Map,this.target=r,this.pIndex=i,this.tIndex=a,this.constants=o,this.withSubElem=null!=this.pIndex||null!=this.tIndex;var l=o.x,h=o.y,d=o.slideWidth,p=o.slideHeight,f=o.width,v=o.height;this.initState=bd(yd({scaleX:1,scaleY:1,rotate:0,opacity:1,xshear:0,yshear:0,fillcolor:Up,visible:!0},c),{ppt_x:l/d,ppt_y:h/p,ppt_w:f/d,ppt_h:v/p}),this.currentState=yd({},this.initState),this.currentPureState=yd({},this.initState),u&&(this.applyStyles=u)}return O(e,[{key:"resetState",value:function(e,t){this.lastStateEvent=void 0,this.lastCmdEvent=void 0,this.byStates.delete(e),Object.assign(this.currentPureState,t),Object.assign(this.currentState,this.currentPureState);var n,r=E(this.byStates.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;for(var a in i)this.mergeByStates(a,i)}}catch(e){r.e(e)}finally{r.f()}this.applyStyles(this.convertStyles(this.currentState))}},{key:"applyStyles",value:function(e){var t=this.getStyler();t&&t.set(e)}},{key:"applyPreAnimation",value:function(){this.preAnimationState&&this.applyStyles(this.convertStyles(this.preAnimationState))}},{key:"preAnimation",value:function(e){if(!e)return this.preAnimationState;this.preAnimationState||(this.preAnimationState={});for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=e[r];null!=i&&(this.preAnimationState[r]=i,this.currentState[r]=i,this.currentPureState[r]=i)}}},{key:"clearCache",value:function(){this._styler=void 0}},{key:"mergeByStates",value:function(e,t){var n,r,i,a,o,s;switch(e){case"rotate":this.currentState.rotate=(null!=(n=this.currentState.rotate)?n:0)+(null!=(r=t.rotate)?r:0);break;case"scaleX":this.currentState.scaleX=(null!=(i=this.currentState.scaleX)?i:1)*(null!=(a=t.scaleX)?a:1);break;case"scaleY":this.currentState.scaleY=(null!=(o=this.currentState.scaleY)?o:1)*(null!=(s=t.scaleY)?s:1);break;case"fillcolor":this.currentState.fillcolor&&t.fillcolor?this.currentState.fillcolor=Fp(this.currentState.fillcolor,t.fillcolor):t.fillcolor&&(this.currentState.fillcolor=t.fillcolor)}}},{key:"convertStyles",value:function(e){var t,n,r,i,a,o,s,c,u={},l=this.constants,h=l.x,d=l.y,p=l.width,f=l.height,v=l.slideWidth,m=l.slideHeight;for(var g in e)if(Tp(e,g))switch(g){case"ppt_x":var y=(null!=(t=e.ppt_x)?t:this.currentState.ppt_x)*v-h;u.translateX=Ep(this.withSubElem?y/this.initState.ppt_x:y);break;case"ppt_y":var b=(null!=(n=e.ppt_y)?n:this.currentState.ppt_y)*m-d;u.translateY=Ep(this.withSubElem?b/this.initState.ppt_y:b);break;case"scaleX":var k=null!=(r=e.scaleX)?r:1,w=this.currentState.ppt_w;u.scaleX=k*w*v/p;break;case"ppt_w":var S=null!=(i=this.currentState.scaleX)?i:1,x=null!=(a=e.ppt_w)?a:this.currentState.ppt_w;u.scaleX=S*x*v/p;break;case"scaleY":var I=null!=(o=e.scaleY)?o:1,C=this.currentState.ppt_h;u.scaleY=I*C*m/f;break;case"ppt_h":var P=null!=(s=this.currentState.scaleY)?s:1,M=null!=(c=e.ppt_h)?c:this.currentState.ppt_h;u.scaleY=P*M*m/f;break;case"fillcolor":if(null!=e.fillcolor){var T=e.fillcolor.hsl;u["--sp-fill"]="hsla(".concat(T.h,",").concat(T.s,"%,").concat(T.l,"%,").concat(T.a,")"),u["--sp-fill-h"]=T.h,u["--sp-fill-s"]=T.s+"%",u["--sp-fill-l"]=T.l+"%",u["--sp-fill-a"]=T.a}break;case"visible":null!=e.visible&&(u.display=e.visible?null==this.tIndex?"block":"inline-block":"none");break;case"rotate":case"opacity":null!=e[g]&&(u[g]=Number(e[g]));break;case"xshear":null!=e.xshear&&(u.skewX=45*e.xshear);break;case"yshear":null!=e.yshear&&(u.skewY=45*e.yshear);break;default:null!=e[g]&&(u[g]=e[g])}return this.constants.flipH&&Tp(u,"scaleX")&&(u.scaleX*=-1),this.constants.flipV&&Tp(u,"scaleY")&&(u.scaleY*=-1),Tp(u,"rotate")&&(u.scaleX<0&&(u.rotate*=-1),u.scaleY<0&&(u.rotate*=-1)),u}},{key:"getStyler",value:function(){if(!this._styler){var e=document.getElementById(this.target);e&&null!=this.pIndex&&(e=e.querySelectorAll(".".concat(jf.Paragraph))[this.pIndex]),e&&null!=this.tIndex&&(e=e.querySelectorAll(".".concat(jf.Text))[this.tIndex]),e&&(this._styler=Uf(e))}return this._styler}}]),e}(),Hf={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(Hf);var _f=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.call(this)}return n}(Hf.exports),Gf=W(n("q1tI")),Yf=W(n("q1tI")),Xf=W(n("q1tI")),Qf=W(n("q1tI")),Zf=W(n("q1tI")),Kf=W(n("q1tI")),qf=W(n("q1tI")),Jf=W(n("q1tI")),$f=W(n("q1tI")),ev=W(n("q1tI")),tv=W(n("q1tI")),nv=W(n("q1tI")),rv=W(n("i8i4")),iv=W(n("q1tI")),av=W(n("q1tI")),ov=W(n("q1tI")),sv=W(n("q1tI")),cv=W(n("q1tI")),uv=W(n("aSns")),lv=W(n("tK0H")),hv=(W(n("/OGU")),W(n("/OGU")),W(n("aSns")),W(n("aSns")),W(n("q1tI"))),dv=W(n("i8i4")),pv=W(n("uhBA")),fv=W(n("q1tI")),vv=W(n("q1tI")),mv=W(n("q1tI")),gv=Object.defineProperty,yv=Object.defineProperties,bv=Object.getOwnPropertyDescriptors,kv=Object.getOwnPropertySymbols,wv=Object.prototype.hasOwnProperty,Sv=Object.prototype.propertyIsEnumerable,xv=function(e,t,n){return t in e?gv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Iv=function(e,t){for(var n in t||(t={}))wv.call(t,n)&&xv(e,n,t[n]);if(kv){var r,i=E(kv(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Sv.call(t,n)&&xv(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Cv=function(e,t){return yv(e,bv(t))},Pv=12700,Mv=9525,Tv=1e5,Ov=6e4;function Ev(e){if("number"==typeof e)return e/Tv;var t=e.endsWith("%");return parseFloat(e)/(t?100:Tv)}function Av(e){return"".concat(Rv(e)/Pv,"pt")}function Nv(e){return e/Ov}function Rv(e){return"string"==typeof e?parseFloat(e):e}function Lv(e){return.75*Rv(e)}function jv(e){return Rv(e)/.75}function Dv(e,t){var n=function(e){var t,n={},r=E(e);try{for(r.s();!(t=r.n()).done;){var i=t.value.name||"";if(i in n)return!0;n[i]=!0}}catch(e){r.e(e)}finally{r.f()}return!1}(e.elements)||t;if(e.elements.length>0){var r,i={},a=n&&e.elements.length>1,o=E(e.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=zv(s,a),u=Dv(s,t);void 0===s.text?i[c]=u:i[c]=Cv(Iv({},u),{body:s.text})}}catch(e){o.e(e)}finally{o.f()}return i}return null}function zv(e,t){var n=[];e.attr.forEach((function(t){var r=e.attr.getOptional(t);"string"==typeof r?n.push("".concat(t,"=").concat(JSON.stringify(r))):n.push("".concat(t,"=").concat(r))}));var r="";return t&&(r+="[".concat(e.index,"] ")),r+="<".concat(e.name),n.length>0&&(r+=" "+n.join(" ")),r+=">"}var Fv=function(){function e(t){M(this,e),this.tagName=t}return O(e,[{key:"get",value:function(e,t){return this.assignDefaultValue(e,this.getOptional(e),t)}},{key:"getString",value:function(e,t){return this.assignDefaultValue(e,this.getStringOptional(e),t)}},{key:"getNumber",value:function(e,t){return this.assignDefaultValue(e,this.getNumberOptional(e),t)}},{key:"getBoolean",value:function(e,t){return this.assignDefaultValue(e,this.getBooleanOptional(e),t)}},{key:"getColor",value:function(e,t){return this.assignDefaultValue(e,this.getColorOptional(e),t)}},{key:"getColorOptional",value:function(e){return this.getOptional(e)}},{key:"getStringOptional",value:function(e){var t=this.getOptional(e);return"number"==typeof t&&(t="".concat(t)),t}},{key:"getNumberOptional",value:function(e){var t=this.getOptional(e);if("string"!=typeof t||(t=parseInt(t,10),!Number.isNaN(t)))return t}},{key:"getBooleanOptional",value:function(e){var t=this.getOptional(e);return"true"===t||"1"===t||"on"===t?t=!0:"false"===t||"0"===t||"off"===t?t=!1:void 0!==t&&(t=!!t),t}},{key:"assignDefaultValue",value:function(e,t,n){var r=t;if(void 0===r&&(r=n),void 0===r)throw new Error("can't find attribute ".concat(JSON.stringify(e)," from ").concat(this.tagName));return r}}]),e}(),Bv=function(e){m(n,e);var t=y(n);function n(e){return M(this,n),t.call(this,e)}return O(n,[{key:"length",value:function(){return 0}},{key:"forEach",value:function(e){}},{key:"getOptional",value:function(e){}},{key:"has",value:function(e){return!1}}]),n}(Fv),Uv=function(e){m(n,e);var t=y(n);function n(e,r){var i;return M(this,n),(i=t.call(this,e)).attributes=r,i}return O(n,[{key:"length",value:function(){return Object.keys(this.attributes).length}},{key:"forEach",value:function(e){for(var t in this.attributes)e(t)}},{key:"has",value:function(e){return e in this.attributes}},{key:"getOptional",value:function(e){return this.attributes[e]}}]),n}(Fv),Vv=function(e){m(n,e);var t=y(n);function n(e,r,i){var a;return M(this,n),(a=t.call(this,e.name)).xml=e,a.picker=r,a.resourceType=i,a}return O(n,[{key:"length",value:function(){return-1}},{key:"forEach",value:function(e){void 0!==this.tagName&&this.picker.forEachAttributes(this.tagName,e)}},{key:"has",value:function(e){return void 0!==this.getOptional(e)}},{key:"getOptional",value:function(e){var t;return this.cachedValues&&e in this.cachedValues?t=this.cachedValues[e]:void 0!==this.tagName&&(this.cachedXMLMap||(this.cachedXMLMap={}),t=this.picker.getAttribute(this.tagName,e,this.xml,this.cachedXMLMap,this.resourceType),this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t),t}}]),n}(Fv),Wv=function(){function e(t,n){M(this,e),this.picker=n,this.resourceType=t}return O(e,[{key:"parse",value:function(e){return new _v(this.picker,null,0,(0,id.xml2js)(e,{compact:!1,captureSpacesBetweenElements:!0}),this.resourceType)}}]),e}(),Hv=function(){function e(){M(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.tagNames=n}return O(e,[{key:"execute",value:function(e){return void 0!==this.tagNames.find((function(t){return t===e}))}},{key:"toString",value:function(){return this.tagNames.join(" or ")}}]),e}(),_v=function(){function e(t,n,r,i,a){M(this,e),this.picker=t,this.parent=n,this.index=r,this.resourceType=a,this.name=i.name,this.type=i.type,this.attr=new Uv(this.name,Object.freeze(Iv({},i.attributes))),this.extraAttr=t?new Vv(this,t,a):new Bv(this.name);var o=[];if(i.elements)for(var s=0;s<i.elements.length;++s){var c=i.elements[s];"text"===c.type?this.text=c.text:o.push(new e(t,this,s,c,a))}this.elements=Object.freeze(o)}return O(e,[{key:"element",get:function(){return this.elements[0]}},{key:"displayer",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c({},zv(e,t),Dv(e,t))}(this,e)}},{key:"elementWithName",value:function(e){var t,n=E(this.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.name===e)return r}}catch(e){n.e(e)}finally{n.f()}}},{key:"extraElementWithName",value:function(e){if(this.picker&&this.name)return this.cachedXMLMap||(this.cachedXMLMap={}),this.picker.getChild(this.name,e,this,this.cachedXMLMap,this.resourceType)}},{key:"elementsWithName",value:function(e){var t,n=[],r=E(this.elements);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.name===e&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"childElementOptional",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i}},{key:"childElement",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i;"string"==typeof this.name&&t.unshift(this.name);var o=t.join(" -> "),s=t.findIndex((function(e){return e===i.name})),c=t.splice(s+1)[0],u=t.join(" -> ");throw new Error("can't find child ".concat(o,": lack of child ").concat(c," from ").concat(u))}},{key:"searchChildElement",value:function(e){for(var t=this,n=0;n<e.length;++n){var r,i=e[n],a=t,o=E(t.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value;if("string"==typeof i){if(s.name===i){t=s;break}}else if(i.execute(s.name)){t=s;break}}}catch(e){o.e(e)}finally{o.f()}if(a===t)return{xml:t,found:!1}}return{xml:t,found:!0}}},{key:"hasChildElementWithName",value:function(e){var t,n=E(this.elements);try{for(n.s();!(t=n.n()).done;){if(t.value.name===e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"parentElement",value:function(e){var t=this.parentElementOptional(e);if(t)return t;throw new Error("can't find parent ".concat(e," from ").concat(this.name))}},{key:"parentElementOptional",value:function(e){for(var t=this.parent;t;){if("string"==typeof e){if(t.name===e)return t}else if(e.execute(t.name))return t;t=t.parent}}}]),e}(),Gv={"Arial Rounded MT Bold":"https://convertcdn.netless.link/fonts/ArialRoundedMTBold.woff",Arial:"https://convertcdn.netless.link/fonts/arial.woff","Cooper Black":"https://convertcdn.netless.link/fonts/COOPBL.woff",Calibri:"https://convertcdn.netless.link/fonts/Calibri.woff","":"https://convertcdn.netless.link/fonts/msyh.woff","":"https://convertcdn.netless.link/fonts/HuaWenXinWei-1.woff","-":"https://convertcdn.netless.link/fonts/yuppy.woff","":"https://convertcdn.netless.link/fonts/simhei.woff","":"https://convertcdn.netless.link/fonts/simkai.woff",Heiti:"https://convertcdn.netless.link/fonts/simhei.woff",Aharoni:"https://convertcdn.netless.link/fonts/Aharoni.woff","Aharoni Bold":"https://convertcdn.netless.link/fonts/Aharoni%20Bold.woff","source-han-sans":"https://convertcdn.netless.link/fonts/simhei.woff"},Yv="netless-ppt-font-face";function Xv(e,t,n){if(document&&n){var r=document.getElementById("".concat(Yv,"-").concat(t));if(r)return;(r=document.createElement("style")).id="".concat(Yv,"-").concat(t),document.head.appendChild(r);var i=n.filter((function(e){return e.src})).map((function(n){var r=n.src.split("."),i=r[(null==r?void 0:r.length)-1],a={"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-family":'"'.concat(n.fontFamily,"-").concat(t,'"'),src:'url("'.concat(e,"/fonts/").concat(n.src,'") format("').concat(i,'")')};return JSON.parse(JSON.stringify(a))})).map((function(e){return"@font-face {".concat(Object.keys(e).reduce((function(t,n){return"".concat(t,"\n").concat(n,": ").concat(e[n],";")}),""),"}")}));r.innerHTML=i.join("\n")}}var Qv=new Map;function Zv(e,t){return Kv.apply(this,arguments)}function Kv(){return(Kv=I(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qv.has(t)||(Qv.set(t,!0),n&&n[t]?qv(t,n[t]).then((function(){}),(function(){})):n&&n["*"]?(qv(t,n["*"]).then((function(){}),(function(){})),qv(t,n["*-bold"],{weight:"500"}).then((function(){}),(function(){})),qv(t,n["*-italic"],{style:"italic"}).then((function(){}),(function(){})),qv(t,n["*-bold-italic"],{weight:"500",style:"italic"}).then((function(){}),(function(){}))):Gv[t]&&qv(t,Gv[t]).then((function(){}),(function(){})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qv(e,t,n){return Jv.apply(this,arguments)}function Jv(){return(Jv=I(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,!e.t0){e.next=7;break}return e.next=4,fetch(n,{cache:"force-cache"});case 4:return e.next=6,e.sent.arrayBuffer();case 6:i=e.sent;case 7:if(!i){e.next=20;break}return a=new FontFace(t,i,r),e.prev=9,e.next=12,a.load();case 12:document.fonts.add(a),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(9),console.error("".concat(t," load error font"),e.t1);case 18:e.next=21;break;case 20:Qv.delete(t);case 21:case"end":return e.stop()}}),e,null,[[9,15]])})))).apply(this,arguments)}function $v(e){var t=nm(e).childElementOptional("a:majorFont");return void 0===t?{}:tm(t)}function em(e){var t=nm(e).childElementOptional("a:minorFont");return void 0===t?{}:tm(t)}function tm(e){var t={},n=e.childElementOptional("a:latin"),r=e.childElementOptional("a:ea"),i=e.childElementOptional("a:cs");n&&(t.latin=""===n.attr.getString("typeface","")?[]:[n.attr.getString("typeface")]),r&&(t.ea=""===r.attr.getString("typeface","")?[]:[r.attr.getString("typeface")]),i&&(t.cs=""===i.attr.getString("typeface","")?[]:[i.attr.getString("typeface")]);var a=e.elementsWithName("a:font").filter((function(e){return["Hans","Hant","Jpan","Hang"].includes(e.attr.getString("script"))})).map((function(e){return e.attr.getString("typeface")}));return void 0!==t.ea?t.ea=t.ea.concat(a):t.ea=a,t}function nm(e){return e.theme.childElement("a:theme","a:themeElements","a:fontScheme")}function rm(e){var t=[];return void 0!==e.latin&&t.concat(e.latin),void 0!==e.ea&&t.concat(e.ea),void 0!==e.cs&&t.concat(e.cs),t}var im=["a:blipFill","a:gradFill","a:grpFill","a:noFill","a:pattFill","a:solidFill"],am=["a:hslClr","a:schemeClr","a:srgbClr","a:scrgbClr","a:sysClr","a:prstClr"];function om(e,t){var n,r=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme"),i=e.childElement("a:effectRef"),a=i.childElement(v(Hv,am)),o=i.attr.getNumber("idx"),s=r.childElement("a:effectStyleLst").elements[o-1],c=e.childElement("a:fillRef"),u=c.childElement(v(Hv,am)),l=c.attr.getNumber("idx"),h=r.childElement("a:fillStyleLst").elements[l-1],d=e.childElement("a:fontRef"),p=d.attr.getString("idx");"none"!==p&&(n=nm(t).childElement("a:".concat(p,"Font")));var f=e.childElement("a:lnRef"),m=f.childElement(v(Hv,am)),g=f.attr.getNumber("idx");return{effect:{xml:s,phClr:a},fill:{xml:h,phClr:u},font:{xml:n,fontRef:d},ln:{xml:r.childElement("a:lnStyleLst").elements[g-1],phClr:m}}}var sm,cm=(0,rd.default)("#FFFFFF").alpha(0),um=(0,rd.default)("#FFFFFF").alpha(0);!function(e){e.None="none",e.Norm="norm",e.Lighten="lighten",e.LightenLess="lightenLess",e.Darken="darken",e.DarkenLess="darkenLess"}(sm||(sm={}));var lm=function(){function e(){M(this,e),this.fillColor=cm.hsl()}return O(e,[{key:"setFillColor",value:function(e){this.fillColor=e}},{key:"hsl",value:function(){return this.fillColor.hsl()}},{key:"rgb",value:function(){return this.fillColor.rgb()}}]),e}(),hm=function(){function e(t){M(this,e),this.alphaModFix=1,this.resId=t.childElement("a:blip").attr.getString("r:embed"),void 0!==t.childElementOptional("a:tile")?this.tile=!0:this.tile=!1;var n=t.childElement("a:blip").childElementOptional("a:alphaModFix");if(void 0!==n){var r=n.attr.getNumberOptional("amt");r&&(this.alphaModFix=Ev(r))}}return O(e,[{key:"getResId",value:function(){return this.resId}},{key:"getAlphaModFix",value:function(){return this.alphaModFix}},{key:"hsl",value:function(){return cm.hsl()}},{key:"rgb",value:function(){return cm.rgb()}}]),e}(),dm=function(){function e(t,n,r){M(this,e),this.colors=[],this.rotation=0,this.path=void 0;var i=t.hasChildElementWithName("a:gsLst")?t.childElement("a:gsLst").elementsWithName("a:gs"):[];if(this.colors=i.sort((function(e,t){return e.attr.getNumber("pos")/Tv-t.attr.getNumber("pos")/Tv})).map((function(e){return{stop:e.attr.getNumber("pos")/Tv,color:pm(e.childElement(v(Hv,am)),n,r)}})),t.hasChildElementWithName("a:lin")&&(this.rotation=Nv(t.childElement("a:lin").attr.getNumber("ang",0))),t.hasChildElementWithName("a:path")){var a=t.childElement("a:path"),o=a.attr.getStringOptional("path"),s=a.childElementOptional("a:fillToRect");if(!s)return void(this.path={path:o,fillToRect:{left:0,top:0,bottom:0,right:0}});var c=s.attr.getNumber("l",0),u=s.attr.getNumber("t",0),l=s.attr.getNumber("b",0),h=s.attr.getNumber("r",0);this.path={path:o,fillToRect:{left:c,top:u,bottom:l,right:h}}}}return O(e,[{key:"getGradientPath",value:function(){return this.path}},{key:"getColors",value:function(){return this.colors}},{key:"getRotation",value:function(){return this.rotation}},{key:"hsl",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.hsl():cm.hsl()}},{key:"rgb",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.rgb():cm.rgb()}}]),e}();function pm(e,t,n){if(e.attr.has("val")){var r=e.childElementOptional("a:alpha"),i=e.childElementOptional("a:shade"),a=e.childElementOptional("a:tint"),o=e.childElementOptional("a:lumMod"),s=e.childElementOptional("a:satMod"),c=e.childElementOptional("a:satOff"),u=e.childElementOptional("a:lumOff"),l=e.childElementOptional("a:hueMod"),h=e.childElementOptional("a:hueOff");switch(e.name){case"a:prstClr":return fm((0,rd.default)(e.attr.getString("val")),r,i,o,a,s,u,c,l,h);case"a:srgbClr":return fm((0,rd.default)("#".concat(e.attr.getString("val"))),r,i,o,a,s,u,c,l,h);case"a:schemeClr":var d=e.attr.getString("val");return"phClr"===d&&(d=n.attr.getString("val")),fm((0,rd.default)("#".concat(function(e,t){if(t.masterThemeColorMapping[e]){var n="a:".concat(t.masterThemeColorMapping[e]),r=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:srgbClr");if(r)return r.attr.getString("val");var i=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:sysClr");return i?i.attr.getString("lastClr",e):e}var a="a:".concat(e),o=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:srgbClr");if(o)return o.attr.getString("val");var s=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:sysClr");return s?s.attr.getString("lastClr",e):e}(d,t))),r,i,o,a,s,u,c,l,h);case"a:hslClr":var p=e.attr.getNumber("hue")/Ov,f=e.attr.getNumber("sat")/Tv,v=e.attr.getNumber("lum")/Tv;return fm((0,rd.default)({h:p,s:f,l:v}),r,i,o,a,s,u);case"a:scrgbClr":var m=255*e.attr.getNumber("r")/Tv,g=255*e.attr.getNumber("g")/Tv,y=255*e.attr.getNumber("b")/Tv;return fm((0,rd.default)({r:m,g:g,b:y}),r,i,o,a,s,u);case"a:sysClr":return fm((0,rd.default)("#".concat(e.attr.getString("lastClr"))),r,i,o,a,s,u,c,l,h);default:return}}}function fm(e,t,n,r,i,a,o,s,c,u){var l=e;if(i&&(l=l.mix((0,rd.default)("white"),1-i.attr.getNumber("val")/Tv)),n&&(l=l.mix((0,rd.default)("black"),1-n.attr.getNumber("val")/Tv)),a){var h=l.hsl().object(),d=h.h,p=h.s,f=h.l,v=p*a.attr.getNumber("val")/Tv;l=(0,rd.default)({l:f,s:v,h:d})}if(s){var m=l.hsl().object(),g=m.h,y=m.s,b=m.l,k=s.attr.getNumber("val")/Tv*100+y;l=(0,rd.default)({l:b,s:k,h:g})}if(r){var w=l.hsl().object(),S=w.h,x=w.s,I=w.l*r.attr.getNumber("val")/Tv;l=(0,rd.default)({l:I,s:x,h:S})}if(o){var C=l.hsl().object(),P=C.h,M=C.s,T=C.l,O=o.attr.getNumber("val")/Tv*100+T;l=(0,rd.default)({l:O,s:M,h:P})}if(c){var E=l.hsl().object(),A=E.h,N=E.s,R=E.l,L=A*c.attr.getNumber("val")/Tv;l=(0,rd.default)({l:R,s:N,h:L})}if(u){var j=l.hsl().object(),D=j.h,z=j.s,F=j.l,B=u.attr.getNumber("val")/Ov+D;l=(0,rd.default)({l:F,s:z,h:B})}return t&&(l=l.alpha(t.attr.getNumber("val")/Tv)),l}var vm=function(){function e(t){M(this,e),this.placeHolderColor=t}return O(e,[{key:"read",value:function(e,t){if(void 0===e)return um;switch(e.name){case"a:noFill":return cm;case"a:solidFill":return pm(e.childElement(v(Hv,am)),t,this.placeHolderColor);case"a:gradFill":return new dm(e,t,this.placeHolderColor);case"a:blipFill":return void 0!==(e.hasChildElementWithName("a:blip")?e.childElement("a:blip").attr.getStringOptional("r:embed"):void 0)?new hm(e):cm;case"a:grpFill":return new lm;case"a:pattFill":default:return um}}}]),e}();function mm(e){return e instanceof hm||void 0===e?"none":e.rgb().string()}function gm(e,t){if("none"===e)return e;switch(t){case sm.None:return"none";case sm.Norm:return e;case sm.Darken:return(0,rd.default)(e).darken(.4).rgb().string();case sm.DarkenLess:return(0,rd.default)(e).darken(.2).rgb().string();case sm.Lighten:return(0,rd.default)(e).lighten(.4).rgb().string();case sm.LightenLess:return(0,rd.default)(e).lighten(.2).rgb().string();default:return e}}var ym=new(function(){function e(){M(this,e),this.tasks={slideDidUpdate:!1},this.isLoadFinished=!1}var t;return O(e,[{key:"reset",value:function(e){this.tasks={slideDidUpdate:!1},this.eventHub=e}},{key:"endLoadTask",value:function(e){var t=this;return this.tasks[e]=!0,!!Object.keys(this.tasks).every((function(e){return t.tasks[e]}))&&(this.eventHub.emit("__PresetTransactionReady__"),!0)}},{key:"addLoadTask",value:function(e){this.tasks[e]=!1}},{key:"loadImage",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return n=e.sent,r=new FileReader,e.next=7,n.blob();case 7:return i=e.sent,a=new Promise((function(e){r.onload=function(t){var n;e(null==(n=t.target)?void 0:n.result)},r.onerror=function(){e(t)}})),r.readAsDataURL(i),e.next=12,a;case 12:return e.abrupt("return",e.sent);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,null,[[0,15]])}))),function(e){return t.apply(this,arguments)})}]),e}()),bm=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).imageUrl="",r.state={imageBase64Url:""},r.updateImageUrl(r.props),r}return O(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateImageUrl(e)}},{key:"updateImageUrl",value:function(e){var t=this,n=e.cSld.extraAttr.getStringOptional("backgroundResId"),r=e.cSld.extraAttr.getStringOptional("backgroundImageResourceType");if(n&&r){var i=e.resourceLoader.loadURL(r,n);this.imageUrl!==i&&(this.imageUrl=i,ym.addLoadTask(i),ym.loadImage(i).then((function(e){t.setState({imageBase64Url:e},(function(){ym.endLoadTask(i)}))}),(function(){})))}}},{key:"renderImage",value:function(e,t){var n=this.props.cSld,r=this.state.imageBase64Url,i=n.extraAttr.getStringOptional("backgroundResId"),a=n.extraAttr.getStringOptional("backgroundImageResourceType");if(i&&a){var o=n.extraElementWithName("getBackgroundImageFill");if(void 0===o||void 0===o.childElementOptional("a:blip"))return null;var s=o.childElement("a:blip").childElementOptional("a:alphaModFix"),c=!!o.childElementOptional("a:tile"),u=1;if(s){var l=s.attr.getNumberOptional("amt");l&&(u=Ev(l))}var h={position:"absolute",left:0,top:0,width:Av(e),height:Av(t),opacity:u,backgroundImage:"url(".concat(r,")"),backgroundSize:c?"auto":"".concat(Av(e)," ").concat(Av(t))};return nd.default.createElement("div",{style:h})}var d=n.extraAttr.getColorOptional("backgroundColor");return d?nd.default.createElement("div",{style:{position:"absolute",left:0,top:0,width:Av(e),height:Av(t),backgroundColor:mm(d)}}):null}},{key:"render",value:function(){var e=this.props,t=e.slideContext,n=e.slideRef,r=e.className,i=e.children,a={position:"relative",width:Av(t.slideWidth),height:Av(t.slideHeight),overflow:"hidden"};return nd.default.createElement("div",{id:"ppt-animation-hub",ref:n,className:r,style:a},this.renderImage(t.slideWidth,t.slideHeight),i)}}]),n}(nd.default.Component),km=function(){function e(t){M(this,e),this.mapper=t}return O(e,[{key:"map",value:function(e,t,n){return(!this.buffer||this.buffer.source!==e)&&(this.buffer={source:e,target:this.mapper(e,t,void 0,n)}),this.buffer.target}}]),e}();function wm(e,t,n){var r;if(e&&(r=e[t]),void 0===r&&(r=n),void 0===r)throw new Error("can't get ".concat(JSON.stringify(t)," from object"));return r}function Sm(e){switch(e){case"b":return"flex-end";case"ctr":return"center";default:return"flex-start"}}function xm(e){switch(e){case"l":return"left";case"r":return"right";case"ctr":return"center";case"just":case"dist":return"justify";default:return"left"}}function Im(e){switch(e){case"sng":return"underline";default:return"none"}}function Cm(e,t){var n=t.scaleX,r=t.scaleY;return Math.abs(Math.cos(e/180*Math.PI))>=Math.abs(Math.sin(e/180*Math.PI))?{scaleX:n,scaleY:r}:{scaleX:r,scaleY:n}}var Pm=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"renderAutoNum",value:function(e){var t=this.props,n=t.buIndexCounter,r=t.paragraphXML,i=t.firstRangeXML,a=e.attr.getString("type"),o=e.attr.getNumber("startAt",1);return Em(n.get(r,o,i)+o,a)}},{key:"renderBuChar",value:function(e){return Mm(e)}},{key:"render",value:function(){var e=this.props,t=e.buXML,n=e.buIndexCounter;switch(t.name){case"a:buChar":return n.reset(),this.renderBuChar(t.attr.getString("char"));case"a:buAutoNum":return this.renderAutoNum(t);case"a:buNone":case"a:buBlip":return n.reset(),""}return""}}]),n}(Gf.default.Component);function Mm(e){switch(e){case String.fromCodePoint(159):case" ":case"l":return"";case"":return"";case"":return"";case"n":return"";case"":return"";case"v":return"";case"u":return"";case"&":return"";case"":return"";case"p":return"";default:return e}}function Tm(e){var t=e%26;t=0===t?26:t;var n=Math.ceil(e/26);return String.fromCodePoint(t+64).repeat(n)}function Om(e){var t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},n="",r=e;for(var i in t)for(;r>=t[i];)n+=i,r-=t[i];return n}function Em(e,t){switch(t){case"alphaLcParenBoth":return"(".concat(Tm(e),")");case"alphaLcParenR":return"".concat(Tm(e).toLowerCase(),")");case"alphaLcPeriod":return"".concat(Tm(e).toLowerCase(),".");case"alphaUcParenBoth":return"(".concat(Tm(e),")");case"alphaUcParenR":return"".concat(Tm(e),")");case"alphaUcPeriod":return"".concat(Tm(e),".");case"arabicParenBoth":return"(".concat(e,")");case"arabicParenR":return"".concat(e,")");case"arabicPeriod":return"".concat(e,".");case"arabicPlain":return"".concat(e);case"ea1JpnChsDbParenBoth":return"(".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbParenR":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbPeriod":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),".");case"ea1JpnChsDbPlain":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"));case"circleNumDbPlain":return function(e){return e<=20?String.fromCodePoint(e+9311):e<=35?String.fromCodePoint(e+12860):e<=50?String.fromCodePoint(e+12941):"".concat(e)}(e);case"romanLcParenBoth":return"(".concat(Om(e).toLowerCase(),")");case"romanLcParenR":return"".concat(Om(e).toLowerCase(),")");case"romanLcPeriod":return"".concat(Om(e).toLowerCase(),".");case"romanUcParenBoth":return"(".concat(Om(e),")");case"romanUcParenR":return"".concat(Om(e),")");case"romanUcPeriod":return"".concat(Om(e),".");default:return"".concat(e,".")}}var Am,Nm=function(e){m(n,e);var t=y(n);function n(e){return M(this,n),t.call(this,e)}return O(n,[{key:"hasUnderLine",value:function(e){switch(e){case"none":return"none";default:return"underline"}}},{key:"render",value:function(){var e=this.props,t=e.text,n=e.highlightColor,r=e.underLineStyle,i=e.indent,a=e.lineHeight,o=e.isTextWrap,s=e.fontFamily,c=e.isBold,u=e.color,l=e.isItalic,h=e.letterSpacing,d=e.fontSize;return t?Yf.default.createElement("span",{style:{display:"inline-flex",justifyContent:"space-between",backgroundColor:mm(n),textDecoration:this.hasUnderLine(r),width:"100%"}},Array.from(t).map((function(e,t){return 0===t&&i?Yf.default.createElement("span",{key:"run-text-".concat(t),style:{display:i?"inline-block":"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:mm(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt"),textIndent:i?Av(i):0}},e):Yf.default.createElement("span",{key:"run-text-".concat(t),style:{display:"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:mm(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt")}},e)}))):null}}]),n}(Yf.default.Component),Rm=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).defaultPtSize=18;var i,a=e.rNodeOrBrNode,o=e.lineHeight,s=e.fontScale,c=a.extraAttr.getNumberOptional("sz");return i=void 0===c?r.defaultPtSize:c,r.lineHeight="string"==typeof o?o:"".concat(i*s*1.2*o,"pt"),r.fontSize="".concat(i*s,"pt"),r}return O(n,[{key:"hasUnderLine",value:function(e){switch(e){case"none":return"none";default:return"underline"}}},{key:"renderText",value:function(){var e,t=this.props,n=t.rNodeOrBrNode,r=t.slideIndex,i=t.fontScale,a=t.lineHeight,o=t.indent,s=t.isTextWrap,c=t.runIndex,u=t.align,l=t.lastRunInParagraph,h=n.attr.getStringOptional("type");if(h)switch(h){case"slidenum":e=r;break;default:e=new Date(Date.now()).toLocaleDateString()}var d=n.childElementOptional("a:t");if(void 0===d)return Yf.default.createElement("span",null);var p,f,v,m,g=n.extraAttr.getBoolean("b",!1),y=n.extraAttr.getString("u","none"),b=n.extraAttr.getNumber("spc",0),k=n.extraAttr.getBoolean("i",!1),w=n.extraAttr.getColorOptional("color"),S=n.extraAttr.getNumber("sz",0)*i,x=n.extraAttr.getString("fontType",""),I=n.extraAttr.getColorOptional("highlight",void 0),C=n.childElementOptional("a:rPr");(void 0!==C&&(p=C.attr.getNumberOptional("baseline")),void 0===p)?f=e||d.text:p>0?(v=40,f=Yf.default.createElement("sup",{style:{fontSize:"small",verticalAlign:"".concat(v+p/Tv*100,"%")}},e||d.text)):p<0?(v=0,f=Yf.default.createElement("sub",{style:{fontSize:"small",verticalAlign:"".concat(v+p/Tv*100,"%")}},e||d.text)):f=e||d.text;if(m="string"==typeof a?a:"".concat(1.2*S*a,"pt"),"dist"===u)return Yf.default.createElement(Nm,{fontSize:S,text:"".concat(f),lineHeight:m,indent:o,isTextWrap:s,isBold:g,isItalic:k,underLineStyle:y,fontFamily:x,letterSpacing:b,color:w,highlightColor:I});var P={display:o?"inline-block":"inline",lineHeight:a,whiteSpace:s?"pre-wrap":"pre",backgroundColor:mm(I),fontSize:"".concat(S,"pt"),textDecoration:this.hasUnderLine(y),fontFamily:x,fontWeight:g?500:400,color:mm(w),fontStyle:k?"italic":"normal",letterSpacing:"".concat(b/100,"pt"),overflowWrap:"break-word",textIndent:o?Av(o):0};if(!l||"string"!=typeof f&&"number"!=typeof f)return Yf.default.createElement("span",{key:"run-".concat(c),style:P},f);var M="",T=f;if("string"==typeof f)f.length>0&&(T=f.substring(0,f.length-1),M=f.substring(f.length-1));else if("number"==typeof f){var O=f+"";T=O.substring(0,O.length-1),M=O.substring(O.length-1)}return P["--data-last-word-indent"]=o?"".concat(Av(-o)):"0pt",Yf.default.createElement("span",{className:"netless-ppt-last-run","data-last-word":M,key:"run-".concat(c),style:P},T)}},{key:"render",value:function(){var e=this.props,t=e.rNodeOrBrNode,n=e.runIndex,r=e.prevElement;switch(t.name){case"a:fld":case"a:r":return this.renderText();case"a:br":return Yf.default.createElement("span",{key:"br-".concat(n),style:{lineHeight:this.lineHeight,fontSize:this.fontSize}},Yf.default.createElement("br",null));case"a:endParaRPr":return r&&"a:br"===r.name?Yf.default.createElement("span",{key:"endParaRPr-".concat(n),style:{lineHeight:this.lineHeight,display:"inline",fontSize:this.fontSize}},Yf.default.createElement("br",null)):null;default:return null}}}]),n}(Yf.default.Component);function Lm(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz;switch(e){case Am.MongolianVert:case Am.WordArtVert:return"vertical-lr";case Am.WordArtVertRtl:case Am.EaVert:return"vertical-rl";default:return"horizontal-tb"}}function jm(e,t,n){var r,i,a,o=null!=(r=e.left)?r:0,s=null!=(i=e.right)?i:0,c=0,u=0;(null==(a=e.textBodyWrapResource)?void 0:a.prop)?(c=e.textBodyWrapResource.prop.width*Mv,u=e.textBodyWrapResource.prop.height*Mv):(c=e.width,u=e.height);var l=s?s-u/2+c/2:u/2-c/2;if(n===Am.Vert270&&t.paddingTop&&"string"==typeof t.paddingTop){var h=parseFloat(t.paddingTop)*Pv;Number.isNaN(h)||(l-=h)}return{left:Av(o?o-c/2+u/2:c/2-u/2),top:Av(l),width:Av(u),height:Av(c)}}function Dm(e){if(void 0===e)return e;if(/^#([A-Fa-f0-9]{8})$/.test(e)){var t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),i=parseInt(e.slice(7,9),16);return 255===i?"rgb(".concat(t,",").concat(n,",").concat(r,")"):"rgba(".concat(t,",").concat(n,",").concat(r,",").concat(i/256,")")}return e}function zm(e){var t,n,r,i=e.run.prop;i.underLine&&(n="underline"),i.strikeThrough&&(n=n?"".concat(n," line-through"):"line-through"),"tab"===e.run.runType&&(r={display:"inline-block",width:e.run.prop.width});var a="'".concat(i.font,"-").concat(e.uuid,"','").concat(i.font,"'"),o=(1-Math.abs(i.baseline))*i.size,s={fontSize:"".concat(o/e.transformScale,"px"),lineHeight:"".concat(i.lineSpacing/e.transformScale,"px")};return Iv(Iv({color:Dm(null==(t=i.fillType)?void 0:t.color),fontFamily:a,fontSize:"".concat(o,"px"),fontStyle:i.italic?"italic":"normal",fontWeight:Fm(i),letterSpacing:"".concat(i.kerning||0,"px"),lineHeight:"".concat(i.lineSpacing,"px"),backgroundColor:i.highlightColor,verticalAlign:i.baseline?"".concat(100*i.baseline,"%"):void 0,textDecoration:n,textIndent:e.firstRun?void 0:0},r),s)}function Fm(e){return e.fontWeight?e.fontWeight:e.bold?"bold":"normal"}!function(e){e.Horz="horz",e.Vert="vert",e.Vert270="vert270",e.WordArtVert="wordArtVert",e.EaVert="eaVert",e.MongolianVert="mongolianVert",e.WordArtVertRtl="wordArtVertRtl"}(Am||(Am={}));var Bm,Um=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"getScaleStyle",value:function(e){var t=e.reduce((function(e,t){return(1-Math.abs(t.prop.baseline))*t.prop.size<(1-Math.abs(e.prop.baseline))*e.prop.size?t:e})),n=(1-Math.abs(t.prop.baseline))*t.prop.size,r={},i=1;return n<12&&(i=n/12,r.transform="scale(".concat(i,")"),r.transformOrigin="0 0",r.lineHeight="1",r.display="block"),{scaleStyle:r,transformScale:i}}},{key:"splitRuns",value:function(e){function t(e){var t=e.codePointAt(0)||0;return t>=65&&t<=122}return(e.text||"").split("").reduce((function(n,r){var i=n[n.length-1];if(void 0===i)return n.push(Cv(Iv({},e),{text:r})),n;var a=i.text||"",o=t(a[a.length-1]),s=t(r);return o&&s?i.text="".concat(a).concat(r):n.push(Cv(Iv({},e),{text:r})),n}),[])}},{key:"render",value:function(){var e=this,t=this.props,n=t.line,r=t.justify,i=t.vert,a=t.style,o=t.firstLine,s=n,c=this.props.uuid,u={};r&&(s=n.reduce((function(t,n){var r=e.splitRuns(n),i=t;return i=i.concat(r)}),[]),u={display:"flex",justifyContent:"space-between",width:"100%"});var l=s.reduce((function(e,t){return t.prop.lineSpacing>e.prop.lineSpacing?t:e})).prop.lineSpacing,h=0;s.forEach((function(e){h+=Number(e.prop.width)}));var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return e===Am.Horz?r.height="".concat(n,"px"):(r.height="".concat(t,"px"),r.width="".concat(n,"px"),(e===Am.Vert||e===Am.Vert270)&&(r.width="".concat(t,"px"),r.height="".concat(n,"px")),e===Am.WordArtVert||e===Am.WordArtVertRtl?r.margin="0 0.6em":r.whiteSpace="nowrap",(e===Am.EaVert||e===Am.WordArtVertRtl)&&(r.transformOrigin="100% 0")),r}(i,h,l),p=this.getScaleStyle(s),f=p.scaleStyle,v=p.transformScale,m=Cv(Iv(Iv(Iv(Iv({},a),u),d),f),{whiteSpace:"pre"}),g=this.props.withAnimation;return i!==Am.Horz?Xf.default.createElement("div",{style:m},s.map((function(e,t){return Xf.default.createElement(Wm,{firstLine:o,withAnimation:g,transformScale:v,vert:i,uuid:c,key:t,run:e,firstRun:0===t})}))):Xf.default.createElement("div",{style:m},s.map((function(e,t){return Xf.default.createElement(Vm,{firstLine:o,withAnimation:g,transformScale:v,uuid:c,key:t,run:e,firstRun:0===t})})))}}]),n}(Xf.default.Component),Vm=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).styles=zm(e),r}return O(n,[{key:"renderSingleTextNodes",value:function(e){return e.split("").map((function(e,t){return Xf.default.createElement("span",{key:t,className:jf.Text},e)}))}},{key:"render",value:function(){var e=this.props,t=e.run,n=e.withAnimation,r=t.text||" ",i=r.split("").map((function(e,t){return Xf.default.createElement("span",{key:t,className:jf.Text},e)}));return Xf.default.createElement("span",{style:this.styles},n?i:r)}}]),n}(Xf.default.Component),Wm=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).horizontalText="",r.needSideWayCharacterList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz;switch(e){case Am.EaVert:return["","","","","","","","","","",""];case Am.WordArtVertRtl:case Am.WordArtVert:return["","","","","[","]","{","}","<",">","","","","(",")","",""];default:return[]}}(e.vert),r.needUpRightCharacterList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz;switch(e){case Am.EaVert:return["","","","",""];default:return[]}}(e.vert);var i=zm(e);return r.fontSpanStyle=Iv(Cv(Iv({},i),{maxHeight:i.fontSize}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz;return e===Am.WordArtVert||e===Am.WordArtVertRtl?{padding:"0.1em"}:{}}(e.vert)),r}return O(n,[{key:"renderHorizontalNumber",value:function(e,t){if(!this.horizontalText)return null;var n=this.horizontalText,r=this.props,i=r.run,a=r.vert;return this.horizontalText="",i.prop.kumimoji&&a===Am.EaVert?Xf.default.createElement("span",{className:jf.Text,key:t+n,style:Cv(Iv({},e),{writingMode:"horizontal-tb"})},n):Xf.default.createElement("span",{key:t+n,style:e},Xf.default.createElement("span",{className:jf.Text},n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.run,r=t.vert,i="tab"===n.runType?" ":n.text||" ",a=zm(this.props),o=Cv(Iv({},this.fontSpanStyle),{display:"inline-block",verticalAlign:"middle"});return Xf.default.createElement("span",{style:Iv({},a)},i&&i.split("").map((function(t,n){return r!==Am.EaVert||Number.isNaN(parseInt(t,10))?e.needSideWayCharacterList.includes(t)?Xf.default.createElement("span",{className:jf.Text,key:n,style:Cv(Iv({},o),{transform:"rotate(90deg)"})},t):e.needUpRightCharacterList.includes(t)?Xf.default.createElement("span",{className:jf.Text,key:n,style:Cv(Iv({},o),{transform:"rotate(-90deg)"})},t):Xf.default.createElement("span",{className:jf.Text,key:n,style:e.fontSpanStyle},t):(e.horizontalText+=t,2===e.horizontalText.length||Number.isNaN(parseInt(i[n+1],10))?e.renderHorizontalNumber(e.fontSpanStyle,n):null)})))}}]),n}(Xf.default.Component);!function(e){e.r="r",e.l="l",e.crl="ctr",e.dist="dist",e.just="just"}(Bm||(Bm={}));var Hm=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),r=t.call(this,e);var i=e.bodyPrXML,a=e.paragraphXML;r.runElements=a.elements.filter((function(e){return["a:fld","a:r","a:br","a:endParaRPr"].includes(e.name)})),r.biggestFontSize=C(r.runElements).filter((function(e){return"a:r"===e.name})).map((function(e){return e.extraAttr.getNumber("sz",0)})).sort((function(e,t){return e-t}))[0],r.fontScale=.01;var o=i.childElementOptional("a:normAutofit");if(o&&(r.fontScale=Ev(o.attr.getNumber("fontScale",Tv))/100),r.buChar=a.extraElementWithName("bu"),r.indent=a.extraAttr.getNumber("indent",0),r.marL=a.extraAttr.getNumber("marL",0),r.lineHeightInXml=a.extraAttr.get("lineHeight"),"number"!=typeof r.lineHeightInXml)r.lineHeight="".concat(parseFloat(r.lineHeightInXml)*r.fontScale*100,"pt");else{var s=r.getBigestLineHeight(C(r.runElements),r.lineHeightInXml,r.fontScale);r.lineHeight=void 0===s?void 0:"".concat(s,"pt")}return r.buClr=a.extraAttr.getColorOptional("buClr"),r.noneBuChar=void 0===r.buChar||"a:buNone"===r.buChar.name,r.paddingBottom=r.getPaddingBottom(a.extraAttr.getStringOptional("a:spcAft"),r.biggestFontSize),r.paddingBottom=r.getPaddingTop(a.extraAttr.getStringOptional("a:spcBef"),r.biggestFontSize),r.align=a.extraAttr.getStringOptional("algn"),r}return O(n,[{key:"getPaddingBottom",value:function(e,t){var n=this.props,r=n.isLast,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPaddingTop",value:function(e,t){var n=this.props,r=n.isFirst,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPadding",value:function(e,t){if(e){if(-1!==e.indexOf("pt"))return e;if(t)return"".concat(t*parseFloat(e)/100,"pt")}return"0pt"}},{key:"getBigestLineHeight",value:function(e,t,n){var r;return e.forEach((function(e){switch(e.name){case"a:fld":case"a:r":case"a:br":case"a:endParaRPr":var i=1.2*e.extraAttr.getNumber("sz",0)*t*n;(void 0===r||r<i)&&(r=i)}})),r}},{key:"isFlexSpaceBetween",value:function(e,t,n){return e===Bm.dist||e===Bm.just&&t!==n-1}},{key:"renderWrapParagraph",value:function(e){var t=this.props,n=t.paragraphWrapResource,r=t.bulletInfo,i=t.vert,a=n,o=a.prop,s=o.spaceBefore,c=o.spaceAfter,u=o.firstLineIndent,l=a.prop,h=l.align,d=l.bulletChar,p=l.indent,f=l.marginLeft,v=l.marginRight;if(0===e.length&&a.endParagraphRunProp){var m=a.endParagraphRunProp;s=m.spaceBefore,c=m.spaceAfter}0===r.order&&(s=0),r.order+1===r.count&&(c=0);var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz,t=arguments.length>1?arguments[1]:void 0;return e===Am.WordArtVertRtl?Cv(Iv({},t),{marginTop:t.marginLeft,marginLeft:t.marginBottom,marginRight:t.marginTop}):e===Am.EaVert||e===Am.WordArtVert?Cv(Iv({},t),{marginTop:t.marginLeft,marginLeft:t.marginTop,marginRight:t.marginBottom}):t}(i,{marginLeft:f,marginRight:v,marginTop:s,marginBottom:c}),y=Cv(Iv({textAlign:xm(h),position:"relative",fontSize:"0",lineHeight:"0"},g),{whiteSpace:"pre"});return void 0===u&&(u=Math.max(p,-f),d&&(u=p>=0?p:Math.max(0,-(f+p)))),ud.default.createElement("div",{className:jf.Paragraph,style:y},d&&this.renderBulletCharNode(e),this.renderLines(e,u,h))}},{key:"renderBulletCharNode",value:function(e){var t,n=this.props,r=n.paragraphWrapResource,i=n.bulletInfo,a=n.vert,o=r.prop,s=o.bulletChar,c=o.indent;if(s){var u=0===e.length,l=i.number,h=e.slice(0,1),d=h[0]&&h[0][0],p=s.colorFollowText&&d?null==(t=d.prop.fillType)?void 0:t.color:s.color,f=s.fontFollowText&&d?d.prop.font:s.font,v=s.sizeFollowText&&d?d.prop.size:s.size,m=d?"".concat(d.prop.lineSpacing,"px"):void 0,g=void 0!==s.autoNumber&&void 0!==s.autoNumberType,y=c>=0?0:c,b="";u||(g&&l&&(b=Em(l,s.autoNumberType)),g||(b+=Mm(s.character||"l")));var k={position:"absolute",fontFamily:f,fontSize:v,textIndent:y,color:p,lineHeight:m};return a===Am.EaVert&&(k.textOrientation="sideways"),ud.default.createElement("div",{style:k},b)}}},{key:"renderLines",value:function(e,t,n){var r=this,i=this.props,a=i.paragraphWrapResource,o=i.uuid,s=i.vert,c=i.withAnimation;if(0===e.length){var u,l={},h=a.endParagraphRunProp?a.endParagraphRunProp.lineSpacing:void 0,d=a.endParagraphRunProp?a.endParagraphRunProp.size:void 0;if(d&&d<12){var p=d/12;d=12,h=h?h*p:void 0,u="scale(".concat(p,")"),l.display="inline-block"}return l.lineHeight="".concat(h,"px"),l.fontSize="".concat(d,"px"),l.transform=u,ud.default.createElement("span",{style:{lineHeight:"".concat(h,"px"),fontSize:"".concat(d,"px"),transform:u}},ud.default.createElement("br",null))}return e.map((function(i,a){return ud.default.createElement(Um,{key:a,withAnimation:c,uuid:o,vert:s,style:0===a?{textIndent:t}:void 0,firstLine:0===a,line:i,justify:r.isFlexSpaceBetween(n,a,e.length)})}))}},{key:"renderRunOrBrOrEnd",value:function(e,t,n,r,i,a,o,s,c){var u=this.props,l=u.isTextWrap,h=u.slideContext;return ud.default.createElement(Rm,{key:"".concat(t,"-").concat(n),isTextWrap:l,paragraphHasRange:void 0!==s,rNodeOrBrNode:e,fontScale:r,runIndex:n,indent:0===n&&this.noneBuChar&&0!==this.marL?a:void 0,slideIndex:h.slideIndex,prevElement:c,lineHeight:i,align:this.align?this.align:"l",lastRunInParagraph:o})}},{key:"render",value:function(){var e=this,t=this.props,n=t.paragraphXML,r=t.resourceType,i=t.paragraphIndex,a=t.paragraphWrapResource,o=t.firstRangeXML,s=t.buIndexCounter,c=t.isTextWrap,u=n.extraAttr.getBoolean("placeHolderType");if("slide"!==r&&u)return ud.default.createElement("div",{key:"".concat(i)});if(a)return this.renderWrapParagraph(a.lines);var l,h=xm(this.align),d=this.runElements.map((function(t,n){var r="left"===h&&n===e.runElements.length-1,a=e.renderRunOrBrOrEnd(t,i,n,e.fontScale,e.lineHeightInXml,e.indent,r,o,l);return l=t,a})),p=0;if(o){if(this.buChar&&"a:buNone"!==this.buChar.name){var f=o.extraAttr.getNumber("sz",0),v=o.extraAttr.getString("fontType","");d.unshift(ud.default.createElement("span",{key:"bu-".concat(p+=1),style:{display:"inline-block",position:"absolute",color:void 0!==this.buClr?mm(this.buClr):mm(o.extraAttr.getColorOptional("color")),fontSize:"".concat(f*this.fontScale,"pt"),lineHeight:this.lineHeight,fontFamily:v,textIndent:Av(this.indent)}},ud.default.createElement(Pm,{paragraphXML:n,firstRangeXML:o,buXML:this.buChar,buIndexCounter:s})))}}else{var m=0,g=n.childElementOptional("a:endParaRPr");if(g){var y=g.extraAttr.getNumberOptional("sz");m=void 0===y?0:y}else m=n.extraAttr.getNumber("sz",0);d.push(ud.default.createElement("span",{key:"end-".concat(p+=1),style:{display:"block",lineHeight:this.lineHeight,fontSize:"".concat(m*this.fontScale,"pt")}},ud.default.createElement("br",null)))}return this.buChar&&"a:buNone"===this.buChar.name&&s.reset(),ud.default.createElement("li",{key:"".concat(i),className:"".concat(jf.Paragraph," Paragraph-").concat(i),style:{whiteSpace:c?"normal":"nowrap",paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,marginLeft:Av(n.extraAttr.getNumber("marL",0)),marginRight:Av(n.extraAttr.getNumber("marR",0)),lineHeight:"1pt",listStyleType:"none",textAlign:h}},d)}}]),n}(ud.default.Component),_m={"*/":function(e,t,n){return e*t/n},"+-":function(e,t,n){return e+t-n},"+/":function(e,t,n){return(e+t)/n},"?:":function(e,t,n){return e>0?t:n},abs:function(e){return Math.abs(e)},at2:function(e,t){return function(e){return e*(180/Math.PI)*Ov}(Math.atan2(t,e))},cat2:function(e,t,n){return e*Math.cos(Math.atan2(n,t))},cos:function(e,t){return e*Math.cos(Gm(t))},max:function(e,t){return e>t?e:t},min:function(e,t){return e<t?e:t},mod:function(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))},pin:function(e,t,n){return t<e?e:t>n?n:t},sat2:function(e,t,n){return e*Math.sin(Math.atan2(n,t))},sin:function(e,t){return e*Math.sin(Gm(t))},sqrt:function(e){return Math.sqrt(e)},tan:function(e,t){return e*Math.tan(Gm(t))},val:function(e){return e}};function Gm(e){return e/Ov*(Math.PI/180)}var Ym=function(){function e(t){M(this,e),this.expr=t}return O(e,[{key:"standardizationTokenSplit",value:function(e){return e.replace(/\s+/g," ")}},{key:"eval",value:function(e){var t=this.standardizationTokenSplit(this.expr).split(" "),n=t.slice(1,t.length).map((function(t){return Number.isNaN(Number(t))?e.getRequiredVariable(t):parseInt(t,10)}));if(void 0===_m[t[0]])throw new Error("Formula ".concat(t[0]," not supported"));return _m[t[0]].apply(_m,C(n))}}],[{key:"deconstructShapeGuide",value:function(e){var t=u(e.split(" ")),n=t[0],r=t.slice(1).map((function(e){return parseInt(e,10)}));return _m[n].apply(_m,C(r))}}]),e}();function Xm(e,t){return Qm.apply(this,arguments)}function Qm(){return(Qm=I(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$m(t,void 0,n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,qm(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.text();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zm(e,t){return Km.apply(this,arguments)}function Km(){return(Km=I(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$m(t,{headers:{"content-type":"application/json",Accept:"application/json"}},n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,qm(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.json();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qm(e,t,n,r){return Jm.apply(this,arguments)}function Jm(){return(Jm=I(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window&&window.postMessage({name:"pptDataLoadError",src:t,event:"PPT data load failed",status:n},"*"),null==r||r.error("fetch ".concat(JSON.stringify(t)," failed with ").concat(n," : "),i);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $m(e,t,n,r){return eg.apply(this,arguments)}function eg(){return(eg=I(regeneratorRuntime.mark((function e(t,n,r,i){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=setTimeout((function(){null==r||r.warn("fetch ".concat(t," for ").concat(i,"ms"))}),i),e.prev=1,e.next=4,fetch(t,Iv({},n));case 4:return o=e.sent,e.abrupt("return",(clearTimeout(a),o));case 8:throw e.prev=8,e.t0=e.catch(1),clearTimeout(a),null==r||r.error("fetch ".concat(t," with error ").concat(e.t0)),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}var tg,ng=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"keyval-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";M(this,e),this.storeName=n,this._dbp=new Promise((function(e,r){var i=indexedDB.open(t,1);i.onerror=function(){return r(i.error)},i.onsuccess=function(){return e(i.result)},i.onupgradeneeded=function(){i.result.createObjectStore(n)}}))}return O(e,[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then((function(r){return new Promise((function(i,a){var o=r.transaction(n.storeName,e);o.oncomplete=function(){return i()},o.onabort=o.onerror=function(){return a(o.error)},t(o.objectStore(n.storeName))}))}))}}]),e}();function rg(){return tg||(tg=new ng),tg}function ig(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rg();return n._withIDBStore("readonly",(function(n){t=n.get(e)})).then((function(){return t.result}))}function ag(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rg();return n._withIDBStore("readwrite",(function(n){n.put(t,e)}))}var og,sg=function(){function e(){M(this,e),this.attributePickers={},this.childPickers={}}return O(e,[{key:"createPickers",value:function(){return new ug(this.attributePickers,this.childPickers)}},{key:"bindAttributePicker",value:function(e,t,n){this.bindPicker(e,t,n,this.attributePickers)}},{key:"bindChildPicker",value:function(e,t,n){this.bindPicker(e,t,n,this.childPickers)}},{key:"bindPicker",value:function(e,t,n,r){"string"==typeof e&&(e=[e]),"string"==typeof t&&(t=[t]);var i,a=E(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.bindPickerWithAttributeNames(o,t,n,r)}}catch(e){a.e(e)}finally{a.f()}}},{key:"bindPickerWithAttributeNames",value:function(e,t,n,r){var i=r[e];if(i||(i=r[e]={}),"object"==R(i)){var a,o=E(t);try{for(o.s();!(a=o.n()).done;){i[a.value]=n}}catch(e){o.e(e)}finally{o.f()}}}}]),e}(),cg=function(){function e(t){M(this,e),this.pickers=t}return O(e,[{key:"forEach",value:function(e,t){var n=this.pickers[e];if(n)for(var r in n)"*"!==r&&t(r)}},{key:"has",value:function(e,t){var n=this.pickers[e];return!!n&&(t in n||"*"in n)}},{key:"get",value:function(e,t,n,r,i,a){var o=this.pickers[t];if(o){var s=o[n];if(s||(s=o["*"]),s)return s(r,e,n,i,a)}}}]),e}(),ug=function(){function e(t,n){M(this,e),this.attributePickers=new cg(t),this.childPickers=new cg(n)}return O(e,[{key:"forEachAttributes",value:function(e,t){this.attributePickers.forEach(e,t)}},{key:"hasAttribute",value:function(e,t){return this.attributePickers.has(e,t)}},{key:"getAttribute",value:function(e,t,n,r,i){if(this.context)return this.attributePickers.get(this.context,e,t,n,r,i)}},{key:"getChild",value:function(e,t,n,r,i){if(this.context)return this.childPickers.get(this.context,e,t,n,r,i)}}]),e}(),lg=function(){function e(t){M(this,e),this.resourceScheme=t}var t,n,r,i,a,o;return O(e,[{key:"loadLumiaPSD",value:(o=I(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a="https://convertcdn.netless.link/publicFiles/xml/PresetShapeDefinitions.xml",this.resourceScheme&&(a=a.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),!1!==n){t.next=8;break}return t.next=5,Xm(a,r);case 5:i=t.sent,t.next=18;break;case 8:return t.next=10,ig("PresetShapeDefinitions");case 10:if(i=t.sent,t.t0=void 0===i,!t.t0){t.next=18;break}return t.next=15,Xm(a,r);case 15:return i=t.sent,t.next=18,ag("PresetShapeDefinitions",i);case 18:e.presetShapeDefinitons=new Wv("slide").parse(i).childElement("presetShapeDefinitons");case 19:case"end":return t.stop()}}),t,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"preLoad",value:(a=I(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllResourceUrl(n,r,i.logger);case 2:a=e.sent,o=0;case 4:if(!(o<a.length)){e.next=12;break}return s=o+1,c=a[o],e.next=8,this.prefetchPageResource(c);case 8:i.preloadProgress&&i.preloadProgress((s/a.length).toFixed(2));case 9:o++,e.next=4;break;case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"prefetchPageResource",value:(i=I(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],r=0,i=Object.keys(t);r<i.length;r++)a=i[r],n.push(this.prefetchResource(t[a]));return e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"prefetchResource",value:(r=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(t).length>0)){e.next=15;break}n=Object.keys(t),r=[],i=0,a=n;case 3:if(!(i<a.length)){e.next=13;break}if(o=a[i],!(s=t[o]).endsWith(".mp4")){e.next=8;break}return e.abrupt("continue",10);case 8:c=s,this.resourceScheme&&(c=s.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),r.push(this.fetch(c));case 10:i++,e.next=3;break;case 13:return e.next=15,Promise.all(r);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.debug("cache fail",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}())},{key:"fetchAllResourceUrl",value:(n=I(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],a=1;a<=n;a++)i.push(Zm("".concat(t,"/resources/resource").concat(a,".json"),r));return e.next=4,Promise.all(i);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchPageResource",value:(t=I(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zm("".concat(t,"/resources/resource").concat(n,".json"),r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),hg=function(){function e(t){M(this,e),this.foundStartPostion=!1,this.variablesMap=t,this.injectConstant()}return O(e,[{key:"injectConstant",value:function(){this.setVariable("3cd4",162e5),this.setVariable("3cd8",81e5),this.setVariable("5cd8",135e5),this.setVariable("7cd8",189e5),this.setVariable("b",new Ym("val h").eval(this)),this.setVariable("cd2",108e5),this.setVariable("cd4",54e5),this.setVariable("cd8",27e5),this.setVariable("hc",new Ym("*/ w 1.0 2.0").eval(this)),this.setVariable("hd2",new Ym("*/ h 1.0 2.0").eval(this)),this.setVariable("hd3",new Ym("*/ h 1.0 3.0").eval(this)),this.setVariable("hd4",new Ym("*/ h 1.0 4.0").eval(this)),this.setVariable("hd5",new Ym("*/ h 1.0 5.0").eval(this)),this.setVariable("hd6",new Ym("*/ h 1.0 6.0").eval(this)),this.setVariable("hd8",new Ym("*/ h 1.0 8.0").eval(this)),this.setVariable("l",0),this.setVariable("ls",new Ym("max w h").eval(this)),this.setVariable("r",new Ym("val w").eval(this)),this.setVariable("ss",new Ym("min w h").eval(this)),this.setVariable("ssd2",new Ym("*/ ss 1.0 2.0").eval(this)),this.setVariable("ssd4",new Ym("*/ ss 1.0 4.0").eval(this)),this.setVariable("ssd6",new Ym("*/ ss 1.0 6.0").eval(this)),this.setVariable("ssd8",new Ym("*/ ss 1.0 8.0").eval(this)),this.setVariable("ssd16",new Ym("*/ ss 1.0 16.0").eval(this)),this.setVariable("ssd32",new Ym("*/ ss 1.0 32.0").eval(this)),this.setVariable("t",0),this.setVariable("vc",new Ym("*/ h 1.0 2.0").eval(this)),this.setVariable("wd2",new Ym("*/ w 1.0 2.0").eval(this)),this.setVariable("wd3",new Ym("*/ w 1.0 3.0").eval(this)),this.setVariable("wd4",new Ym("*/ w 1.0 4.0").eval(this)),this.setVariable("wd5",new Ym("*/ w 1.0 5.0").eval(this)),this.setVariable("wd6",new Ym("*/ w 1.0 6.0").eval(this)),this.setVariable("wd8",new Ym("*/ w 1.0 8.0").eval(this)),this.setVariable("wd10",new Ym("*/ w 1.0 10.0").eval(this)),this.setVariable("wd12",new Ym("*/ w 1.0 12.0").eval(this)),this.setVariable("wd32",new Ym("*/ w 1.0 32.0").eval(this))}},{key:"getVariable",value:function(e,t){return void 0!==this.variablesMap[e]?this.variablesMap[e]:t}},{key:"getRequiredVariable",value:function(e){if(void 0!==this.variablesMap[e])return this.variablesMap[e];throw new Error("".concat(e," is required"))}},{key:"setVariable",value:function(e,t){this.variablesMap[e]=t}},{key:"setVariableIfNotExist",value:function(e,t){void 0===this.variablesMap[e]&&(this.variablesMap[e]=t)}},{key:"isNumeric",value:function(e){return/^-{0,1}\d+$/.test(e)}},{key:"accessValue",value:function(e){return this.isNumeric(e)?parseInt(e,10):this.getRequiredVariable(e)}},{key:"setLatestPostion",value:function(e,t){this.latestPostionX=e,this.latestPostionY=t,this.foundStartPostion||(this.startPostionX=e,this.startPostionY=t,this.foundStartPostion=!0)}},{key:"getLatestPostion",value:function(){return{x:this.latestPostionX,y:this.latestPostionY}}},{key:"getStartPostion",value:function(){return{x:this.startPostionX,y:this.startPostionY}}},{key:"inspect",value:function(){console.debug(JSON.stringify(this.variablesMap))}}]),e}(),dg=function(){function e(){M(this,e)}return O(e,[{key:"renderLumiaPath",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=e.childElementOptional("".concat(r,"avLst"));i&&i.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new Ym(n).eval(t),i=e.attr.getString("name");t.setVariableIfNotExist(i,r)}));var a=e.childElementOptional("".concat(r,"gdLst"));a&&a.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new Ym(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}));var o=e.childElementOptional("".concat(r,"rect"));o?(t.setVariable("rectLeft",t.accessValue(o.attr.getString("l"))),t.setVariable("rectTop",t.accessValue(o.attr.getString("t"))),t.setVariable("rectRight",t.accessValue(o.attr.getString("r"))),t.setVariable("rectBottom",t.accessValue(o.attr.getString("b")))):(t.setVariable("rectLeft",t.accessValue("l")),t.setVariable("rectTop",t.accessValue("t")),t.setVariable("rectRight",t.accessValue("r")),t.setVariable("rectBottom",t.accessValue("b")));var s=e.childElement("".concat(r,"pathLst")).elementsWithName("".concat(r,"path")),c=[];return s.forEach((function(e){var i,a={fill:void 0,pathD:"",isBorder:null==(i=e.attr.getBooleanOptional("stroke"))||i};a.fill=e.attr.getStringOptional("fill")||void 0;var o=n.calcPathScale(e,t),s=o.pathWidthScale,u=o.pathHeightScale,l=e.elements.map((function(e){return new pg(e,r,s,u).generate(t)}));a.pathD=l.join(" "),c.push(a)})),c}},{key:"calcPathScale",value:function(e,t){var n=e.attr.getNumberOptional("w"),r=e.attr.getNumberOptional("h"),i=1,a=1;return n&&(i=t.accessValue("w")/n),r&&(a=t.accessValue("h")/r),{pathWidthScale:i,pathHeightScale:a}}}]),e}(),pg=function(){function e(t,n,r,i){M(this,e),this.actionXML=t,this.namespace=n,this.pathWidthScale=r,this.pathHeightScale=i}return O(e,[{key:"xUnitTransformAndPathScale",value:function(e){return e*this.pathWidthScale/Mv}},{key:"yUnitTransformAndPathScale",value:function(e){return e*this.pathHeightScale/Mv}},{key:"generate",value:function(e){var t=this,n=this.actionXML.elementsWithName("".concat(this.namespace,"pt")).map((function(e){return{x:e.attr.getString("x"),y:e.attr.getString("y")}})).map((function(n){return{x:t.getPtValue(n,e,"x"),y:t.getPtValue(n,e,"y")}})),r=n.length>0?n[0].x:0,i=n.length>0?n[0].y:0,a=n.length>1?n[1].x:0,o=n.length>1?n[1].y:0,s=n.length>2?n[2].x:0,c=n.length>2?n[2].y:0;switch(this.actionXML.name){case"".concat(this.namespace,"moveTo"):return e.setLatestPostion(r,i),["M",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"lnTo"):return e.setLatestPostion(r,i),["L",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"arcTo"):var u=e.accessValue(this.actionXML.attr.getString("wR")),l=e.accessValue(this.actionXML.attr.getString("hR")),h=e.accessValue(this.actionXML.attr.getString("stAng"))/Ov,d=e.accessValue(this.actionXML.attr.getString("swAng"))/Ov,p=e.getLatestPostion(),f=p.x,v=p.y,m=this.getSvgArc(u,l,h,d,f,v);return d>=360?(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.middleX),this.yUnitTransformAndPathScale(m.middleY),"A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" ")):(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" "));case"".concat(this.namespace,"cubicBezTo"):return e.setLatestPostion(s,c),["C",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o),this.xUnitTransformAndPathScale(s),this.yUnitTransformAndPathScale(c)].join(" ");case"".concat(this.namespace,"quadBezTo"):return e.setLatestPostion(n[1].x,n[1].y),["Q",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o)].join(" ");case"".concat(this.namespace,"close"):return e.setLatestPostion(e.getStartPostion().x,e.getStartPostion().y),"Z";default:throw new Error("unknow ".concat(this.actionXML.name))}}},{key:"getPtValue",value:function(e,t,n){return t.accessValue(e[n])}},{key:"getSvgArc",value:function(e,t,n,r,i,a){var o,s,c,u,l,h=e,d=t;if(0===r)o=i,s=a,l=0;else if(r>=360)o=i,s=a,c=i+2*e*Math.abs(Math.cos(-n/180*Math.PI)),u=a+2*t*Math.sin(-n/180*Math.PI),l=1;else{var p=-n,f=-(n+r),v=this.getCoordinateOnEllipse(p,h,d),m=i-v.x,g=a+v.y,y=this.getCoordinateOnEllipse(f,h,d);o=y.x+m,s=g-y.y,l=r>=-360&&r<-180?1:r>=-180&&r<0||r>0&&r<180?0:1}return{radiusX:h,radiusY:d,xAxisRotation:0,largeArcFlag:l,sweepFlag:r>0?1:0,endX:o,endY:s,middleX:c,middleY:u}}},{key:"getCoordinateOnEllipse",value:function(e,t,n){var r,i,a=e%360;if(a%180==0)r=Math.cos(a*(Math.PI/180))*t,i=0;else if(a%90==0)r=0,i=Math.sin(a*(Math.PI/180))*n;else{var o=this.getTanDeg(a);r=t*n/Math.sqrt(Math.pow(n,2)+Math.pow(t*o,2)),(a>90&&a<270||a<-90&&a>-270)&&(r=-r),i=o*r}return{x:r,y:i}}},{key:"getTanDeg",value:function(e){var t=e*Math.PI/180;return Math.tan(t)}}]),e}();function fg(e){return lg.presetShapeDefinitons.childElementOptional(e)||(console.warn("".concat(e," not include preset shape.")),lg.presetShapeDefinitons.childElement("rect"))}function vg(e){switch(e){case"none":return 0;case"triangle":return 1;case"stealth":return 2;case"diamond":return 3;case"oval":return 4;case"arrow":return 5;default:return 0}}!function(e){e[e.none=0]="none",e[e.triangle=1]="triangle",e[e.stealth=2]="stealth",e[e.diamond=3]="diamond",e[e.oval=4]="oval",e[e.arrow=5]="arrow"}(og||(og={}));var mg=function(){function e(t){M(this,e),this.logger=t}return O(e,[{key:"createMonitor",value:function(){return new gg(this.logger).ref}}]),e}(),gg=function(){function e(t){var n=this;M(this,e),this.logger=t,this.image=null,this.timer=null,this.beginTimestamp=0,this.ref=function(e){e?n.bindImage(e):n.releaseImage()},this.onLoad=function(){0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer())},this.onError=function(e){var t,r;0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer(),r="string"==typeof e?new Error(e):new Error("".concat(e.message)),null==(t=n.logger)||t.error("loading image ".concat(n.getImageUrl()," with error: ").concat(r)))},this.onTimeout=function(){var e;n.beginTimestamp=0,null==(e=n.logger)||e.warn("loading image ".concat(n.getImageUrl()," timeout for ").concat(1e4,"ms"))},this.getImageUrl=function(){var e,t;return n.image&&n.image instanceof SVGImageElement?null==(e=n.image)?void 0:e.href.animVal:null==(t=n.image)?void 0:t.src}}return O(e,[{key:"bindImage",value:function(e){e.onload=this.onLoad,e.onerror=this.onError,this.image=e,this.timer=setTimeout(this.onTimeout,1e4),this.beginTimestamp=Date.now()}},{key:"releaseImage",value:function(){this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null,this.beginTimestamp=0,this.clearTimer())}},{key:"clearTimer",value:function(){null!==this.timer&&clearTimeout(this.timer)}}]),e}(),yg="body";function bg(e,t,n){var r=function(e){var t=!1,n=e.childElementOptional("p:nvSpPr");return n&&n.childElement("p:cNvSpPr").attr.getBooleanOptional("txBox")&&(t=!0),t}(e),i=!0;if("master"===n){var a=kg(e);if(!a)return i=!1,{allShape:[e],masterStyleXML:Sg(t),isTextBox:r,hasPlaceHolder:i};var o=a.type||yg;return{placeHolderType:o,masterShape:e,masterStyleXML:wg(o,t,r),allShape:[e],isTextBox:r,hasPlaceHolder:i}}if("layout"===n){var s=kg(e);if(!s)return i=!1,{allShape:[e],masterStyleXML:Sg(t),isTextBox:r,hasPlaceHolder:i};var c=xg(s.type||yg),u=t.masterIndex.typeIndex[c],l=[e];return u&&l.push(u),{allShape:l,placeHolderType:c,layoutShape:e,masterShape:u,masterStyleXML:wg(c,t,r),isTextBox:r,hasPlaceHolder:i}}var h,d=kg(e);if(!d)return i=!1,{allShape:[e],masterStyleXML:Sg(t),isTextBox:r,hasPlaceHolder:i};if(function(e){return void 0!==e&&void 0!==e.idx&&"4294967295"===e.idx}(d)&&(d.idx="1"),d.idx?(h=t.layoutIndex.idxIndex[d.idx],d.type&&void 0===h&&(h=t.layoutIndex.typeIndex[d.type])):d.type&&(h=t.layoutIndex.typeIndex[d.type]),h){var p=kg(h);if(p){var f=xg(p.type||yg),v=t.masterIndex.typeIndex[f],m=[e];return h&&m.push(h),v&&m.push(v),{allShape:m,placeHolderType:f,layoutShape:h,masterShape:v,masterStyleXML:wg(f,t,r),isTextBox:r,hasPlaceHolder:i}}throw new Error("layout ph not existed.")}var g=xg(d.type||yg),y=t.masterIndex.typeIndex[g],b=[e];return y&&b.push(y),{allShape:b,placeHolderType:g,layoutShape:e,masterShape:y,masterStyleXML:wg(g,t,r),isTextBox:r,hasPlaceHolder:i}}function kg(e){if(e){var t=e.childElementOptional(new Hv("p:nvSpPr","p:nvCxnSpPr"));if(t){var n=t.childElementOptional("p:nvPr","p:ph");if(n){var r=n.attr.getStringOptional("idx"),i=n.attr.getStringOptional("type");return("title"===i||"ctrTitle"===i)&&(r=r||"0"),{idx:r,type:i}}}}}function wg(e,t,n){if(t.masterIndex.txStyle){var r=t.masterIndex.txStyle[e];return r||(r=n?t.masterIndex.txStyle[yg]:t.masterIndex.txStyle.other),r}}function Sg(e){return e.main.childElementOptional("p:presentation","p:defaultTextStyle")}function xg(e){switch(e){case"ctrTitle":case"title":return"title";case"dt":return"dt";case"ftr":return"ftr";case"sldNum":return"sldNum";default:return"body"}}var Ig=6350;function Cg(e){var t="";return"master"===e?t="m":"layout"===e&&(t="l"),t}function Pg(e,t,n,r){var i=n.lnStyleXMLDescription;return i||(i=n.lnStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=bg(e,t,n),s=o.allShape,c=o.placeHolderType,u=E(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Hv("p:spPr","p:grpSpPr"));if(h){var d=h.childElementOptional("a:ln");d&&a.push(d)}var p=l.childElementOptional("p:style");if(p){var f=om(p,t);f.ln.xml&&a.push(f.ln.xml),r=f.ln.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}function Mg(e,t,n,r){var i=n.fillStyleXMLDescription;return i||(i=n.fillStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=bg(e,t,n),s=o.allShape,c=o.placeHolderType,u=E(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Hv("p:spPr","p:grpSpPr"),v(Hv,im));h&&a.push(h);var d=l.childElementOptional("p:style");if(d){var p=om(d,t);p.fill.xml&&a.push(p.fill.xml),r=p.fill.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}var Tg,Og=function(e,t,n,r,i){var a,o=E(bg(e,t,i).allShape);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("p:spPr",n);if(s)return s}}catch(e){o.e(e)}finally{o.f()}},Eg=function(e,t,n,r,i){var a,o=Mg(e,t,r,i),s=E(o.shapeStyleXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value;return new vm(o.placeHolderColor).read(c,t)||void 0}}catch(e){s.e(e)}finally{s.f()}},Ag=function(e,t,n,r,i){var a,o=Pg(e,t,r,i),s=E(o.shapeStyleXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.childElementOptional(v(Hv,im));if(c){var u=new vm(o.placeHolderColor).read(c,t);if(u)return u}}}catch(e){s.e(e)}finally{s.f()}return um},Ng=function(e,t,n,r,i){var a,o=E(Pg(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s&&s.attr.has("w")){var c=s.attr.getNumber("w");return c>Ig?c:Ig}}}catch(e){o.e(e)}finally{o.f()}return Ig},Rg=function(e,t,n,r,i){var a,o=E(Pg(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:prstDash");if(s&&s.attr.has("val"))return s.attr.getString("val")}}catch(e){o.e(e)}finally{o.f()}return"solid"},Lg=function(e,t,n,r,i){var a=Ng(e,t,n,r,i)/Pv;switch(Rg(e,t,n,r,i)){case"solid":return"0";case"dash":return"".concat(5*a);case"dashDot":return" ".concat(5*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"dot":return"".concat(a,",  ").concat(5*a);case"lgDash":return"".concat(2*a,", ").concat(a);case"lgDashDot":return"".concat(10*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDash":return"".concat(5*a,", ").concat(2*a);case"sysDashDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a);case"sysDashDotDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDot":return"".concat(2*a,", ").concat(5*a);default:return"0"}},jg=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).isRender=!1,r.state={dataUrl:""};var i=e.xlinkHref||e.href;return i&&ym.addLoadTask(i),r}return O(n,[{key:"componentDidMount",value:function(){this.isRender=!0,this.loadImage()}},{key:"getSnapshotBeforeUpdate",value:function(e){var t=this.props,n=t.xlinkHref,r=t.href,i=n||r;return!((e.xlinkHref||e.href)===i||!i)&&(ym.addLoadTask(i),!0)}},{key:"componentDidUpdate",value:function(e,t,n){n&&this.loadImage()}},{key:"componentWillUnmount",value:function(){this.isRender=!1}},{key:"updateImageState",value:function(e,t){this.isRender&&this.setState({dataUrl:e},t)}},{key:"loadImage",value:function(){var e=this,t=this.props,n=t.xlinkHref,r=t.href,i=n||r;i&&ym.loadImage(i).then((function(t){e.updateImageState(t,(function(){ym.endLoadTask(i)}))})).then((function(){}),(function(){}))}},{key:"render",value:function(){var e=this.state.dataUrl,t=this.props.innerref;if(e){var n=Cv(Iv({},this.props),{innerref:void 0,xlinkHref:e,href:e});return Kf.default.createElement("image",Cv(Iv({},n),{ref:t}))}return null}}]),n}(Kf.default.Component),Dg=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).pathElements={},r.imageElement=Zf.default.createRef();var i=e.shapeXML;if(r.spId=e.spId,r.graphType="p:sp"===e.shapeXML.name?"shape":"connection",r.prestGeomXML=i.extraElementWithName("a:prstGeom"),r.custGeomXML=i.extraElementWithName("a:custGeom"),r.svgLoadingMonitor=new mg(e.logger).createMonitor(),r.useBgFill=i.attr.getBoolean("useBgFill",!1),r.useBgFill){var a=i.parentElement("p:cSld");if(a){var o=a.extraAttr.getColorOptional("backgroundColor");o&&(r.fillColor=o)}}return r}return O(n,[{key:"getCssVaribleColor",value:function(e){switch(e){case sm.Darken:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.6),var(--sp-fill-a))";case sm.DarkenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.8),var(--sp-fill-a))";case sm.Lighten:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.4),var(--sp-fill-a))";case sm.LightenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.2),var(--sp-fill-a))";default:return"hsla(var(--sp-fill-h),var(--sp-fill-s),var(--sp-fill-l),var(--sp-fill-a))"}}},{key:"updateFillColor",value:function(e){var t,n,r,i=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=[],s=0;if(e instanceof dm)o=e.getColors(),s=e.getRotation(),n=e.getGradientPath(),t="url(#".concat(this.identification(),"-gradient-fill)");else if(e instanceof hm)r=e.getResId();else if(e instanceof lm){var c=this.props.groupFillColor;t=mm(c)}else t=mm(e);if(a&&(Object.keys(this.pathElements).forEach((function(e){var n=i.pathElements[e];n&&t&&(void 0!==r?n.setAttribute("fill","none"):n.setAttribute("fill",t))})),this.imageElement.current&&e)){var u=e.getAlphaModFix();this.imageElement.current.setAttribute("opacity",u.toString())}return{path:n,imageResId:r,colorStops:o,rotation:s,fillColor:t}}},{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new Ym(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"renderSVG",value:function(e,t,n,r){var i,a=null,o=null,s=this.props,c=s.shapeXML,u=s.width,l=s.height,h=s.fillColor,d=s.resourceLoader,p=s.resourceType,f=s.borderStyle,v=null==(i=c.childElementOptional("p:nvSpPr","p:cNvSpPr"))?void 0:i.attr.getBooleanOptional("txBox"),m=c.childElementOptional("p:spPr","a:blipFill","a:stretch","a:fillRect"),g=(m?m.attr.getNumber("l",0)/Tv:0)*u,y=(m?m.attr.getNumber("b",0)/Tv:0)*l,b=(m?m.attr.getNumber("r",0)/Tv:0)*u,k=(m?m.attr.getNumber("t",0)/Tv:0)*l;if(r){var w=h.getAlphaModFix();v||(a=Zf.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},e));var S=d.loadURL(p,r);o=Zf.default.createElement(jg,{innerref:this.imageElement,xlinkHref:S,href:S,width:Av(u-b-g),height:Av(l-y-k),x:Av(g),y:Av(k),opacity:w,clipPath:"url(#clippath-".concat(this.identification(),")"),preserveAspectRatio:"none"})}var x,I,C="connection"===this.graphType&&f.color||"shape"===this.graphType;return x=Rv(l)/Mv<1?"1px":Av(l),I=Rv(u)/Mv<1?"1px":Av(u),C?Zf.default.createElement("svg",{style:{position:"absolute",width:I,height:x,overflow:"visible"}},Zf.default.createElement("defs",null,a,t,Zf.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:mm(f.color),fill:mm(f.color),orient:"auto"},Zf.default.createElement("path",{d:"M 1 0 L 10 5 L 1 10 L 0 9 L 7.18 5 L 0 1 Z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:mm(f.color),fill:mm(f.color),orient:"auto"},Zf.default.createElement("path",{d:"M 9 0 L 0 5 L 9 10 L 10 9 L 2.82 5 L 10 1 L 9 0 Z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 L 3 5 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 L 7 5 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-oval-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-oval-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Zf.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:mm(f.color)})),Zf.default.createElement("marker",{id:"".concat(this.identification(),"-none")})),o,e):null}},{key:"render",value:function(){var e,t,n=this;this.pathElements={};var r,i=this.props,a=i.width,o=i.height,s=i.shapeXML,c=i.fillColor,u=i.borderStyle,l=i.children,h=new hg({w:a,h:o}),d="";if(this.prestGeomXML){var p=this.prestGeomXML.attr.getString("prst");this.injectAdjustValue(this.prestGeomXML,h),r=fg(p)}else this.custGeomXML?(r=this.custGeomXML,d="a:"):r=fg("rect");var f=og.none,v=og.none,m=s.childElementOptional("p:spPr","a:ln","a:headEnd"),g=s.childElementOptional("p:spPr","a:ln","a:tailEnd"),y=(null==(e=null==m?void 0:m.parent)?void 0:e.attr.getNumber("w",Ig))||(null==(t=null==g?void 0:g.parent)?void 0:t.attr.getNumber("w",Ig))||Ig,b=Math.max(y/Mv*3,10);if(m){var k=m.attr.getString("type","none");f=vg(k)}if(g){var w=g.attr.getString("type","none");v=vg(w)}var S=this.useBgFill?this.fillColor:c,x=this.updateFillColor(S,!1),I=x.fillColor,C=x.colorStops,P=x.imageResId,M=x.path,T=x.rotation,O=null;C.length>0&&(O=M?Zf.default.createElement("radialGradient",{id:"".concat(this.identification(),"-gradient-fill"),gradientTransform:"rotate(".concat(T,")")},C.map((function(e,t){return Zf.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:mm(e.color)})}))):Zf.default.createElement("linearGradient",{id:"".concat(this.identification(),"-gradient-fill"),gradientTransform:"rotate(".concat(T,")")},C.map((function(e,t){return Zf.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:mm(e.color)})}))));var E=(new dg).renderLumiaPath(r,h,d).map((function(e,t){var r="none"!==e.fill?I:"none",i=e.isBorder?mm(u.color):"none";0===C.length&&(I&&e.fill&&(r=gm(I,e.fill)),!s.childElementOptional("p:spPr","a:ln","a:solidFill")&&"none"!==I&&(i=gm(i,sm.Darken)));var c={};return"none"!==e.fill&&0===C.length&&(c.fill=n.getCssVaribleColor(e.fill)),Zf.default.createElement("path",{ref:function(e){n.pathElements[t.toString()]=e},key:"path".concat(t),d:e.pathD,style:c,fill:P?"none":r,height:Av(o),width:Av(a),stroke:i,strokeWidth:Av(u.width),strokeDasharray:u.strokeDashArray,markerStart:"url(#".concat(n.identification(),"-").concat(og[f],"-start)"),markerEnd:"url(#".concat(n.identification(),"-").concat(og[v],"-end)")})})),A=h.accessValue("rectLeft"),N=h.accessValue("rectTop"),R=h.accessValue("rectRight")-h.accessValue("rectLeft"),L=h.accessValue("rectBottom")-h.accessValue("rectTop"),j=Zf.default.Children.map(l,(function(e){return Zf.default.cloneElement(e,{left:A,right:N,width:R,height:L})}));return Zf.default.createElement(Zf.default.Fragment,null,j,this.renderSVG(E,O,b,P))}}]),n}(Zf.default.Component),zg=["textPlain"];!function(e){e.textNoShape="textNoShape",e.textPlain="textPlain",e.textRingInside="textRingInside",e.textRingOutside="textRingOutside"}(Tg||(Tg={}));var Fg=function(e){m(n,e);var t=y(n);function n(e){var r,i;M(this,n),(r=t.call(this,e)).contentWidth=0,r.fontRowCount=0;var a=e.textBodyWrapResource;r.gbDataList=e.shapeGuideList.map((function(e){return c({},e.attr.getString("name"),e.attr.getString("fmla"))})),r.textContent=null==(i=e.textBodyWrapResource.paragraphs[0].runs)?void 0:i.map((function(e){return e.text})).join(""),r.height=Lv(a.prop.height),r.width=Lv(a.prop.width);var o=0;return a.paragraphs.forEach((function(e){r.fontRowCount+=e.lines.length,e.lines.forEach((function(e){var t=0;e.forEach((function(e){t+=parseInt(e.prop.width,10),o||(o=e.prop.lineSpacing),r.fontSize||(r.fontSize=Lv(e.prop.size))})),r.contentWidth=Math.max(r.contentWidth,t)}))})),r.contentHeight=jv((r.fontRowCount-1)*o+r.fontSize||r.fontSize),r}return O(n,[{key:"textNoShape",value:function(){var e=this,t={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(this.height,"pt"),width:"".concat(this.width,"pt"),justifyContent:"center",alignItems:"center"},n=this.height,r=this.width,i=this.contentWidth,a=this.contentHeight,o=Number.isNaN(r/i)?1:jv(r/i),s=Number.isNaN(n/a)?1:jv(n/a),c={margin:0,padding:0,fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),width:"".concat(this.fontSize,"pt"),display:"inline-block"},u=this.props.textBodyWrapResource;return Qf.default.createElement("div",{style:t},Qf.default.createElement("div",{ref:function(t){e.spanRef=t},style:{whiteSpace:"initial",transform:"scaleX(".concat(o,") scaleY(").concat(s,")")}},u.paragraphs.map((function(e,t){var n;return Qf.default.createElement("span",{key:t,style:{whiteSpace:"initial"}},null==(n=e.lines)?void 0:n.map((function(e,t){return Qf.default.createElement(Qf.default.Fragment,null,e.map((function(e){var n;return null==(n=e.text)?void 0:n.split("").map((function(e,n){return Qf.default.createElement("pre",{style:c,key:"".concat(t,"-").concat(n)},e)}))})),Qf.default.createElement("br",null))})))}))))}},{key:"textRing",value:function(e){var t,n,r,i=this,a=Math.atan(this.height/this.width),o=180*a/Math.PI,s=6e4;(null==(t=this.gbDataList[0])?void 0:t.adj)&&(s=Ym.deconstructShapeGuide(this.gbDataList[0].adj));var c=200,u=100,l=(1-Ev(s)*u)/this.fontSize;if(!(null==(n=this.textContent)?void 0:n.length))return this.textNoShape();var h=this.textContent.length;return Qf.default.createElement("div",{style:{display:"inline-block",position:"relative",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"scale(".concat(this.width/c,", ").concat(this.height/u/(Math.cos(a/180)*Math.PI),")")}},Qf.default.createElement("div",{style:{transformStyle:"preserve-3d",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"rotateX(".concat(-o,"deg)")}},null==(r=this.textContent)?void 0:r.split("").map((function(t,n){return Qf.default.createElement("span",{style:{position:"absolute",lineHeight:"".concat(i.fontSize,"pt"),left:"".concat(100-i.fontSize/2,"pt"),top:"".concat((u-i.fontSize)/2,"pt"),transform:e(n,h,l)},key:n},t)}))))}},{key:"textRingInside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(70-340/t*e,"deg) translateZ(").concat(-100,"pt) scaleY(").concat(n,")")}))}},{key:"textRingOutside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(320*e/(t-1)-60,"deg) translateZ(",100,"pt) scaleY(").concat(n,")")}))}},{key:"textPlain",value:function(){var e=this,t=this.gbDataList[0]?Ym.deconstructShapeGuide(this.gbDataList[0].adj):5e4,n=this.width,r=this.height,i=Ev(t),a=i>.5?(2*i-1)*n:(1-2*i)*n,o=Math.atan(a/r),s=180*o/Math.PI;i<.5&&(s=-s);var c={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"0, 0",height:"".concat(r,"pt"),width:"".concat(n,"pt"),justifyContent:"center",alignItems:"center"},u={display:"block",lineHeight:"".concat(this.fontSize,"pt"),textAlign:"center"},l={display:"inline-block",fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),transformOrigin:"50% 0",margin:0,padding:"0"},h=this.contentWidth,d=this.contentHeight,p=Number.isNaN(n/h)?1:jv(n)/(h+Math.tan(o)*jv(r)),f=Number.isNaN(r/d)?1:jv(r/d),v=0,m=this.props.textBodyWrapResource;return Qf.default.createElement("div",{style:Iv({},c)},Qf.default.createElement("div",{ref:function(t){e.spanRef=t},style:Cv(Iv({},u),{whiteSpace:"initial",transform:"skew(".concat(s,"deg) scaleY(").concat(f,") scaleX(").concat(p,")")})},m.paragraphs.map((function(t,n){var r;return Qf.default.createElement("div",{key:"wordart-".concat(n),style:Cv(Iv({},u),{whiteSpace:"initial"})},null==(r=t.lines)?void 0:r.map((function(n,r){var i=1===e.fontRowCount?e.fontSize:n[0].prop.lineSpacing,a={};return(0===v||v===e.fontRowCount-1)&&(i=(i+e.fontSize)/2,a.display="flex",v===e.fontRowCount-1&&(a.alignItems="flex-end")),"l"===t.prop.align||"just"===t.prop.align?a.justifyContent="flex-start":"r"===t.prop.align?a.justifyContent="flex-end":"dist"===t.prop.align?a.justifyContent="space-between":"ctr"===t.prop.align&&(a.justifyContent="center"),v+=1,Qf.default.createElement("div",{key:n[0].text+r.toString(),style:Iv({whiteSpace:"nowrap",lineHeight:"".concat(i,"pt")},a)},n.map((function(e){var t;return null==(t=e.text)?void 0:t.split("").map((function(t,n){return Qf.default.createElement("pre",{style:Cv(Iv({},l),{fontFamily:e.prop.font}),key:n},t)}))})),Qf.default.createElement("br",null))})))}))))}},{key:"render",value:function(){var e=this.props.presetType;return this[e]?this[e]():this.textNoShape()}}]),n}(Qf.default.Component),Bg=function(){function e(){M(this,e),this.indexByLevel=new Map,this.startAtByLevel=new Map}return O(e,[{key:"get",value:function(e,t,n){var r=e.extraAttr.getNumber("level");if(this.indexByLevel.has(r)||(this.indexByLevel.set(r,0),this.startAtByLevel.set(r,-1)),t!==this.startAtByLevel.get(r))this.indexByLevel.set(r,0),this.startAtByLevel.set(r,t);else{var i=this.indexByLevel.get(r);n&&(i+=1,this.indexByLevel.set(r,i))}return this.indexByLevel.get(r)}},{key:"reset",value:function(){this.indexByLevel=new Map,this.startAtByLevel=new Map}}]),e}(),Ug=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).buIndexCounter=new Bg,r.paragraphBulletInfo=[];var i=r.props,a=i.txBodyXML,o=i.textBodyWrapResource,s=i.flipH,c=i.insideTable,u=i.totalPadding,l=i.height,h=i.width,d=i.right,p=i.left;r.bodyPrXML=a.childElement("a:bodyPr"),r.paragraphXMLs=a.elementsWithName("a:p");var f=r.bodyPrXML.childElementOptional("a:prstTxWarp");f&&(r.presetType=f.attr.getString("prst","textNoShape"));var v=r.bodyPrXML.extraAttr.getString("anchor","t"),m=r.bodyPrXML.extraAttr.getString("wrap","square");r.isTextWrap="square"===m,r.spcFirstLastPara=r.bodyPrXML.extraAttr.getBoolean("spcFirstLastPara",!1),r.anchorCtr=r.bodyPrXML.extraAttr.getBoolean("anchorCtr",!1);var g,y=r.bodyPrXML.extraAttr.getNumber("numCol",1),b=0,k=0;if(o){var w=o.prop;r.vert=w.vert,r.paddingLeft=w.lIns*Mv,r.paddingRight=w.rIns*Mv,b=w.tIns*Mv,k=w.bIns*Mv}else r.vert=function(e){var t=e.childElement("a:bodyPr").attr.getStringOptional("vert");if(!t){var n=e.parentElementOptional("a:tc");if(n){var r=n.childElementOptional("a:tcPr");r&&(t=r.attr.getStringOptional("vert"))}}return t||Am.Horz}(a),r.paddingLeft=r.bodyPrXML.extraAttr.getNumber("lIns",91440),r.paddingRight=r.bodyPrXML.extraAttr.getNumber("rIns",91440),b=r.bodyPrXML.extraAttr.getNumber("tIns",45720),k=r.bodyPrXML.extraAttr.getNumber("bIns",45720);return s&&(g="scale(-1, 1)"),r.rectStyle=c?{position:"relative",left:0,top:0,width:Av(h),paddingTop:Av(b-u/2),paddingBottom:Av(k-u/2),height:"calc(100% - ".concat(Av(u),")"),transform:g}:{position:"absolute",left:Av(void 0===p?0:p),top:Av(void 0===d?0:d),width:Av(h),height:Av(l),transform:g},r.rectStyle=Iv({display:"inline-flex",flexDirection:"column",alignItems:r.anchorCtr?"center":"flex-start",justifyContent:Sm(v),zIndex:9999,paddingLeft:Av(r.paddingLeft),paddingTop:Av(b),paddingRight:Av(r.paddingRight),paddingBottom:Av(k),boxSizing:"border-box",whiteSpace:r.isTextWrap?"normal":"nowrap",columnCount:1===y?void 0:y},r.rectStyle),r.updateRectStyleByWrapResource(),r.generateParagraphBulletInfo(),r}return O(n,[{key:"updateRectStyleByWrapResource",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.prop.anchor;this.rectStyle=Cv(Iv({},this.rectStyle),{justifyContent:Sm(t)}),this.rectStyle=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;switch(n){case Am.EaVert:return Cv(Iv({},r),{writingMode:Lm(n)});case Am.WordArtVert:case Am.WordArtVertRtl:return Cv(Iv({},r),{writingMode:Lm(n),textOrientation:"upright"});case Am.Vert:var a=jm(i,r,n),o=null!=(e=r.transform)?e:"";return Cv(Iv(Iv({},r),a),{position:"absolute",minHeight:i.insideTable?void 0:a.height,paddingLeft:r.paddingBottom,paddingTop:r.paddingLeft,paddingRight:r.paddingTop,paddingBottom:r.paddingRight,transform:"".concat(o," rotate(90deg)")});case Am.Vert270:var s=jm(i,r,n),c=null!=(t=r.transform)?t:"";return Cv(Iv(Iv({},r),s),{position:"absolute",minHeight:i.insideTable?void 0:s.height,paddingLeft:r.paddingTop,paddingTop:r.paddingRight,paddingRight:r.paddingBottom,paddingBottom:r.paddingLeft,transform:"".concat(c," rotate(-90deg)")});default:return r}}(this.vert,this.rectStyle,this.props)}}},{key:"generateParagraphBulletInfo",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.paragraphs.map((function(e){var t,n;return{autoNumber:null==(t=e.prop.bulletChar)?void 0:t.autoNumber,autoNumberType:null==(n=e.prop.bulletChar)?void 0:n.autoNumberType,level:e.prop.level,empty:0===e.lines.length}})),n=[0,0,0,0,0,0,0,0,0];this.paragraphBulletInfo=t.map((function(e,r){var i=e.level,a=e.autoNumberType;if(n=n.map((function(e,t){return t>i?0:t===i?a?e:0:e})),a){var o=e.autoNumber;if(r>0&&t[r-1].autoNumber!==o&&(n[i]=0),e.empty)return{order:r,count:t.length};var s=n[i];return n[i]=s+1,{number:s+(o||1),order:r,count:t.length}}return{order:r,count:t.length}}))}}},{key:"renderParagraph",value:function(e,t,n,r,i,a,o,s){var c=e.elements.find((function(e){return"a:r"===e.name})),u=this.props,l=u.slideContext,h=u.width,d=u.height,p=u.uuid,f=u.resourceType,v=u.withAnimation;return cd.default.createElement(Hm,{key:"".concat(n),slideContext:l,isTextWrap:o,width:h,height:d,paragraphIndex:n,firstRangeXML:c,buIndexCounter:this.buIndexCounter,paragraphXML:e,bodyPrXML:t,uuid:p,round:0,spcFirstLastPara:r,isFirst:i,isLast:a,vert:this.vert,resourceType:f,paragraphWrapResource:s,withAnimation:!!v,bulletInfo:this.paragraphBulletInfo[n]})}},{key:"render",value:function(){var e=this,t=this.props,n=t.textBodyWrapResource,r=t.width;if(this.presetType&&this.presetType!==Tg.textNoShape&&zg.includes(this.presetType)&&n){var i=this.bodyPrXML.childElementOptional("a:prstTxWarp"),a=null==i?void 0:i.childElementOptional("a:avLst"),o=(null==a?void 0:a.elementsWithName("a:gd"))||[];return cd.default.createElement("div",{style:Cv(Iv({},this.rectStyle),{display:"flex",justifyContent:"center",alignItems:"center",padding:0}),className:"txBody"},cd.default.createElement(Fg,{presetType:this.presetType,shapeGuideList:o,textBodyWrapResource:n}))}var s,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Am.Horz;return e!==Am.Horz?{maxHeight:"100%",width:void 0}:{}}(this.vert);return s=n?this.paragraphXMLs.map((function(t,r){return e.renderParagraph(t,e.bodyPrXML,r,e.spcFirstLastPara,0===r,r===e.paragraphXMLs.length-1,e.isTextWrap,n.paragraphs[r])})):this.paragraphXMLs.map((function(t,n){return e.renderParagraph(t,e.bodyPrXML,n,e.spcFirstLastPara,0===n,n===e.paragraphXMLs.length-1,e.isTextWrap)})),this.buIndexCounter.reset(),cd.default.createElement("div",{className:"txBoby",style:this.rectStyle},cd.default.createElement("ol",{style:Iv({width:Av(r-this.paddingLeft-this.paddingRight),marginBlockEnd:0,marginBlockStart:0,paddingBlockStart:0,paddingBlockEnd:0,marginInlineEnd:0,marginInlineStart:0,paddingInlineStart:0,paddingInlineEnd:0,margin:0,padding:0,whiteSpace:this.isTextWrap?"normal":"nowrap"},c)},s))}}]),n}(cd.default.Component),Vg=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"renderCol",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=function(){var e;return(e=[]).concat.apply(e,arguments).reduce((function(e,t){return e+t}),0)},c=e.childElementOptional("a:tcPr");if(!c)return null;var u=c.extraAttr.getColor("".concat(t,"-").concat(n,"-fillColor"),um),l=c.extraAttr.getStringOptional("".concat(t,"-").concat(n,"-fontFamily")),h=c.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isBold"),!1),d=c.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isItalic"),!1),p=c.extraAttr.getString("".concat(t,"-").concat(n,"-bottomBorderStyle"),"none"),f=c.extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0),v=c.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-bottomBorderColor"),um),m=c.extraAttr.getString("".concat(t,"-").concat(n,"-topBorderStyle"),"none"),g=c.extraAttr.getNumber("".concat(t,"-").concat(n,"-topBorderWidth"),0),y=c.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-topBorderColor"),um),b=c.extraAttr.getString("".concat(t,"-").concat(n,"-leftBorderStyle"),"none"),k=c.extraAttr.getNumber("".concat(t,"-").concat(n,"-leftBorderWidth"),0),w=c.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-leftBorderColor"),um),S=c.extraAttr.getString("".concat(t,"-").concat(n,"-rightBorderStyle"),"none"),x=c.extraAttr.getNumber("".concat(t,"-").concat(n,"-rightBorderWidth"),0),I=c.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-rightBorderColor"),um),C=e.childElementOptional("a:txBody");if(void 0===C)return null;var P=e.attr.getNumber("gridSpan",1),M=e.attr.getNumber("rowSpan",1),T=e.attr.getBoolean("hMerge",!1),O=e.attr.getBoolean("vMerge",!1),E=s(a.slice(n,n+P)),A="".concat(t,"-").concat(n),N=this.props,R=N.slideContext,L=N.uuid,j=N.shapeWrapResource;return T||O?null:sd.default.createElement("td",{colSpan:P,rowSpan:M,style:{position:"relative",fontFamily:l&&l,fontWeight:h?500:400,fontStyle:d?"italic":"normal",borderBottomStyle:p,borderTopStyle:m,borderLeftStyle:b,borderRightStyle:S,borderBottomWidth:Av(f),borderTopWidth:Av(g),borderLeftWidth:Av(k),borderRightWidth:Av(x),borderBottomColor:mm(v),borderTopColor:mm(y),borderLeftColor:mm(w),borderRightColor:mm(I),width:Av(E),height:Av(i),backgroundColor:mm(u),boxSizing:"border-box",fontSize:0,lineHeight:0},key:"tc-".concat(t,"-").concat(n),className:"tc-".concat(t,"-").concat(n)},sd.default.createElement(Ug,{slideContext:R,insideTable:!0,width:E,height:i,totalPadding:o,uuid:L,txBodyXML:C,resourceType:"slide",textBodyWrapResource:null==j?void 0:j.textBodyMap[A]}))}},{key:"render",value:function(){var e=this,t=this.props.graphXML.childElementOptional("a:graphic","a:graphicData","a:tbl"),n=t&&t.childElement("a:tblGrid"),r=n?n.elementsWithName("a:gridCol"):[],i=t?t.elementsWithName("a:tr"):[],a=i.length,o=0;if(a>0){var s=0;i.forEach((function(e,t){if(0===t){var n=0;e.elementsWithName("a:tc").forEach((function(e,r){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(r,"-topBorderWidth"),0);n=Math.max(i,n)})),s+=n}var r=0;e.elementsWithName("a:tc").forEach((function(e,n){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0);r=Math.max(i,r)})),s+=r})),o=s/a}var c=i.map((function(t,n){var i=t.attr.getNumber("h"),a=t.elementsWithName("a:tc").map((function(e,t){return r[t].attr.getNumber("w")})),s=t.elementsWithName("a:tc").map((function(t,s){var c=r[s].attr.getNumber("w");return e.renderCol(t,n,s,c,i,a,o)}));return sd.default.createElement("tr",{key:"tr-"+n},s)}));return sd.default.createElement("table",{style:{borderCollapse:"collapse"},cellSpacing:"0",cellPadding:"0"},sd.default.createElement("tbody",null,c))}}]),n}(sd.default.Component),Wg=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new mg(e.logger).createMonitor(),r}return O(n,[{key:"getId",value:function(){var e=this.props.graphXML,t=e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getStringOptional("id");return t?"spId".concat(t):e.parent&&"mc:Choice"===e.parent.name?this.getResId():void 0}},{key:"getResId",value:function(){var e,t=null==(e=this.props.graphXML.parent)?void 0:e.parent;if(t){var n=t.childElementOptional("mc:Fallback","p:pic","p:blipFill","a:blip");return n?n.attr.getStringOptional("r:embed"):void 0}}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return r?t.resourceLoader.loadURL(n,r):void 0}},{key:"render",value:function(){if(!this.url)return null;var e=this.props,t=e.width,n=e.height;return qf.default.createElement("img",{src:this.url,alt:"graph",style:{width:Av(t),height:Av(n)},ref:this.imageLoadingMonitor})}}]),n}(qf.default.Component),Hg=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new mg(e.logger).createMonitor(),r}return O(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return Jf.default.createElement("img",{src:this.url,alt:"diagram",style:{width:Av(t),height:Av(n)},ref:this.imageLoadingMonitor})}}]),n}(Jf.default.Component),_g=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"render",value:function(){return $f.default.createElement("div",null)}}]),n}($f.default.PureComponent),Gg=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new mg(e.logger).createMonitor(),r}return O(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){if(this.url){var e=this.props,t=e.width,n=e.height;return ev.default.createElement("img",{src:this.url,alt:"oleGraph",style:{width:Av(t),height:Av(n)},ref:this.imageLoadingMonitor})}return ev.default.createElement("div",null)}}]),n}(ev.default.Component),Yg=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n);var i=(r=t.call(this,e)).props.graphXML;return r.uri=i.childElement("a:graphic","a:graphicData").attr.getStringOptional("uri"),r}return O(n,[{key:"subGraphClassWithURI",value:function(e){switch(e){case"http://schemas.openxmlformats.org/drawingml/2006/table":return Vg;case"http://schemas.microsoft.com/office/drawing/2014/chartex":case"http://schemas.openxmlformats.org/drawingml/2006/chart":return Wg;case"http://schemas.openxmlformats.org/drawingml/2006/diagram":return Hg;case"http://schemas.openxmlformats.org/presentationml/2006/ole":return Gg;default:return console.debug("Unsupported graph",e),_g}}},{key:"render",value:function(){var e=this.subGraphClassWithURI(this.uri);return od.default.createElement(e,Iv({},this.props))}}]),n}(od.default.Component),Xg=function(e){var t=e.startTime,n=e.endTime,r=e.duration;return t&&(r-=t),n&&(r-=n),r},Qg=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).state={total:Xg(e)},r}return O(n,[{key:"componentDidMount",value:function(){var e=this.props.protalId;this.controllerPortal=document.getElementById(e)}},{key:"onPlayClick",value:function(e){var t=this.props.onPlayClick;e.stopPropagation(),t()}},{key:"onPauseClick",value:function(e){var t=this.props.onPauseClick;e.stopPropagation(),t()}},{key:"onBarClick",value:function(e){var t=this.props,n=t.duration,r=t.startTime,i=t.endTime,a=t.onSeekClick;if(e.stopPropagation(),n){var o=this.props.duration;r&&(o-=r),i&&(o-=i);var s=e.nativeEvent.offsetX/e.currentTarget.clientWidth*o;r&&(s+=r),a(Math.floor(s))}}},{key:"computedCurrent",value:function(){var e=this.props.startTime,t=this.props.currentTime,n=this.state.total;return e&&(t>e?t-=e:t=0),t>n&&(t=n),t}},{key:"formatTime",value:function(e){var t="00:00";if(e){var n=Math.floor(e/60),r=String(n<0?0:n).padStart(2,"0"),i=Math.floor(e%60),a=String(i<0?0:i).padStart(2,"0");t="".concat(r,":").concat(a)}return t}},{key:"renderController",value:function(e){var t=this.props,n=t.display,r=t.style,i=t.controllerRef,a=t.resourceLoader,o=t.playing,s=this.state.total;return nv.default.createElement("div",{className:"ppt-event-source",style:Iv({background:"#FFFFFF",borderRadius:50,height:50,width:300,display:n?"flex":"none",flexDirection:"row",alignItems:"center"},r),ref:i},nv.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"none":"block"},onClick:this.onPlayClick.bind(this)},nv.default.createElement("img",{style:{height:20},alt:"play",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/play.png")})),nv.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"block":"none"},onClick:this.onPauseClick.bind(this)},nv.default.createElement("img",{style:{height:20},alt:"pause",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/pause.png")})),nv.default.createElement("div",{style:{width:100},className:"timer"},nv.default.createElement("span",{className:"current"},this.formatTime(this.computedCurrent())),nv.default.createElement("span",null,"/"),nv.default.createElement("span",{className:"total"},this.formatTime(s))),nv.default.createElement("div",{className:"ppt-event-source",style:{flex:1,position:"relative",marginRight:10},onMouseDown:this.onBarClick.bind(this)},nv.default.createElement("div",{style:{background:"#D9D9D9",position:"relative",height:10,display:"flex"},className:"total"},nv.default.createElement("div",{style:{background:"#4F4F4F",top:0,left:0,height:10,flex:e},className:"played"}))))}},{key:"render",value:function(){var e=this.props,t=e.duration,n=e.endTime,r=e.currentTime,i=e.playing,a=e.onMediaEnd,o=this.state.total;n&&(t>0&&r+n>=t&&i&&a());var s=0;return t&&(s=this.computedCurrent()/o),this.controllerPortal?(0,rv.createPortal)(this.renderController(s),this.controllerPortal):this.renderController(s)}}],[{key:"getDerivedStateFromProps",value:function(e){return{total:Xg(e)}}}]),n}(nv.default.Component),Zg=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=tv.default.createRef(),r.controller=tv.default.createRef(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return O(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.disableAnimation,r=t.outsidePausing,i=t.mediaState,a=t.rtcClient,o=this.state.playing;!0!==n&&(r||!e.outsidePausing)?!r||e.outsidePausing?void 0===i||i.playing!==e.mediaState.playing||i.currentTime!==e.mediaState.currentTime?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===i&&void 0!==e.mediaState?void 0===i&&void 0!==e.mediaState&&(this.player.current&&(this.pauseAudio(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playAudio():this.pauseAudio()),this.setState(e.mediaState)):void 0!==i&&void 0!==e.mediaState&&this.player.current&&(i.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==a||a.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,o&&!e.mediaState.playing?this.pauseAudio():!o&&e.mediaState.playing&&this.playAudio(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):o!==i.playing&&this.setState({playing:i.playing}):this.player.current&&this.playAudio():this.player.current&&this.pauseAudio()}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseAudio():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playAudio()))}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),p=l/parseFloat(getComputedStyle(n.current).width),f=0,v=0;null!==d&&null!==d.width&&(f=parseInt(d.width,10)*p),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*p);var m=0,g=0;g=i<c?0:c+l<i+f?l-f:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/p,controllerPositionLeft:g/p})}}},{key:"onMediaPlay",value:function(){var e=this.props,t=e.onMediaPlay,n=e.shapeId,r=this.state.currentTime;t&&t(n,"audio",r)}},{key:"onMediaPause",value:function(){var e=this.props,t=e.onMediaPause,n=e.shapeId,r=this.state.currentTime;this.stopSyncPlayTime(),t&&t(n,"audio",r)}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.props,n=t.mediaRef,r=t.onMediaChange,i=t.shapeId,a=this.state.currentTime,o=n.startTime,s=n.endTime,c=e||a,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<o&&(l=o),r({playing:!0,currentTime:l},i)}}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"pauseAudio",value:function(){var e=this;this.player.current&&(void 0!==this.props.rtcClient?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalAudio",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play audio exception: ".concat(e)):console.error(e),n&&n(i,"audio",e)}))}}},{key:"playAudio",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalAudio.bind(this)):this.playLocalAudio())}},{key:"mixAudio",value:function(e,t){var n=this,r=this.props,i=r.rtcClient,a=r.audioURL,o=r.logger;this.state.playing?(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==i||i.startAudioMixing(a,!0,!1,1,(function(r,a){714===r?(null==o||o.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current){var t=this.props,n=t.startTime,r=t.startTimePerfix,i=this.state.playing;1===e.play&&this.player.current.paused&&(this.player.current.currentTime=n?r+n:r,this.playAudio(),this.setState({playing:!0,currentTime:this.player.current.currentTime})),1===e.stop&&this.player.current&&i&&(this.pauseAudio(),this.setState({playing:!1}))}}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"UNSAFE_componentWillReceivePropseslintreact",value:function(){this.pauseAudio(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.resourceLoader,r=t.width,i=t.height,a=t.rtcClient,o=t.audioURL,s=t.logger,c=t.controllerProtalId,u=t.mediaRef,l=this.state,h=l.controllerPositionTop,d=l.controllerPositionLeft,p=l.displayController,f=l.duration,v=l.playing,m=l.currentTime;return tv.default.createElement("div",{style:{position:"relative"},onMouseLeave:function(){return e.setState({displayController:!1})}},tv.default.createElement("img",{className:"ppt-event-source",alt:"audio",src:n.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/audio.png"),style:{width:Av(r),height:Av(i)},onMouseOver:this.onMouseOver.bind(this)}),tv.default.createElement("audio",{src:o,ref:this.player,muted:!!a,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(o," error, code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(o," error without error message"))}}),tv.default.createElement(Qg,{controllerRef:this.controller,protalId:c,style:{position:"absolute",top:h,left:d,zIndex:1},resourceLoader:n,mediaRef:this.player,display:p,playing:v,duration:f,currentTime:m,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){var t=e.props,n=t.onMediaChange,r=t.shapeId,i=e.state.currentTime;e.stopSyncPlayTime(),e.pauseAudio(),n&&n({playing:!1,currentTime:i},r)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseAudio(),e.setState({playing:!1})},endTime:u.endTime,startTime:u.startTime}))}}]),n}(tv.default.Component),Kg=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new Ym(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"render",value:function(){var e,t=this.props,n=t.shapeXML,r=t.width,i=t.height,a=t.fillColor,o=t.borderStyle,s=t.children,c=n.childElementOptional("p:spPr","a:prstGeom"),u=n.childElementOptional("p:spPr","a:custGeom"),l=new hg({w:r,h:i}),h="";if(c){var d=c.attr.getString("prst");this.injectAdjustValue(c,l),e=fg(d)}else u?(e=u,h="a:"):e=fg("rect");var p=(new dg).renderLumiaPath(e,l,h).map((function(e,t){return av.default.createElement("path",{key:"path".concat(t),d:e.pathD,fill:mm(a),height:Av(i),width:Av(r),stroke:mm(o.color),strokeWidth:Av(o.width),strokeDasharray:o.strokeDashArray})}));return av.default.createElement("svg",{style:{position:"absolute",width:Av(r),height:Av(i),overflow:"visible"}},av.default.createElement("defs",null,av.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},p)),s,p)}}]),n}(av.default.Component),qg=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).spId="",r.opacity=1,r.imageLoadingMonitor=new mg(e.logger).createMonitor(),r.svgLoadingMonitor=new mg(e.logger).createMonitor(),r.spId=e.imageXML.extraAttr.getString("spId"),r.getAlphaModFix(),r}return O(n,[{key:"hasSoftEdge",get:function(){var e=this.props.imageXML.childElementOptional("p:spPr","a:effectLst","a:softEdge");return Boolean(e)}},{key:"hasBlipChild",get:function(){var e=this.props.imageXML.childElementOptional("p:blipFill","a:blip");return Boolean(null==e?void 0:e.elements.length)}},{key:"needSpUrl",get:function(){return this.hasSoftEdge||this.hasBlipChild}},{key:"getAlphaModFix",value:function(){var e=this.props.imageXML.childElement("p:blipFill"),t=new hm(e).getAlphaModFix();t&&(this.opacity=t)}},{key:"identification",value:function(){var e=this.props.slideIndex;return"".concat(e,"-").concat(this.spId,"-")}},{key:"render",value:function(){var e=this.props,t=e.imageXML,n=e.width,r=e.height,i=e.spURL,a=e.imageURL,o=e.margin,s=e.uuid,c=e.slideIndex,u=e.borderStyle,l=t.childElementOptional("p:blipFill","a:stretch","a:fillRect"),h=(l?l.attr.getNumber("l",0)/Tv:0)*n,d=(l?l.attr.getNumber("b",0)/Tv:0)*r,p=(l?l.attr.getNumber("r",0)/Tv:0)*n,f=(l?l.attr.getNumber("t",0)/Tv:0)*r;if(void 0===t.childElementOptional("p:spPr",new Hv("a:prstGeom","a:custGeom"))){var v=t.childElementOptional("p:blipFill","a:srcRect"),m={top:0,left:0,right:0,bottom:0};return v&&(m.top=Ev(v.attr.getNumber("t",0)),m.left=Ev(v.attr.getNumber("l",0)),m.right=Ev(v.attr.getNumber("r",0)),m.bottom=Ev(v.attr.getNumber("b",0))),iv.default.createElement("div",{style:{overflow:"hidden",height:"100%"}},iv.default.createElement("img",{src:a,style:{width:Av(n),height:Av(r),position:"relative",top:"".concat(Av(r*-m.top)),left:"".concat(Av(n*-m.left))},alt:"",ref:this.imageLoadingMonitor}))}var g,y,b,k,w=this.needSpUrl?i:a,S=this.needSpUrl?1:this.opacity;return this.needSpUrl&&i?(g=n-o.left-o.right,y=r-o.top-o.bottom,b=void 0,k=void 0):(g=n-h-p,y=r-f-d,b=Av(-o.left+h),k=Av(-o.top+f)),iv.default.createElement(Kg,{uuid:s,slideIndex:c,borderStyle:u,width:n-o.left-o.right,height:r-o.top-o.bottom,shapeXML:t,spId:this.spId},iv.default.createElement(jg,{innerref:this.svgLoadingMonitor,preserveAspectRatio:"none",xlinkHref:w||a,href:w||a,x:b,y:k,width:Av(g),height:Av(y),clipPath:"url(#clippath-".concat(this.identification(),")"),opacity:S}))}}]),n}(iv.default.Component),Jg=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=ov.default.createRef(),r.controller=ov.default.createRef(),r.imageLoadingMonitor=new mg(e.logger).createMonitor(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return O(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.state.playing,n=this.props,r=n.disableAnimation,i=n.outsidePausing,a=n.mediaState,o=n.rtcClient;!0!==r&&(i||!e.outsidePausing)?!i||e.outsidePausing?void 0===a||a.playing!==e.mediaState.playing||a.currentTime!==e.mediaState.currentTime?void 0===a&&void 0!==e.mediaState?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===a&&void 0!==e.mediaState&&(this.player.current&&(this.pauseVideo(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playVideo():this.pauseVideo()),this.setState(e.mediaState))):void 0!==a&&void 0!==e.mediaState&&(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),this.player.current&&(a.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==o||o.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,t&&!e.mediaState.playing?this.pauseVideo():!t&&e.mediaState.playing&&this.playVideo(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):t!==a.playing&&this.setState({playing:a.playing}):this.player.current&&this.playVideo():this.player.current&&this.pauseVideo()}},{key:"componentWillUnmount",value:function(){this.pauseVideo(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"onMediaPause",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPause,r=t.shapeId;this.stopSyncPlayTime(),n&&n(r,"video",e)}},{key:"onMediaPlay",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPlay,r=t.shapeId;n&&n(r,"video",e)}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),p=l/parseFloat(getComputedStyle(n.current).width),f=0,v=0;null!==d&&null!==d.width&&(f=parseInt(d.width,10)*p),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*p);var m=0,g=0;g=i<c?0:c+l<i+f?l-f:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/p,controllerPositionLeft:g/p})}}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseVideo():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playVideo()))}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"mixAudio",value:function(e,t){var n=this,r=this.state.playing,i=this.props,a=i.rtcClient,o=i.logger,s=i.videoURL;r?(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==a||a.startAudioMixing(s,!0,!1,1,(function(r,i){714===r?(null==o||o.error("rtc mixing error : ".concat(i)),console.error("rtc mixing error :",i)):(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current&&this.lastAnimeState){var t=this.state.playing,n=this.props,r=n.startTime,i=n.startTimePerfix;0===this.lastAnimeState.play&&1===e.play&&this.player.current&&(1===e.stop?t&&(this.pauseVideo(),this.setState({playing:!1})):t||(this.player.current.currentTime=r?i+r:i,this.playVideo(),this.setState({playing:!0}))),0===this.lastAnimeState.stop&&1===e.stop&&this.player.current&&t&&(this.pauseVideo(),this.setState({playing:!1}))}this.lastAnimeState=e}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.state.currentTime,n=this.props,r=n.mediaRef,i=n.onMediaChange,a=n.shapeId,o=r.startTime,s=r.endTime,c=e||t,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<=o&&(l=o),i({playing:!0,currentTime:l},a)}}},{key:"pauseVideo",value:function(){var e=this,t=this.props.rtcClient;this.player.current&&(void 0!==t?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalVideo",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play video exception: ".concat(e)):console.error(e),n&&n(i,"video",e)}))}}},{key:"playVideo",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalVideo.bind(this)):this.playLocalVideo())}},{key:"render",value:function(){var e=this,t=this.props,n=t.mediaRef,r=t.videoURL,i=t.width,a=t.height,o=t.rtcClient,s=t.logger,c=t.controllerProtalId,u=t.resourceLoader,l=t.onMediaChange,h=t.shapeId,d=this.state,p=d.controllerPositionTop,f=d.controllerPositionLeft,v=d.displayController,m=d.playing,g=d.duration,y=d.currentTime,b=n.startTime?1e3*n.startTime:1e4,k="".concat(r,"?x-oss-process=video/snapshot,t_").concat(b,",m_fast,w_800,f_png,ar_auto");return ov.default.createElement("div",{className:"ppt-event-source",style:{position:"relative",width:Av(i),height:Av(a)},onMouseLeave:function(){return e.setState({displayController:!1})}},ov.default.createElement("img",{src:k,alt:"poster",style:{position:"absolute",zIndex:0,top:0,left:0,width:Av(i),height:Av(a)},ref:this.imageLoadingMonitor}),ov.default.createElement("video",{className:"ppt-event-source","webkit-playsinline":"true",playsInline:!0,src:r,ref:this.player,muted:!!o,style:{position:"absolute",zIndex:1,top:0,left:0,width:Av(i),height:Av(a),objectFit:"fill"},poster:k,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(r," error,\n                                code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(r," error without error message"))},onMouseOver:this.onMouseOver.bind(this),preload:"auto"}),ov.default.createElement(Qg,{protalId:c,style:{position:"absolute",top:p,left:f,zIndex:2,backfaceVisibility:"hidden"},resourceLoader:u,controllerRef:this.controller,mediaRef:this.player,display:v,playing:m,duration:g,currentTime:y,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){e.stopSyncPlayTime(),l&&l({playing:!1,currentTime:y},h)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseVideo(),e.setState({playing:!1})},endTime:n.endTime,startTime:n.startTime}))}}]),n}(ov.default.Component),$g=function(){function e(t){M(this,e),this.spTreeXML=t}return O(e,[{key:"indexBySpId",value:function(){var e,t={},n=0,r=E(this.spTreeXML.elements);try{for(r.s();!(e=r.n()).done;){var i=e.value.extraAttr.getStringOptional("spId");"string"==typeof i&&(t[i]=n,n+=1)}}catch(e){r.e(e)}finally{r.f()}return t}}]),e}(),ey=function(e){m(n,e);var t=y(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).lumiaRef=sv.default.createRef(),e}return O(n,[{key:"renderTextBody",value:function(e){var t,n=this.props,r=n.shapeWrapResource,i=n.slideContext,a=n.width,o=n.height,s=n.resourceType,c=n.flipH,u=n.uuid,l=n.withAnimation;return r&&!r.prop.specialShape&&(t=r.textBodyMap[0]),sv.default.createElement(Ug,{slideContext:i,txBodyXML:e,width:a,height:o,resourceType:s,flipH:c,uuid:u,textBodyWrapResource:t,withAnimation:l})}},{key:"renderShape",value:function(e,t){var n,r,i=0,a=this.props,o=a.shapeGroupTransform,s=a.width,c=a.height,u=a.fillColor,l=a.groupFillColor,h=a.borderStyle,d=a.slideIndex,p=a.uuid,f=a.resourceLoader,v=a.resourceType,m=a.logger;if("p:sp"===e.name){var g=e.childElementOptional("p:spPr","a:xfrm");if(g){var y=g.attr.getNumber("rot",0);i=Number(y)/Ov}}if(o){var b=Cm(i,o);n=s*b.scaleX,r=c*b.scaleY}else n=s,r=c;return sv.default.createElement(Dg,{ref:this.lumiaRef,fillColor:u,groupFillColor:l,spId:e.extraAttr.getString("spId"),borderStyle:h,width:n,height:r,slideIndex:d,uuid:p,resourceLoader:f,resourceType:v,logger:m,shapeXML:e},t?this.renderTextBody(t):null)}},{key:"render",value:function(){var e=this.props.shapeXML,t=e.childElementOptional("p:txBody");return this.renderShape(e,t)}}]),n}(sv.default.PureComponent);function ty(e,t,n){return"".concat(n,"_").concat(t,"_").concat(e)}var ny="ppaction://hlinksldjump";function ry(e,t,n,r){var i,a={x:e.extraAttr.getNumber("x"),y:e.extraAttr.getNumber("y"),width:e.extraAttr.getNumber("width"),height:e.extraAttr.getNumber("height")},o=e.extraAttr.getBoolean("hidden"),s=e.extraAttr.getBoolean("flipV"),c=e.extraAttr.getBoolean("flipH"),u=e.extraAttr.getNumberOptional("rot"),l={color:e.extraAttr.getColor("borderColor"),width:e.extraAttr.getNumber("borderWidth"),type:e.extraAttr.getString("borderType"),strokeDashArray:e.extraAttr.getString("borderStrokeDashArray")};e.extraAttr.getOptional("fillColor")&&((i=e.extraAttr.getColor("fillColor"))instanceof lm&&i.setFillColor(r.fillColor));var h,d=e.childElementOptional("p:blipFill","a:srcRect");if(d){var p=Ev(d.attr.getNumber("l",0)),f=Ev(d.attr.getNumber("r",0)),v=Ev(d.attr.getNumber("t",0)),m=Ev(d.attr.getNumber("b",0)),g=a.width/(1-p-f),y=a.height/(1-v-m);h={width:g,height:y,margin:{left:g*p,top:y*v,right:g*f,bottom:y*m}}}var b,k=e.childElementOptional("p:nvSpPr","p:cNvPr","a:hlinkClick"),w=e.childElementOptional("p:nvPicPr","p:cNvPr","a:hlinkClick");return k&&k.attr.getStringOptional("action")===ny?b=k.attr.getStringOptional("r:id"):w&&w.attr.getStringOptional("action")===ny&&(b=w.attr.getStringOptional("r:id")),{rectangle:a,borderStyle:l,fillColor:i,tailor:h,flipV:s,flipH:c,rotate:u,parentGroupShapeId:n,hidden:o,hyperLinkDestination:b}}var iy=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).animeTarget=cv.default.createRef(),r.shapeMap=new km(ry),r.childrenRef=cv.default.createRef(),r.eventSourceId=void 0,r.emptyClick=function(){},r.onClick=function(){var e=r.props,t=e.onHyperLinkClick,n=e.onEventSourceClick;return r.shapeWrapperParams.hyperLinkDestination?t?t(r.shapeWrapperParams.hyperLinkDestination):void 0:void 0!==r.eventSourceId&&n?n(r.eventSourceId):void 0},r.state={soundEffectUrl:null};var i=e.shapeXML,a=e.resourceType,o=e.shapeGroupTransform,s=e.onEventSourceClick;if(r.spId=i.extraAttr.getString("spId"),r.resourceType=a,r.player=cv.default.createRef(),r.shapeWrapperParams=r.shapeMap.map(i,void 0,o),void 0!==e.eventSourceId)r.eventSourceId=e.eventSourceId;else{var c=ty(e.slideContext.uuid,e.slideContext.slideIndex,r.spId);e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==s&&(r.eventSourceId=c)}return r}return O(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===ty(t.uuid,t.slideIndex,e.spId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"getPositionAndSize",value:function(){var e,t,n,r,i=0,a=this.props,o=a.shapeXML,s=a.shapeGroupTransform;if("p:sp"===o.name||"p:pic"===o.name){var c=o.childElementOptional("p:spPr","a:xfrm");if(c){var u=c.attr.getNumber("rot",0);i=Number(u)/Ov}}if(s){var l=this.shapeWrapperParams.rectangle,h=l.x,d=l.y,p=l.width,f=l.height,v=s.scaleX,m=s.scaleY,g=s.translateX,y=s.translateY;Math.abs(Math.cos(i/180*Math.PI))>=Math.abs(Math.sin(i/180*Math.PI))?(e=Av((h+g)*v),t=Av((d+y)*m),n=Av(p*v),r=Av(f*m)):(e=Av((h+g+p/2)*v-p*m/2),t=Av((d+y+f/2)*m-f*v/2),n=Av(p*m),r=Av(f*v))}else e=Av(this.shapeWrapperParams.rectangle.x),t=Av(this.shapeWrapperParams.rectangle.y),n=Av(this.shapeWrapperParams.rectangle.width),r=Av(this.shapeWrapperParams.rectangle.height);return{left:e,top:t,width:n,height:r}}},{key:"transform",value:function(e,t){var n=this.transformWithAnimation(t),r=this.transformWithShapeParams(e,n),i=r.translateX,a=r.translateY,o=r.scaleX,s=r.scaleY,c=r.rotate,u=(e.rotate||0)+c;return o<0&&(u=-u),s<0&&(u=-u),"translate(".concat(Av(i),", ").concat(Av(a),") scale(").concat(o,",").concat(s,") rotate(").concat(Nv(u),"deg)")}},{key:"opacity",value:function(e){return wm(e,"opacity",1)}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"transformWithAnimation",value:function(e){return e?{translateX:wm(e,"translateX",0),translateY:wm(e,"translateY",0),scaleX:wm(e,"scaleX",1),scaleY:wm(e,"scaleY",1),rotate:wm(e,"rotate",0)}:{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0}}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"renderShape",value:function(e){var t=e.tailor,n={left:0,right:0,top:0,bottom:0},r=e.rectangle;t&&(r=Cv(Iv({},r),{width:t.width,height:t.height}),n=t.margin);var i=this.props,a=i.flipH,o=i.shapeGroupTransform,s=i.resourceType,c=!!a!==e.flipH;return this.renderChildren({play:e.play,stop:e.stop,width:r.width,height:r.height,borderStyle:e.borderStyle,fillColor:e.fillColor,rotate:e.rotate,margin:n,shapeGroupTransform:o,flipH:c,resoureType:s})}},{key:"renderChildren",value:function(e){var t=this.props.children;if("function"==typeof t){var n=t(e);return n&&cv.default.cloneElement(n,{ref:this.childrenRef})}return cv.default.cloneElement(t,{ref:this.childrenRef})}},{key:"render",value:function(){var e,t=this.state.soundEffectUrl,n=this.getPositionAndSize(),r=n.left,i=n.top,a=n.height,o=n.width;!0===this.shapeWrapperParams.hidden&&(e="none");var s=this.shapeWrapperParams.hyperLinkDestination||void 0!==this.eventSourceId,c="none"!==mm(this.shapeWrapperParams.fillColor)?(0,uv.default)(mm(this.shapeWrapperParams.fillColor)):(0,uv.default)("#FFFFFF00"),u=c.hsl().array(),l=this.props,h=l.slideContext,d=l.zIndex;return cv.default.createElement("div",{className:"spId-".concat(this.spId).concat(s?" ppt-event-source":""),id:ty(h.uuid,h.slideIndex,this.spId),ref:this.animeTarget,style:{position:"absolute",display:e,zIndex:d,left:r,top:i,width:o,height:a,transform:this.transform(this.shapeWrapperParams),opacity:this.opacity(),backfaceVisibility:"hidden","--sp-fill-h":c&&u[0],"--sp-fill-s":c&&u[1]+"%","--sp-fill-l":c&&u[2]+"%","--sp-fill-a":c?c.alpha():0},onClick:s?this.onClick:this.emptyClick},t&&cv.default.createElement("audio",{src:t,ref:this.player,controls:!1}),this.renderShape(this.shapeWrapperParams))}}]),n}(cv.default.Component);function ay(e,t,n,r){var i,a=e.childElementOptional("p:grpSpPr","a:xfrm"),o=0,s=0,c=0,u=0,l=1,h=1;e.extraAttr.getOptional("fillColor")&&((i=e.extraAttr.getColor("fillColor"))instanceof lm&&i.setFillColor(r.fillColor));var d=!1,p=!1,f=0,v={x:0,y:0,width:t?t.slideWidth:0,height:t?t.slideHeight:0},m=0;if(a){var g=e.childElementOptional("p:grpSpPr","a:xfrm","a:chExt"),y=e.childElementOptional("p:grpSpPr","a:xfrm","a:ext"),b=e.childElementOptional("p:grpSpPr","a:xfrm","a:chOff");c=g?g.attr.getNumber("cx"):0,u=g?g.attr.getNumber("cy"):0,l=0!==c&&y?y.attr.getNumber("cx")/c:1,l=Number.isNaN(l)?1:l,h=0!==c&&y?y.attr.getNumber("cy")/u:1,h=Number.isNaN(h)?1:h,o=b?-b.attr.getNumber("x"):0,s=b?-b.attr.getNumber("y"):0,f=(m=a.attr.getNumber("rot",0))/Ov,d=a.attr.getBoolean("flipV",!1),p=a.attr.getBoolean("flipH",!1);var k=e.childElementOptional("p:grpSpPr","a:xfrm","a:off");v={x:k?k.attr.getNumber("x"):0,y:k?k.attr.getNumber("y"):0,width:y?y.attr.getNumber("cx"):0,height:y?y.attr.getNumber("cy"):0}}return{rectangle:v,borderStyle:{},opacity:1,tailor:void 0,flipV:d,flipH:p,transform:{translateX:o,translateY:s,scaleX:l,scaleY:h,rotate:f,fillColor:i},parentGroupShapeId:n,fillColor:i,rotate:m,hidden:e.extraAttr.getBooleanOptional("hidden")}}var oy=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).animeTarget=ad.default.createRef(),r.eventSourceId=void 0,r.shapeWrappers=[],r.shapeMap=new km(ay),r.renderShape=function(e,t,n,i,a,o){var s=t.extraAttr.getString("spId"),c=r.props,u=c.slideContext,l=c.interactiveSeqsKeys,h=c.onEventSourceClick,d=c.onHyperLinkClick,p=c.resourceType,f=c.uuid,v=c.wrapResource,m=c.animationManager;return ad.default.createElement(iy,{key:"".concat(n),ref:function(e){return r.shapeWrappers.push(e)},shapeXML:t,slideContext:u,shapeGroupTransform:i,interactiveSeqsKeys:l,eventSourceId:r.eventSourceId,onEventSourceClick:h,onHyperLinkClick:d,zIndex:r.zIndex(e,t),resourceType:p,flipH:o},(function(e){return ad.default.createElement(ey,{uuid:f,width:e.width,fillColor:e.fillColor,slideContext:u,height:e.height,slideIndex:u.slideIndex,groupFillColor:a.fillColor,borderStyle:e.borderStyle,shapeGroupTransform:e.shapeGroupTransform,shapeXML:t,resourceLoader:u.resourceLoader,resourceType:p,shapeWrapResource:null==v?void 0:v.shapes[s],withAnimation:null==m?void 0:m.withTextAnimation(s),flipH:e.flipH})}))},r.renderPicture=function(e,t,n,i){var a=r.props,o=a.slideContext,s=a.interactiveSeqsKeys,c=a.onEventSourceClick,u=a.onHyperLinkClick,l=a.resourceType;return ad.default.createElement(iy,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:o,interactiveSeqsKeys:s,shapeGroupTransform:i,eventSourceId:r.eventSourceId,onEventSourceClick:c,onHyperLinkClick:u,zIndex:r.zIndex(e,t),resourceType:l},(function(e){return r.renderPictureContent(t,e,o.resourceLoader,i)}))},r.renderGraph=function(e,t,n,i){var a=t.extraAttr.getString("spId"),o=r.props,s=o.slideContext,c=o.interactiveSeqsKeys,u=o.onEventSourceClick,l=o.onHyperLinkClick,h=o.resourceType,d=o.uuid,p=o.wrapResource;return ad.default.createElement(iy,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:s,interactiveSeqsKeys:c,eventSourceId:r.eventSourceId,onEventSourceClick:u,onHyperLinkClick:l,zIndex:r.zIndex(e,t),resourceType:h,shapeGroupTransform:i},(function(e){return ad.default.createElement(Yg,{uuid:d,slideContext:s,width:e.width,height:e.height,rotate:e.rotate,borderStyle:e.borderStyle,fillColor:e.fillColor,key:"".concat(n),graphXML:t,shapeWrapResource:null==p?void 0:p.shapes[a],resourceType:e.resoureType})}))},r.renderShapeGroup=function(e,t,i,a,o){var s=r.zIndex(e,t),c=r.props,u=c.uuid,l=c.slideRef,h=c.slideContext,d=c.interactiveSeqsKeys,p=c.resourceType,f=c.onEventSourceClick,v=c.onHyperLinkClick,m=c.meidaStates,g=c.disableAnimation,y=c.onMediaChange,b=c.onMediaPause,k=c.onMediaPlay,w=c.onMediaPlayError,S=c.mediaSlideActionUserIds,x=c.rtcClient,I=c.userId,C=c.wrapResource;return ad.default.createElement(n,{key:"".concat(i),uuid:u,slideRef:l,slideContext:h,zIndex:s,shapeGroupXML:t,interactiveSeqsKeys:d,eventSourceId:r.eventSourceId,resourceType:p,onEventSourceClick:f,onHyperLinkClick:v,shapeGroupTransform:a,flipH:o,meidaStates:m,disableAnimation:g,onMediaChange:y,onMediaPlay:k,onMediaPause:b,onMediaPlayError:w,userId:I,mediaSlideActionUserIds:S,wrapResource:C,rtcClient:x})},r.state={soundEffectUrl:null};var i=r.props,a=i.shapeGroupXML,o=i.onEventSourceClick,s=a.extraAttr.getString("spId");r.shapeId=s;var c=ty(e.slideContext.uuid,e.slideContext.slideIndex,s);return e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==o&&(r.eventSourceId=c),r.player=ad.default.createRef(),r}return O(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===ty(t.uuid,t.slideIndex,e.shapeId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"componentDidCatch",value:function(e,t){var n=this.props.logger;n&&n.error("catch render error: ",e," stack: ",t.componentStack),this.setState({error:!0})}},{key:"transformWithAnimation",value:function(e,t){return t?{translateX:wm(t,"translateX",0),translateY:wm(t,"translateY",0),scaleX:wm(t,"scaleX",1),scaleY:wm(t,"scaleY",1),rotate:wm(t,"rotate",0)}:{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0}}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"transform",value:function(e,t){var n=this.props.shapeGroupTransform,r=this.transformWithAnimation(e.transform,t);n&&(r.rotate=n.rotate+r.rotate);var i=this.transformWithShapeParams(e,r),a=i.translateX,o=i.translateY,s=i.scaleX,c=i.scaleY,u=i.rotate;return"translate(".concat(Av(a),", ").concat(Av(o),") scale(").concat(s,",").concat(c,") rotate(").concat(Nv(u)+e.transform.rotate,"deg)")}},{key:"opacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return wm(e,"opacity",t)}},{key:"visible",value:function(e){return wm(e,"visible",!0)}},{key:"updateAnimation",value:function(e){var t;(null==(t=this.player)?void 0:t.current)&&(1===e.play&&0===e.stop?this.player.current.play().then((function(){}),(function(){})):0===e.play&&1===e.stop&&this.player.current.pause())}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"parseMediaRef",value:function(e,t){if(t){var n=this.props.resourceType,r=t.childElementOptional(new Hv("a:videoFile","a:audioFile"));if(r){var i="a:videoFile"===r.name?"video":"audio",a=r.attr.getString("r:link"),o=e.loadURL(n,a);if(o)return{resURL:o,mediaType:i};var s=t.childElementOptional("p:extLst","p:ext");if(s&&"{DAA4B4D4-6D71-4841-9C94-3DE7FCFB9230}"===s.attr.getString("uri")){var c=s.childElement("p14:media"),u=c.attr.getStringOptional("r:link"),l=c.attr.getStringOptional("r:embed"),h=u||l||"unknow";if(c.hasChildElementWithName("p14:trim")){var d=c.childElement("p14:trim"),p=d.attr.getNumberOptional("st"),f=d.attr.getNumberOptional("end");return p&&(p/=1e3),f&&(f/=1e3),{resURL:e.loadURL(n,h),mediaType:i,startTime:p,endTime:f}}return{resURL:e.loadURL(n,h),mediaType:i}}}}else;}},{key:"zIndex",value:function(e,t){var n=t.extraAttr.getStringOptional("spId");if("string"==typeof n){var r=new $g(e).indexBySpId();if(n in r)return r[n]}return 999}},{key:"renderPictureContent",value:function(e,t,n,r){var i=t.width,a=t.height,o=t.fillColor,s=t.borderStyle,c=t.margin,u=e.childElementOptional("p:nvPicPr","p:nvPr"),l=e.childElement("p:nvPicPr","p:cNvPr").attr.getString("id"),h=this.parseMediaRef(n,u),d=e.childElementOptional("p:blipFill","a:blip"),p=0,f=null==e?void 0:e.childElementOptional("p:spPr","a:xfrm");if(f){var v=f.attr.getNumber("rot",0);p=Number(v)/Ov}var m,g,y=Iv({},c);if(r){var b=Cm(p,r),k=b.scaleX,w=b.scaleY;m=i*k,g=a*w,y.left*=k,y.right*=k,y.top*=w,y.bottom*=w}else m=i,g=a;var S=this.props,x=S.meidaStates,I=S.uuid,C=S.slideContext,P=S.logger,M=S.slideRef,T=S.pausing,O=S.disableAnimation,E=S.onMediaChange,A=S.onMediaPause,N=S.onMediaPlay,R=S.onMediaPlayError,L=S.userId,j=S.mediaSlideActionUserIds,D=S.rtcClient,z=S.resourceType,F=x?x[l]:void 0;if(h&&"video"===h.mediaType)return ad.default.createElement(Jg,{width:m,uuid:I,controllerProtalId:"netless-media-controller-portal-".concat(C.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,fillColor:o,borderStyle:s,videoURL:h.resURL,shapeId:l,targetID:ty(C.uuid,C.slideIndex,l),mediaState:F,resourceLoader:n,disableAnimation:O,onMediaChange:E,onMediaPlay:N,onMediaPause:A,onMediaPlayError:R,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(h&&"audio"===h.mediaType)return ad.default.createElement(Zg,{width:m,controllerProtalId:"netless-media-controller-portal-".concat(C.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,borderStyle:s,uuid:I,audioURL:h.resURL,shapeId:l,targetID:ty(C.uuid,C.slideIndex,l),mediaState:F,resourceLoader:n,disableAnimation:O,onMediaChange:E,onMediaPlay:N,onMediaPause:A,onMediaPlayError:R,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(d){var B=d.attr.getStringOptional("r:embed");if(void 0===B)return null;var U,V=n.loadURL(z,B);return l&&(U=n.loadURL(z,"spId".concat(l))),ad.default.createElement(qg,{width:m,uuid:C.uuid,logger:P,resourceType:z,resId:B,height:g,slideIndex:C.slideIndex,fillColor:o,borderStyle:s,imageURL:V,margin:y,imageXML:e,preload:C.preload,spURL:U})}return null}},{key:"renderShapeGroupContent",value:function(e){var t=this,n=this.props,r=n.shapeGroupXML,i=n.shapeGroupTransform,a=n.flipH,o=r.elementsWithName("p:sp"),s=r.elementsWithName("p:cxnSp"),c=r.elementsWithName("p:pic"),u=r.elementsWithName("p:graphicFrame"),l=r.elementsWithName("p:grpSp");r.elementsWithName("mc:AlternateContent").forEach((function(e){var t=e.childElementOptional("mc:Choice","p:graphicFrame");if(t)u.push(t);else{var n=e.childElementOptional("mc:Fallback","p:pic");n&&c.push(n)}}));var h=Iv({},e.transform),d=i;d&&(h.rotate+=d.rotate,h.scaleX*=d.scaleX,h.scaleY*=d.scaleY);var p=!!a!==e.flipH;return ad.default.createElement(ad.default.Fragment,null,o.map((function(n,i){return t.renderShape(r,n,i,h,e,p)})),s.map((function(n,i){return t.renderShape(r,n,i,h,e,p)})),c.map((function(e,n){return t.renderPicture(r,e,n,h)})),u.map((function(e,n){return t.renderGraph(r,e,n,h)})),l.map((function(e,n){return t.renderShapeGroup(r,e,n,h,p)})))}},{key:"render",value:function(){this.shapeWrappers=[];var e=this.state,t=e.error,n=e.soundEffectUrl;if(t)return ad.default.createElement("div",{"data-reason":"render error"});var r,i,a,o,s=this.props,c=s.shapeGroupXML,u=s.slideContext,l=s.shapeGroupTransform,h=s.zIndex,d=this.shapeMap.map(c,u,l),p=c.extraAttr.getString("spId");return l?(r=Av((d.rectangle.x+l.translateX)*l.scaleX),i=Av((d.rectangle.y+l.translateY)*l.scaleY),a=Av(d.rectangle.width*l.scaleX),o=Av(d.rectangle.height*l.scaleY)):(r=Av(d.rectangle.x),i=Av(d.rectangle.y),a=Av(d.rectangle.width),o=Av(d.rectangle.height)),ad.default.createElement("div",{ref:this.animeTarget,className:"spGoupId-"+p,id:ty(u.uuid,u.slideIndex,p),style:{position:"absolute",left:r,top:i,transform:this.transform(d),width:a,height:o,zIndex:h,opacity:this.opacity(void 0,d.opacity),display:this.visible(void 0)?void 0:"none"}},n&&ad.default.createElement("audio",{src:n,ref:this.player,controls:!1}),this.renderShapeGroupContent(d))}}]),n}(ad.default.Component),sy=function(){function e(t,n){M(this,e),this.slideXML=t,this.context=n,this.animations=[]}return O(e,[{key:"collect",value:function(){var e=this.slideXML.childElementOptional("p:sld","p:timing","p:tnLst","p:par","p:cTn","p:childTnLst");if(e)for(var t=e.elementsWithName("p:seq"),n=0;n<t.length;++n){var r=t[n],i=r.childElement("p:cTn").attr.getString("nodeType","afterEffect");this.searchAndIndexParXMLs(r,i,[n],void 0)}return this.animations}},{key:"searchAndIndexParXMLs",value:function(e,t,n,r){var i=e.childElementOptional("p:cTn","p:childTnLst"),a=i?i.elementsWithName("p:par"):[],o=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),s=r;if(o){var c=o.childElementOptional("p:tgtEl","p:spTgt");if(c&&(s=c.attr.getString("spid"),this.context.shapeParamsIndex[parseInt(s,10)].hidden))return}if(0===a.length)this.handleLeafParXML(e,t,n,s);else for(var u=0;u<a.length;++u)this.searchAndIndexParXMLs(a[u],t,[].concat(C(n),[u]),s)}},{key:"handleLeafParXML",value:function(e,t,n,r){var i,a,o,s=e.childElementOptional("p:cTn","p:iterate"),c=null==(i=null==s?void 0:s.attr)?void 0:i.getStringOptional("type"),u=null==s?void 0:s.childElementOptional("p:tmPct"),l="lt"!==c&&"wd"!==c||!u?null:Ev(u.attr.getString("val")),h=e.childElementOptional("p:cTn","p:childTnLst"),d=h&&h.element.childElementOptional("p:cBhvr","p:tgtEl","p:spTgt"),p=d?d.attr.getString("spid"):"",f=null==d?void 0:d.childElementOptional("p:txEl","p:pRg"),v=null==(a=null==f?void 0:f.attr)?void 0:a.getNumberOptional("st"),m=null==(o=null==f?void 0:f.attr)?void 0:o.getNumberOptional("end"),g=null!=v&&null!=m?{start:v,end:m}:null;if(this.context.shapeParamsIndex[parseInt(p,10)]&&!this.context.shapeParamsIndex[parseInt(p,10)].hidden){var y=e.childElement("p:cTn"),b=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),k=h?h.elements:[],w=Number.MIN_SAFE_INTEGER;k.forEach((function(e){var t=0,n=e.childElementOptional("p:cBhvr","p:cTn","p:stCondLst","p:cond");n&&(t=n.attr.getNumberOptional("delay")||0);var r=e.childElement("p:cBhvr","p:cTn").attr.getNumberOptional("dur");void 0===r&&(r=1),r+t>w&&(w=r+t)}));var S,x=y.childElementOptional("p:endCondLst");void 0!==x&&"onNext"===x.childElement("p:cond").attr.getStringOptional("evt")&&(S="onNext");var I=y.attr.get("repeatCount","none");"indefinite"!==I&&"none"!==I&&(0===(I/=1e3)&&(I="none"));var C=y.attr.getStringOptional("presetClass");C||(C="entr");var P=Object.freeze({eventSourceShapeId:r,spId:p,pRg:g,textAnimMode:c,textAnimDelay:l,sequenceType:t,animationXML:h,sequenceIndex:n[1],parallelIndex:n[3],isLoop:y.attr.has("repeatCount"),id:y.attr.getStringOptional("id")||"",presetClass:C,presetID:y.attr.getStringOptional("presetID")||"",presetSubtype:y.attr.getStringOptional("presetSubtype"),repeatCount:I,repeatEndCondition:S,nodeType:y.attr.getStringOptional("nodeType")||"afterEffect",delay:b&&b.attr.getNumberOptional("delay")||0,duration:w,autoRev:y.attr.getBoolean("autoRev",!1),soundEffectId:this.parseAnimeSoundEffect(e),dimAfter:this.parseDimAfter(e)});this.animations.push(P)}}},{key:"parseAnimeSoundEffect",value:function(e){var t=e.childElementOptional("p:cTn","p:subTnLst","p:audio");if(void 0!==t)return t.childElement("p:cMediaNode","p:tgtEl","p:sndTgt").attr.getString("r:embed")}},{key:"parseDimAfter",value:function(e){var t,n,r=e.childElementOptional("p:cTn","p:subTnLst","p:set","p:cBhvr");if(r){var i=r.childElementOptional("p:attrNameLst","p:attrName");return i&&String(i.text).includes("visibility")?"nextClick"===(null==(n=null==(t=r.childElementOptional("p:cTn"))?void 0:t.attr)?void 0:n.getStringOptional("masterRel"))?"next":"same":void 0}}}]),e}();function cy(e,t,n){var r=t.input,i=t.output;return(e-r)/(n.input-r)*(n.output-i)+i}var uy=function(){function e(t){M(this,e),this.behaviorNode=t.childElement("p:cBhvr"),this.timingNode=this.behaviorNode.childElement("p:cTn")}return O(e,[{key:"animeId",value:function(){var e;return String(null!=(e=this.timingNode.attr.getNumberOptional("id"))?e:Date.now())}},{key:"duration",value:function(){var e=this.timingNode.attr.getStringOptional("dur");return e?"indefinite"===e?1/0:parseInt(e,10):1}},{key:"delay",value:function(){var e=this.timingNode.childElementOptional("p:stCondLst","p:cond");return e?e.attr.getNumber("delay",0):0}},{key:"ease",value:function(){var e=function(e){if(!e)return Gd;var t=e.replace(/\s+/g,"").split(";").map((function(e){var t=h(e.split(","),2),n=t[0],r=t[1];return{input:parseFloat(n),output:parseFloat(r)}}));t[t.length-1].input<1&&t.push({input:1,output:1});var n=t.length-1,r=0,i=0;return function(e){if(e>=r)for(var a=i;a<n;a++){var o=t[a],s=t[a+1];if(e>=o.input&&e<=s.input)return i=a,r=e,cy(e,o,s)}else for(var c=i;c>=0;c--){var u=t[c],l=t[c+1];if(e>=u.input&&e<=l.input)return i=c,r=e,cy(e,u,l)}return i=0,r=0,e}}(this.timingNode.attr.getStringOptional("tmFilter")),t=this.timingNode.attr.getStringOptional("spd");if(t){var n=Ev(t);if(!Number.isNaN(n)&&1!==n&&0!==n)return n>0?function(t){return e(t/n)}:function(t){return 1-e(t/-n)}}return e}},{key:"reverse",value:function(){return Boolean(this.timingNode.attr.getBooleanOptional("autoRev"))}},{key:"rewind",value:function(){var e=this.timingNode.attr.getStringOptional("fill");return"transition"===e||"remove"===e}},{key:"repeat",value:function(){var e=this.timingNode.attr.get("repeatCount","");if(!e)return 1;if("indefinite"===e)return 1/0;var t=Number(e)/1e3;return Number.isNaN(t)?1:t}},{key:"attrNames",value:function(){var e=this.behaviorNode.childElementOptional("p:attrNameLst"),t=[];if(e){var n,r=E(e.elementsWithName("p:attrName"));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.mapAttrName(i.text);a&&t.push(a)}}catch(e){r.e(e)}finally{r.f()}}return t}},{key:"mapAttrName",value:function(e){if("string"==typeof e){var t=e.toLowerCase();switch(t){case"ppt_x":case"ppt_y":case"ppt_w":case"ppt_h":case"xshear":case"yshear":case"fillcolor":return t;case"scalex":return"scaleX";case"scaley":return"scaleY";case"style.rotation":case"r":return"rotate";case"style.visibility":return"visible";case"style.opacity":return"opacity"}}}}]),e}();function ly(e){var t,n,r,i,a=function(e){var t,n=[],r=E(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(""!==i)if(1===i.length)n.push(i);else{var a=i[0];/[a-zA-Z]/.test(a)?(n.push(a),n.push(i.substring(1))):n.push(i)}}}catch(e){r.e(e)}finally{r.f()}return n}(e.split(/,|\s/i)),o=[],s=E(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(/^[a-zA-Z]$/.test(c)){if(void 0!==r)throw new Error("invalid path: lack of number");void 0!==t&&o.push({sign:t,points:n}),t=c,n=[]}else{var u=parseFloat(c);if(Number.isNaN(u))throw new Error("invalid path: unrecognized number ".concat(JSON.stringify(c)));void 0===r?r=u:(n.push({x:r,y:u}),r=void 0)}}}catch(e){s.e(e)}finally{s.f()}if(void 0!==r)throw new Error("invalid path: lack of number");return void 0!==t&&o.push({sign:t,points:n}),o}var hy=function(){function e(){M(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(0===n.length)throw new Error("expect 1 curve minimum");for(var i=[],a=0,o=0,s=n;o<s.length;o++){var c=s[o];i.push(c.rectangle),a+=c.length}this.curves=Object.freeze(n),this.length=a,this.rectangle=e.unionRectangles(i)}return O(e,[{key:"get",value:function(e){var t,n,r=0,i=0,a=E(this.curves);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(t=o,i=r,e<r+o.length)break;r+=o.length}}catch(e){a.e(e)}finally{a.f()}return t.get(e-i)}}],[{key:"unionRectangles",value:function(e){var t,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,o=E(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.left<n&&(n=s.left),s.right>r&&(r=s.right),s.top<i&&(i=s.top),s.bottom>a&&(a=s.bottom)}}catch(e){o.e(e)}finally{o.f()}return Object.freeze({left:n,right:r,top:i,bottom:a})}}]),e}(),dy=function(){function e(t,n){M(this,e),this.beginX=t.x,this.beginY=t.y,this.deltaX=n.x-t.x,this.deltaY=n.y-t.y,this.length=Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY),this.rectangle=Object.freeze({left:Math.min(t.x,n.x),right:Math.max(t.x,n.x),top:Math.min(t.y,n.y),bottom:Math.max(t.y,n.y)})}return O(e,[{key:"get",value:function(e){if(0===this.length)return{x:this.beginX,y:this.beginY};var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),{x:this.beginX+t*this.deltaX,y:this.beginY+t*this.deltaY}}}]),e}(),py=function(){function e(t,n,r,i){M(this,e),this.bezier=new lv.default([t,n,r,i]),this.length=this.bezier.length(),this.rectangle=this.createRectangle()}return O(e,[{key:"createRectangle",value:function(){var e=this.bezier.bbox();return Object.freeze({left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max})}},{key:"get",value:function(e){var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),this.bezier.get(t)}}]),e}();function fy(e){var t=e.controller,n=e.end,r=n.x-t.x,i=n.y-t.y;return{x:n.x+r,y:n.y+i}}function vy(e,t,n){if(t.length!==n)throw new Error("invalid path: sign ".concat(e," should have ").concat(n," points (").concat(2*n," number)"))}function my(e){if(!e)throw new Error("invalid path: expect M")}var gy=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new uy(t),a=function(e){var t,n,r,i,a=[],o=E(ly(e));try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.sign,u=s.points;switch(c){case"M":vy(c,u,1),t=u[0],n=u[0],r=void 0;break;case"L":vy(c,u,1),my(n),a.push(new dy(n,u[0])),n=u[0],r=void 0;break;case"Z":vy(c,u,0),my(n),a.push(new dy(n,t)),n=t,r=void 0;break;case"C":vy(c,u,3),my(n),a.push(new py(n,u[0],u[1],u[2])),r={controller:u[1],end:u[2]},n=u[2];break;case"S":if(!r)throw new Error("invalid path: expect C or S before S");vy(c,u,2),my(n);var l=fy(r);a.push(new py(n,l,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"Q":vy(c,u,2),my(n),a.push(new py(n,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"T":if(!r)throw new Error("invalid path: expect Q or T before T");vy(c,u,1),my(n);var h=fy(r);r={controller:h,end:u[0]},r={controller:h,end:u[0]},n=u[0];break;case"E":break;default:throw new Error("invalid path: unrecognized sign ".concat(JSON.stringify(c)))}}}catch(e){o.e(e)}finally{o.f()}return v(hy,a)}(t.attr.getString("path","M 0 0")),o=r.initState,s=o.ppt_x,c=o.ppt_y;return new Dp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),transform:function(e){var t=a.get(e*a.length),n=t.x,r=t.y;return{ppt_x:(n||0)+s,ppt_y:(r||0)+c}}})},yy=function(){function e(t){var n=t.context,r=t.animBox;M(this,e),this.context=n,this.animBox=r}return O(e,[{key:"parse",value:function(e,t){var n=null==e?void 0:e.childElementOptional(new Hv("p:strVal","p:fltVal","p:clrVal","p:intVal"));if(n)switch(n.name){case"p:fltVal":case"p:intVal":var r=parseFloat(n.attr.getString("val"));return Op(r)?r:void 0;case"p:clrVal":var i=pm(n.childElement(v(Hv,am)),this.context.slideContext);if(i){var a=i.rgb().object(),o=a.r,s=a.g,c=a.b;return new Ap({r:o,g:s,b:c,a:1})}return;default:return Op(this.animBox.initState[t])?new Pp(n.attr.getString("val"),this.formulaScope):"visible"===t?"hidden"!==n.attr.getString("val"):n.attr.getString("val")}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new Cp(this.animBox)}}]),e}();function by(e,t){if(t){var n=t.childElementOptional(new Hv("p:rgb","p:hsl"));if(n)switch(n.name){case"p:rgb":return new Ap({r:n.attr.getNumber("r"),g:n.attr.getNumber("g"),b:n.attr.getNumber("b"),a:1});case"p:hsl":return new Ap({h:n.attr.getNumber("h")/Ov,s:n.attr.getNumber("s")/Tv*100,l:n.attr.getNumber("l")/Tv*100,a:1})}else{var r=pm(t.childElement(v(Hv,am)),e);if(r){var i=r.rgb().object(),a=i.r,o=i.g,s=i.b;return new Ap({r:a,g:o,b:s,a:1})}}}}function ky(e){var t=Number(e);if(!Number.isNaN(t))return Nv(t)}function wy(e){if(e)return{scaleX:Ev(e.attr.getString("x")),scaleY:Ev(e.attr.getString("y"))}}var Sy=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new uy(t),a=function(e){var t=/^playFrom\(([^)]+)\)$/.exec(e);return t?{name:"playFrom",value:parseFloat(t[1])}:e.includes("pause")?{name:"pause"}:{name:"stop"}}(t.attr.getString("cmd"));return new zp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:1,delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),cmd:a})};function xy(e,t,n){var r=e.node,i=e.context,a=e.animBox;var o=r.childElementOptional("p:tavLst");if(o){var s=new yy({context:i,animBox:a}),c=o.elementsWithName("p:tav").map((function(e){var t=s.parse(e.childElement("p:val"),n);if(null!=t)return{val:t,progress:Ev(e.attr.getString("tm")),fmla:function(e){if(e){if(Op(a.initState[n]))return new Pp(e,s.formulaScope);console.error("Expr ".concat(e," cannot work with targetKey ").concat(n))}}(e.attr.getStringOptional("fmla"))}})).filter((function(e){return Boolean(e)}));if(!(c.length<=0)){if("lin"!==t)return Iy(c,n,Cy);if(Op(c[0].val))return Iy(c,n,cp);if(c[0].val instanceof Ap)return Iy(c,n,Fp)}}}function Iy(e,t,n){return function(r){for(var i=1;i<e.length;i++){var a=e[i-1],o=e[i];if(r>=a.progress&&r<=o.progress){var s=n(a.val,o.val,(r-a.progress)/(o.progress-a.progress));return c({},t,a.fmla?a.fmla.evaluate(s):s)}}var u=e[e.length-1],l=u.fmla,h=u.val;return c({},t,l?l.evaluate(h):h)}}function Cy(e,t,n){return n<1?e:t}var Py=function(){function e(t,n){M(this,e),this.node=t,this.animBox=n}return O(e,[{key:"parse",value:function(e,t){var n=this.node.attr.getStringOptional(e);if(n){var r=this.animBox.initState[t];if(r instanceof Ap)try{return new Ap(n)}catch(i){return}if(Op(r)){var i=Number(n);return Op(i)?i:new Pp(n,this.formulaScope)}return"visible"===t?"hidden"!==n:void 0}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new Cp(this.animBox)}}]),e}(),My=function(e){switch(e.node.name){case"p:animMotion":return gy(e);case"p:set":return function(e){var t,n=e.node,r=e.animation,i=e.context,a=e.animBox,o=new uy(n),s=o.attrNames(),c={},u=new yy({context:i,animBox:a}),l=E(s);try{for(l.s();!(t=l.n()).done;){var h=t.value;switch(h){case"visible":var d=u.parse(n.childElementOptional("p:to"),"visible");null!=d&&(c.visible=d,a.preAnimation()||a.preAnimation({visible:!d}));break;case"opacity":case"xshear":case"yshear":var p=u.parse(n.childElementOptional("p:to"),h);null!=p&&(c[h]=p)}}}catch(e){l.e(e)}finally{l.f()}return new Dp({animBox:a,effectType:r.nodeType,playerID:o.animeId(),eventSource:r.eventSourceShapeId,duration:o.duration(),delay:o.delay(),transform:jp((function(){var e={};for(var t in c)if(Tp(c,t))switch(t){case"visible":e.visible=!c.visible;break;case"opacity":case"xshear":case"yshear":e[t]=a.currentState[t]}return e}),c)})}(e);case"p:animEffect":return function(e){var t=e.animBox,n=e.node,r=e.animation,i=n.attr.getStringOptional("transition");if(i){var a=new uy(n),o=0,s=1;return"out"===i&&(o=1,s=0),new Dp({animBox:t,effectType:r.nodeType,playerID:a.animeId(),eventSource:r.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:!0,transform:Lp({opacity:o},{opacity:s})})}}(e);case"p:anim":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new uy(t),a=t.attr.getString("calcmode","lin"),o=i.attrNames()[0];if(o){var s=new Py(t,r),u=!1,l=xy(e,a,o);if(!l){var h=s.parse("from",o),d=s.parse("to",o);if(d||(u=!0,d=s.parse("by",o)),!d)return;l=jp((function(){return c({},o,null!=h?h:r.currentState[o])}),c({},o,d))}return new Dp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:u,transform:l})}console.error("Missing attrName for p:anim",i.animeId())}(e);case"p:animClr":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=e.context,a=new uy(t);if(a.attrNames().includes("fillcolor")){var o,s=!1;if((o=by(i.slideContext,t.childElementOptional("p:to")))||(s=!0,o=by(i.slideContext,t.childElementOptional("p:by"))),o){var c,u=o,l=by(i.slideContext,t.childElementOptional("p:from"));return new Dp({animBox:r,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:s,transform:function(e){l||(l=r.currentState.fillcolor,c=l.alpha());var t=Np(l,u,e);return{fillcolor:c>0?t.alpha(c):t}}})}}}(e);case"p:animRot":return function(e){var t=e.node,n=e.animation,r=e.context,i=e.animBox,a=new uy(t),o=!1,s=ky(t.attr.getStringOptional("to"));if(null==s&&(o=!0,s=ky(t.attr.getStringOptional("by"))),null==s){var c=new yy({context:r,animBox:i}).parse(t.childElementOptional("p:by"),"rotate");Op(c)&&(s=Nv(Number(c)))}if(null!=s){var u=s,l=ky(t.attr.getStringOptional("from"));return new Dp({animBox:i,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:o,transform:jp((function(){var e;return{rotate:null!=l?l:o?0:null!=(e=i.currentState.rotate)?e:0}}),{rotate:u})})}}(e);case"p:animScale":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new uy(t),a=!1,o=wy(t.childElementOptional("p:to"));if(null==o&&(a=!0,o=wy(t.childElementOptional("p:by"))),null!=o){var s=o,c=wy(t.childElementOptional("p:from"));return new Dp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:a,transform:jp((function(){var e,t;return null!=c?c:a?{scaleX:1,scaleY:1}:{scaleX:null!=(e=r.currentState.scaleX)?e:1,scaleY:null!=(t=r.currentState.scaleY)?t:1}}),s)})}}(e);case"p:cmd":return Sy(e);default:console.error("failed parsing ".concat(e.node.name," animation node"))}};function Ty(e,t,n){return new Dp({animBox:e,effectType:t,playerID:"Dim".concat(String(Date.now())),duration:1,delay:n,transform:jp((function(){return{visible:e.currentState.visible}}),{visible:!1})})}var Oy,Ey,Ay,Ny=function(){function e(t,n){var r,i,a,o=this;M(this,e),this.animations=t,this.context=n,this.mainPlayerSeq=[],this.interactivePlayerSeqs=new Map,this.subNextPlayerAnimBoxes=[],this.textAnimSpIds=new Set,this.triggerEvent=new _f,this.animBoxes=new Map;for(var s=0;s<this.animations.length;s+=1){var c=this.animations[s],u=this.getAnimationSeq(c);if(u){var l=this.getAnimBox(c.spId,null==(r=c.pRg)?void 0:r.start),h=void 0;"lt"===c.textAnimMode||"wd"===c.textAnimMode?(this.textAnimSpIds.add(c.spId),h=this.getTextAnimationPlayer(c)):h=this.getAnimationPlayer(c,l),h&&(h=this.joinSubSamePlayers(h,c,l),u.length>0&&h.effectType!==u[u.length-1].effectType&&this.squashLastSeqPlayers(u),"withEffect"!==h.effectType&&this.joinLastSubNextPlayers(),("withEffect"!==h.effectType||0===s)&&this.subNextPlayerAnimBoxes.push([]),"next"===c.dimAfter&&this.subNextPlayerAnimBoxes[this.subNextPlayerAnimBoxes.length-1].push(l),u.push(h))}}this.squashLastSeqPlayers(this.mainPlayerSeq),this.interactivePlayerSeqs.forEach((function(e){o.squashLastSeqPlayers(e)})),this.joinLastSubNextPlayers(),this.mainSeq=new sp({playerID:"mainSeq",players:this.mainPlayerSeq,effectType:null!=(a=null==(i=this.mainPlayerSeq[0])?void 0:i.effectType)?a:"clickEffect"}),this.interactiveSeqs=new Map,this.interactivePlayerSeqs.forEach((function(e,t){var n,r;o.interactiveSeqs.set(t,new sp({playerID:"interactiveSeq"+t,players:e,effectType:null!=(r=null==(n=e[0])?void 0:n.effectType)?r:"clickEffect"}))}))}return O(e,[{key:"withTextAnimation",value:function(e){return this.textAnimSpIds.has(e)}},{key:"end",value:function(){console.log("[animation manager]: end"),this.mainSeq.seek(this.mainSeq.duration+1)}},{key:"pause",value:function(){console.log("[animation manager]: pause");var e,t=E(this.mainSeq.players);try{for(t.s();!(e=t.n()).done;){e.value.pause()}}catch(e){t.e(e)}finally{t.f()}this.interactiveSeqs.forEach((function(e){var t,n=E(e.players);try{for(n.s();!(t=n.n()).done;){t.value.pause()}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"clearCache",value:function(){console.log("[animation manager]: clearCache"),this.animBoxes.forEach((function(e){return e.clearCache()}))}},{key:"logSeq",value:function(){var e="";function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n instanceof sp?(e+="".concat(r,"seq ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof kd?(e+="".concat(r,"par ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof op?(e+="".concat(r,"par2 ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):e+="".concat(r).concat(n.playerID," ").concat(n.effectType,"\n")}e+="mainSeq\n",t(this.mainSeq,"  "),e+="interactiveSeqs\n",this.interactiveSeqs.forEach((function(e){return t(e,"  ")})),console.log(e)}},{key:"getPlayer",value:function(e,t){var n=t;n||(n=[this.mainSeq].concat(C(Array.from(this.interactiveSeqs.values()))));var r,i=E(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.playerID===e)return a;var o=a.players;if(o){var s=this.getPlayer(e,o);if(s)return s}}}catch(e){i.e(e)}finally{i.f()}}},{key:"getAnimationSeq",value:function(e){switch(e.sequenceType){case"mainSeq":return this.mainPlayerSeq;case"interactiveSeq":if(void 0!==e.eventSourceShapeId)return this.getInteractiveSeq(ty(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId));console.error("interactiveSeq animation ".concat(e.id," does not have eventSourceShapeId"),e);break;default:console.error('not support sequenceType: "'.concat(e.sequenceType,'"'),e)}}},{key:"getInteractiveSeq",value:function(e){var t=this.interactivePlayerSeqs.get(e);return t||(t=[],this.interactivePlayerSeqs.set(e,t)),t}},{key:"getAnimBox",value:function(e,t,n){var r,i=e;null!=t?(i+=",".concat(t),null!=n&&(i+=",".concat(n))):null!=n&&(i+=",,".concat(n));var a=this.animBoxes.get(i);if(!a){var o=this.context.shapeParamsIndex[parseInt(e,10)],s=Up;if(o.fillColor){var c=o.fillColor.rgb().object(),u=c.r,l=c.g,h=c.b,d=c.alpha;s=new Ap({r:u,g:l,b:h,a:null!=d?d:1})}a=new Wf({target:ty(this.context.pptUUID,this.context.slideIndex,e),pIndex:t,tIndex:n,constants:{x:o.rectangle.x,y:o.rectangle.y,width:o.rectangle.width||1,height:o.rectangle.height||1,slideWidth:this.context.slideWidth,slideHeight:this.context.slideHeight,flipH:o.flipH,flipV:o.flipV},initState:{opacity:null!=(r=o.opacity)?r:1,fillcolor:s,rotate:o.rotate?Nv(o.rotate):0}}),this.animBoxes.set(i,a)}return a}},{key:"squashLastSeqPlayers",value:function(e,t){var n,r;if(!(e.length<=1)){var i=e[e.length-1].effectType;if("withEffect"===i){for(var a=e.length-1;a>0&&e[a].effectType===i;)a-=1;var o=e.splice(a,e.length-a);e.push(new kd({players:o,effectType:null!=(r=null!=t?t:null==(n=o[0])?void 0:n.effectType)?r:"clickEffect"}))}}}},{key:"getAnimationPlayer",value:function(e,t){if(e.animationXML){var n,r=[],i=E(e.animationXML.elements);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=My({node:a,animation:e,context:this.context,triggerEvent:this.triggerEvent,animBox:t});!o||(t.preAnimation()||t.preAnimation({}),r.push(o))}}catch(e){i.e(e)}finally{i.f()}if(!(r.length<=0)){if(e.soundEffectId){var s=function(e,t){if(e.soundEffectId)return new zp({animBox:t,effectType:e.nodeType,playerID:"SF".concat(String(Date.now())),eventSource:e.eventSourceShapeId,duration:1,delay:0,cmd:{name:"playSF",value:e.soundEffectId}})}(e,t);s&&r.push(s)}var c=function(e){return"number"==typeof e?e:"indefinite"===e?1/0:1}(e.repeatCount);return e.delay>0||c>1||e.autoRev?new op({playerID:"parr"+e.id,players:r,effectType:e.nodeType,delay:e.delay,repeat:c,reverse:Boolean(e.autoRev)}):r.length>1?new kd({playerID:"par"+e.id,players:r,effectType:e.nodeType}):r[0]}}}},{key:"getTextAnimationPlayer",value:function(e){var t,n,r=this,i=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0,a=e.slide.shapes[t].textBodyMap[0];return a&&(null==n?a.paragraphs:a.paragraphs.slice(n,n+1)).forEach((function(e){e.runs.forEach((function(e){e.text&&(r&&"en"===e.prop.language?i+=1:i+=e.text.length)}))})),i}(this.context.wrapResource,Number(e.spId),null==(t=e.pRg)?void 0:t.start,"wd"===e.textAnimMode),a=null!=(n=e.textAnimDelay)?n:0,o=Array(i).fill(0).map((function(t,n){var i,o=r.getAnimBox(e.spId,null==(i=e.pRg)?void 0:i.start,n),s=r.getAnimationPlayer(e,o);return s?new op({effectType:e.nodeType,delay:a*s.duration*n,players:[s]}):null})).filter((function(e){return Boolean(e)}));return o.length<=1?o[0]:new kd({effectType:e.nodeType,players:o})}},{key:"joinSubSamePlayers",value:function(e,t,n){return"mainSeq"!==t.sequenceType||"same"!==t.dimAfter?e:new kd({players:[e,Ty(n,"withEffect",e.duration+32)],effectType:e.effectType})}},{key:"joinLastSubNextPlayers",value:function(){var e=this.mainPlayerSeq[this.mainPlayerSeq.length-1],t=this.subNextPlayerAnimBoxes[this.subNextPlayerAnimBoxes.length-2];if(e&&t&&!(t.length<=0)){var n,r=[e],i=E(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(Ty(a,"withEffect",e.delay))}}catch(e){i.e(e)}finally{i.f()}this.mainPlayerSeq[this.mainPlayerSeq.length-1]=new kd({players:r,effectType:e.effectType})}}}]),e}(),Ry="-1";function Ly(e,t){var n=new sy(e,t).collect(),r=new Ny(n,t);return r.triggerEvent.on("onNext",(function(e){"slide"===e.target&&r.mainSeq.next()})),r.triggerEvent.on("onPrev",(function(e){"slide"===e.target&&r.mainSeq.back()})),r.triggerEvent.on("onEnd",(function(e){"slide"===e.target&&r.end()})),r.triggerEvent.on("onUnmount",(function(e){"slide"===e.target&&(r.pause(),tp.render((function(){r.clearCache()}),!1,!1))})),{animationManager:r,sequenceAnimesCounts:{get"-1"(){return r.mainSeq.length}}}}!function(e){e[e.Ready=0]="Ready",e[e.Playing=1]="Playing",e[e.Stop=2]="Stop"}(Oy||(Oy={})),function(e){e[e.Ready=0]="Ready",e[e.Playing=1]="Playing",e[e.Stop=2]="Stop"}(Ey||(Ey={})),function(e){e[e.floatType=0]="floatType",e[e.stringType=1]="stringType",e[e.colorType=2]="colorType",e[e.intType=3]="intType",e[e.formulaType=4]="formulaType"}(Ay||(Ay={}));var jy,Dy="sequenceIndexes",zy="disableAutoPlay",Fy="playLastStep";!function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(jy||(jy={}));var By=function(e){m(n,e);var t=y(n);function n(e){var r;M(this,n),(r=t.call(this,e)).shapeGroupRef=ed.default.createRef(),r.eventHub=new td.default,r.isImageLoadFinished=!1,r.onHyperLinkClick=function(e){var t=r.props,n=t.data,i=t.stateAdapter,a=n.slideRefIndex[e];if(a&&a.endsWith(".xml")){var o=a.match(/slide(\S*).xml/);null!==o&&i.onPageJumpTo&&i.onPageJumpTo(n.uuid,parseInt(o[1],10))}},r.onEventSourceClick=function(e){var t,n=r.animationManager.interactiveSeqs.get(e),i=r.state[r.currentSlideKey],a=r.props,o=a.stateAdapter,s=a.data,u=i,l=u.sequenceSteps[e];if(void 0!==l){t=void 0!==n&&e!==Ry&&(l>n.length||l===n.length&&!n.isPlaying)?0:l+1;var h=u.sequenceSteps;o.setState(s.uuid,s.index,r.composeSlideStateIntoPPTState(Cv(Iv({},h),c({},e,t))))}},r.onMediaPlay=function(e,t,n){void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"play"},"*");var i=r.props.callbacks;i&&i.onMediaPlay&&i.onMediaPlay(e,t)},r.onMediaPause=function(e,t,n){var i=r.props,a=i.userId,o=i.callbacks,s=r.state.mediaActionUserIds;void 0!==a&&void 0!==s&&void 0!==s[r.currentSlideKey]&&s[r.currentSlideKey][e]===a&&r.setMediaState({playing:!1,currentTime:n},e),void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"pause"},"*"),o&&o.onMediaPause&&o.onMediaPause(e,t)},r.setMediaState=function(e,t){var n,i,a=r.props,o=a.pptState,s=a.userId,u=a.stateAdapter,l=a.data;if(void 0===o||void 0===o.mediaStates)n=c({},r.currentSlideKey,c({},t,e)),void 0!==s&&(i=c({},r.currentSlideKey,c({},t,s)));else{var h=o.mediaStates[r.currentSlideKey];if(void 0===h?h=c({},t,e):h[t]=e,void 0!==s){var d=r.state.mediaActionUserIds;i=void 0!==d?void 0!==d[r.currentSlideKey]?Cv(Iv({},d),c({},r.currentSlideKey,Cv(Iv({},d[r.currentSlideKey]),c({},t,s)))):Cv(Iv({},d),c({},r.currentSlideKey,c({},t,s))):c({},r.currentSlideKey,c({},t,s))}n=Cv(Iv({},o.mediaStates),c({},r.currentSlideKey,h))}u.setState(l.uuid,l.index,Cv(Iv({},o),{mediaStates:n,mediaActionUserIds:i}))};var i=e.data;return r.animationManager=i.animations.animationManager,r.interactiveSeqsKeys=Array.from(r.animationManager.interactiveSeqs.keys()),r.slide=ed.default.createRef(),r.currentSlideKey="".concat(i.uuid,"-").concat(i.index),r.isRenderMaster=e.data.layoutXML.childElement("p:sldLayout").attr.getBoolean("showMasterSp",!0),r.initSlideStates(),r.changeStep.bind(k(r)),ym.reset(r.eventHub),r}return O(n,[{key:"componentDidMount",value:function(){var e=this.state[this.currentSlideKey];this.isImageLoadFinished=ym.endLoadTask("slideDidUpdate"),this.animationManager.animBoxes.forEach((function(e){return e.applyPreAnimation()})),"clickEffect"!==this.animationManager.mainSeq.effectType&&1===e.sequenceSteps[Ry]&&(this.animationManager.mainSeq.seekIndex(0),this.animationManager.mainSeq.play())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(void 0!==e.pptState){var n=this.props.pptState;this.setState(e.pptState),this.playAnime(n,e.pptState,this.animationManager.mainSeq,Ry),this.animationManager.interactiveSeqs.forEach((function(r,i){t.playAnime(n,e.pptState,r,i)}))}}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props,i=r.data,a=r.stateAdapter,o=this.state[this.currentSlideKey];e.data.index!==i.index&&ym.endLoadTask("slideDidUpdate");var s=t[this.currentSlideKey].sequenceSteps,u=o.sequenceSteps,l=function(e){if(e!==Ry&&void 0!==s[e]&&0!==s[e]&&0===u[e])return setTimeout((function(){a.setState(i.uuid,i.index,n.composeSlideStateIntoPPTState(Cv(Iv({},s),c({},e,u[e]+1))))}),80),{v:void 0}};for(var h in s){var d=l(h);if("object"===R(d))return d.v}}},{key:"componentDidCatch",value:function(e){console.error("catched error: ",e);var t=this.props,n=t.data,r=t.userId;n.logger&&n.logger.error("catched ppt: ".concat(n.uuid,",\n                index: ").concat(n.index,", user: ").concat(r," render error : "),e)}},{key:"componentWillUnmount",value:function(){this.animationManager.triggerEvent.emit("onUnmount",{target:"slide"})}},{key:"onPageToNext",value:function(){var e=this.props.stateAdapter;return this.setDisableAutoPlay(!1),this.animationManager.mainSeq.seekIndex(this.animationManager.mainSeq.length),this.animationManager.mainSeq.pause(),this.animationManager.interactiveSeqs.forEach((function(e){return e.pause()})),e.onPageToNext?e.onPageToNext():void 0}},{key:"onPageToPrev",value:function(){var e=this.props.stateAdapter;return this.setPrevPageToLastStep(),this.animationManager.mainSeq.pause(),this.animationManager.interactiveSeqs.forEach((function(e){return e.pause()})),e.onPageToPrev?e.onPageToPrev():void 0}},{key:"setDisableAutoPlay",value:function(e){var t=this.props,n=t.stateAdapter,r=t.data,i=this.state[this.currentSlideKey];n.setState(r.uuid,r.index,this.composeSlideStateIntoPPTState(i.sequenceSteps,e))}},{key:"setPrevPageToLastStep",value:function(){var e=this.props,t=e.data,n=e.pptState,r=e.stateAdapter;if(0!==t.index){var i,a,o,s="".concat(t.uuid,"-").concat(t.index-1),u=n[s];o=Cv(Iv({},n),void 0!==u?(c(i={},s,Cv(Iv({},u),{sequenceSteps:Cv(Iv({},u.sequenceSteps),c({},Ry,-1))})),c(i,"uuid",t.uuid),c(i,"pageIndex",t.index-1),c(i,"disableAutoPlay",!1),i):(c(a={},s,{sequenceSteps:c({},Ry,-1)}),c(a,"uuid",t.uuid),c(a,"pageIndex",t.index-1),c(a,"disableAutoPlay",!1),a)),r.setState(t.uuid,t.index-1,o)}}},{key:"initSlideStates",value:function(){var e=this,t={};0!==this.animationManager.mainSeq.length&&("clickEffect"!==this.animationManager.mainSeq.effectType?t[Ry]=1:t[Ry]=0),this.animationManager.interactiveSeqs.forEach((function(e,n){t[n]=0}));var n=this.props.pptState,r={};void 0!==n&&(r=n);var i=r[this.currentSlideKey];if(i&&void 0!==i.sequenceSteps){t=Iv(Iv({},t),i.sequenceSteps);var a=i.sequenceSteps[Ry];void 0!==a&&a<0&&(a=void 0===this.animationManager.mainSeq.length?void 0:this.animationManager.mainSeq.length),t[Ry]=a}this.state=this.composeSlideStateIntoPPTState(t),t[Ry]&&(1===t[Ry]&&"clickEffect"!==this.animationManager.mainSeq.effectType?this.animationManager.mainSeq.seekIndex(0):this.animationManager.mainSeq.seekIndex(t[Ry])),this.animationManager.interactiveSeqs.forEach((function(n,r){t[r]&&e.animationManager.mainSeq.seekIndex(t[r])}))}},{key:"composeSlideStateIntoPPTState",value:function(e,t){var n,r,i=this.props,a=i.pptState,o=i.data;return Cv(Iv({},a),void 0!==t?(c(n={},this.currentSlideKey,{sequenceSteps:e}),c(n,"uuid",o.uuid),c(n,"pageIndex",o.index),c(n,"disableAutoPlay",t),n):(c(r={},this.currentSlideKey,{sequenceSteps:e}),c(r,"uuid",o.uuid),c(r,"pageIndex",o.index),r))}},{key:"playAnime",value:function(e,t,n,r){var i,a,o,s,c=(null==(a=null==(i=null==e?void 0:e[this.currentSlideKey])?void 0:i.sequenceSteps)?void 0:a[r])||0,u=null==(o=null==t?void 0:t[this.currentSlideKey])?void 0:o.sequenceSteps[r];if(void 0!==u&&u!==c)if(-1===c)n.seekIndex((null==(s=this.animationManager.mainSeq)?void 0:s.length)||0);else if(u<=n.length&&u>=0){var l=u-c;l>0?((n.index===u-2&&n.isPlaying||l>1)&&n.seekIndex(u-1),n.play()):l<0&&(n.pause(),n.seekIndex(u))}else u>n.length&&(n.pause(),n.seekIndex(n.length))}},{key:"resetCurrentSlideAnimation",value:function(){var e=this,t=this.state[this.currentSlideKey],n=this.props,r=n.stateAdapter,i=n.data;if(t){var a=t.sequenceSteps;Object.keys(a).forEach((function(t){t===Ry&&"clickEffect"!==e.animationManager.mainSeq.effectType?a[t]=1:a[t]=0})),r.setState(i.uuid,i.index,this.composeSlideStateIntoPPTState(Iv({},a),!0))}}},{key:"resetCurrentPPTAnimation",value:function(){var e=this,t=this.state,n=t.disableAutoPlay,r=t.pageIndex,i=t.playLastStep,a=t.progressIndex,o=t.uuid,s=this.props,c=s.data,u=s.stateAdapter,l={disableAutoPlay:n,pageIndex:r,playLastStep:i,progressIndex:a,uuid:o},h=Object.keys(this.state).filter((function(e){return e.includes(c.uuid)})).map((function(t){return{key:t,sequenceSteps:e.state[t].sequenceSteps}})),d={};h.forEach((function(t){var n=t.key,r=t.sequenceSteps;n===e.currentSlideKey&&(Object.keys(r).forEach((function(t){t===Ry&&"clickEffect"!==e.animationManager.mainSeq.effectType?r[t]=1:r[t]=0})),d[n]={sequenceSteps:r})})),l=Iv(Iv({},l),d),u.setState(c.uuid,c.index,l)}},{key:"toNextPage",value:function(){var e=this.props.stateAdapter;e.onPageToNext&&e.onPageToNext()}},{key:"toPrevPage",value:function(){var e=this.props.stateAdapter;e.onPageToPrev&&e.onPageToPrev()}},{key:"changeStep",value:function(e){var t=this.state[this.currentSlideKey],n=this.props,r=n.stateAdapter,i=n.data,a=t.sequenceSteps,o=a[Ry];if(void 0===o||0===this.animationManager.mainSeq.length)e>0?this.onPageToNext():e<0&&this.onPageToPrev();else{o<0&&(this.animationManager.triggerEvent.emit("onEnd",{target:"slide"}),o=this.animationManager.mainSeq.length);var s=o+e;s<0?this.onPageToPrev():s>this.animationManager.mainSeq.length?this.onPageToNext():1===o&&0===s?r.setState(i.uuid,i.index,this.composeSlideStateIntoPPTState(Cv(Iv({},a),c({},Ry,s)),!0)):r.setState(i.uuid,i.index,this.composeSlideStateIntoPPTState(Cv(Iv({},a),c({},Ry,s)),!1))}}},{key:"renderMediaControllerPortal",value:function(e){return 0===this.props.renderMode?ed.default.createElement("div",{id:"netless-media-controller-portal-".concat(e.uuid),style:{position:"absolute",zIndex:1e3}}):null}},{key:"render",value:function(){var e,t,n,r,i,a=this.props,o=a.disableAnimation,s=a.renderMode,c=a.className,u=a.data,l=a.pausing,h=a.userId,d=a.callbacks,p=a.pptState,f=u.slideXML.childElement("p:sld","p:cSld","p:spTree"),v=u.masterXML.childElement("p:sldMaster","p:cSld","p:spTree"),m=u.layoutXML.childElement("p:sldLayout","p:cSld","p:spTree"),g=u.slideXML.childElement("p:sld","p:cSld"),y={uuid:u.uuid,resourceLoader:u.resourceLoader,slideWidth:u.width,slideHeight:u.height,slideIndex:u.index+1,preload:u.preload},b=o;void 0!==s&&1===s&&(b=!0);var k=null==(e=null==p?void 0:p.mediaStates)?void 0:e[this.currentSlideKey];return ed.default.createElement(bm,{className:c,slideContext:y,slideRef:this.slide,cSld:g,resourceLoader:u.resourceLoader},this.renderMediaControllerPortal(u),this.isRenderMaster&&ed.default.createElement(oy,{uuid:u.uuid,logger:u.logger,slideRef:this.slide,slideContext:y,shapeGroupXML:v,resourceType:"master",disableAnimation:b,zIndex:0,wrapResource:null==(t=u.WrapResource)?void 0:t.master}),ed.default.createElement(oy,{uuid:u.uuid,logger:u.logger,slideRef:this.slide,slideContext:y,shapeGroupXML:m,resourceType:"layout",disableAnimation:b,zIndex:1,wrapResource:null==(n=u.WrapResource)?void 0:n.layout}),ed.default.createElement(oy,{uuid:u.uuid,ref:this.shapeGroupRef,shapeGroupXML:f,pausing:l,userId:h,logger:u.logger,slideRef:this.slide,slideContext:y,resourceType:"slide",interactiveSeqsKeys:this.interactiveSeqsKeys||[],zIndex:2,onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:k,mediaSlideActionUserIds:null==(r=null==p?void 0:p.mediaActionUserIds)?void 0:r[this.currentSlideKey],disableAnimation:b,onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:d?d.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:u.rtcClient,wrapResource:null==(i=u.WrapResource)?void 0:i.slide,animationManager:this.animationManager}))}}]),n}(ed.default.Component);function Uy(e,t){var n,r={},i={},a={},o=E(e.elements);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.childElementOptional(new Hv("p:nvSpPr","p:nvCxnSpPr"));if(c){var u=c.childElement("p:cNvPr").attr.getStringOptional("id"),l=c.childElementOptional("p:nvPr","p:ph"),h=l&&l.attr.getStringOptional("idx"),d=l&&l.attr.getStringOptional("type");void 0!==u&&(r[u]=s),void 0!==h?i[h]=s:("title"===d||"ctrTitle"===d)&&(i[0]=s),"title"===d||"ctrTitle"===d?(a.title=s,a.ctrTitle=s):void 0!==d&&(a[d]=s)}}}catch(e){o.e(e)}finally{o.f()}return Object.freeze(t?{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a),txStyle:Object.freeze(Vy(t))}:{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a)})}function Vy(e){var t={},n=e.elementWithName("p:bodyStyle");n&&(t.body=n);var r=e.elementWithName("p:titleStyle");r&&(t.title=r,t.subTitle=r,t.ctrTitle=r);var i=e.elementWithName("p:otherStyle");return i&&(t.other=i),t}var Wy=function(){function e(t,n){M(this,e),this.resource=t,this.resourceScheme=n}return O(e,[{key:"loadURL",value:function(e,t){var n=this.resource[e]&&this.resource[e][t];return void 0===n||(n=this.replaceProtocolByresourceScheme(n)),n}},{key:"replaceProtocolByresourceScheme",value:function(e){var t=e;return this.resourceScheme&&(t=t.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),t}}]),e}();var Hy=function(e,t,n,r,i){var a,o=function(e,t,n,r){var i=n.bodyPrXMlList;return i||(i=n.bodyPrXMlList=Object.freeze(function(e,t,n){var r,i=[],a=bg(e.parentElement(new Hv("p:sp","p:graphicFrame")),t,n),o=a.allShape,s=a.hasPlaceHolder,c=E(o);try{for(c.s();!(r=c.n()).done;){var u=r.value.childElementOptional("p:txBody","a:bodyPr");u&&i.push(u)}}catch(e){c.e(e)}finally{c.f()}return{pPrXMLList:i,hasPlaceHolder:s}}(e,t,r))),i}(e,t,r,i),s=E(o.pPrXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.attr.getOptional(n);if(void 0!==c)return c}}catch(e){s.e(e)}finally{s.f()}};var _y=function(e,t,n,r,i){var a,o=E(Xy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},Gy=function(e,t){return function(n,r,i,a,o){var s,c=Xy(n,r,a,o),u=c.pPrXMLList,l=c.hasPlaceHolder,h=E(u);try{for(h.s();!(s=h.n()).done;){var d=s.value.attr.getOptional(i);if(void 0!==d)return d}}catch(e){h.e(e)}finally{h.f()}return l?e:t}},Yy=function(e,t,n,r,i){return Xy(e,t,r,i).level};function Xy(e,t,n,r){var i=n.pPrXMlList;return i||(i=n.pPrXMlList=Object.freeze(function(e,t,n){var r=[],i=e.parentElement(new Hv("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;a&&(r.push(a),o=a.attr.getNumber("lvl",0));var s,c="a:lvl".concat(o+1,"pPr"),u=bg(i,t,n),l=u.allShape,h=u.placeHolderType,d=u.masterStyleXML,p=u.hasPlaceHolder,f=E(l);try{for(f.s();!(s=f.n()).done;){var v=s.value.childElementOptional("p:txBody","a:lstStyle",c);v&&r.push(v)}}catch(e){f.e(e)}finally{f.f()}if(d){var m=d.childElementOptional(c);m&&r.push(m)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:p}}(e,t,r))),i}var Qy=function(e,t,n,r,i){var a,o=E(qy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},Zy=function(e,t){var n=e.childElementOptional("a:rPr","a:highlight",v(Hv,am));if(n)return pm(n,t)},Ky=function(e,t,n,r,i){var a=Qy(e,t,"sz",r,i),o=Qy(e,t,"kern",r,i);return a||o};function qy(e,t,n,r){var i=n.rangeXMlList;return i||(i=n.rangeXMlList=Object.freeze(function(e,t,n){var r,i=e.elementWithName("a:rPr");r="a:p"===e.name?e:e.parentElement("a:p");var a=function(e,t,n){var r=[],i=e.parentElement(new Hv("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;if(a){o=a.attr.getNumber("lvl",0);var s=a.childElementOptional("a:defRPr");s&&r.push(s)}var c,u="a:lvl".concat(o+1,"pPr"),l=bg(i,t,n),h=l.allShape,d=l.placeHolderType,p=l.masterStyleXML,f=l.hasPlaceHolder,v=E(h);try{for(v.s();!(c=v.n()).done;){var m=c.value,g=m.childElementOptional("p:txBody","a:lstStyle",u,"a:defRPr");g&&r.push(g);var y=m.childElementOptional("p:style");if(y){var b=om(y,t);r.push(b.font.fontRef),b.font.xml&&r.push(b.font.xml)}}}catch(e){v.e(e)}finally{v.f()}if(p){var k=p.childElementOptional(u,"a:defRPr");k&&r.push(k)}return{pPrXMLList:r,placeHolderType:d,level:o,hasPlaceHolder:f}}(r,t,n),o=a.placeHolderType,s=a.pPrXMLList,c=a.level,u=a.hasPlaceHolder;return i?{placeHolderType:o,pPrXMLList:[e,i].concat(C(s)),level:c,hasPlaceHolder:u}:{placeHolderType:o,pPrXMLList:[e].concat(C(s)),level:c,hasPlaceHolder:u}}(e,t,r))),i}var Jy=function(e,t,n,r,i){var a,o=E(qy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.childElementOptional(v(Hv,im));if(c)return(new vm).read(c,t);var u=s.childElementOptional(v(Hv,am));if(u)return pm(u,t)}}catch(e){o.e(e)}finally{o.f()}},$y=function(e,t,n,r,i){var a,o=qy(e,t,r,i),s=[],c=E(o.pPrXMLList);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=u.childElementOptional("a:latin"),h=u.childElementOptional("a:ea");if(l){var d=l.attr.getOptional("typeface");"string"==typeof d&&s.push(d)}if(h){var p=h.attr.getOptional("typeface");"string"==typeof p&&s.push(p)}}}catch(e){c.e(e)}finally{c.f()}s=(s=function(e){switch(e){case"title":case"ctrTitle":return!0;default:return!1}}(o.placeHolderType)?s.concat(rm($v(t))):s.concat(rm(em(t)))).filter((function(e){return""!==e}));var f=[],v=$v(t),m=em(t);return s.forEach((function(e){switch(e){case"+mj-lt":f=v.latin?f.concat(v.latin):f;break;case"+mj-ea":f=v.ea?f.concat(v.ea):f;break;case"+mj-cs":f=v.cs?f.concat(v.cs):f;break;case"+mn-lt":f=m.latin?f.concat(m.latin):f;break;case"+mn-ea":f=m.ea?f.concat(m.ea):f;break;case"+mn-cs":f=v.cs?f.concat(v.cs):f;break;default:f.push(e)}})),f.forEach((function(e){Zv(e,t.userFonts).then((function(){}),(function(){}))})),f.join(",")},eb=function(e){var t=e.parentElement(new Hv("p:sp","p:graphicFrame")).childElementOptional(new Hv("p:nvSpPr","p:nvCxnSpPr"));return t&&t.childElementOptional("p:nvPr","p:ph")?"true":"false"},tb=function(e,t,n,r,i){var a,o=E(Xy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional(new Hv("a:buChar","a:buNone","a:buAutoNum","a:buBlip"));if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},nb=function(e,t,n,r,i){var a,o=E(Xy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:buClr");if(s)return pm(s.childElement(v(Hv,am)),t)}}catch(e){o.e(e)}finally{o.f()}};function rb(e){var t=e.childElementOptional("a:lnSpc",new Hv("a:spcPct","a:spcPts"));if(t){var n=0,r=e.parentElementOptional("p:txBody");if(r){var i=r.childElementOptional("a:bodyPr","a:normAutofit");i&&(n=Ev(i.attr.getNumber("lnSpcReduction",0)))}switch(t.name){case"a:spcPct":return Ev(t.attr.getString("val"))-n;case"a:spcPts":return"".concat(t.attr.getNumber("val")/100*(1-n),"pt");default:return}}}var ib=function(e,t,n,r,i){var a,o=E(Xy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=rb(a.value);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}return 1},ab=function(e,t,n,r,i){var a,o=E(Xy(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=ob(a.value,n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}};function ob(e,t){var n=e.childElementOptional(t,new Hv("a:spcPct","a:spcPts"));if(n)switch(n.name){case"a:spcPct":return Ev(n.attr.getString("val"));case"a:spcPts":return"".concat(n.attr.getNumber("val")/100,"pt");default:return}}function sb(e,t,n){var r,i=E(bg(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:off");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:off")))return o}}catch(e){i.e(e)}finally{i.f()}var s=ub(e,t,n);return s&&s.childElementOptional("a:off")}function cb(e,t,n){var r,i=E(bg(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:ext");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:ext")))return o}}catch(e){i.e(e)}finally{i.f()}var s=ub(e,t,n);return s&&s.childElementOptional("a:ext")}function ub(e,t,n){var r;if("slide"===n){var i=e.childElementOptional("p:spPr","a:xfrm");if(i)return i;var a=null==(r=e.childElementOptional("p:nvPicPr","p:nvPr","p:ph"))?void 0:r.attr.getStringOptional("idx");if(a){var o=t.layoutIndex.idxIndex[a];if(o)return o.childElementOptional("p:spPr","a:xfrm");var s=t.masterIndex.idxIndex[a];return s?s.childElementOptional("p:spPr","a:xfrm"):void 0}}}var lb=function(e,t,n,r,i){var a=function(e,t,n,r,i){var a=r.tableStyleXML;return a||(a=r.tableStyleXML=Object.freeze(function(e,t){var n,r=e.parentElement("a:tbl").childElementOptional("a:tblPr");if(r&&r.hasChildElementWithName("a:tableStyleId")){var i=r.childElement("a:tableStyleId").text,a=null==(n=t.tableStyles)?void 0:n.childElement("a:tblStyleLst").elementsWithName("a:tblStyle"),o=null==a?void 0:a.filter((function(e){return e.attr.getString("styleId")===i}))[0],s=r.attr.getBoolean("bandCol",!1),c=r.attr.getBoolean("bandRow",!1),u=r.attr.getBoolean("firstCol",!1),l=r.attr.getBoolean("firstRow",!1),h=r.attr.getBoolean("lastCol",!1),d=r.attr.getBoolean("lastRow",!1),p=r.attr.getBoolean("rtl",!1);return{tableStyle:o,bandCol:s,bandRow:c,firstCol:u,firstRow:l,lastCol:h,lastRow:d,rtl:p}}return{tableStyle:void 0,bandCol:!1,bandRow:!1,firstCol:!1,firstRow:!1,lastCol:!1,lastRow:!1,rtl:!1}}(e,t))),a}(e,t,0,r),o=n.split("-"),s=parseInt(o[0],10),c=parseInt(o[1],10),u=o[2],l=e.parentElement("a:tbl").childElementOptional("a:tblPr"),h=function(e,t,n,r){switch(n){case"isBold":case"isItalic":return;case"fillColor":var i=e.childElementOptional(v(Hv,im));return i?(new vm).read(i,t):(new vm).read(r,t);case"fontFamily":case"fontColor":return;case"bottomBorderWidth":return new fb(e,"a:lnB").getBorderWidth();case"bottomBorderColor":return new fb(e,"a:lnB").getBorderColor(t);case"bottomBorderStyle":return new fb(e,"a:lnB").getBorderType();case"bottomBorderStrokeDashArray":return new fb(e,"a:lnB").getBorderStrokeDashArray();case"topBorderWidth":return new fb(e,"a:lnT").getBorderWidth();case"topBorderColor":return new fb(e,"a:lnT").getBorderColor(t);case"topBorderStyle":return new fb(e,"a:lnT").getBorderType();case"topBorderStrokeDashArray":return new fb(e,"a:lnT").getBorderStrokeDashArray();case"leftBorderWidth":return new fb(e,"a:lnL").getBorderWidth();case"leftBorderColor":return new fb(e,"a:lnL").getBorderColor(t);case"leftBorderStyle":return new fb(e,"a:lnL").getBorderType();case"leftBorderStrokeDashArray":return new fb(e,"a:lnL").getBorderStrokeDashArray();case"rightBorderWidth":return new fb(e,"a:lnR").getBorderWidth();case"rightBorderColor":return new fb(e,"a:lnR").getBorderColor(t);case"rightBorderStyle":return new fb(e,"a:lnR").getBorderType();case"rightBorderStrokeDashArray":return new fb(e,"a:lnR").getBorderStrokeDashArray();default:return}}(e,t,u,l);if(void 0!==h&&h!==um)return h;if(a.tableStyle){var d=a.tableStyle.childElementOptional("a:band1H"),p=a.tableStyle.childElementOptional("a:band2H"),f=a.tableStyle.childElementOptional("a:band1V"),m=a.tableStyle.childElementOptional("a:band2V"),g=a.tableStyle.childElementOptional("a:firstRow"),y=a.tableStyle.childElementOptional("a:firstCol"),b=a.tableStyle.childElementOptional("a:wholeTbl"),k=(s+1)%2==1,w=(c+1)%2==1,S=0===s,x=0===s;return a.firstRow&&S?hb(g,t,u,b):a.firstCol&&x?hb(y,t,u,b):a.bandRow?a.firstRow?hb(k?p:d,t,u,b):hb(k?d:p,t,u,b):a.bandCol?a.firstCol?hb(w?m:f,t,u,b):hb(w?f:m,t,u,b):db(b,t,u)}};function hb(e,t,n,r){if(e){var i=db(e,t,n);return void 0===i?db(r,t,n):i}return db(r,t,n)}function db(e,t,n){switch(n){case"isBold":var r=e&&e.childElementOptional("a:tcTxStyle");return r?r.attr.getString("b","off"):"false";case"isItalic":var i=e&&e.childElementOptional("a:tcTxStyle");return i?i.attr.getString("i","off"):"false";case"fillColor":var a=e&&e.childElementOptional("a:tcStyle","a:fill",v(Hv,im));return a?(new vm).read(a,t):void 0;case"fontFamily":var o=e&&e.childElementOptional("a:tcTxStyle","a:fontRef");return o?function(e,t){return"none"!==e?rm(tm(nm(t).childElement("a:".concat(e,"Font")))).filter((function(e){return!e.startsWith("+")&&""!==e})).map((function(e){return Zv(e,t.userFonts),e})):[]}(o.attr.getString("idx","none"),t).join(","):void 0;case"fontColor":var s=e&&e.childElementOptional("a:tcTxStyle",v(Hv,am));return s?pm(s,t):void 0;case"bottomBorderWidth":return new pb(e,"a:bottom").getBorderWidth();case"bottomBorderColor":return new pb(e,"a:bottom").getBorderColor(t);case"bottomBorderStyle":return new pb(e,"a:bottom").getBorderType();case"topBorderWidth":return new pb(e,"a:top").getBorderWidth();case"topBorderColor":return new pb(e,"a:top").getBorderColor(t);case"topBorderStyle":return new pb(e,"a:top").getBorderType();case"leftBorderWidth":return new pb(e,"a:left").getBorderWidth();case"leftBorderColor":return new pb(e,"a:left").getBorderColor(t);case"leftBorderStyle":return new pb(e,"a:left").getBorderType();case"rightBorderWidth":return new pb(e,"a:right").getBorderWidth();case"rightBorderColor":return new pb(e,"a:right").getBorderColor(t);case"rightBorderStyle":return new pb(e,"a:right").getBorderType();default:return}}var pb=function(){function e(t,n){M(this,e),this.tcStyle=t,this.lnKey=n}return O(e,[{key:"getBorderColor",value:function(e){var t=this.tcStyle&&this.tcStyle.childElementOptional("a:tcStyle","a:tcBdr",this.lnKey,"a:ln",v(Hv,im));if(t)return(new vm).read(t,e)}},{key:"getBorderWidth",value:function(){var e=this.tcStyle&&this.tcStyle.childElementOptional("a:tcStyle","a:tcBdr",this.lnKey,"a:ln");if(e)return e.attr.getNumberOptional("w")}},{key:"getBorderType",value:function(){var e=this.tcStyle&&this.tcStyle.childElementOptional("a:tcStyle","a:tcBdr",this.lnKey,"a:ln");if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val"))return t.attr.getString("val")}return"solid"}}]),e}(),fb=function(){function e(t,n){M(this,e),this.tcPrXMl=t,this.lnKey=n}return O(e,[{key:"getBorderColor",value:function(e){var t=this.tcPrXMl.childElementOptional(this.lnKey);if(t)return(new vm).read(t.childElement(v(Hv,im)),e)}},{key:"getBorderWidth",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e)return e.attr.getNumber("w",0)}},{key:"getBorderType",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val")){var n=t.attr.getStringOptional("val");return"dot"===n||"sysDot"===n?"dotted":"dash"===n||"sysDash"===n?"dashed":"solid"}}}},{key:"getBorderStrokeDashArray",value:function(){var e=this.getBorderWidth(),t=this.getBorderType();if(void 0!==e&&void 0!==t)switch(t){case"solid":return"0";case"dash":return"".concat(5*e);case"dashDot":return" ".concat(5*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"dot":return"".concat(e,",  ").concat(5*e);case"lgDash":return"".concat(2*e,", ").concat(e);case"lgDashDot":return"".concat(10*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDash":return"".concat(5*e,", ").concat(2*e);case"sysDashDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e);case"sysDashDotDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDot":return"".concat(2*e,", ").concat(5*e);default:return"0"}}}]),e}();var vb=function(e,t,n,r,i){var a=kb(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx");return t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1]}return a.bgXML.childElementOptional("p:bgPr","a:blipFill")},mb=function(e,t,n,r,i){var a=kb(e,t,n,r,i);if(!a.bgXML||!a.bgXML.hasChildElementWithName("p:bgRef"))return gb(a.bgXML.childElementOptional("p:bgPr","a:blipFill"));var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return"a:blipFill"===s.name?gb(s):void 0};function gb(e){if(e)return e.childElement("a:blip").attr.getStringOptional("r:embed")}var yb=function(e,t,n,r,i){var a=kb(e,t,n,r,i);return a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")?"theme":a.resourceType},bb=function(e,t,n,r,i){var a=kb(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return new vm(a.bgXML.childElement("p:bgRef").childElementOptional("a:schemeClr")).read(s,t)}return(new vm).read(a.bgXML.childElement("p:bgPr",v(Hv,im)),t)};function kb(e,t,n,r,i){var a=r.bgXML;return a||(a=r.bgXML=Object.freeze(function(e,t){return e.hasChildElementWithName("p:bg")?{bgXML:e.childElement("p:bg"),resourceType:"slide"}:t.layout.childElementOptional("p:sldLayout","p:cSld","p:bg")?{bgXML:t.layout.childElement("p:sldLayout","p:cSld","p:bg"),resourceType:"layout"}:{bgXML:t.master.childElement("p:sldMaster","p:cSld","p:bg"),resourceType:"master"}}(e,t))),a}var wb=new sg;!function(e){e.bindAttributePicker("a:p","*",_y),e.bindAttributePicker("a:p","indent",Gy(-342900,0)),e.bindAttributePicker("a:p","marL",Gy(342900,0)),e.bindAttributePicker("a:p","level",Yy),e.bindAttributePicker("a:bodyPr","*",Hy),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld"],"*",Qy),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld","a:p"],"sz",Ky),e.bindAttributePicker(["a:r"],"highlight",Zy),e.bindAttributePicker(["a:r","a:fld"],"color",Jy),e.bindAttributePicker(["a:r","a:fld"],"fontType",$y),e.bindAttributePicker("a:p","placeHolderType",eb),e.bindChildPicker("a:p","bu",tb),e.bindAttributePicker("a:p","buClr",nb),e.bindAttributePicker("a:p","lineHeight",ib),e.bindAttributePicker("a:p",["a:spcBef","a:spcAft"],ab)}(wb),function(e){e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:prstGeom",Og),e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:custGeom",Og),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"fillColor",Eg),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderWidth",Ng),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderType",Rg),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderColor",Ag),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderStrokeDashArray",Lg),e.bindAttributePicker("p:sp","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:cxnSp","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvCxnSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:pic","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvPicPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:grpSp","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:spTree","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","spId",(function(e,t,n,r,i){return Cg(i)+e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","borderWidth",(function(){return 0})),e.bindAttributePicker("p:graphicFrame","borderType",(function(){return"none"})),e.bindAttributePicker("p:graphicFrame","borderColor",(function(){return"black"})),e.bindAttributePicker("p:graphicFrame","borderStrokeDashArray",(function(){return"0"}))}(wb),function(e){e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"x",(function(e,t,n,r,i){var a=sb(e,t,i);return a?a.attr.getOptional("x"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"y",(function(e,t,n,r,i){var a=sb(e,t,i);return a?a.attr.getOptional("y"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"width",(function(e,t,n,r,i){var a=cb(e,t,i);return a?a.attr.getOptional("cx"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"height",(function(e,t,n,r,i){var a=cb(e,t,i);return a?a.attr.getOptional("cy"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipV",(function(e,t){var n=ub(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipV")?n.attr.getOptional("flipV"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipH",(function(e,t){var n=ub(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipH")?n.attr.getOptional("flipH"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"hidden",(function(e){var t=e.childElementOptional(new Hv("p:nvGraphicFramePr","p:nvSpPr","p:nvCxnSpPr","p:nvPicPr"),"p:cNvPr");return t?t.attr.get("hidden","false"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp"],"rot",(function(e,t){var n=ub(e,t,"slide");return n?n.attr.getOptional("rot"):0}))}(wb),function(e){e.bindAttributePicker("a:tcPr","*",lb)}(wb),function(e){e.bindChildPicker(["p:cSld"],"getBackgroundImageFill",vb),e.bindAttributePicker(["p:cSld"],"backgroundResId",mb),e.bindAttributePicker(["p:cSld"],"backgroundImageResourceType",yb),e.bindAttributePicker(["p:cSld"],"backgroundColor",bb)}(wb);var Sb="masterPartName",xb="layoutPartName";function Ib(e,t){return Cb.apply(this,arguments)}function Cb(){return(Cb=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zm("".concat(t,"/text/slide/slide").concat(n,".json"));case 2:return r=e.sent,i=r[Sb].replace("/ppt/slideMasters/slideMaster","/text/master/master").replace(".xml",".json"),a=r[xb].replace("/ppt/slideLayouts/slideLayout","/text/layout/layout").replace(".xml",".json"),e.next=7,Zm("".concat(t).concat(i));case 7:return o=e.sent,e.next=10,Zm("".concat(t).concat(a));case 10:return s=e.sent,e.abrupt("return",{slide:r,master:o,layout:s});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pb(e,t){return Mb.apply(this,arguments)}function Mb(){return(Mb=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,p,f,v,m,g,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]&&y[2],y.length>3?y[3]:void 0,i=y.length>4?y[4]:void 0,a=y.length>5?y[5]:void 0,o=y.length>6?y[6]:void 0,a&&a.info("Start load ppt ".concat(n," resource.")),s=t.replace(/\/$/i,""),o&&o.scheme&&(c=o.scheme,s=s.replace(/^[a-zA-z]+[^://]/,c)),u=new lg(c),e.next=11,Promise.all([Zm(s+"/info.json",a),Xm(s+"/pptxml/ppt.xml",a),Xm(s+"/table/tableStyles.xml").catch((function(e){null==a||a.warn(e)}))]);case 11:return l=e.sent,d=h(l,3),p=d[0],f=d[1],v=d[2],e.next=18,u.loadLumiaPSD(r,a);case 18:return a&&a.info("load ppt ".concat(n," resource success")),m=(o||{}).useServerWrap,g=void 0===m||m,e.abrupt("return",(g&&Xv(s,n,p.fonts),new Ab({uuid:n,url:s,width:p.width,height:p.height,slidesCount:p.totalPageSize,mainXMLContent:f,tableStylesXMLContent:v,userFonts:i,preload:r,logger:a,resourceScheme:c,rtcClient:null==o?void 0:o.rtcClient,useServerWrap:g})));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Tb,Ob,Eb,Ab=function(){function e(t){M(this,e),this.url=t.url,this.uuid=t.uuid,this.width=t.width*Pv,this.height=t.height*Pv,this.slidesCount=t.slidesCount,this.userFonts=t.userFonts,this.preload=t.preload,this.logger=t.logger,this.resourceScheme=t.resourceScheme,this.mainXMLContent=t.mainXMLContent,this.tableStylesXMLContent=t.tableStylesXMLContent,this.rtcClient=t.rtcClient,this.useServerWrap=t.useServerWrap}var t,n,r;return O(e,[{key:"loadSlide",value:(r=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,p,f,v,m,g,y,b,k,w,S,x,I,C,P,M,T,O=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=this.logger)||n.debug("begin load slide ".concat(t+1)),o=wb.createPickers(),s=new Wv("main",o).parse(this.mainXMLContent),c=this.tableStylesXMLContent?new Wv("main",o).parse(this.tableStylesXMLContent):void 0,!(t<0||t>=this.slidesCount)){e.next=4;break}throw new Error("index should be in 0 ~ ".concat(this.slidesCount-1));case 4:return u=t+1,e.next=7,this.fetchSlideInfo(u);case 7:return l=e.sent,h=l.slideXMLContent,d=l.slideRefXMLContent,p=l.layoutXMLContent,f=l.masterXMLContent,v=l.themeXMLContent,m=l.resource,g=l.wrapResource,!0===this.preload&&(null==(r=this.logger)||r.debug("begin preload slide ".concat(u+1)),this.prefetch(u+1).catch((function(e){var t;null==(t=O.logger)||t.debug("prefetch slide ".concat(u+1," error: "),e)})),null==(i=this.logger)||i.debug("preloaded slide ".concat(u+1))),y=new Wv("layout",o).parse(p),b=Uy(y.childElement("p:sldLayout","p:cSld","p:spTree")),k=new Wv("master",o).parse(f),w=Uy(k.childElement("p:sldMaster","p:cSld","p:spTree"),k.childElementOptional("p:sldMaster","p:txStyles")),S=new Wv("theme",o).parse(v),x=new Wy(m,this.resourceScheme),I=new Wv("slide",o).parse(h),C=new Wv("slideRef",o).parse(d),P={},void 0!==C.element&&C.element.elements.forEach((function(e){P[e.attr.getString("Id")]=e.attr.getStringOptional("Target")})),M={slide:I,layout:y,layoutIndex:b,master:k,masterIndex:w,masterThemeColorMapping:k.childElement("p:sldMaster","p:clrMap").attr.attributes,theme:S,main:s,tableStyles:c,userFonts:this.userFonts},o.context=Object.freeze(M),T=Ly(I,Object.freeze({pptUUID:this.uuid,slideIndex:u,slideContext:M,slideWidth:this.width,slideHeight:this.height,shapeParamsIndex:this.getShapeIndexMap(I.childElement("p:sld","p:cSld","p:spTree")),wrapResource:g})),e.abrupt("return",(null==(a=this.logger)||a.debug("loaded slide ".concat(u)),Object.freeze({uuid:this.uuid,url:this.url,index:t,width:this.width,height:this.height,masterXML:k,masterIndex:w,layoutXML:y,layoutIndex:b,mainXML:s,themeXML:S,slideXML:I,slideRefIndex:P,resourceLoader:x,animations:T,tableStylesXML:c,preload:this.preload,logger:this.logger,rtcClient:this.rtcClient,WrapResource:g})));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchSlideInfo",value:(n=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[Xm("".concat(this.url,"/slide/slide").concat(t,".xml"),this.logger),Xm("".concat(this.url,"/slideRef/slideRef").concat(t,".xml"),this.logger).catch((function(e){return console.log("error ",e),""})),Xm("".concat(this.url,"/layout/layout").concat(t,".xml"),this.logger),Xm("".concat(this.url,"/master/master").concat(t,".xml"),this.logger),Xm("".concat(this.url,"/theme/theme").concat(t,".xml"),this.logger),Zm("".concat(this.url,"/resources/resource").concat(t,".json"),this.logger)],e.next=3,Promise.all(n);case 3:if(r=e.sent,i=h(r,6),a=i[0],o=i[1],s=i[2],c=i[3],u=i[4],l=i[5],!this.useServerWrap){e.next=20;break}return e.prev=12,e.next=15,Ib(this.url,t);case 15:d=e.sent,e.next=20;break;case 18:e.prev=18,e.t0=e.catch(12);case 20:return e.abrupt("return",{slideXMLContent:a,slideRefXMLContent:o,layoutXMLContent:s,masterXMLContent:c,themeXMLContent:u,resource:l,wrapResource:d});case 21:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(e){return n.apply(this,arguments)})},{key:"prefetch",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>this.slidesCount)){e.next=3;break}return null==(n=this.logger)||n.debug("no slide need prefetch"),e.abrupt("return");case 3:return i=new lg(this.resourceScheme),e.next=6,i.fetchPageResource(this.url,t);case 6:a=e.sent,i.prefetchPageResource(a).then((function(){}),(function(){})),null==(r=this.logger)||r.debug("prefetch slide ".concat(t," finish"));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getShapeIndexMap",value:function(e){var t={},n=e.extraAttr.getNumber("spId"),r=ay(e);return this.getShapeGroupIndexMap(e,t,n,r.transform),t}},{key:"getShapeGroupIndexMap",value:function(e,t,n,r){var i=this,a=e.elementsWithName("p:sp");this.getChildShapesIndexMap(a,t,n,r);var o=e.elementsWithName("p:cxnSp");this.getChildShapesIndexMap(o,t,n,r);var s=e.elementsWithName("p:pic");this.getChildShapesIndexMap(s,t,n,r);var c=e.elementsWithName("p:graphicFrame");this.getChildShapesIndexMap(c,t,n,r);var u=e.elementsWithName("p:grpSp");u.length>0&&u.forEach((function(e){var a=e.extraAttr.getNumber("spId"),o=ay(e,void 0,n,r);i.getShapeGroupIndexMap(e,t,a,o.transform),t[a]=o}))}},{key:"getChildShapesIndexMap",value:function(e,t,n,r){e.forEach((function(e){var i=e.extraAttr.getNumber("spId"),a=ry(e,0,n,r);t[i]=a}))}}]),e}(),Nb=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).state={disableJumpTo:!1},r}return O(n,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.emitter;e.on("nextStep",this.onNextStepHandler,this),e.on("preStep",this.onPreStepHandler,this),e.on("nextPage",this.onNextPageHandler,this),e.on("prePage",this.onPrePageHandler,this),e.on("resetSlideAnimation",this.resetCurrentSlideAnimation,this),e.on("resetPPTAnimation",this.resetCurrentPPTAnimation,this),e.on("changePageTo",this.onClickJumpToHandler,this),e.on("displaySidebar",this.displaySidebar,this),e.on("hideSidebar",this.hideSidebar,this),e.on("displayNote",this.displayNote,this),e.on("hideNote",this.hideNote,this)}},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"onPrePageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t>0&&n(t-1)}},{key:"onNextPageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t<e.total-1&&n(t+1)}},{key:"onClickJumpToHandler",value:function(e){var t=this.props,n=t.total,r=t.changeToPage,i=(e||parseInt(this.inputRef.value,10))-1;return Number.isNaN(i)||i<0?(this.inputRef.value="1",void r(0)):i>n-1?(this.inputRef.value="".concat(n),void r(n-1)):(this.inputRef.value=(i+1).toString(),void r(i))}},{key:"onPreStepHandler",value:function(){(0,this.props.changeStep)(-1)}},{key:"onNextStepHandler",value:function(){(0,this.props.changeStep)(1)}},{key:"invalidJumpTo",value:function(){Number.isNaN(parseInt(this.inputRef.value,10))?this.setState({disableJumpTo:!0}):this.setState({disableJumpTo:!1})}},{key:"resetCurrentSlideAnimation",value:function(){(0,this.props.resetCurrentSlideAnimation)()}},{key:"resetCurrentPPTAnimation",value:function(){(0,this.props.resetCurrentPPTAnimation)()}},{key:"displaySidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!0)}},{key:"hideSidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!1)}},{key:"displayNote",value:function(){(0,this.props.changeIsShowNote)(!0)}},{key:"hideNote",value:function(){(0,this.props.changeIsShowNote)(!1)}},{key:"render",value:function(){var e=this,t=this.state.disableJumpTo,n=this.props,r=n.slideIndex,i=n.total,a=n.isExtendSidebar,o=n.isShowNote,s=n.international,c=n.disableSidebar,u=n.disableNote;return fv.default.createElement("div",{className:"ppt-preview-beauty-scroll-bar ppt-preview-controls"},fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:0===r,onClick:function(){e.onPrePageHandler()}},s&&s.prePage||""),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onPreStepHandler()}},s&&s.preStep||""),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onNextStepHandler()}},s&&s.nextStep||""),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:r===i-1,onClick:function(){e.onNextPageHandler()}},s&&s.nextPage||""),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentSlideAnimation()}},s&&s.resetCurrentSlideAnimation||""),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentPPTAnimation()}},s&&s.resetCurrentPPTAnimation||""),fv.default.createElement("input",{className:"ppt-preview-controls-input",type:"text",onInput:function(){e.invalidJumpTo()},ref:function(t){e.inputRef=t}}),fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onClickJumpToHandler()},disabled:t},s&&s.jumpTo||""),a?fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideSidebar()}},s&&s.hideSidebar||""):fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displaySidebar()},disabled:c},s&&s.displaySidebar||""),o?fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideNote()}},s&&s.hideNote||""):fv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displayNote()},disabled:u},s&&s.displayNote||""),fv.default.createElement("p",{className:"ppt-preview-controls-page"},s&&s.pageNumber||"","",r+1," ","/",i))}}]),n}(fv.default.Component),Rb=function(e){m(n,e);var t=y(n);function n(e){return M(this,n),t.call(this,e)}return O(n,[{key:"render",value:function(){var e=this.props,t=e.isShow,n=e.noteList;return vv.default.createElement("div",{style:{width:"100%",height:"200px",overflow:"auto",position:"absolute",bottom:t?0:"-200px",transition:"1s",zIndex:"2",fontSize:"12px",padding:"12px",boxSizing:"border-box",fontFamily:""},className:"ppt-preview-beauty-scroll-bar ppt-preview-note"},n.map((function(e,t){var n,r={textAlign:xm(null!=(n=e.align)?n:"l"),marginLeft:e.marginLeft?"".concat(e.marginLeft,"px"):0,marginRight:e.marginRight?"".concat(e.marginRight,"px"):0,textIndent:e.indent?"".concat(e.indent,"px"):0};return vv.default.createElement("div",{key:t,style:r},e.buchar&&vv.default.createElement("span",null,parseInt(e.buchar,10)?e.buchar+".":e.buchar,""),!e.runs&&vv.default.createElement("br",null),e.runs&&e.runs.map((function(e,n){var r,i={letterSpacing:e.wordSpace?"".concat(e.wordSpace,"px"):0,verticalAlign:e.baseline?"".concat(e.baseline,"px"):0,textDecoration:e.underLine?Im(e.underLine):"none",strikeThrough:e.strikeThrough?"":"none",fontWeight:e.bold?"bolder":"normal",fontStyle:e.italic?"italic":"normal"},a=e.text?e.text:"";if(null==(r=e.text)?void 0:r.includes("\t")){for(var o=[],s=0;s<e.text.length;s+=1)"\t"===e.text[s]?o.push(vv.default.createElement("span",{key:"tab"+s},"\t")):o.push(vv.default.createElement("span",{key:"tab"+s,style:{fontFamily:""}},e.text[s]));return vv.default.createElement("pre",{key:a+t+n,style:{margin:"0",display:"inline"}},o)}return"sngStrike"===e.strikeThrough?vv.default.createElement("span",{key:a+t+n,style:i},vv.default.createElement("s",null,e.text)):"br"===e.runType?vv.default.createElement("br",null):"text"===e.runType?vv.default.createElement("span",{key:a+t+n,style:i},e.text):vv.default.createElement("span",{key:a+t+n})})))})))}}]),n}(vv.default.PureComponent),Lb=function(e){m(n,e);var t=y(n);function n(){return M(this,n),t.apply(this,arguments)}return O(n,[{key:"clickHandler",value:function(e){(0,this.props.changeToPage)(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isExtend,r=t.previewList,i={display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"absolute",right:n?0:"-20%",width:"20%",overflow:"auto",transition:"1s",top:0,bottom:0,zIndex:"3",borderLeft:"1px solid #ccc",backgroundColor:"#eee"},a={display:"flex",flexDirection:"column",justifyContent:"space-around"};return mv.default.createElement("div",{style:i,className:"ppt-preview-beauty-scroll-bar ppt-preview-sidebar"},r.map((function(t,n){return mv.default.createElement("div",{className:"ppt-preview-sidebar-item ppt-event-source",key:t,style:a,onClick:function(){e.clickHandler(n)}},mv.default.createElement("img",{className:"ppt-preview-sidebar-img",src:t,alt:"PPT"}),mv.default.createElement("span",{className:"ppt-preview-sidebar-span"},n+1))})))}}]),n}(mv.default.Component);!function(e){e.waiting="Waiting",e.converting="Converting",e.finished="Finished",e.fail="Fail"}(Tb||(Tb={})),function(e){e.packaging="Packaging",e.extracting="Extracting",e.generatingPreview="GeneratingPreview",e.mediaTranscode="MediaTranscode"}(Ob||(Ob={})),function(e){e.dynamic="dynamic",e.static="static"}(Eb||(Eb={}));var jb=function(e){m(a,e);var t,n,r,i=y(a);function a(e){var t,n,r;return M(this,a),(t=i.call(this,e)).previewList=[],t.PPTSliderList=[],t.stateAdapter={disableInteractive:!1,setState:(r=I(regeneratorRuntime.mark((function e(n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({globalPPTState:i});case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)}),onPageToPrev:function(){var e=t.state.slideIndex;t.changePageTo(e-1).then((function(){}),(function(){}))},onPageToNext:function(){var e=t.state.slideIndex;t.changePageTo(e+1).then((function(){}),(function(){}))},onPageJumpTo:(n=I(regeneratorRuntime.mark((function e(n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.changePageTo(r-1).then((function(){}),(function(){}));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),setSlideStateAdapterCallbacks:function(e){}},t.clickSidebarHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.clickControllerHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.changeIsExtendSidebar=function(e){0!==t.previewList.length&&t.setState({isExtendingSidebar:e})},t.changeIsShowNote=function(e){0!==t.state.noteList.length&&t.setState({isShownNote:e})},t.resetCurrentSlideAnimation=function(){t.slideRef&&t.slideRef.resetCurrentSlideAnimation()},t.resetCurrentPPTAnimation=function(){t.slideRef&&t.slideRef.resetCurrentPPTAnimation()},t.state={slide:void 0,slideIndex:0,globalPPTState:void 0,isExtendingSidebar:!1,isShownNote:!1,noteList:[],isLoading:!0},t.isGotNodeList=!1,e.conversionResponse.status===Tb.finished&&(t.uuid=e.conversionResponse.uuid,e.conversionResponse.progress.convertedFileList.forEach((function(e){t.PPTSliderList.push(Cv(Iv({},e),{conversionFileUrl:e.conversionFileUrl.replace(/\d.slide/g,"")})),e.preview&&t.previewList.push(e.preview)})),t.total=t.PPTSliderList.length),t}return O(a,[{key:"UNSAFE_componentWillMount",value:(r=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.props,r=n.preloadProgress,i=n.userFonts,a=n.logger,o=this.PPTSliderList[t],e.next=3,Pb(o.conversionFileUrl,this.uuid,!0,r,i,a,{scheme:"https",useServerWrap:!0});case 3:return this.ppt=e.sent,e.next=6,this.ppt.loadSlide(t);case 6:return s=e.sent,e.next=9,this.getNoteList();case 9:this.setState({slide:s,isLoading:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"getNoteList",value:(n=I(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.PPTSliderList[t],e.prev=1,e.next=4,Zm("".concat(n.conversionFileUrl.replace("pptx","https"),"notes/note").concat(t+1,".json"));case 4:r=e.sent,this.setState({noteList:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.setState({noteList:[]});case 11:this.isGotNodeList=!0;case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"changePageTo",value:(t=I(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<0||t>=this.total)){e.next=2;break}return e.abrupt("return");case 2:if(!this.state.isLoading){e.next=5;break}return e.abrupt("return");case 5:return this.setState({isLoading:!0}),e.next=8,this.ppt.loadSlide(t);case 8:return n=e.sent,this.setState({slide:n,slideIndex:t,isLoading:!1,isShownNote:!1}),e.next=12,this.getNoteList();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeStep",value:function(e){this.state.isLoading||this.slideRef.changeStep(e)}},{key:"emitData",value:function(){var e=this;clearTimeout(this.emitSetTimeout),this.emitSetTimeout=setTimeout((function(){if(e.isGotNodeList){var t=e.total,n=e.state,r=n.slideIndex,i=n.isExtendingSidebar,a=n.isShownNote,o=n.noteList,s=e.props.emitter,c=!e.previewList.length,u=!o.length;s.emit("update",{index:r+1,total:t,disableNote:u,disableSidebar:c,isShowNote:a,isExtendSidebar:i})}}),500)}},{key:"render",value:function(){var e=this,t=this.total,n=this.PPTSliderList,r=this.state,i=r.globalPPTState,a=r.slide,o=r.slideIndex,s=r.isExtendingSidebar,c=r.isShownNote,u=r.noteList,l=r.isLoading,h=this.props,d=h.parentElement,p=h.config,f=h.emitter,v=!this.previewList.length,m=!u.length,g=n[0].width;this.emitData();var y=n[0].height+40,b={width:"".concat(g,"px"),height:"".concat(y,"px"),transform:""},k=Math.min(d.offsetWidth/g,d.offsetHeight/y);return d.style.width&&(b.transform="scale(".concat(k,", ").concat(k,")")),hv.default.createElement("div",{style:b,className:"ppt-preview-container"},hv.default.createElement(Nb,{international:p&&p.international,isShowNote:c,emitter:f,disableNote:m,disableSidebar:v,isExtendSidebar:s,changeStep:function(t){e.changeStep(t)},changeIsShowNote:this.changeIsShowNote,changeIsExtendSidebar:this.changeIsExtendSidebar,total:t,resetCurrentSlideAnimation:this.resetCurrentSlideAnimation,resetCurrentPPTAnimation:this.resetCurrentPPTAnimation,changeToPage:this.clickControllerHandler,slideIndex:o}),hv.default.createElement("div",{style:{position:"relative",display:"inline-block",overflow:"hidden",width:"100%",fontSize:"0"},className:"ppt-preview-main-container"},hv.default.createElement("div",{style:{display:"inline-block"},className:"ppt-preview-slide-container"},!l&&a&&hv.default.createElement(By,{ref:function(t){e.slideRef=t},stateAdapter:this.stateAdapter,pptState:i,data:a,renderMode:jy.Normal}),l&&hv.default.createElement("div",{style:b})),this.previewList.length>0&&hv.default.createElement(Lb,{isExtend:s,previewList:this.previewList,changeToPage:this.clickSidebarHandler}),u.length>0&&hv.default.createElement(Rb,{isShow:c,noteList:u})))}}]),a}(hv.default.Component);function Db(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center";var c=null!=s?s:new pv.default;return dv.default.render(hv.default.createElement(jb,{conversionResponse:e,parentElement:t,preload:r,userFonts:i,logger:a,config:n,pptPrams:o,emitter:c}),t),c}var zb=W(n("GBY4")),Fb=W(n("A3Fa")),Bb=Object.defineProperty,Ub=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Wb=Object.prototype.propertyIsEnumerable,Hb=function(e,t,n){return t in e?Bb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var _b=new(function(){function e(){var t=this;M(this,e),this.libraryMap={},this.paddingMap={},this.freeInterrupters={},this.defineLibrary=function(e,n){if(e.libName in t.libraryMap)throw new Error("found duplicated library ".concat(JSON.stringify(e.libName)));n&&(t.freeInterrupters[e.libName]=n),t.libraryMap[e.libName]=Object.freeze(function(e,t){for(var n in t||(t={}))Vb.call(t,n)&&Hb(e,n,t[n]);if(Ub){var r,i=E(Ub(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Wb.call(t,n)&&Hb(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e}({},e))},this.requireModules=function(e){return new Promise((function(n,r){var i=t.paddingMap[e];i||(i=t.paddingMap[e]=[]),i.push({resolve:n,reject:r})}))},this.loader=function(e,n,r){if(!n&&!r){var i=e;return t.createRequireFunction(i)}var a=e;t.handlePanddingNodes(a,n,r)};var n="__netlessJavaScriptLoader",r=window;if(void 0!==r[n])throw new Error("window.".concat(n," was override"));Object.defineProperty(r,n,{enumerable:!1,configurable:!1,writable:!1,value:this.loader})}return O(e,[{key:"handlePanddingNodes",value:function(e,t,n){var r=this.paddingMap[e];if(r){delete this.paddingMap[e];var i,a=E(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(n)o.reject(n);else try{o.resolve(this.handleModules(t))}catch(c){o.reject(c)}}}catch(e){a.e(e)}finally{a.f()}}else if(!n&&t){var s=function(e){var t=e.split("/");return t.pop(),t.join("/")}(e),c=this.freeInterrupters[s];c&&c(e,t)}else console.warn("find invalid async module ".concat(JSON.stringify(e)))}},{key:"createRequireFunction",value:function(e){var t=this.libraryMap[e];if(!t)throw new Error("undefined library ".concat(JSON.stringify(e)));return function(n){var r=t.dependencies,i=r&&r[n];if(!i)throw new Error("cannot find module ".concat(JSON.stringify(n)," of library ").concat(JSON.stringify(e)));return i}}},{key:"handleModules",value:function(e){for(var t in e){var n=e[t];"__esModule"in n||Object.defineProperty(n,"__esModule",{value:!0})}return Object.freeze(e)}}]),e}()),Gb=_b.requireModules,Yb=_b.defineLibrary;function Xb(e,t){for(var n=window.atob(e),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return new Blob([r],t)}function Qb(e){return new Promise((function(t,n){try{var r=new FileReader;r.onload=function(e){var r,i=null==(r=e.target)?void 0:r.result;"string"==typeof i?t(i):n(new Error("blob load wrong type "+R(i)))},r.readAsDataURL(e)}catch(e){n(e)}}))}var Zb="modules";function Kb(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var t=new Error(e.error.message);t.name=e.error.name,n(t)}else n(new Error("failed with null Error"))}}))}var qb=function(){function e(t,n,r){M(this,e);var i=new URL(n),a=i.protocol,o=i.host,s=new te({fetcher:window.fetch.bind(window),retryCount:e.retryCount,retryLoopsCount:0,configmap:{module:{useSSL:"https:"===a,hosts:{"*":o}}}});this.fetcher=s.fetch("module"),this.storeBase64=t,this.findPath=r}var t,n,r,i;return O(e,[{key:"findObjectURL",value:(i=I(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readBlob(t);case 2:if(n=e.sent,e.t0=n,e.t0){e.next=10;break}return e.next=7,this.fetchBuffer(t);case 7:return n=e.sent,e.next=10,this.writeBlob(t,n);case 10:return e.abrupt("return",URL.createObjectURL(n,{oneTimeOnly:!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"readBlob",value:(r=I(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return r=t.sent.transaction([Zb],"readonly").objectStore(Zb).get(n),t.next=5,Kb(r);case 5:return"string"==typeof(i=t.sent)&&(a=i.split(/;base64,/im),o=h(a,2),s=o[0],c=o[1],u=s.replace(/^data:/im,""),i=Xb(c,{type:u})),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"writeBlob",value:(n=I(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r,t.t0=this.storeBase64,!t.t0){t.next=6;break}return t.next=5,Qb(i);case 5:i=t.sent;case 6:return t.next=8,e.dbp;case 8:return a=t.sent.transaction([Zb],"readwrite").objectStore(Zb).put(i,n),t.next=11,Kb(a);case 11:case"end":return t.stop()}}),t,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchBuffer",value:(t=I(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="http://module"+this.findPath(t),e.next=3,this.fetcher(n,{method:"get",headers:{Accept:"application/javascript"}});case 3:if(200===(r=e.sent).status){e.next=6;break}throw new Error("failed to fetch ".concat(JSON.stringify(n)," with status ").concat(r.status));case 6:return e.next=8,r.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"dbp",get:function(){if(!this._dbp){var e=indexedDB.open("__netlessJavaScriptCache",1);e.onupgradeneeded=function(e){e.target.result.createObjectStore(Zb)},this._dbp=Kb(e)}return this._dbp}}]),e}();qb.retryCount=5;var Jb=function(){function e(t){M(this,e),this.params=t,this.completeCallbacks=[]}var t,n;return O(e,[{key:"load",value:(n=I(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],void 0!==this.params.timeout&&t.push(this.startTimeout(this.params.timeout)),t.push(this.loadScript()),e.prev=2,e.next=5,Promise.race(t);case 5:e.prev=5,n=E(this.completeCallbacks);try{for(n.s();!(r=n.n()).done;)(0,r.value)()}catch(e){n.e(e)}finally{n.f()}return e.finish(5);case 9:case"end":return e.stop()}}),e,this,[[2,,5,9]])}))),function(){return n.apply(this,arguments)})},{key:"loadScript",value:(t=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.params,n=t.origin,r=t.findPath,i=t.identifier,!(a=t.storage)){e.next=13;break}return e.prev=2,e.next=5,a.findObjectURL(i);case 5:o=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.warn("read from storage failed: ".concat(e.t0.message)),o="".concat(n).concat(r(i));case 11:e.next=14;break;case 13:o="".concat(n).concat(r(i));case 14:return e.next=16,this.loadScriptWithURL(o);case 16:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return t.apply(this,arguments)})},{key:"loadScriptWithURL",value:function(e){var t=this;return new Promise((function(n,r){var i=document.createElement("script");t.completeCallbacks.push((function(){i.onerror=null,i.onload=null,i.remove()})),i.charset="utf-8",i.src=e,i.onload=function(){n()},i.onerror=function(t){var n=t&&("load"===t.type?"missing":t.type);r(new Error("fetch ".concat(JSON.stringify(e)," failed: ").concat(n)))},document.head.appendChild(i)}))}},{key:"startTimeout",value:function(e){var t=this,n=null;return this.completeCallbacks.push((function(){null!==n&&(clearTimeout(n),n=null)})),new Promise((function(r,i){n=setTimeout((function(){n=null,i(new Error("fetch ".concat(t.params.identifier," timeout")))}),e)}))}}]),e}();var $b,ek,tk=function(){function e(t){var n=this;M(this,e),this.modulesMap={},this.taskPromises={},this.onInterruptFreeModules=function(e,t){n.modulesMap[e]||(n.modulesMap[e]=t)};var r={libName:t.libName,dependencies:t.dependencies};Yb(r,this.onInterruptFreeModules),this.origin=t.origin,this.findPath=t.findPath,this.timeout=t.timeout,this.storage=t.cache?new qb(!!t.storeBase64,t.origin,t.findPath):void 0}var t;return O(e,[{key:"require",value:(t=I(regeneratorRuntime.mark((function e(t,n){var r,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.modulesMap[t]){e.next=7;break}return void 0===(i=this.taskPromises[t])&&(i=this.taskPromises[t]=I(regeneratorRuntime.mark((function e(){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={identifier:t,origin:o.origin,findPath:o.findPath,timeout:o.timeout,storage:o.storage},e.next=4,Promise.all([Gb(t),new Jb(n).load()]);case 4:return r=e.sent,i=h(r,1),a=i[0],e.abrupt("return",a);case 8:return e.prev=8,delete o.taskPromises[t],e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()),e.next=6,i;case 6:r=this.modulesMap[t]=e.sent;case 7:if(a=r[n]){e.next=10;break}throw new Error("can't find module ".concat(JSON.stringify(n)," from ").concat(t));case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),nk=function e(t){if("object"!=R(t)||null===t)return t;if(t.constructor===Object){var n={};for(var r in t)n[r]=e(t[r]);return Object.freeze(n)}if(Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)i[a]=e(t[a]);return Object.freeze(i)}return t}(_);(ek=$b||($b={})).DisableCache="disableCache",ek.StoreAsBlob="storeAsBlob",ek.StoreAsBase64="storeAsBase64";var rk=$b.StoreAsBase64,ik=null;function ak(e){if(void 0===rk)throw new Error("cannot set async module load mode after joined or replay any room");rk=e}function ok(e){return ik||(ik=function(e){var t,n;switch(e){case $b.DisableCache:t=!1,n=!1;break;case $b.StoreAsBlob:t=!0,n=!1;break;case $b.StoreAsBase64:t=!0,n=!0}return function(e){return new tk(e)}({libName:nk.modules.identifier,timeout:12e4,cache:t,storeBase64:n,origin:nk.modules.origin,findPath:function(e){return"/dynamic-libraries/".concat(e,".js")},dependencies:{akko:G,boundless:hc,mobx:Qh,"mobx-react":Zh,react:Kh,"netless-ppt":qh,"url-parse":zb,"textarea-caret-ts":Fb}})}(rk),rk=void 0),Promise.all([ik.require(e,"white-model"),ik.require(e,"white-render")]).then((function(e){return Object.freeze({WhiteModel:e[0],WhiteRender:e[1]})}))}!function(e){var t=document.createElement("style"),n=document.createTextNode(e);t.appendChild(n),document.head.appendChild(t)}(".netless-whiteboard div.highlight-box{border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>*.cursor-nwse{cursor:nwse-resize}.netless-whiteboard div.editor-box>*.cursor-nesw{cursor:nesw-resize}.netless-whiteboard div.editor-box>*.cursor-ns{cursor:ns-resize}.netless-whiteboard div.editor-box>*.cursor-ew{cursor:ew-resize}.netless-whiteboard div.editor-box{pointer-events:none;border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>.lock{pointer-events:none;position:absolute;width:22px;height:22px;top:-11px;left:-11px}.netless-whiteboard div.editor-box>div.operation-point-desktop{width:7px;height:7px;position:absolute;pointer-events:auto}.netless-whiteboard div.editor-box>div.operation-point-touch{width:33px;height:33px;position:absolute;pointer-events:auto;display:flex;align-items:center;justify-content:center}.netless-whiteboard div.editor-box>div.operation-point-touch>*{pointer-events:none;width:7px;height:7px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-top{left:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-top{right:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-bottom{left:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-bottom{right:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.top{top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right{right:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.bottom{bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left{left:-4px}.netless-whiteboard div.editor-box>.operation-point-touch.left-top{left:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-top{right:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left-bottom{left:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-bottom{right:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.top{top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right{right:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.bottom{bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left{left:-17px}.netless-whiteboard div.editor-box-others{border:1px solid}.netless-whiteboard textarea{-webkit-appearance:none;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding:0;margin:0;outline:none;border:none;resize:none;overflow:hidden}.netless-whiteboard .textarea-border{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed}.netless-whiteboard .textarea-border>*{position:absolute;pointer-events:auto}.netless-whiteboard .textarea-layout{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed;border-style:solid;border-color:#0000}.netless-whiteboard .textarea-layout>*{position:absolute;pointer-events:auto}.netless-whiteboard textarea.readonly-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.editable-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.my-textarea{pointer-events:auto}.netless-whiteboard div.float-bar{display:flex;flex-direction:row;align-items:center;background:#ffffff;border:1px solid #EFEFEF;box-shadow:0 6px 12px #0000001f;border-radius:4px}.netless-whiteboard div.float-bar div,.netless-whiteboard div.float-bar input{pointer-events:auto}.netless-whiteboard div.float-bar img{pointer-events:none}.netless-whiteboard div.float-bar .button{display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar .button:hover{background:#EEF0F6}.netless-whiteboard div.float-bar .button.disable{opacity:.5;cursor:not-allowed;background:transparent}.netless-whiteboard div.float-bar>.normal-button{width:40px;height:40px}.netless-whiteboard div.float-bar>.highlight-button{background:#EEF0F6}.netless-whiteboard div.float-bar>img.font-size-icon{width:16px;height:16px;margin-left:12px}.netless-whiteboard div.float-bar>input.font-size-input::-webkit-outer-spin-button,.netless-whiteboard div.float-bar>input.font-size-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.netless-whiteboard div.float-bar>input.middle:focus,.netless-whiteboard div.float-bar>input:focus{outline-width:0}.netless-whiteboard div.float-bar>input.font-size-input{-moz-appearance:textfield;width:29px;height:20px;margin-left:10px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#212324;line-height:14px;border-radius:2px;border:1px solid #e7e7e7;text-align:center}.netless-whiteboard div.float-bar>div.font-size-buttons{display:flex;flex-direction:column;flex-wrap:none;justify-content:space-between;align-items:stretch;margin-left:5px;margin-right:7px}.netless-whiteboard div.float-bar>div.font-size-buttons>div.arrow-button{display:flex;flex-direction:column;flex-wrap:none;justify-content:center;align-items:center;width:16px;height:8px}.netless-whiteboard div.float-bar>div.font-size-buttons>div.arrow-button>img{width:6px;height:3px}.netless-whiteboard div.float-bar div.font-size-menu{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:stretch;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-size-menu>div.hover{background:#e7e7e7}.netless-whiteboard div.float-bar div.font-size-menu>div.cell{display:flex;flex-direction:row;justify-content:center;align-items:center;width:64px;height:24px}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>span{padding-left:4px;padding-right:4px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#000}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>.check{width:8px;height:8px}.netless-whiteboard div.float-bar div.font-colors-icon{position:relative;width:16px;height:16px}.netless-whiteboard div.float-bar div.font-colors-icon>img{position:absolute;top:0;left:0;width:16px;height:16px;z-index:1}.netless-whiteboard div.float-bar div.font-colors-icon>div.bar{position:absolute;left:2px;right:2px;top:12.5px;height:1.5px;z-index:2}.netless-whiteboard div.float-bar div.font-colors-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:8px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-selected{border-color:#a7a7a7}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-not-selected{border-color:#fff}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button{display:flex;justify-content:center;align-items:center;cursor:pointer;margin:4px;width:20px;height:20px;border-radius:50%;border-width:1px;border-style:solid}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button>.core{width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.12)}.netless-whiteboard div.float-bar div.image-layer-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:4px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.image-layer-menu>.normal-button{width:32px;height:32px}.netless-whiteboard *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cursor-selector .ppt-event-source{cursor:pointer;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.cursor-clicker .ppt-event-source{pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.netless-whiteboard{text-align:start}.netless-whiteboard *{box-sizing:border-box}.netless-whiteboard *>svg{text-align:start}.netless-ppt-last-run:after{content:attr(data-last-word);margin-left:var(--data-last-word-indent);display:inline-block;width:0}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar{width:12px;height:6px}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-track{border-radius:3px;background:rgba(0,0,0,.06);-webkit-box-shadow:inset 0 0 5px rgba(0,0,0,.08);box-shadow:inset 0 0 5px #00000014}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-thumb{border-radius:3px;background:rgba(0,0,0,.12);-webkit-box-shadow:inset 0 0 10px rgba(0,0,0,.2);box-shadow:inset 0 0 10px #0003}.ppt-preview-main-container{border:1px solid #222}.ppt-preview-show-note-svg{width:40px;height:40px}.ppt-preview-show-sidebar-svg{width:40px;height:40px}.ppt-preview-controls{height:40px;width:100%}.ppt-preview-controls-button{margin:0 2px}.ppt-preview-sidebar{border-left:1px solid #ccc;background-color:#eee}.ppt-preview-sidebar-item{margin:14px 14px 16px}.ppt-preview-sidebar-span{font-size:10pt;text-align:center}.ppt-preview-note{background-color:#eee}.ppt-preview-animation-svg{width:20px;height:20px}.ppt-preview-controls-page{float:right;line-height:16px;font-size:16px;padding:0;margin:0}\n");var sk,ck,uk=W(n("yyeZ")),lk=W(n("Pzfo")),hk=W(n("Fs82")),dk=W(n("q1tI")),pk=W(n("Pzfo")),fk=W(n("Pzfo")),vk=function(){function e(t){M(this,e),this.atoms={},this.debugName=t}return O(e,[{key:"reportChanged",value:function(e,t,n){var r=this.atoms[e];if(r&&r.reportChanged(),this.iterationAtom)switch(n){case ei.Removed:case ei.Inserted:this.iterationAtom.reportChanged()}r&&n===ei.Removed&&delete this.atoms[e]}},{key:"reportObservedIteration",value:function(){var e=this.iterationAtom;e||(e=this.iterationAtom=(0,fk.createAtom)(this.debugName)),e.reportObserved()}},{key:"reportObservedKey",value:function(e){var t=this.atoms[e];t||(t=this.atoms[e]=(0,fk.createAtom)(this.debugName)),t.reportObserved()}}]),e}(),mk=function(){function e(){M(this,e)}return O(e,[{key:"observeUpdate",value:function(e){(0,pk.runInAction)(e)}},{key:"create",value:function(e){return new vk(e)}}]),e}(),gk=function(){function e(){M(this,e),this.listenerNodes=[]}return O(e,[{key:"isOnline",get:function(){return navigator.onLine}},{key:"addListener",value:function(e){var t={origin:e,onOffline:function(){return e.onOffline()},onOnline:function(){return e.onOnline()}};this.listenerNodes.push(t),window.addEventListener("online",t.onOnline),window.addEventListener("offline",t.onOffline)}},{key:"removeListener",value:function(e){var t=this.listenerNodes.findIndex((function(t){return t.origin===e}));if(-1!==t){var n=h(this.listenerNodes.splice(t,1),1)[0];window.removeEventListener("online",n.onOnline),window.removeEventListener("offline",n.onOffline)}}}]),e}(),yk=W(n("cr+I")),bk=new te({fetcher:window.fetch.bind(window),retryCount:2,retryLoopsCount:0,configmap:{api:{hosts:{"*":nk.shuntApiHosts}},"ppt-api":{hosts:{"*":nk.hosts.pptApi}}}}),kk=function(){function e(){M(this,e),this.map={}}return O(e,[{key:"values",value:function(e){return this.map[e]}},{key:"has",value:function(e,t){var n=this.map[e];return!!n&&-1!==n.indexOf(t)}},{key:"put",value:function(e,t){var n=this.map[e];n||(n=this.map[e]=[]),-1===n.indexOf(t)&&n.push(t)}},{key:"remove",value:function(e,t){if(e)if(t){var n=this.map[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.map[e])}}else delete this.map[e];else for(var i in this.map)delete this.map[i]}}]),e}(),wk=function(){function e(t){if(M(this,e),this.listeners=new kk,this.oncesListeners=new kk,t)for(var n in t){var r=t[n];r&&this.listeners.put(n,r)}}return O(e,[{key:"dispatch",value:function(e,t){var n=0;return n+=this.dispatchTo(e,this.listeners,t),n+=this.dispatchTo(e,this.oncesListeners,t),this.oncesListeners.remove(e),n}},{key:"dispatchTo",value:function(e,t,n){var r=t.values(e);if(r){var i,a=E(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;try{n(o)}catch(e){console.error(e)}}}catch(e){a.e(e)}finally{a.f()}return r.length}return 0}},{key:"on",value:function(e,t){this.listeners.put(e,t)}},{key:"once",value:function(e,t){this.oncesListeners.put(e,t)}},{key:"off",value:function(e,t){this.listeners.remove(e,t),this.oncesListeners.remove(e,t)}},{key:"forwardTo",value:function(e,t){var n=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.dispatch(e,(function(e){return e.apply(void 0,r)}))};return this.on(e,n),n}}]),e}();(ck=sk||(sk={})).Mac="mac",ck.Windows="windows";var Sk=Object.freeze({delete:Object.freeze(["Backspace","Delete"]),lock:"Shift",undo:function(e,t){var n;switch(t){case sk.Mac:return!("z"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||null===(n=e.nativeEvent)||void 0===n||!n.metaKey);case sk.Windows:return"z"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},redo:function(e,t){var n;switch(t){case sk.Mac:return!("y"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||null===(n=e.nativeEvent)||void 0===n||!n.metaKey);case sk.Windows:return"y"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},copy:function(e,t){var n;switch(t){case sk.Mac:return!("c"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||null===(n=e.nativeEvent)||void 0===n||!n.metaKey);case sk.Windows:return"c"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},paste:function(e,t){var n;switch(t){case sk.Mac:return!("v"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||null===(n=e.nativeEvent)||void 0===n||!n.metaKey);case sk.Windows:return"v"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}}}),xk=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sk;M(this,e);var n=[];for(var r in t){var i=t[r];i&&n.push(Object.freeze({kind:r,checker:this.toHotKeyChecker(i)}))}this.nodes=Object.freeze(n)}return O(e,[{key:"checkHotKey",value:function(e){var t,n=this.getKeyboardKind(),r=E(this.nodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.checker(e,n))return i.kind}}catch(e){r.e(e)}finally{r.f()}}},{key:"getKeyboardKind",value:function(){return/^Mac/i.test(navigator.platform)?sk.Mac:sk.Windows}},{key:"toHotKeyChecker",value:function(e){var t=e;if("function"!=typeof t&&(t instanceof Array||(t=[t]),t instanceof Array)){var n=Object.freeze(t.map((function(e){var t=e;return"string"==typeof t&&(t={key:t,altKey:null,ctrlKey:null,shiftKey:null}),Object.freeze(s({},t))})));t=function(e){var t,r=E(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!(i.key!==e.key||null!==i.altKey&&i.altKey!==e.altKey||null!==i.ctrlKey&&i.ctrlKey!==e.ctrlKey||null!==i.shiftKey&&i.shiftKey!==e.shiftKey))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}}return t}}]),e}(),Ik=W(n("Pzfo"));function Ck(e,t){if(R(e)!=R(t))return!1;if("object"!=R(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var n in e){if(!(n in t))return!1;if(!Ck(e[n],t[n]))return!1}for(var r in t)if(!(r in e))return!1;return!0}if(e.constructor===Array){var i=e,a=t;if(i.length!==a.length)return!1;for(var o=0;o<i.length;++o)if(!Ck(e[o],t[o]))return!1;return!0}return!0}var Pk=function(){function e(t){var n=this,r=t.disableMaskKey,i=t.useMobXMode,a=t.propertyGetters,o=t.onStateChanged;M(this,e),this.didStateReady=!1,this.updatedState={},this.activeUpdateKey=null,this.updateState=function(){var e=n.updatedState;n._state=n.patchState(e),n.updatedState={},n.onStateChanged&&n.onStateChanged(e)},this.disableActiveCallback=r,this.useMobXMode=i,this.updateLimiter=new We(0,this.updateState),this.onStateChanged=o,this.disposers=this.createAutoRun(a)}return O(e,[{key:"state",get:function(){return this._state}},{key:"release",value:function(){var e,t=E(this.disposers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}}},{key:"activeUpdate",value:function(e,t){try{this.activeUpdateKey=e;var n=t();return this._state=this.setState(e,n),this.onStateChanged&&!this.disableActiveCallback&&this.onStateChanged(c({},e,n)),n}finally{this.activeUpdateKey=null}}},{key:"createAutoRun",value:function(e){var t=this,n=[],r=function(r){var i=e[r],a=(0,Ik.autorun)((function(){if(t.didStateReady){var e=i(),n=r in t.updatedState?t.updatedState[r]:t._state[r];t.activeUpdateKey!==r&&!Ck(e,n)&&(t.updatedState[r]=e,t.updateLimiter.invoke())}else t.updatedState[r]=i()}));n.push(a)};for(var i in e)r(i);return this._state=this.createState(this.updatedState),this.updatedState={},this.didStateReady=!0,n}},{key:"createState",value:function(e){return this.useMobXMode?(0,Ik.observable)(e):Object.freeze(e)}},{key:"patchState",value:function(e){if(this.useMobXMode){for(var t in e)this._state[t]=e[t];return this._state}return Object.freeze(s(s({},this._state),e))}},{key:"setState",value:function(e,t){return this.useMobXMode?(this._state[e]=t,this._state):Object.freeze(s(s({},this._state),{},c({},e,t)))}}]),e}();function Mk(e){switch(e){case Xx.Desktop:case Xx.Phone:case Xx.Pad:case Xx.TV:return 2.42;default:return 1}}function Tk(e){return Ok.apply(this,arguments)}function Ok(){return(Ok=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,r=null,i=null,a=0;case 2:if(!(a<n)){e.next=19;break}return e.prev=3,e.next=6,fetch(t);case 6:r=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),i=e.t0,e.abrupt("continue",16);case 13:if(200!==r.status){e.next=15;break}return e.abrupt("break",19);case 15:throw new Error("fetch ".concat(JSON.stringify(t)," failed with status ").concat(r.status));case 16:++a,e.next=2;break;case 19:if(!i){e.next=21;break}throw i;case 21:return e.next=23,r.blob();case 23:return o=e.sent,e.next=26,Ek(o);case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function Ek(e){return Ak.apply(this,arguments)}function Ak(){return(Ak=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.createImageBitmap?window.createImageBitmap(t):new Promise((function(e,n){var r=URL.createObjectURL(t),i=document.createElement("img");i.addEventListener("load",(function(){URL.revokeObjectURL(i.src),e(i)})),i.src=r})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}H([Ik.action],Pk.prototype,"activeUpdate",1),H([Ik.action],Pk.prototype,"updateState",2);var Nk,Rk,Lk,jk,Dk=Object.freeze({x:8,y:18}),zk=Object.freeze({width:26,height:26}),Fk=function(){function e(t){var n=this;M(this,e),this.cursors=Object.freeze([]),Tk("https://sdk.netless.link/resource/mouse-cursor/easer-cursor.png").then((function(e){for(var t=[],r=0;r<1;++r)t[r]=null;for(var i=1;i<=36;++i)t[i]=n.createCursor(i,e);n.cursors=Object.freeze(t)})).catch((function(e){return t.error(e)}))}return O(e,[{key:"cursorStyle",value:function(e){var t=this.cursors[Math.min(Math.ceil(e),36)];if(t)return"url(".concat(t.url,") ").concat(t.centerX," ").concat(t.centerY,", auto")}},{key:"release",value:function(){var e,t=E(this.cursors);try{for(t.s();!(e=t.n()).done;){var n=e.value;n&&URL.revokeObjectURL(n.url)}}catch(e){t.e(e)}finally{t.f()}this.cursors=Object.freeze([])}},{key:"createCursor",value:function(e,t){var n=-e,r=-e,i=-Dk.x,a=-Dk.y,o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;Number.MIN_SAFE_INTEGER;o=Math.min(o,n),o=Math.min(o,i),s=Math.min(s,r),s=Math.min(s,a),c=Math.max(c,n)+2*e,c=Math.max(c,i)+2*zk.width,Math.max(s,r);var u=-o,l=-s,h=c-o,d=Math.max(s,a)+2*zk.height-s;i+=u,a+=l;var p=document.createElement("canvas"),f=p.getContext("2d");return p.width=h,p.height=d,f.fillStyle="rgba(216,216,216,146)",f.beginPath(),f.ellipse(u,l,e,e,0,0,2*Math.PI),f.fill(),f.drawImage(t,i,a),Object.freeze({centerX:u,centerY:l,url:p.toDataURL("mycanvas")})}}]),e}(),Bk=function(){function e(t){M(this,e),this.stackMap=new Map,this.stackIndexMap=new Map,this.index=0,this.textareaExtraStep=0,this.execute=t.execute,this.onCanUndoStepsUpdate=t.onCanUndoStepsUpdate,this.onCanRedoStepsUpdate=t.onCanRedoStepsUpdate}return O(e,[{key:"canUndoSteps",get:function(){return this.stack.length-this.index+this.textareaExtraStep}},{key:"canRedoSteps",get:function(){return this.index}},{key:"stack",get:function(){var e=this.stackMap.get(this.currentScenePath);return e||(e=[],this.stackMap.set(this.currentScenePath,e)),e}},{key:"commit",value:function(e){var t=this.stack,n=this.canUndoSteps,r=this.canRedoSteps;for(t.splice(0,this.index,zo(e)),this.index=0;t.length>20;)t.pop();var i=this.canUndoSteps,a=this.canRedoSteps;i!==n&&this.onCanUndoStepsUpdate(i),a!==r&&this.onCanRedoStepsUpdate(i)}},{key:"undo",value:function(){var e=this.stack[this.index];e&&(this.index+=1,this.textareaExtraStep=0,this.execute(e.undo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"redo",value:function(){this.index>0&&(this.index-=1,this.textareaExtraStep=0,this.execute(this.stack[this.index].redo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"setCurrentScenePath",value:function(e){this.currentScenePath=e,this.index=this.stackIndexMap.get(this.currentScenePath)||0,this.textareaExtraStep=0,this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps)}},{key:"onTextareaUpdate",value:function(e){this.textareaExtraStep=e?1:0,this.onCanUndoStepsUpdate(this.canUndoSteps)}}]),e}(),Uk=function(){function e(){M(this,e),this.creators={}}return O(e,[{key:"addTextareaRectGetter",value:function(e,t){this.creators[e]=t}},{key:"removeTextareaRectGetter",value:function(e){delete this.creators[e]}},{key:"getTextareaSizeMap",value:function(e){var t={};for(var n in this.creators){var r=this.creators[n](e);r&&(t[n]=r)}return t}}]),e}(),Vk=W(n("Pzfo")),Wk=function(){function e(){var t=this;M(this,e),this.mainView=null,this._cameraState={centerX:0,centerY:0,scale:1,width:0,height:0},this.onSizeUpdated=function(e){(e.width!==t._cameraState.width||e.height!==t._cameraState.height)&&(t._cameraState=Object.freeze(s(s({},t._cameraState),e)))},this.onCameraUpdated=function(e){(e.centerX!==t._cameraState.centerX||e.centerY!==t._cameraState.centerY||e.scale!==t._cameraState.scale)&&(t._cameraState=Object.freeze(s(s({},t._cameraState),e)))}}return O(e,[{key:"cameraState",get:function(){return this._cameraState}},{key:"setupMainView",value:function(e){this.releaseMainView(),this.mainView=e,e.callbacks.on("onSizeUpdated",this.onSizeUpdated),e.callbacks.on("onCameraUpdated",this.onCameraUpdated)}},{key:"releaseMainView",value:function(){this.mainView&&(this.mainView.callbacks.off("onSizeUpdated",this.onSizeUpdated),this.mainView.callbacks.off("onCameraUpdated",this.onCameraUpdated),this.mainView=null)}},{key:"dispose",value:function(){this.releaseMainView()}}]),e}();function Hk(e){return new _k(e)}H([Vk.observable],Wk.prototype,"_cameraState",2),H([Vk.action],Wk.prototype,"onSizeUpdated",2),H([Vk.action],Wk.prototype,"onCameraUpdated",2),function(e){e.Dynamic="dynamic",e.Static="static"}(Nk||(Nk={})),function(e){e.Waiting="Waiting",e.Converting="Converting"}(Rk||(Rk={})),(jk=Lk||(Lk={})).Extracting="Extracting",jk.Packaging="Packaging",jk.GeneratingPreview="GeneratingPreview",jk.MediaTranscode="MediaTranscode";var _k=function(){function e(t){M(this,e),this.pptPromise=null,this.uuid=t.uuid,this.region=t.region||nk.defaultRegion,this.kind=t.kind,this.taskToken=t.taskToken,this.checkProgressInterval=t.checkProgressInterval||e.defaultCheckProgressInterval,this.checkProgressTimeout=t.checkProgressTimeout||e.defaultCheckProgressTimeout,this.callbacks=new wk(t.callbacks)}var t,n;return O(e,[{key:"checkUtilGet",value:function(){var e=this;return this.pptPromise||(this.pptPromise=this.getPPTResult(),this.pptPromise.then((function(t){e.callbacks.dispatch("onTaskSuccess",(function(e){return e(t)}))})).catch((function(t){e.callbacks.dispatch("onTaskFail",(function(e){return e(t)}))}))),this.pptPromise}},{key:"getPPTResult",value:(n=I(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=Date.now(),r=regeneratorRuntime.mark((function e(){var r,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,a.fetchProgress(a.uuid,a.kind,a.taskToken);case 3:i=e.sent,e.t0=i.status,e.next="Waiting"===e.t0||"Converting"===e.t0?7:"Finished"===e.t0?9:"Fail"===e.t0?10:11;break;case 7:return a.updateProgress(i),e.abrupt("break",11);case 9:return e.abrupt("return",{v:(t||a.updateProgress(i),a.toPPT(i))});case 10:throw new Error(i.failedReason);case 11:if(!((o=r+a.checkProgressInterval)>=n+a.checkProgressTimeout)){e.next=14;break}throw new Error("timeout");case 14:if(100===i.progress.convertedPercentage&&(t=!0),s=o-Date.now(),e.t1=s>0,!e.t1){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,s)}));case 20:case"end":return e.stop()}}),e)}));case 2:return e.delegateYield(r(),"t0",3);case 3:if("object"!==R(i=e.t0)){e.next=6;break}return e.abrupt("return",i.v);case 6:e.next=2;break;case 8:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"updateProgress",value:function(e){var t=Object.freeze({status:e.status,currentStep:e.progress.currentStep,totalPageSize:e.progress.totalPageSize,convertedPageSize:e.progress.convertedPageSize,convertedPercentage:e.progress.convertedPercentage});this.callbacks.dispatch("onProgressUpdated",(function(e){return e(t)}))}},{key:"toPPT",value:function(e){for(var t=e.progress.convertedFileList,n=[],r=0,i=0,a=0;a<t.length;++a){var o=t[a],s={name:"".concat(a+1),ppt:{src:o.conversionFileUrl,previewURL:o.preview,width:o.width,height:o.height}};r=Math.max(r,o.width),i=Math.max(i,o.height),n.push(s)}return{uuid:this.uuid,kind:this.kind,width:r,height:i,scenes:n}}},{key:"fetchProgress",value:(t=I(regeneratorRuntime.mark((function t(n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="http://ppt-api/v5/services/conversion/tasks/".concat(n),o=(0,yk.stringify)({type:r}),t.next=4,e.apiFetch(a+"?"+o,{method:"get",headers:{"content-type":"application/json",token:i,region:this.region}});case 4:if(200===(s=t.sent).status){t.next=10;break}return t.next=8,s.json();case 8:throw c=t.sent,new Error(c.error.title);case 10:return t.next=12,s.json();case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();_k.apiFetch=bk.fetch("api"),_k.defaultCheckProgressInterval=1500,_k.defaultCheckProgressTimeout=3e5;var Gk=W(n("cr+I")),Yk=function(){function e(t){M(this,e),this.roomToken=t}var t,n,r,i;return O(e,[{key:"convert",value:(i=I(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createPPTTask(n);case 2:return r=t.sent,t.next=5,this.checkUtilHasResult(r,n);case 5:return i=t.sent,t.abrupt("return",e.wrapPPTDescriptions(r,n.kind,i));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"createPPTTask",value:(r=I(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.prefix+"/services/conversion/tasks",i=(0,Gk.stringify)({roomToken:this.roomToken}),t.next=4,fetch(r+"?"+i,{method:"post",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({sourceUrl:n.url,serviceType:e.convertPPTKindToServiceType(n.kind)})});case 4:if(200===(a=t.sent).status){t.next=13;break}return t.t0=Error,t.t1="failed to convert ".concat(JSON.stringify(n.url)," with status ").concat(a.status," message:"),t.next=10,a.text();case 10:throw t.t2=t.sent,t.t3=t.t1.concat.call(t.t1,t.t2),new t.t0(t.t3);case 13:return t.next=15,a.json();case 15:if(o=t.sent,s=o.msg,c=s.succeed,u=s.reason,l=s.taskUUID,c){t.next=22;break}throw new Error("create ppt task failed: "+u);case 22:return t.abrupt("return",l);case 23:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"checkUtilHasResult",value:(n=I(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=!1,a=Date.now(),o=r.checkProgressInterval||e.defaultCheckProgressInterval,s=r.checkProgressTimeout||e.defaultCheckProgressTimeout,c=regeneratorRuntime.mark((function e(){var t,c,u,h,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),e.next=3,l.fetchProgress(n,r.kind);case 3:c=e.sent,e.t0=c.convertStatus,e.next="Finished"===e.t0?7:"Fail"===e.t0||"NotFound"===e.t0?8:9;break;case 7:return e.abrupt("return",{v:(r.onProgressUpdated&&!i&&r.onProgressUpdated(1),c.convertedFileList.map((function(e){return{width:e.width,height:e.height,src:c.prefix+e.conversionFileUrl}})))});case 8:throw new Error("failed to convert ".concat(JSON.stringify(r.url),": ").concat(c.reason));case 9:if(u=c.totalPageSize,h=c.convertedPercentage,d=0===u?0:h/100,!((p=t+o)>=a+s)){e.next=12;break}throw new Error("failed to convert ".concat(JSON.stringify(r.url),": timeout"));case 12:if(r.onProgressUpdated&&r.onProgressUpdated(d),1===d&&(i=!0),f=p-Date.now(),e.t1=f>0,!e.t1){e.next=18;break}return e.next=18,new Promise((function(e){return setTimeout(e,f)}));case 18:case"end":return e.stop()}}),e)}));case 2:return t.delegateYield(c(),"t0",3);case 3:if("object"!==R(u=t.t0)){t.next=6;break}return t.abrupt("return",u.v);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchProgress",value:(t=I(regeneratorRuntime.mark((function t(n,r){var i,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="".concat(e.prefix,"/services/conversion/tasks/").concat(n,"/progress"),a=(0,Gk.stringify)({roomToken:this.roomToken,serviceType:e.convertPPTKindToServiceType(r)}),t.next=4,fetch(i+"?"+a,{headers:{"content-type":"application/json",Accept:"application/json"}});case 4:if(200===(o=t.sent).status){t.next=7;break}throw new Error("failed to fetch progress of ".concat(JSON.stringify(i)));case 7:return t.next=9,o.json();case 9:return t.abrupt("return",t.sent.msg.task);case 10:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"wrapPPTDescriptions",value:function(e,t,n){for(var r=[],i=[],a=0,o=0,s=0;s<n.length;++s){var c=n[s],u=c.src,l=c.width,h=c.height;r[s]=u,i[s]={name:"".concat(s+1),ppt:{src:u,width:l,height:h}},a=l,o=h}return{uuid:e,kind:t,width:a,height:o,slideURLs:r,scenes:i}}},{key:"convertPPTKindToServiceType",value:function(e){switch(e){case Nk.Dynamic:return"dynamic_conversion";case Nk.Static:return"static_conversion";default:throw new Error("invalid kind ".concat(JSON.stringify(e)))}}}]),e}();Yk.prefix="https://console-api.netless.link",Yk.defaultCheckProgressInterval=1500,Yk.defaultCheckProgressTimeout=3e5;var Xk=W(n("q1tI")),Qk=W(n("NbXW")),Zk=W(n("Pzfo"));function Kk(e){return function(){return e}}function qk(){return Jk(1)}function Jk(e){return function(t,n){var r=t.width/n.width,i=t.height/n.height,a=Math.max(r,i)*e;return Number.isNaN(a)?1:a}}function $k(){return nw(1,0)}function ew(e){return nw(1,e)}function tw(e){return nw(e,0)}function nw(e,t){return function(n,r){var i=n.width/(r.width+2*t),a=n.height/(r.height+2*t),o=Math.min(i,a)*e;return Number.isNaN(o)||o===1/0?0:o}}var rw,iw,aw,ow,sw=function(){function e(t,n){M(this,e),this._cameraBound=n,this.cameraman=t.bindCameraman(this.toCameraBorder(n))}return O(e,[{key:"cameraBound",get:function(){return this._cameraBound}},{key:"setScreenSize",value:function(e){(!this.screenSize||this.screenSize.width!==e.width||this.screenSize.height!==e.height)&&(this.screenSize=e,this.setCameraBound({maxContentMode:this.maxContentMode,minContentMode:this.minContentMode}))}},{key:"setCameraBound",value:function(e){this._cameraBound=e,this.cameraman.setCameraBorder(this.toCameraBorder(e))}},{key:"toCameraBorder",value:function(e){var t=e.damping,n=e.centerX,r=e.centerY,i=e.width,a=e.height,o=this.boundSize(i,a);this.maxContentMode=e.maxContentMode,this.minContentMode=e.minContentMode;var s=1/0,c=0;return this.screenSize&&(this.maxContentMode&&(s=this.maxContentMode(this.screenSize,o)),this.minContentMode&&(c=this.minContentMode(this.screenSize,o))),function(e){for(var t in e)void 0===e[t]&&delete e[t];return e}({damping:t,centerX:n,centerY:r,width:i,height:a,maxScale:s,minScale:c})}},{key:"boundSize",value:function(e,t){return this.cameraman?{width:void 0===e?this.cameraman.cameraBorder.width:e,height:void 0===t?this.cameraman.cameraBorder.height:t}:{width:void 0===e?1/0:e,height:void 0===t?1/0:t}}}]),e}();!function(e){e.Triangle="triangle",e.Rhombus="rhombus",e.Pentagram="pentagram",e.SpeechBalloon="speechBalloon"}(rw||(rw={})),(aw=iw||(iw={})).selector="selector",aw.clicker="clicker",aw.laserPointer="laserPointer",aw.pencil="pencil",aw.rectangle="rectangle",aw.ellipse="ellipse",aw.shape="shape",aw.eraser="eraser",aw.text="text",aw.straight="straight",aw.arrow="arrow",aw.hand="hand",function(e){e.None="none",e.Dir="dir",e.Page="page"}(ow||(ow={}));var cw=function(){function e(){M(this,e),this.listeners={},this.eventsMergers={},this.waitingNodes=[]}return O(e,[{key:"dispatchMagixEvent",value:function(e){var t=this.listeners[e.event];if(t){var n,r=E(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i(e)}catch(e){console.error(e)}}}catch(e){r.e(e)}finally{r.f()}}var a=this.waitingNodes.findIndex((function(t){return!!t.filter(e)&&(t.resolve(e),!0)}));-1!==a&&this.waitingNodes.splice(a,1)}},{key:"addMagixEventsListener",value:function(e,t,n){var r=function(e,t){var n=[],r=new We(t,(function(){n.length>0&&e(n.splice(0,n.length))}));function i(e){n.push(e),r.invoke()}return Object.defineProperty(i,"proxyListener",{writable:!1,value:e}),i}(t,n),i=this.eventsMergers[e];i||(i=[],this.eventsMergers[e]=i),i.push(r),this.addMagixEventListener(e,r)}},{key:"addMagixEventListener",value:function(e,t){var n=this.listeners[e];n||(n=[],this.listeners[e]=n),n.push(t)}},{key:"removeMagixEventListener",value:function(e,t){if(t){var n=this.removeFromEventMerges(e,t);n?this.removeFromListeners(e,n):this.removeFromListeners(e,t)}else delete this.listeners[e],delete this.eventsMergers[e]}},{key:"removeFromEventMerges",value:function(e,t){var n=this.eventsMergers[e];if(n){for(var r=-1,i=0;i<n.length;++i)if(n[i].proxyListener===t){r=i;break}if(-1!==r){var a=n[r];return n.splice(r,1),0===n.length&&delete this.eventsMergers[e],a}}}},{key:"removeFromListeners",value:function(e,t){var n=this.listeners[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.listeners[e])}}},{key:"waitMagixEvent",value:function(e){var t=this;return new Promise((function(n){t.waitingNodes.push({resolve:n,filter:e})}))}}]),e}(),uw=new(function(){function e(){M(this,e)}return O(e,[{key:"parse",value:function(e){var t=e.split("/");if(""!==t[0])throw new Error("path ".concat(JSON.stringify(e),' should start with "/"'));""===t[t.length-1]&&t.pop();for(var n=[],r=1;r<t.length;++r)n.push(t[r].trim());return n}},{key:"stringify",value:function(e){return"/".concat(e.join("/"))}}]),e}()),lw=W(n("q1tI")),hw=lw.createContext(void 0),dw=lw.createContext(void 0),pw=lw.createContext(void 0);function fw(e,t){var n=e.Provider;return function(e){var r=e.children;return lw.createElement(n,{value:t},r)}}var vw=hw.Consumer,mw=dw.Consumer,gw=pw.Consumer;function yw(e){return new bw(e)}var bw=function(){function e(t){M(this,e),this.cacheContextMap={},this.manager=null,this.plugins=this.copyAndFreezePlugins(t)}return O(e,[{key:"copyAndFreezePlugins",value:function(e){var t={};for(var n in e){var r=e[n];if(void 0!==r.kind&&n!==r.kind)throw new Error("plugin's kind ".concat(JSON.stringify(r.kind)," is not equals key ").concat(JSON.stringify(n)));var i=r.defaultAttributes;"object"==R(i)&&null!==i&&(i=Object.freeze(s({},i))),t[n]=Object.freeze({kind:n,render:r.render,defaultAttributes:i,hitTest:r.hitTest,willInterruptEvent:r.willInterruptEvent})}return Object.freeze(t)}},{key:"setPluginContext",value:function(e,t){this.manager?this.manager.setPluginContext(e,t):this.cacheContextMap&&e in this.plugins&&(this.cacheContextMap[e]=t)}},{key:"getPluginContext",value:function(e){return this.manager?this.manager.getPluginContext(e):this.cacheContextMap?this.cacheContextMap[e]:void 0}},{key:"setPluginManager",value:function(e){if(this.cacheContextMap){for(var t in this.cacheContextMap)e.setPluginContext(t,this.cacheContextMap[t]);this.cacheContextMap=null}else if(this.manager)for(var n in this.plugins){var r=this.manager.getPluginContext(n);e.setPluginContext(n,r)}this.manager=e}}]),e}(),kw=W(n("Pzfo")),ww=function(){function e(t){M(this,e),this.enableCallbackUpdate=!0,this.disposer=null,this.kind=t.kind,this._displayer=t.displayer,this._callbacks=new wk,this.onAttributesUpdate&&this._callbacks.on("onAttributesUpdate",this.onAttributesUpdate.bind(this)),this.onDestroy&&this._callbacks.on("onDestroy",this.onDestroy.bind(this)),this.autorunAttributesUpdate()}return O(e,[{key:"autorunAttributesUpdate",value:function(){var e=this,t=!1;this.disposer=(0,kw.autorun)((function(){if(e._displayer.applianceManager.hasInvisibilePluginKind(e.kind)){var n=e.attributes;t&&e.enableCallbackUpdate&&e._callbacks.dispatch("onAttributesUpdate",(function(e){return e(n)})),t=!0}}))}},{key:"displayer",get:function(){return this._displayer}},{key:"callbacks",get:function(){return this._callbacks}},{key:"attributes",get:function(){var e=this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind);return this._displayer.useMobXState||(e=zo(e)),e}},{key:"getAttributesValue",value:function(e){return this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind,e)}},{key:"setAttributes",value:function(e){var t=this;try{this.enableCallbackUpdate=!1,this._displayer.applianceManager.updateAttributesInvisiblePlugin(this.kind,e)}finally{Promise.resolve((function(){t.enableCallbackUpdate=!0}))}}},{key:"updateAttributes",value:function(e,t){var n=this;try{this.enableCallbackUpdate=!1,this._displayer.applianceManager.updateAttributesInvisiblePluginWithKeys(this.kind,e,t)}finally{Promise.resolve((function(){n.enableCallbackUpdate=!0}))}}},{key:"destroy",value:function(){var e=this;try{this.enableCallbackUpdate=!1,this._displayer.applianceManager.removeInvisiblePlugin(this.kind)}finally{Promise.resolve((function(){e.enableCallbackUpdate=!0}))}}},{key:"_dispose",value:function(e){this.disposer&&(this.disposer(),this.disposer=null),e&&this.enableCallbackUpdate&&this._callbacks.dispatch("onDestroy",(function(e){return e()}))}}]),e}();H([kw.computed],ww.prototype,"attributes",1);var Sw=function(){function e(t,n,r){M(this,e),this.pluginClasses={},this.plugins={},this.paddingCreators={},this.disposer=null,this._isWatching=!1,this.logger=t,this.displayer=n,this.pluginClasses=this.createPluginClasses(r)}return O(e,[{key:"createPluginClasses",value:function(e){var t,n={},r=E(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.kind in n)throw new Error("duplicated kind from invisible plugin ".concat(JSON.stringify(i.kind)));n[i.kind]=i}}catch(e){r.e(e)}finally{r.f()}return Object.freeze(n)}},{key:"isWatching",get:function(){return this._isWatching},set:function(e){var t=this;this._isWatching!==e&&(this._isWatching=e,e&&!this.disposer?this.disposer=(0,kw.autorun)((function(){for(var e in t.pluginClasses)t.refreshPlugin(t.pluginClasses[e])})):!e&&this.disposer&&(this.disposer(),this.disposer=null))}},{key:"get",value:function(e){return this.plugins[e]||null}},{key:"create",value:function(e,t){var n=this;return new Promise((function(r,i){var a=e.kind,o=n.displayer.applianceManager;try{if(n.addPaddingCreator(a,r),e!==n.pluginClasses[a])throw new Error("unregister invisible plugin class");o.putInvisiblePlugin(a,t)}catch(e){i(e),n.removePaddingCreator(a,r)}}))}},{key:"dispose",value:function(){this.disposer&&(this.disposer(),this.disposer=null);for(var e in this.plugins){try{this.plugins[e]._dispose(!1)}catch(e){this.logger.error(e)}delete this.plugins[e]}}},{key:"refreshPlugin",value:function(e){var t=this.displayer.applianceManager,n=e.kind;if(t.hasInvisibilePluginKind(n)){if(!this.plugins[n]){var r=this.plugins[n]=new e({displayer:this.displayer,kind:n});if(e.onCreate)try{e.onCreate(r)}catch(e){this.logger.error(e)}}var i=this.paddingCreators[n];if(i){delete this.paddingCreators[n];var a,o=E(i);try{for(o.s();!(a=o.n()).done;){(0,a.value)(this.plugins[n])}}catch(e){o.e(e)}finally{o.f()}}}else{var s=this.plugins[n];if(s){delete this.plugins[n];try{s._dispose(!0)}catch(e){this.logger.error(e)}if(e.onDestroy)try{e.onDestroy(s)}catch(e){this.logger.error(e)}}}}},{key:"addPaddingCreator",value:function(e,t){var n=this.paddingCreators[e];n||(n=this.paddingCreators[e]=[]),n.push(t)}},{key:"removePaddingCreator",value:function(e,t){var n=this.paddingCreators[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.paddingCreators[e])}}}]),e}();function xw(e,t){var n=s({},e),r=!1;for(var i in t){var a=t[i];e[i]!==a&&(n[i]=a,r=!0)}return r?n:null}var Iw=function(){function e(t){M(this,e),this._state=Object.freeze(s({},t))}return O(e,[{key:"state",get:function(){return this._state}},{key:"putState",value:function(e){var t=xw(this._state,e),n=!1;if(t){var r=this._state;this._state=Object.freeze(t),this.onStateUpdate(e,r),n=!0}return n}}]),e}(),Cw=W(n("i8i4")),Pw=W(n("q1tI")),Mw=W(n("Pzfo")),Tw=W(n("Pzfo")),Ow=W(n("q1tI")),Ew=function(e){m(n,e);var t=y(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props.payload;if(!e._divElement&&t)e._divElement=t,n.onCursorComponentChanged(k(e));else if(e._divElement&&!t)try{n.onCursorComponentChanged(null)}finally{e._divElement=t}},e}return O(n,[{key:"divElement",get:function(){return this._divElement}},{key:"render",value:function(){var e=this.props,t=e.cnode,n=e.size,r=e.payload;return Ow.createElement(qu,{context:t,onRef:this.onRef,style:n},r.reactNode)}}]),n}(Ow.Component);Ew.isVisible=!1;var Aw,Nw,Rw=function(){function e(t){var n=this;M(this,e),this.reactNode=null,this.onCursorComponentChanged=function(e){n.cursorComponent=e,e?n.adapter.onAddedCursor&&n.adapter.onAddedCursor(n):n.adapter.onRemovedCursor&&n.adapter.onRemovedCursor(n)},this.onComponentMoved=function(){if(n.adapter.onMovingCursor){var e=n.component.originX+n._x+n.screen.width/2,t=n.component.originY+n._y+n.screen.height/2;n.adapter.onMovingCursor(n,e,t)}},this.idPrefix=t.idPrefix,this.applianceManager=t.applianceManager,this.adapter=t.adapter,this.screen=t.screen,this.memberId=t.displayer.memberId;var r=t.displayer,i=this.adapter.createCursor(r.memberId);this._x=i.x,this._y=i.y,this._width=i.width,this._height=i.height,this.reactNode=i.reactNode||null,this.cursorDefinition=_h({name:"Cursor"}),t.engine.bind(this.cursorDefinition)(Ew),this.component=this.screen.scene.addComponent({id:this.idPrefix+r.memberId,definition:this.cursorDefinition,originX:t.point.x-this._x,originY:t.point.y-this._y,width:i.width,height:i.height,orderIndex:this.memberId,absoluteCoordinates:!0,payload:{reactNode:this.reactNode,onCursorComponentChanged:this.onCursorComponentChanged}}),this.adapter.onMovingCursor&&this.component.addRectangleUpdatedListener(this.onComponentMoved),this.disposer=(0,Tw.autorun)((function(){var e=n.applianceManager.getMemberState(r.memberId);if(e){var t=e.currentApplianceName,i=zo(e.strokeColor);n._cursorMember?(n._cursorMember=Object.freeze(s(s({},n._cursorMember),{},{color:i,appliance:t})),n.onCursorMemberChanged&&n.onCursorMemberChanged(n._cursorMember)):n._cursorMember=Object.freeze({color:i,appliance:t,information:r.information})}}))}return O(e,[{key:"cursorMember",get:function(){return this._cursorMember}},{key:"updateDisplayer",value:function(e){this._cursorMember&&!Ck(this._cursorMember.information,e.information)&&(this._cursorMember=Object.freeze(s(s({},this._cursorMember),{},{information:e.information})),this.onCursorMemberChanged&&this.onCursorMemberChanged(this._cursorMember))}},{key:"release",value:function(){this.disposer(),this.adapter.onMovingCursor&&this.component.removeRectangleUpdatedListener(this.onComponentMoved)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){if(!this.cursorComponent)throw new Error("cursor isn't added");return this.cursorComponent.divElement}},{key:"setReactNode",value:function(e){this.reactNode=e,this.component.payload={reactNode:e,onCursorComponentChanged:this.onCursorComponentChanged}}},{key:"setCursorDescription",value:function(e){var t=s({x:this._x,y:this._y,width:this._width,height:this._height},e),n=this._x-t.x,r=this._y-t.y;this.component.setRectangle(this.component.originX+n,this.component.originY+r,t.width,t.height),this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height}}]),e}();!function(e){e.SVG="svg",e.Canvas="canvas"}(Aw||(Aw={})),function(e){e.Freedom="freedom",e.Follower="follower",e.Broadcaster="broadcaster"}(Nw||(Nw={}));var Lw=function(){function e(t){M(this,e),this.didMouseCursorMoved=!1,this.inactivityTimer=null,this.shouldAppearNextFrame=!0;var n=t.displayer;this.applianceManager=t.applianceManager,this.screen=t.screen,this.engine=t.engine,this.isCursorInScene=n.isCursorInScene,this.isPressed=n.isPressed,this.isActivity=n.isActivity,this.isKeepVisible=n.isActivity,this.setPositionProperties(n,t.isFollowerFixedOnScreen),this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY,this.cursor=new Rw({idPrefix:t.idPrefix,applianceManager:this.applianceManager,displayer:n,screen:this.screen,engine:this.engine,adapter:t.adapter,point:this.getCurrentComponentPosition()}),this.refreshIsVisible()}return O(e,[{key:"isVisible",get:function(){return this.isCursorInScene&&this.isKeepVisible}},{key:"updateDisplayer",value:function(e,t){this.setPositionProperties(e,t),this.setVisibleProperties(e),this.refreshComponentPosition(),this.cursor.updateDisplayer(e)}},{key:"updateScreenSize",value:function(){this.refreshComponentPosition()}},{key:"remove",value:function(){this.cleanInactivityDelayer(),this.screen.scene.removeComponent(this.cursor.component),this.cursor.release()}},{key:"setPositionProperties",value:function(e,t){if(this.mode=e.mode,this.originX=e.originX,this.originY=e.originY,this.cursorX=e.cursorX,this.cursorY=e.cursorY,this.width=e.width,this.height=e.height,this.isFollowerFixedOnScreen=t,this.didMouseCursorMoved)this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY;else{var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=(this.cursorX-this.latestCheckedCursorX)*this.width*n,a=(this.cursorY-this.latestCheckedCursorY)*this.height*r;i*i+a*a>=16&&(this.didMouseCursorMoved=!0,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY)}}},{key:"setVisibleProperties",value:function(e){var t=this.isActivity;this.isCursorInScene=e.isCursorInScene,this.isPressed=e.isPressed,this.isActivity=e.isActivity,t&&!this.isActivity?(this.delayInactivity(),this.checkMouseCursorMoved()):!t&&this.isActivity?(this.cleanInactivityDelayer(),this.isKeepVisible=!0):!this.isActivity&&this.checkMouseCursorMoved()&&this.delayInactivity(),this.refreshIsVisible()}},{key:"refreshComponentPosition",value:function(){if(this.isVisible){var e=this.getCurrentComponentPosition(),t=this.getNextAnimationMode();this.cursor.component.moveTo(e.x-this.cursor.x,e.y-this.cursor.y,t)}}},{key:"getNextAnimationMode",value:function(){return this.shouldAppearNextFrame?(this.shouldAppearNextFrame=!1,Uh.Immediately):this.isPressed?Uh.Immediately:Uh.Continuous}},{key:"getCurrentComponentPosition",value:function(){var e,t;if(this.isFollowerFixedOnScreen&&this.mode!==Nw.Freedom){var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=Math.min(n,r),a=(this.screen.width-i*this.width)/2,o=(this.screen.height-i*this.height)/2;e=this.cursorX*this.width*i+a-this.screen.width/2,t=this.cursorY*this.height*i+o-this.screen.height/2}else{var s=this.screen.camera,c=s.centerX,u=s.centerY,l=s.scale;e=((e=this.cursorX*this.width+this.originX)-c)*l,t=((t=this.cursorY*this.height+this.originY)-u)*l}return{x:e,y:t}}},{key:"checkMouseCursorMoved",value:function(){return!!this.didMouseCursorMoved&&(this.didMouseCursorMoved=!1,!0)}},{key:"cleanInactivityDelayer",value:function(){null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}},{key:"delayInactivity",value:function(){var e=this;null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.isActivity||(this.isKeepVisible=!0,this.refreshIsVisible(),this.inactivityTimer=setTimeout((function(){e.isKeepVisible=!1,e.inactivityTimer=null,e.refreshIsVisible()}),5600))}},{key:"refreshIsVisible",value:function(){var e=this.isVisible;e||(this.shouldAppearNextFrame=!0),this.cursor.component.setVisible(this.engine,e)}}]),e}(),jw=function(){function e(t){M(this,e),this.nodes={},this.idPrefix=t.idPrefix,this.adapter=t.adapter,this.applianceManager=t.applianceManager,this.engine=t.engine,this.screen=t.screen,this.willShow=t.willShow}return O(e,[{key:"updateScreenSize",value:function(){for(var e in this.nodes)this.nodes[e].updateScreenSize()}},{key:"removeAll",value:function(){for(var e in this.nodes)this.nodes[e].remove(),delete this.nodes[e]}},{key:"updateMemberDisplayers",value:function(e,t){for(var n={},r=this.nodes,i=0;i<e.length;++i){var a=e[i],o=a.memberId;if(this.willShow(a)){var s=r[o];s?(s.updateDisplayer(a,t),n[o]=s,delete r[o]):n[o]=new Lw({idPrefix:this.idPrefix,applianceManager:this.applianceManager,screen:this.screen,engine:this.engine,displayer:a,isFollowerFixedOnScreen:t,adapter:this.adapter})}}for(var c in r)r[c].remove();this.nodes=n}}]),e}(),Dw=W(n("q1tI")),zw=function(){function e(){M(this,e)}return O(e,[{key:"createCursor",value:function(){return{x:14,y:14,width:28,height:28,reactNode:Dw.createElement(Fw,null)}}}]),e}(),Fw=function(){return Dw.createElement("img",{alt:"laser",src:"https://sdk.netless.link/resource/mouse-cursor/laser-pointer-cursor.svg"})},Bw=function(){function e(t){var n=this;M(this,e),this._isHidden=!1,this.autoUpdateCursors=function(){var e;if(n._isHidden)n.laserPointerStateNodes.removeAll(),null===(e=n.cursorStateNodes)||void 0===e||e.removeAll();else{var t,r=n.applianceManager.getMemberDisplayers(),i=n.isFollowerFixedOnScreen(r);n.laserPointerStateNodes.updateMemberDisplayers(r,i),null===(t=n.cursorStateNodes)||void 0===t||t.updateMemberDisplayers(r,i)}},this.applianceManager=t.applianceManager,this.screen=t.screen,this.observerId=t.observerId,this._isHidden=t.isHidden;var r=this.getMouseCursorEngine(t.appVersion,t.engine),i=t.willHideObserver;this.laserPointerStateNodes=new jw({idPrefix:"laser-pointer-",adapter:new zw,applianceManager:this.applianceManager,engine:r,screen:this.screen,willShow:function(e){return e.currentApplianceName===iw.laserPointer&&(!i||e.memberId!==n.observerId)}}),t.adapter&&(this.cursorStateNodes=new jw({idPrefix:"cursor-",adapter:t.adapter,applianceManager:this.applianceManager,engine:r,screen:this.screen,willShow:function(e){return e.currentApplianceName!==iw.laserPointer&&(!i||e.memberId!==n.observerId)}})),this.disposer=(0,Mw.autorun)(this.autoUpdateCursors)}return O(e,[{key:"isHidden",get:function(){return this._isHidden}},{key:"setHidden",value:function(e){this._isHidden!==e&&(this._isHidden=e)}},{key:"updateObserverId",value:function(e){this.observerId=e}},{key:"updateScreenSize",value:function(){var e;this.laserPointerStateNodes.updateScreenSize(),null===(e=this.cursorStateNodes)||void 0===e||e.updateScreenSize()}},{key:"release",value:function(){this.disposer()}},{key:"getMouseCursorEngine",value:function(e,t){if(t)return t;switch(e){case"2.0.0":return this.screen.scene.getEngineWithLegacyLayout(4);case"2.1.0":return this.screen.scene.getEngineWithLegacyLayout(5);default:throw new Error("invalid app version "+e)}}},{key:"isFollowerFixedOnScreen",value:function(e){for(var t,n=0;n<e.length;++n){var r=e[n];if(r.memberId===this.observerId){t=r;break}}return!!t&&(t.mode===Nw.Broadcaster||t.mode===Nw.Follower)}}]),e}();function Uw(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.toDataURL("screenshot")}H([Mw.observable],Bw.prototype,"observerId",2),H([Mw.observable],Bw.prototype,"_isHidden",2),H([Mw.action],Bw.prototype,"setHidden",1);var Vw,Ww=function(){function e(t,n,r,i,a,o){var c,u=this;M(this,e),this._maskScreenObserverId=!0,this.onScreenSizeUpdated=function(e){u.cameraBoundState.setScreenSize(e),u.cursors&&u.cursors.updateScreenSize(),u.render.refreshSceneComponents(),u._onScreenSizeUpdated&&u._onScreenSizeUpdated(e)},this.updateCursorClassBySelector=function(e){if(u.applianceManager){var t=u.applianceManager.getMemberState();t&&t.currentApplianceName===iw.selector&&u.updateCursorClass(e)}};var l=r.modules,h=l.WhiteRender,d=h.WhiteboardRender,p=h.BezierCurvePainter;this.engines=r.engines,this.modules=r.modules,this.pluginManager=r.pluginManager,this.applianceManager=r.applianceManager,this.dynamicPpt=r.dynamicPpt,this.view=t,this._isCursorsHidden=a,this.observerId=n.observerId,this.bezierCurvePainter=this.createBezierCurvePainter(p);var f=this.applianceManager.getViewState(),v=this.createScene(i.boundless,i.logger,i.renderEngine,l),m=Object.freeze(s(s({},n),{},{observerId:this.screenObserverId(n),deviceType:i.boundless.deviceType,dynamicPpt:this.dynamicPpt,disalbeImageHit:!1,disableOthersSelectingBox:!1,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,fontFamily:i.fontFamily,convertIdToUrl:i.urlInterrupter,updateTextarea:i.onTextareaUpdate,updateCursorClass:this.updateCursorClassBySelector,floatBarClass:i.floatBarClass,textareaHub:i.textareaHub}));if(this.screen=v.createScreen({className:"netless-whiteboard",context:m,engines:null===(c=this.engines)||void 0===c?void 0:c.enginesList,autoResize:i.autoResize,eventInterrupter:i.eventInterrupter,wrappedComponents:i.wrappedComponents,onRenderDuration:function(e){return u.view.fireRenderDuration(e)}}),this.onCatchErrorWhenRender=i.onCatchErrorWhenRender,this._onScreenSizeUpdated=i.onScreenSizeUpdated,i.onCatchErrorWhenRender&&this.screen.addRenderErrorCatchedListener(i.onCatchErrorWhenRender),this.screen.addSizeUpdatedListener(this.onScreenSizeUpdated),o){var g=o.cameraBoundState;this.cameraBoundState=new sw(this.screen,g.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=g.cameraman.disableBoundlessEvent,this.cameraBoundState.cameraman.disableCameraTransform=g.cameraman.disableCameraTransform,this.cameraBoundState.cameraman.handToolKey=g.cameraman.handToolKey}else this.cameraBoundState=new sw(this.screen,i.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=i.disableOperations,this.cameraBoundState.cameraman.handToolKey=i.handToolKey;this.cameraBoundState.cameraman.adaptRectangle({originX:f.originX,originY:f.originY,width:f.width,height:f.height,adapterMode:jh.Centering,animationMode:Uh.Immediately}),this.render=new d(this.screen,this.pluginManager,this.applianceManager,this.engines),this.setupViewContextState(t.state),setTimeout((function(){var e;u.cursors=new Bw({appVersion:r.appVersion,applianceManager:u.applianceManager,screen:u.screen,engine:null===(e=u.engines)||void 0===e?void 0:e.engines.mouseCurosrEngine,observerId:u.observerId,isHidden:u._isCursorsHidden,willHideObserver:i.willHideSelfCursor,adapter:i.cursorAdapter})}),0)}var t,n;return O(e,[{key:"isCursorsHidden",get:function(){return this._isCursorsHidden},set:function(e){this._isCursorsHidden!==e&&(this._isCursorsHidden=e,this.cursors&&this.cursors.setHidden(this._isCursorsHidden))}},{key:"maskFloatBar",get:function(){return this.render.maskFloatBar},set:function(e){this.render.maskFloatBar=e}},{key:"updateState",value:function(e){"cameraBound"in e&&this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),"disableCameraTransform"in e&&(this.cameraman.disableCameraTransform=e.disableCameraTransform),"handToolActive"in e&&(this.cameraman.handToolActive=e.handToolActive),"handToolKey"in e&&(this.cameraman.handToolKey=e.handToolKey),"divElement"in e&&(this.screen.divElement=e.divElement)}},{key:"syncCameraMoving",value:function(e){if(e){var t=e.camera,n=e.toContaint;if(t){var r=t.animationMode||Uh.Continuous;this.cameraman.transformCamera(s(s({},t),{},{animationMode:r}))}else if(n){var i=n.animationMode||Uh.Continuous;this.cameraman.adaptRectangle(s(s({},n),{},{animationMode:i,adapterMode:jh.Centering}))}}}},{key:"setupViewContextState",value:function(e){this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),this.cameraman.transformCamera(s(s({},e.cameraMoving),{},{animationMode:Uh.Immediately})),this.cameraman.disableCameraTransform=e.disableCameraTransform,this.cameraman.handToolActive=e.handToolActive,this.cameraman.handToolKey=e.handToolKey,this.screen.divElement=e.divElement}},{key:"createBezierCurvePainter",value:function(e){var t=null;return e&&(t=new e([.1,.3,.5,.7,.9,1])),t}},{key:"createScene",value:function(e,t,n,r){var i=r.WhiteRender;if(i.createLayoutDescriptions){var a=i.createLayoutDescriptions(n);return e.createSceneWithLegacyLayoutDescriptions(a,t)}return e.createScene(t)}},{key:"scenePath",get:function(){return"/"+this.applianceManager.getCurrentScenePath().join("/")}},{key:"foucsScenePath",get:function(){return this.render.foucsScenePath},set:function(e){this.render.foucsScenePath=e}},{key:"cameraman",get:function(){return this.cameraBoundState.cameraman}},{key:"maskScreenObserverId",get:function(){return this._maskScreenObserverId},set:function(e){this._maskScreenObserverId!==e&&(this._maskScreenObserverId=e,this.screen.context=Object.freeze(s(s({},this.screen.context),{},{observerId:e?nn:this.observerId})))}},{key:"setCommonScreenContext",value:function(e){var t,n=this.observerId,r=e.observerId;this.screen.context=Object.freeze(s(s(s({},this.screen.context),e),{},{observerId:this.screenObserverId(e)})),n!==r&&(this.observerId=r,null===(t=this.cursors)||void 0===t||t.updateObserverId(r))}},{key:"setCameraBound",value:function(e){this.cameraBoundState.setCameraBound(e)}},{key:"resizeScreen",value:function(){this.screen.resize()}},{key:"refreshRender",value:function(){this.render.refreshSceneComponents()}},{key:"refreshCameraToFocus",value:function(){var e=this.applianceManager.getViewState(),t={originX:e.originX,originY:e.originY,width:e.width,height:e.height};this.screen.adaptRectangle(s(s({},t),{},{animationMode:Uh.Continuous,adapterMode:jh.Centering}))}},{key:"getTargetsMap",value:function(e,t){var n,r=e.component,i=e.engine,a=this.modules.WhiteModel.ApplianceComponent;return Lo(r.payload,a)&&(n=this.render.getTargetsMap?this.render.getTargetsMap(r,t):this.render.findTargetsMap(r.id,i.orderIndex,t)),n}},{key:"release",value:function(){var e;this.onCatchErrorWhenRender&&this.screen.removeRenderErrorCatchedListener(this.onCatchErrorWhenRender),this.screen.removeSizeUpdatedListener(this.onScreenSizeUpdated),null!==(e=this.cursors)&&void 0!==e&&e.release(),this.screen.divElement=null,this.render.release(),this.cameraBoundState.cameraman.release()}},{key:"scenePreview",value:function(e,t,n,r){var i=this.modules.WhiteRender,a=i.screenshot,o=i.EnginesHub;if(a){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var s=uw.parse(e),c=this.screen,u=n,l=r;u="number"!=typeof u?t.clientWidth:u,l="number"!=typeof l?t.clientHeight:l;var h=1;0!==c.width&&0!==c.height&&(h=Math.min(u/c.width,l/c.height)*c.camera.scale);var d={centerX:c.camera.centerX,centerY:c.camera.centerY,scale:h},p=a({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:u,height:l,path:s,camera:d});if(!(0,Pw.isValidElement)(p))throw new Error("scene preview must render ReactElement");Cw.render(p,t)}}},{key:"fillSceneSnapshot",value:function(e,t,n,r){var i=this.modules.WhiteRender,a=i.screenshot,o=i.EnginesHub;if(a){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var s=uw.parse(e),c=a({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:n,height:r,path:s});if(!(0,Pw.isValidElement)(c))throw new Error("scene preview must render ReactElement");Cw.render(c,t)}}},{key:"generateScreenshot",value:(n=I(regeneratorRuntime.mark((function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t?(a=uw.parse(t),i=this.applianceManager.scenes.getScene(a)):i=this.applianceManager.scene,i){e.next=3;break}throw new Error("cannot find scene with path ".concat(JSON.stringify(t)));case 3:if(!(o=this.findBackgroundImage(i))){e.next=10;break}return e.next=7,this.generateImage(o,n,r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=Uw(1,1);case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"findBackgroundImage",value:function(e){for(var t=this.modules.WhiteModel.BackgroundImage,n=0;n<e.componentsLength;++n){var r=e.componentAt(n);if(Lo(r,t))return r}return null}},{key:"generateImage",value:(t=I(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,p,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=r,void 0===(a=n)&&(a=t.width),void 0===o&&(o=t.height),i.width=a,i.height=o,!(s=t.previewURL)&&/^https?:\/\//im.test(t.src)&&(s=t.src),!s){e.next=14;break}return e.next=6,Tk(s);case 6:c=e.sent,u=i.getContext("2d"),l=Math.min(a/t.width,o/t.height),h=t.width*l,d=t.height*l,p=(a-h)/2,f=(o-d)/2,u.drawImage(c,p,f,h,d);case 14:return e.next=16,new Promise((function(e){return i.toBlob(e)}));case 16:return v=e.sent,e.abrupt("return",URL.createObjectURL(v));case 18:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"updateCursorClass",value:function(e){this.screen.className=null!==e?"netless-whiteboard "+e:"netless-whiteboard"}},{key:"updateCursorStyle",value:function(e){this.screen.style=null===e?void 0:{cursor:e}}},{key:"screenObserverId",value:function(e){var t=e.observerId;return this._maskScreenObserverId?nn:t}}]),e}();!function(e){e[e.Writable=0]="Writable",e[e.FollowSceneAndCamera=1]="FollowSceneAndCamera",e[e.FollowScene=2]="FollowScene",e[e.Freedom=3]="Freedom"}(Vw||(Vw={}));var Hw=function(e){m(n,e);var t=y(n);function n(e,r,i,a,o,c,u){var l;return M(this,n),(l=t.call(this,o)).extraWrappedComponents=Object.freeze([]),l.didRelease=!1,l.wannaFocusScenePath=void 0,l._mode=3,l.onSizeUpdated=function(e){var t=e.width,n=e.height;l._size=Object.freeze({width:t,height:n}),l._callbacks.dispatch("onSizeUpdated",(function(e){return e(l._size)}))},l.onCameraUpdated=function(e){l._camera=Object.freeze(s({},e)),l._callbacks.dispatch("onCameraUpdated",(function(e){return e(l._camera)}))},l.onBoundlessEvent=function(e){l.delegate.onBoundlessEvent(e)},l.onHandToolActive=function(e){l._callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))},l.onCameraTransformation=function(e){l._callbacks.dispatch("onCameraTransform",(function(t){return t(e)}))},l.id=e,l.commonScreenContext=r,l.params=i,l.node=new Ww(k(l),r,a,i,l.shouldHideCursors(a)),l.node.maskFloatBar=!1,l.latestScenePath=l.node.scenePath,l.delegate=c,l._callbacks=new wk(u),l.registerScreenAndCameraman(l.node.screen,l.node.cameraman),l}return O(n,[{key:"scenePath",get:function(){return this.latestScenePath}},{key:"focusScenePath",get:function(){return this.wannaFocusScenePath},set:function(e){var t=this;this.wannaFocusScenePath!==e&&(this.wannaFocusScenePath=e,this.shouldFollowScene(this._mode)||this.watchScenePathUpdate((function(){t.node.foucsScenePath=e})))}},{key:"disableCameraTransform",get:function(){return this.state.disableCameraTransform},set:function(e){this.putState({disableCameraTransform:e})}},{key:"callbacks",get:function(){return this._callbacks}},{key:"mode",get:function(){return this._mode},set:function(e){var t=this;this.assertNotRelease(),this._mode!==e&&this.watchScenePathUpdate((function(){0===t._mode&&t.delegate.onIsWriterChanged(!1),t.shouldFollowCamera(e)&&!t.shouldFollowCamera(t._mode)&&t.node.refreshCameraToFocus(),t.shouldFollowScene(e)&&!t.shouldFollowScene(t._mode)?t.node.foucsScenePath=void 0:!t.shouldFollowScene(e)&&t.shouldFollowScene(t._mode)&&(t.node.foucsScenePath=t.wannaFocusScenePath),t.node.maskScreenObserverId=t.shouldMaskScreenObserverId(e),0===e?(t.node.maskFloatBar=!1,t.delegate.onIsWriterChanged(!0)):t.node.maskFloatBar=!0,t._mode=e}))}},{key:"wrappedComponents",get:function(){return this.extraWrappedComponents},set:function(e){this.extraWrappedComponents=Object.freeze(C(e)),this.node.screen.wrappedComponents=[].concat(C(e),C(this.params.wrappedComponents))}},{key:"shouldMaskScreenObserverId",value:function(e){return 0!==e}},{key:"shouldFollowCamera",value:function(e){switch(e){case 0:case 1:return!0;default:return!1}}},{key:"shouldHideCursors",value:function(e){var t="/"+e.applianceManager.getCurrentScenePath().join("/");return!(!this.wannaFocusScenePath||this.shouldFollowScene(this._mode)||t===this.wannaFocusScenePath)}},{key:"shouldFollowScene",value:function(e){switch(e){case 0:case 1:case 2:return!0;default:return!1}}},{key:"camera",get:function(){return this._camera}},{key:"size",get:function(){return this._size}},{key:"screen",get:function(){return this.node.screen}},{key:"cameraman",get:function(){return this.node.cameraman}},{key:"divElement",get:function(){return this.state.divElement},set:function(e){this.putState({divElement:e})}},{key:"getTargetsMap",value:function(e,t){return this.node.getTargetsMap(e,t)}},{key:"cancelCurrentContinuityEvent",value:function(){this.cameraman.cancelCurrentContinuityEvent()}},{key:"setCommonScreenContext",value:function(e){this.assertNotRelease(),this.commonScreenContext=e,this.node.setCommonScreenContext(e)}},{key:"updateContext",value:function(e){var t=this,n=this.node.maskFloatBar;this.assertNotRelease(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.node=new Ww(this,this.commonScreenContext,e,this.handleUpdatedParams(this.params),this.shouldHideCursors(e),this.node),this.node.maskFloatBar=n,this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate((function(){return t.node.foucsScenePath=t.wannaFocusScenePath})),this.registerScreenAndCameraman(this.node.screen,this.node.cameraman)}},{key:"handleUpdatedParams",value:function(e){return 0===this.extraWrappedComponents.length?e:s(s({},e),{},{wrappedComponents:[].concat(C(this.extraWrappedComponents),C(e.wrappedComponents))})}},{key:"setCameraBound",value:function(e){this.putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.putState({cameraMoving:{toContaint:e}})}},{key:"updateDisableBoundlessEvent",value:function(e){this.node.cameraman.disableBoundlessEvent=e}},{key:"updateCursorClass",value:function(e){this.node.updateCursorClass(e)}},{key:"updateCursorStyle",value:function(e){this.node.updateCursorStyle(e)}},{key:"resizeScreen",value:function(){this.node.resizeScreen()}},{key:"refreshRender",value:function(){var e=this;this.watchScenePathUpdate((function(){return e.node.refreshRender()}))}},{key:"scenePreview",value:function(e,t,n,r){return this.node.scenePreview(e,t,n,r)}},{key:"generateScreenshot",value:function(e,t,n){return this.node.generateScreenshot(e,t,n)}},{key:"fillSceneSnapshot",value:function(e,t,n,r){this.node.fillSceneSnapshot(e,t,n,r)}},{key:"convertToPointInWorld",value:function(e){var t=e.x,n=e.y;return this.node.screen.convertPointToScene(t,n)}},{key:"fireRenderDuration",value:function(e){this._callbacks.dispatch("onRenderDuration",(function(t){return t(e)}))}},{key:"release",value:function(){this.assertNotRelease(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.didRelease=!0,this.delegate.onRelease()}},{key:"onStateUpdate",value:function(e){this.node.updateState(e)}},{key:"registerScreenAndCameraman",value:function(e,t){var n=this,r=e.width,i=e.height,a=e.camera;(!this._size||this._size.width!==r||this._size.height!==i)&&(this._size=Object.freeze({width:r,height:i}),this._callbacks.dispatch("onSizeUpdated",(function(e){return e(n._size)}))),(!this._camera||!Ck(this._camera,a))&&(this._camera=Object.freeze(s({},a)),this._callbacks.dispatch("onCameraUpdated",(function(e){return e(n._camera)}))),e.addSizeUpdatedListener(this.onSizeUpdated),e.addCameraUpdatedListener(this.onCameraUpdated),t.addBoundlessEventListener(this.onBoundlessEvent),t.addHandToolActiveListener(this.onHandToolActive),t.addCameraTransformationListener(this.onCameraTransformation)}},{key:"unregisterScreenAndCameraman",value:function(e,t){e.removeSizeUpdatedListener(this.onSizeUpdated),e.removeCameraUpdatedListener(this.onCameraUpdated),t.removeBoundlessEventListener(this.onBoundlessEvent),t.removeHandToolActiveListener(this.onHandToolActive),t.removeCameraTransformationListener(this.onCameraTransformation)}},{key:"assertNotRelease",value:function(){if(this.didRelease)throw new Error("view did release")}},{key:"watchScenePathUpdate",value:function(e){try{return e()}finally{var t=this.latestScenePath,n=this.node.scenePath;this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&n!==this.wannaFocusScenePath?this.node.isCursorsHidden=!0:this.node.isCursorsHidden=!1,t!==n&&(this.latestScenePath=n,this._callbacks.dispatch("onScenePathUpdated",(function(e){return e(n)})))}}}]),n}(Iw),_w=function(e){m(n,e);var t=y(n);function n(e,r,i){var a;return M(this,n),(a=t.call(this,r)).viewsMap={},a.previousViewId=0,a.writer=null,a.params=e,a.context=Object.freeze(s({},i)),a._dynamicPpt=i.dynamicPpt,a._callbacks=new wk,a.commonScreenContext=Object.freeze({observerId:r.observerId,forcePPTLandscape:r.forcePPTLandscape,disalbeImageHit:r.disalbeImageHit,disableOthersSelectingBox:r.disableOthersSelectingBox}),a}return O(n,[{key:"writableView",get:function(){return this.writer}},{key:"dynamicPpt",get:function(){return this._dynamicPpt}},{key:"callbacks",get:function(){return this._callbacks}},{key:"onStateUpdate",value:function(e,t){var n,r;if("observerId"in e&&this.updateCommonScreenContext("observerId",e.observerId),"forcePPTLandscape"in e&&this.updateCommonScreenContext("forcePPTLandscape",e.forcePPTLandscape),"disalbeImageHit"in e&&this.updateCommonScreenContext("disalbeImageHit",e.disalbeImageHit),"disableOthersSelectingBox"in e&&this.updateCommonScreenContext("disableOthersSelectingBox",e.disableOthersSelectingBox),"disableBoundlessEvent"in e&&this.forEach((function(t){return t.updateDisableBoundlessEvent(e.disableBoundlessEvent)})),"cursorClass"in e&&null!==(n=this.writer)&&void 0!==n&&n.updateCursorClass(e.cursorClass),"cursorStyle"in e&&null!==(r=this.writer)&&void 0!==r&&r.updateCursorStyle(e.cursorStyle),"playerState"in e){var i=e.playerState,a=this.context.pluginManager;a.setPlayerState?a.setPlayerState(i):void 0!==i.isPlaying&&a.setPlayingState(i.isPlaying)}}},{key:"setupViewContext",value:function(e){e.updateDisableBoundlessEvent(this.state.disableBoundlessEvent),e.updateCursorClass(this.state.cursorClass),e.updateCursorClass(this.state.cursorStyle)}},{key:"updateCommonScreenContext",value:function(e,t){for(var n in this.commonScreenContext=Object.freeze(s(s({},this.commonScreenContext),{},c({},e,t))),this.viewsMap)this.viewsMap[n].setCommonScreenContext(this.commonScreenContext)}},{key:"forEach",value:function(e){for(var t in this.viewsMap)e(this.viewsMap[t])}},{key:"createView",value:function(e,t){var n=this,r="".concat(this.previousViewId+=1),i=Object.freeze({onIsWriterChanged:function(e){return n.changeViewIsWriter(a,e)},onRelease:function(){return n.releaseView(a)},onBoundlessEvent:function(e){n._callbacks.dispatch("onBoundlessEvent",(function(t){return t(a,e)}))}}),a=new Hw(r,this.commonScreenContext,this.params,this.context,e,i,t);return this.viewsMap[a.id]=a,this.setupViewContext(a),this._callbacks.dispatch("onCreatedView",(function(e){return e(a)})),a}},{key:"updateContext",value:function(e){var t=this;for(var n in this.viewsMap){var r=this.viewsMap[n];r.updateContext(e),this.setupViewContext(r)}this._dynamicPpt=e.dynamicPpt,this.writer&&this._callbacks.dispatch("onWritableScreenChanged",(function(e){return e(t.writer)}))}},{key:"refreshPluginInstances",value:function(){this.context.pluginManager.refreshPluginInstances&&this.context.pluginManager.refreshPluginInstances()}},{key:"changeViewIsWriter",value:function(e,t){if(t){if(this.writer&&this.writer!==e)throw new Error("there is another view who's mode is Writable. it should be singleton");this.writer=e,this.writer.updateCursorClass(this.state.cursorClass),this.writer.updateCursorStyle(this.state.cursorStyle),this._callbacks.dispatch("onWritableViewChanged",(function(t){return t(e)})),this._callbacks.dispatch("onWritableScreenChanged",(function(t){return t(e)}))}else this.writer===e&&(this.writer.updateCursorClass(null),this.writer.updateCursorStyle(null),this.writer=null,this._callbacks.dispatch("onWritableViewChanged",(function(e){return e(null)})),this._callbacks.dispatch("onWritableScreenChanged",(function(e){return e(null)})))}},{key:"releaseView",value:function(e){delete this.viewsMap[e.id],this.writer===e&&(this.writer=null),this._callbacks.dispatch("onReleasedView",(function(t){return t(e)}))}}]),n}(Iw),Gw=function(){function e(t){M(this,e),this.viewsHub=t}return O(e,[{key:"writableView",get:function(){return this.viewsHub.writableView}},{key:"createView",value:function(e){return this.viewsHub.createView({cameraBound:{},handToolActive:!1,divElement:null,disableCameraTransform:!1},e)}},{key:"forEach",value:function(e){this.viewsHub.forEach(e)}}]),e}(),Yw=function(){function e(t){M(this,e),this._owner=void 0,this._state=Object.freeze(s({},t))}return O(e,[{key:"owner",get:function(){return this._owner}},{key:"state",get:function(){return this._state||this._owner.state}},{key:"putState",value:function(e){var t;if(this._state){var n=xw(this._state,e);n&&(this._state=Object.freeze(n)),t=!!n}else t=this._owner.putState(e);return t}},{key:"updateOwner",value:function(e){this._owner=e,this._state=null}}]),e}();function Xw(e){return"object"==R(e)&&null!==e}var Qw,Zw,Kw,qw=function(){function e(t){var n=this,r=t.logger,i=t.region,a=t.boundless,o=t.useMobXState,s=t.preloadDynamicPPT,c=t.userFonts,u=t.pptHandler,l=t.globalStateUpdater,h=t.screenType,d=t.cameraBound,p=t.renderEngine,f=t.autoResize,v=t.plugins,m=t.wrappedComponents,g=t.floatBarClass,y=t.useMultiViews,b=t.willHideSelfCursor,k=t.disableCameraTransform,w=t.onlyCallbackRemoteStateModify,S=t.invisiblePlugins,x=t.handToolKey,P=t.fontFamily,T=t.disableOperations,O=t.disableOthersSelectingBox,E=t.cursorAdapter,A=t.eraserRadiusCursor,N=t.textareaHub,R=t.eventInterrupter,L=t.callbacks,j=t.urlInterrupter,D=t.onTextareaUpdate,z=t.userPayload,F=t.pptParams;M(this,e),this.magixEventsManager=new cw,this.preloadDynamicPPT=!1,this.mainViewProxy=null,this.context=null,this._views=null,this.libraryNodeFetcher=function(){var e=I(regeneratorRuntime.mark((function e(t){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(nk.modules.identifier,"/").concat(t.libIdentifier),e.next=3,ok(r);case 3:return i=e.sent,a=i.WhiteModel.default,e.abrupt("return",(n.logger.info("load modules ",r),Object.freeze({modules:i,libraryClass:a,appVersion:t.appVersion})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.covertMemberDisplayerToMember=function(e){var t=e.information,r=t?t.session:"",i=t&&t.payload;return{memberId:e.memberId,memberState:n.memberState(e.memberId),session:r,payload:zo(i)}},this.logger=r,this.region=i,this.useMobXState=o,this.textareaHub=N,this.boundless=a,this.screenType=h,this.eraserRadiusCursor=A,this.pluginOperator=this.createPluginOperator(),this.plugins=v,this.autoResize=f,this.cameraObserver=new Wk,this.wrappedComponents=Object.freeze(C(m)),this.onlyCallbackRemoteStateModify=w,this.invisiblePluginNode=new Sw(r,this,S),this.callbacks=new wk(L),this.preloadDynamicPPT=s,this.viewsParams=Object.freeze({logger:r,renderEngine:p,boundless:a,cameraBound:d,fontFamily:P,cursorAdapter:E,autoResize:f,floatBarClass:g,wrappedComponents:this.createWrappedComponents(),disableOperations:T,disableOthersSelectingBox:O,willHideSelfCursor:b,handToolKey:x,eventInterrupter:R,urlInterrupter:j,onTextareaUpdate:D,textareaHub:N,userPayload:z,pptParams:F,onScreenSizeUpdated:function(e){return n.onScreenSizeUpdated(e)}}),this.dynamicPptParams={globalStateUpdater:l,observerId:nn,userFonts:c,preload:s,pptHandler:u,logger:r,pptParams:F,userPayload:z,pptAssetsOrigin:"https://convertcdn.netless.link/dynamicConvert",onPPTLoadProgress:function(e,t){return n.callbacks.dispatch("onPPTLoadProgress",(function(n){return n(e,t)}))},onPPTMediaPause:function(e,t){return n.callbacks.dispatch("onPPTMediaPause",(function(n){return n(e,t)}))},onPPTMediaPlay:function(e,t){return n.callbacks.dispatch("onPPTMediaPlay",(function(n){return n(e,t)}))}},this.viewsHubProxy=new Yw({observerId:nn,forcePPTLandscape:!1,disalbeImageHit:!1,disableBoundlessEvent:!0,disableOthersSelectingBox:!1,cursorClass:null,cursorStyle:null,playerState:Object.freeze({isPlaying:!0,timestamp:0,playbackSpeed:1})}),y||(this.mainViewProxy=new Yw({cameraBound:d,handToolActive:!1,divElement:null,disableCameraTransform:!!k}))}var t;return O(e,[{key:"enableWriteNow",get:function(){return!1}},{key:"deviceType",get:function(){return this.boundless.deviceType}},{key:"observerId",get:function(){return this.viewsHubProxy.state.observerId}},{key:"version",get:function(){return nk.sdkVersion}},{key:"viewsHub",get:function(){return this.viewsHubProxy.owner}},{key:"useMultiViews",get:function(){return!this.mainViewProxy}},{key:"mainView",get:function(){return this.assertMainViewProxy().owner}},{key:"onScreenSizeUpdated",value:function(e){}},{key:"createWrappedComponents",value:function(){return[].concat(C(this.wrappedComponents),[fw(hw,this)])}},{key:"createPluginOperator",value:function(){return Object.freeze({remove:function(){throw new Error("it is not a writable room")},update:function(){throw new Error("it is not a writable room")},getPlugin:function(){throw new Error("it is not a writable room")}})}},{key:"scalePptToFit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Uh.Continuous,t=this.state.sceneState.scenes[this.state.sceneState.index];t.ppt&&this.moveCameraToContain({originX:-t.ppt.width/2,originY:-t.ppt.height/2,width:t.ppt.width,height:t.ppt.height,animationMode:e})}},{key:"scenePathType",value:function(e){var t=e.replace(/\/$/g,"").split("/");t.shift();var n=this.applianceManager.scenes.findSceneOrGroup(t),r=this.context.modules.WhiteModel.SceneNode;return void 0===n?ow.None:Lo(n,r)?ow.Page:ow.Dir}},{key:"entireScenes",value:function(){var e,t=this.applianceManager,n={},r=E(zo(t.getAllScenePaths()));try{for(r.s();!(e=r.n()).done;){var i=e.value,a=zo(t.getScene(i)),o=i.slice(0,-1),s="".concat("/").concat(o.join("/"));n[s]=n[s]||[],a&&n[s].push(a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"refreshViewSize",value:function(){var e;this.autoResize||null===(e=this.viewsHubProxy.owner)||void 0===e||e.forEach((function(e){return e.resizeScreen()}))}},{key:"getCurrentSceneState",value:function(){for(var e=this.applianceManager,t=zo(e.getCurrentScenePath()),n=uw.stringify(t),r=t.pop(),i=e.getSceneNames(t),a=uw.stringify(t),o=[],s=Number.NaN,c=0;c<i.length;++c){var u=i[c],l=e.getScene([].concat(C(t),[u]));(null==l?void 0:l.name)===r&&(s=c),o[c]=zo(l)}return{sceneName:r,scenePath:n,contextPath:a,scenes:o,index:s}}},{key:"assignAttributes",value:function(e,t){if(this.context){var n=t;if(void 0===n||Xw(n)){var r=this.context.pluginManager.findPlugin(e);r&&Xw(r.defaultAttributes)&&(n=s(s({},r.defaultAttributes),n))}return n}}},{key:"hasLibraryNode",get:function(){return!!this.context}},{key:"bezierCurvePainter",get:function(){return this.context?this.context.bezierCurvePainter:null}},{key:"putPlayerState",value:function(e){var t=Object.freeze(s(s({},this.viewsHubProxy.state.playerState),e));this.viewsHubProxy.putState({playerState:t})}},{key:"updateLibraryNode",value:function(e){var t=e.modules,n=t.WhiteRender,r=n.createDynamicPpt,i=n.EnginesHub,a=n.BezierCurvePainter,o=this.createPluginManager(t,this.pluginOperator,this.plugins),c=this.createBezierCurvePainter(a),u=r(s(s({},this.dynamicPptParams),{},{observerId:this.viewsHubProxy.state.observerId})),l=Object.freeze({appVersion:e.appVersion,applianceManager:this.applianceManager,pluginManager:o,dynamicPpt:u,engines:i&&new i(this.viewsParams.renderEngine),modules:t});if(this.viewsHubProxy.owner)this.viewsHubProxy.owner.updateContext(l);else{var h=this.viewsHubProxy.state,d=new _w(this.viewsParams,h,l);if(this.viewsHubProxy.updateOwner(d),this._views=new Gw(d),this.mainViewProxy){var p=this.mainViewProxy.state,f=d.createView(p);f.mode=Vw.Writable,this.mainViewProxy.updateOwner(f),this.cameraObserver.setupMainView(f),f.callbacks.forwardTo("onHandToolActive",this.callbacks),f.callbacks.forwardTo("onRenderDuration",this.callbacks)}}this.context=Object.freeze({modules:t,pluginManager:o,bezierCurvePainter:c}),this.refreshViewSize()}},{key:"createPluginManager",value:function(e,t,n){var r=new(0,e.WhiteRender.PluginManager)(n?n.plugins:{},t);return n&&n.setPluginManager(r),r}},{key:"createBezierCurvePainter",value:function(e){var t=null;return e&&(t=new e([.1,.3,.5,.7,.9,1])),t}},{key:"refreshRender",value:function(){var e;null===(e=this.viewsHubProxy.owner)||void 0===e||e.forEach((function(e){return e.refreshRender()}))}},{key:"disableOthersSelectingBox",get:function(){return this.viewsHubProxy.state.disableOthersSelectingBox},set:function(e){this.viewsHubProxy.putState({disableOthersSelectingBox:e})}},{key:"views",get:function(){if(this.mainViewProxy)throw new Error("you can only read views when useMultiViews is true");if(!this._views)throw new Error("views is not ready");return this._views}},{key:"dispose",value:function(){var e;null!==(e=this.viewsHubProxy.owner)&&void 0!==e&&e.forEach((function(e){return e.release()})),this.eraserRadiusCursor.release(),this.invisiblePluginNode.dispose(),this.cameraObserver.dispose()}},{key:"setObserverId",value:function(e){var t;(null===(t=this.viewsHubProxy.owner)||void 0===t?void 0:t.putState({observerId:e}))&&this.dynamicPpt.updateObserverId&&this.dynamicPpt.updateObserverId(e)}},{key:"dynamicPpt",get:function(){return this.viewsHubProxy.owner.dynamicPpt}},{key:"fetchNextPptSlideIfNeeded",value:function(e){if(this.preloadDynamicPPT&&e.index+1<e.scenes.length){var t,n=null===(t=e.scenes[e.index+1].ppt)||void 0===t?void 0:t.src;this.viewsHubProxy.owner.dynamicPpt.getPptSildeDefinition(n||"")}}},{key:"getInvisiblePlugin",value:function(e){return this.invisiblePluginNode.get(e)}},{key:"dispatchMagixEventWithObject",value:function(e){this.magixEventsManager.dispatchMagixEvent(e)}},{key:"addMagixEventListener",value:function(e,t,n){var r=n;void 0===r?this.magixEventsManager.addMagixEventListener(e,t):(r<500&&(this.logger.warn("fireInterval ".concat(r,"ms of event ").concat(JSON.stringify(e)," can't less than ").concat(500,"ms, it's will be reset as ").concat(500,"ms")),r=500),this.magixEventsManager.addMagixEventsListener(e,t,r))}},{key:"removeMagixEventListener",value:function(e,t){this.magixEventsManager.removeMagixEventListener(e,t)}},{key:"waitMagixEvent",value:function(e){return this.magixEventsManager.waitMagixEvent(e)}},{key:"assertMainViewProxy",value:function(){var e=this.mainViewProxy;if(!e)throw new Error("can not use these methods or properties. you should pass useMultiViews: false");return e}},{key:"scenePreview",value:function(e,t,n,r){var i=this.assertMainViewProxy().owner;i&&i.scenePreview(e,t,n,r)}},{key:"generateScreenshot",value:(t=I(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.assertMainViewProxy().owner.generateScreenshot(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"fillSceneSnapshot",value:function(e,t,n,r){var i;null===(i=this.assertMainViewProxy().owner)||void 0===i||i.fillSceneSnapshot(e,t,n,r)}},{key:"convertToPointInWorld",value:function(e){var t=this.assertMainViewProxy().owner;return t?t.convertToPointInWorld(e):{x:e.x,y:e.y}}},{key:"handToolActive",get:function(){return this.assertMainViewProxy().state.handToolActive},set:function(e){this.assertMainViewProxy().putState({handToolActive:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"handToolKey",get:function(){return this.assertMainViewProxy().state.handToolKey}},{key:"disableCameraTransform",get:function(){return this.assertMainViewProxy().state.disableCameraTransform},set:function(e){this.assertMainViewProxy().putState({disableCameraTransform:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"bindHtmlElement",value:function(e){this.assertMainViewProxy().putState({divElement:e})}},{key:"setCameraBound",value:function(e){this.assertMainViewProxy().putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{toContaint:e}})}}]),e}();(Zw=Qw||(Qw={})).Connecting="connecting",Zw.Connected="connected",Zw.Reconnecting="reconnecting",Zw.Disconnecting="disconnecting",Zw.Disconnected="disconnected",function(e){e.ThrowError="throwError",e.Warn="warn",e.Ignore="ignore"}(Kw||(Kw={}));var Jw=W(n("lOZ2")),$w=function(){function e(t,n,r){M(this,e),this.enableDrawPoint=t,this.disableNewPencil=n,this.undoStack=r}return O(e,[{key:"becomeWritable",value:function(e){if(this.disableNewPencil){var t=e.getMemberState();if(t){var n=t.pencilOptions;n=n?s(s({},n),{},{disableBezier:!0}):{disableBezier:!0,enableDrawPoint:!1,sparseHump:3,sparseWidth:4};var r=e.setMemberStateWithCommitter({pencilOptions:n}).committer;r&&this.undoStack.commit(r)}}}},{key:"shouldUseNewPencil",value:function(e){return!this.disableNewPencil&&e===iw.pencil}},{key:"shouldCancelPaintingPencil",value:function(e){return!this.enableDrawPoint&&e.isLikePoint()}}]),e}(),eS=W(n("yyeZ")),tS=Object.freeze({x:0,y:0});function nS(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function rS(e){return Math.pow(e.x,2)+Math.pow(e.y,2)}function iS(e,t){return{x:e.x+t.x,y:e.y+t.y}}function aS(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{x:t.reduce((function(e,t){return e+t.x}),0),y:t.reduce((function(e,t){return e+t.y}),0)}}function oS(e,t){return{x:e.x-t.x,y:e.y-t.y}}function sS(e,t){return{x:e.x*t,y:e.y*t}}function cS(e){var t=nS(e);return 0===t?e:function(e,t){return{x:e.x/t,y:e.y/t}}(e,t)}function uS(e,t){return e.x*t.x+e.y*t.y}function lS(e,t){if(e.length<2)return[];var n=e.length;return function e(t,n,r,i){if(2===t.length){var a=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(t[0],t[1])/3;return[{curve:[t[0],iS(t[0],sS(n,a)),iS(t[1],sS(r,a)),t[1]],beginIndex:0,count:t.length}]}var o=function(e){var t,n,r,i=[];return e.forEach((function(e,a){t=a>0?n+nS(oS(e,r)):0,i.push(t),n=t,r=e})),i=i.map((function(e){return 0===n?0:e/n}))}(t),s=h(hS(t,o,o,n,r),3),c=s[0],u=s[1],l=s[2];if(0===u||u<i)return[{curve:c,beginIndex:0,count:t.length}];if(u<i*i)for(var d=o,p=u,f=l,v=0;v<20;v++){var m,g;if(d=dS(c,t,d),m=hS(t,o,d,n,r),g=h(m,3),c=g[0],u=g[1],l=g[2],u<i)return[{curve:c,beginIndex:0,count:t.length}];if(l===f){var y=u/p;if(y>.9999&&y<1.0001)break}p=u,f=l}var b=oS(t[l-1],t[l+1]);if(0===b.x&&0===b.y){var k=oS(t[l-1],t[l]),w=k.x,S=k.y;b={x:-S,y:w}}var x,I=cS(b),P=sS(I,-1),M=e(t.slice(0,l+1),n,I,i),T=e(t.slice(l),P,r,i),O=E(T);try{for(O.s();!(x=O.n()).done;){x.value.beginIndex+=l}}catch(e){O.e(e)}finally{O.f()}return[].concat(C(M),C(T))}(e,fS(e[1],e[0]),fS(e[n-2],e[n-1]),t)}function hS(e,t,n,r,i){var a=function(e,t,n,r){for(var i=e[0],a=e[e.length-1],o=[i,tS,tS,a],s=t.map((function(e){var t=1-e;return[sS(n,3*e*(t*t)),sS(r,3*t*(e*e))]})),c=[[0,0],[0,0]],u=[0,0],l=0,d=Array.from(t.entries());l<d.length;l++){var p=h(d[l],2),f=p[0],v=p[1],m=h(s[f],2),g=m[0],y=m[1];c[0][0]+=uS(g,g),c[0][1]+=uS(g,y),c[1][0]+=uS(g,y),c[1][1]+=uS(y,y);var b=oS(e[f],vS([i,i,a,a],v));u[0]+=uS(g,b),u[1]+=uS(y,b)}var k=c[0][0]*c[1][1]-c[1][0]*c[0][1],w=c[0][0]*u[1]-c[1][0]*u[0],S=u[0]*c[1][1]-u[1]*c[0][1],x=0===k?0:S/k,I=0===k?0:w/k,C=nS(oS(i,a)),P=1e-6*C;return x<P||I<P?(o[1]=iS(i,sS(n,C/3)),o[2]=iS(a,sS(r,C/3))):(o[1]=iS(i,sS(n,x)),o[2]=iS(a,sS(r,I))),o}(e,n,r,i),o=h(function(e,t,n){for(var r=0,i=Math.floor(e.length/2),a=function(e,t){for(var n=[0],r=e[0],i=0,a=1;a<=t;a++){var o=vS(e,a/t);i+=nS(oS(o,r)),n.push(i),r=o}return n=n.map((function(e){return e/i}))}(t,10),o=1;o<e.length-1;o++){var s=e[o],c=pS(t,n[o],a,10),u=rS(oS(vS(t,c),s));u>r&&(r=u,i=o)}return[r,i]}(e,a,t),2);return[a,o[0],o[1]]}function dS(e,t,n){return n.map((function(n,r){return function(e,t,n){var r=oS(vS(e,n),t),i=function(e,t){var n=1-t,r=sS(oS(e[1],e[0]),3*Math.pow(n,2)),i=sS(oS(e[2],e[1]),6*n*t),a=sS(oS(e[3],e[2]),3*Math.pow(t,2));return aS(r,i,a)}(e,n),a=uS(r,i),o=rS(i)+2*uS(r,function(e,t){return iS(sS(iS(oS(e[2],sS(e[1],2)),e[0]),6*(1-t)),sS(iS(oS(e[3],sS(e[2],2)),e[1]),6*t))}(e,n));return 0===o?n:n-a/o}(e,t[r],n)}))}function pS(e,t,n,r){if(t<0)return 0;if(t>1)return 1;for(var i=1;i<=r;i++)if(t<=n[i]){var a=(i-1)/r,o=i/r,s=n[i-1];return(t-s)/(n[i]-s)*(o-a)+a}return Number.NaN}function fS(e,t){return cS(oS(e,t))}function vS(e,t){var n=1-t;return aS(sS(e[0],Math.pow(n,3)),sS(e[1],3*Math.pow(n,2)*t),sS(e[2],3*n*Math.pow(t,2)),sS(e[3],Math.pow(t,3)))}var mS=function(){function e(t,n,r,i){var a=this;M(this,e),this.paintingShape=null,this.extraSteups=0,this.lastCurveBeginIndex=0,this.points=[],this.commiter=null,this.onAddExtraSteups=function(){a.applianceManager.addBezierCurveExtraSteups(),a.extraSteups+=1,a.extraSteups>=a.bezierCurvePainter.maxExtraSteups&&a.fountain.stop()},this.applianceManager=t,this.cameraObserver=n,this.pencilOptions=r,this.bezierCurvePainter=i,this.fountain=new gS(this.onAddExtraSteups)}return O(e,[{key:"pushBoundlessMouseEvent",value:function(e,t){switch(this.commiter=null,e){case Oc.MouseDown:case Oc.SortedTouchStart:this.onMouseDown(t);break;case Oc.MouseMove:case Oc.SortedTouchMove:this.onMouseMove(t);break;case Oc.MouseUp:case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:this.onMouseUp(t);break;case Oc.MouseLeave:this.onMouseLeave(t)}return this.commiter}},{key:"onMouseDown",value:function(e){var t=e.x,n=e.y;this.paintingShape||(this.paintingShape=this.createCurveShape(t,n),this.fountain.touch())}},{key:"onMouseMove",value:function(e){if(this.paintingShape){var t=e.x,n=e.y;this.points.push(this.createStrokePoint(t,n)),this.fitCurvesIfNeed(),this.fountain.touch()}else this.applianceManager.onMouseMove(e)}},{key:"onMouseUp",value:function(e){var t=e.x,n=e.y;this.paintingShape&&(this.fountain.stop(),this.bezierCurvePainter.completePainting(),this.pencilOptions.shouldCancelPaintingPencil(this.paintingShape)?this.applianceManager.cancelPencilPainting(t,n):this.commiter=this.applianceManager.completePencilPainting(t,n),this.points=[],this.paintingShape=null)}},{key:"onMouseLeave",value:function(e){this.paintingShape||(this.commiter=this.applianceManager.onMouseLeave(e))}},{key:"createStrokePoint",value:function(e,t){var n=this.points[this.points.length-1],r=0;if(n){var i=e-n.x,a=t-n.y;r=n.distance+Math.sqrt(i*i+a*a)}return this.bezierCurvePainter.pushPoint(e,t),{x:e,y:t,distance:r}}},{key:"createCurveShape",value:function(e,t){var n=this.applianceManager.createBezierCurve({x:e,y:t});return this.bezierCurvePainter.startPainting(n.identifier),this.paintingShape=n,this.extraSteups=0,this.lastCurveBeginIndex=0,n}},{key:"fitCurvesIfNeed",value:function(){if(this.points.length>1){var t=e.fitCurveMaxError/this.cameraObserver.cameraState.scale,n=lS(this.points.slice(this.lastCurveBeginIndex),Math.pow(t,2)),r=0;if(this.extraSteups>0&&(this.extraSteups-=1,r=1),1===n.length){var i=n[0].curve,a=this.points.length-this.lastCurveBeginIndex,o=this.createBezierCurve(i,0,a);this.applianceManager.updateBezierCurveTail(o,r)}else{var s,c=0,u=[],l=E(n);try{for(l.s();!(s=l.n()).done;){var h=s.value,d=h.curve,p=h.beginIndex,f=h.count;u.push(this.createBezierCurve(d,p,f)),c=Math.max(c,p)}}catch(e){l.e(e)}finally{l.f()}this.lastCurveBeginIndex+=c,this.applianceManager.splitBezierCurveTail(u,r)}if(this.points.length>e.maxSegmentsPointsCount){this.points.shift(),this.bezierCurvePainter.cleanAndKeepPoints(1),this.lastCurveBeginIndex-=1}}}},{key:"createBezierCurve",value:function(e,t,n){var r=n-2,i=this.points[t],a=this.points[t+n-1];return{point1:e[1],point2:e[2],point3:e[3],hiddenPoints:r,cubic:this.fitCubic(t,n),distance:a.distance-i.distance}}},{key:"fitCubic",value:function(e,t){var n,r=this.points[e].distance,i=this.points[e+t-1].distance-r;if(t>=1&&i>0){for(var a=[],o=0;o<t;++o){var s=this.points[e+o].distance;a.push({distance:(s-r)/i,progress:o/(t-1)})}n=(0,eS.uncmin)((function(e){var t,n=0,r=E(a);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.distance,s=i.progress;n+=Math.pow(e[0]*Math.pow(o,3)+e[1]*Math.pow(o,2)+e[2]*o+e[3]-s,2)}}catch(e){r.e(e)}finally{r.f()}return n}),[1,1,1,1]).solution}else n=[0,0,1,0];return n}}]),e}();mS.fitCurveMaxError=1,mS.maxSegmentsPointsCount=350;var gS=function(){function e(t){var n=this;M(this,e),this.onGush=t,this.sleepTimer=null,this.gushInterval=null,this.onTick=function(){n.sleepTimer=null,n.gushInterval=setTimeout(n.onTick,e.GushInterval),n.onGush()}}return O(e,[{key:"touch",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&clearTimeout(this.sleepTimer),this.sleepTimer=setTimeout(this.onTick,e.SleepDuration)}},{key:"stop",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null)}}]),e}();gS.SleepDuration=68,gS.GushInterval=17;var yS=function(){function e(t){M(this,e),this.inputs={},this.outputs={},this.previousId=0,this.pressedInputId="",this.isPressed=!1,this.output=void 0,this.outputSwitch=t}return O(e,[{key:"createInput",value:function(){var e=this,t="".concat(this.previousId+=1),n=Object.freeze({id:t,pushEvent:function(n){return e.pushEventByInput(t,n)}});return this.inputs[t]={input:n,isPressed:!1},n}},{key:"removeInput",value:function(e){var t;(null===(t=this.inputs[e.id])||void 0===t?void 0:t.input)===e&&(delete this.inputs[e.id],this.pressedInputId=e.id,this.pressedInputId&&(this.pressedInputId=""))}},{key:"putOutput",value:function(e,t){this.outputs[e]=t}},{key:"pushEventByInput",value:function(e,t){var n=this.inputs[e];switch(t.kind){case Oc.MouseDown:case Oc.SortedTouchStart:n.isPressed=!0,this.isPressed=!0,""===this.pressedInputId&&(this.pressedInputId=e,this.pushEvent(n.input,t));break;case Oc.MouseMove:case Oc.MouseLeave:case Oc.SortedTouchMove:(""===this.pressedInputId&&!n.isPressed||this.pressedInputId===e)&&this.pushEvent(n.input,t);break;case Oc.MouseUp:case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:this.pressedInputId===e&&(this.pressedInputId="",this.pushEvent(n.input,t)),n.isPressed=!1,this.isPressed=!1}}},{key:"pushEvent",value:function(e,t){var n=this.outputSwitch(e),r=this.outputs[n];if(void 0===this.output||this.output!==n){var i,a=null===(i=void 0!==this.output?this.outputs[this.output]:void 0)||void 0===i?void 0:i.onCancel,o=null==r?void 0:r.onStart;this.output=n,this.isPressed&&(a&&a(t,e),o&&o(t,e))}else null==r||r.onEvent(t,e)}}]),e}(),bS=W(n("Pzfo")),kS=function(){function e(t,n){var r=this;M(this,e),this.isReadonlyMode=!1,this.isOverrideWithFreedom=!1,this.overrideDisposer=null,this.previousRectangle=null,this.onCreatedView=function(e){r.previousRectangle&&r.refreshScreenRectangle(e,r.previousRectangle)},this.viewsHub=t,this.applianceManager=n,this.followerCheckingDisposer=(0,bS.reaction)((function(){return r.getCurrentMode()===Nw.Follower}),(function(e){e?r.refreshCameraRectangle():r.previousRectangle=null})),t.callbacks.on("onCreatedView",this.onCreatedView)}return O(e,[{key:"release",value:function(){this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.followerCheckingDisposer()}},{key:"setReadonlyMode",value:function(e){this.isReadonlyMode!==e&&(this.isReadonlyMode=e,this.overrideDisposer&&!e&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"overrideWithFreedom",value:function(e){var t=this;this.isReadonlyMode&&this.isOverrideWithFreedom!==e&&(this.isOverrideWithFreedom=e,e?this.overrideDisposer=(0,bS.when)((function(){return t.applianceManager.getViewState().mode===Nw.Freedom}),(function(){t.isReadonlyMode&&t.isOverrideWithFreedom&&(t.isOverrideWithFreedom=!1),t.overrideDisposer=null})):this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"getBroadcastState",value:function(){var e,t=this.applianceManager,n=zo(t.getBroadcasterId());if(void 0!==n){var r,i=E(t.getMemberDisplayers());try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.memberId===n){e=zo(a.information);break}}}catch(e){i.e(e)}finally{i.f()}}return{mode:this.getCurrentMode(),broadcasterId:n,broadcasterInformation:e}}},{key:"getCurrentMode",value:function(){return this.isReadonlyMode&&this.isOverrideWithFreedom?Nw.Freedom:this.applianceManager.getViewState().mode}},{key:"refreshCameraRectangle",value:function(){var e=this,t=this.applianceManager.getViewState(),n=t.originX,r=t.originY,i=t.width,a=t.height,o={originX:n,originY:r,width:i,height:a};(!this.previousRectangle||this.previousRectangle.originX!==n||this.previousRectangle.originY!==r||this.previousRectangle.width!==i||this.previousRectangle.height!==a)&&(this.viewsHub.forEach((function(t){return e.refreshScreenRectangle(t,o)})),this.previousRectangle=o)}},{key:"refreshScreenRectangle",value:function(e,t){var n=e.mode;(n===Vw.Writable||n===Vw.FollowSceneAndCamera)&&e.screen.adaptRectangle(s(s({},t),{},{animationMode:Uh.Continuous,adapterMode:jh.Centering}))}}]),e}();H([bS.observable],kS.prototype,"isReadonlyMode",2),H([bS.observable],kS.prototype,"isOverrideWithFreedom",2),H([bS.action],kS.prototype,"setReadonlyMode",1),H([bS.action],kS.prototype,"overrideWithFreedom",1);var wS,SS=function(){function e(t,n){M(this,e),this.deviceType=t,this.screenType=n,this.previousPoint={x:0,y:0},this.previousTimestamp=0,this.currentSpeed=0,this.isPressed=!1}return O(e,[{key:"radius",value:function(e,t,n){switch(this.updatePressed(t,n),this.deviceType){case Ah.Touch:return 36/Mk(this.screenType);default:return e===iw.eraser?this.getSpeedRaidus():0}}},{key:"updatePressed",value:function(e,t){if(this.isPressed!==t&&(this.isPressed=t,t?(this.previousPoint.x=0,this.previousPoint.y=0,this.previousTimestamp=Date.now(),this.currentSpeed=0):this.currentSpeed=0),t){var n=Date.now(),r=e.x-this.previousPoint.x,i=e.y-this.previousPoint.y,a=n-this.previousTimestamp,o=0===a?0:Math.sqrt(r*r+i*i)/a;this.previousPoint.x=e.x,this.previousPoint.y=e.y,this.previousTimestamp=n,this.currentSpeed=(o+this.currentSpeed)/2}}},{key:"getSpeedRaidus",value:function(){var e=this.currentSpeed;e>4.35?e=4.35:e<.45&&(e=.45);return 90*(e-.45)/(4.35-.45)/Mk(this.screenType)}}]),e}(),xS=function(){function e(t){var n=this;M(this,e),this.onLimiterInvoke=function(){if(n.nextInvoker)try{n.nextInvoker()}finally{n.nextInvoker=void 0}},this.limiter=new We(t,this.onLimiterInvoke)}return O(e,[{key:"limitDuration",get:function(){return this.limiter.limitDuration},set:function(e){this.limiter.limitDuration=e}},{key:"invoke",value:function(e){this.nextInvoker=e,this.limiter.invoke()}},{key:"cancel",value:function(){this.nextInvoker=void 0,this.limiter.cancel()}}]),e}();!function(e){e[e.Down=0]="Down",e[e.Move=1]="Move",e[e.Up=2]="Up",e[e.Leave=3]="Leave"}(wS||(wS={}));var IS,CS=function(){function e(t,n){var r=this;M(this,e),this.invoker=new xS(100),this.latestHitTestIdentifies=[],this.isPressed=!1,this.onStart=function(e){var t=r.createProxyEvent(e,0);t&&r.pushProxyEvent(t)},this.onEvent=function(e){var t=r.createProxyEvent(e);t&&r.pushProxyEvent(t)},this.onCancel=function(e){var t=r.createProxyEvent(e,2);t&&r.pushProxyEvent(t)},this.radiusSelector=t,this.delegate=n}return O(e,[{key:"release",value:function(){this.invoker.cancel()}},{key:"pushProxyEvent",value:function(e){var t=this;switch(e.boundlessEvent.kind){case Oc.MouseDown:this.invoker.limitDuration=17;break;case Oc.MouseUp:this.invoker.limitDuration=100}switch(e.kind){case 0:this.invoker.limitDuration=17;break;case 2:this.invoker.limitDuration=100}var n=e.mouseEvent.hitTestIdentifies;e.boundlessEvent.kind!==Oc.MouseMove||this.isHitTestIdentifiesDifferent(n)?(this.invoker.cancel(),setTimeout((function(){return t.callbackReceiveMouseEvent(e)}),0)):this.invoker.invoke((function(){return t.callbackReceiveMouseEvent(e)})),this.latestHitTestIdentifies=n}},{key:"callbackReceiveMouseEvent",value:function(e){var t=e.kind,n=e.eraserRadius,r=e.mouseEvent;this.onReceviedMouseEvent&&this.onReceviedMouseEvent(t,n,r)}},{key:"createProxyEvent",value:function(e,t){var n=null,r=this.delegate.getWritableScreen();if(r){var i,a=0,o=this.delegate.getCurrentApplianceName(),s=e.pointOnScreen,c=this.getProxyEventKind(e,t);if(o===iw.selector||o===iw.eraser){var u=this.radiusSelector.radius(o,s,this.isPressed);this.isPressed&&o===iw.eraser&&(a=u),i=r.hitTest(s.x,s.y,u)}else i=[];n={kind:c,eraserRadius:a,applianceName:o,mouseEvent:this.createMouseEvent(r,e,i),boundlessEvent:e}}return n}},{key:"createMouseEvent",value:function(e,t,n){var r,i=t.nativeEvent;if(i&&i.target){var a=e.findComponentWithTarget(i.target);a&&(r=this.delegate.getTargetsMap(a,i))}return r||(r={}),{x:t.pointOnScene.x,y:t.pointOnScene.y,targetsMap:r,hitTestIdentifies:n}}},{key:"getProxyEventKind",value:function(e,t){if(void 0!==t)return t;switch(e.kind){case Oc.MouseDown:case Oc.SortedTouchStart:return 0;case Oc.MouseMove:case Oc.SortedTouchMove:return 1;case Oc.MouseUp:case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:return 2;case Oc.MouseLeave:return 3;default:throw new Error("invalid kind ".concat(e.kind))}}},{key:"isHitTestIdentifiesDifferent",value:function(e){var t=this.latestHitTestIdentifies.length!==e.length;if(!t)for(var n=0;n<e.length;++n){if(t=e[n]!==this.latestHitTestIdentifies[n])break}return t}}]),e}(),PS=function(){function e(t,n){M(this,e),this.eventsInput=t,this.convertPointToScene=n}return O(e,[{key:"inputDown",value:function(e,t){this.pushEvent(Oc.MouseDown,e,t)}},{key:"inputMove",value:function(e,t){this.pushEvent(Oc.MouseMove,e,t)}},{key:"inputUp",value:function(e,t){this.pushEvent(Oc.MouseUp,e,t)}},{key:"pushEvent",value:function(e,t,n){var r={kind:e,isOnScreen:!0,pointOnScreen:{x:t,y:n},pointOnScene:this.convertPointToScene(t,n)};this.eventsInput.pushEvent(r)}}]),e}();!function(e){e[e.Hand=0]="Hand",e[e.NewPencil=1]="NewPencil",e[e.Others=2]="Others",e[e.Ignore=3]="Ignore"}(IS||(IS={}));var MS=function(){function e(t){var n=this;M(this,e),this.views2Inputs={},this.inputs2Views={},this.onCreatedView=function(e){var t=n.eventChannel.createInput();n.views2Inputs[e.id]=t,n.inputs2Views[t.id]=e},this.onReleasedView=function(e){var t=n.views2Inputs[e.id];t&&(delete n.views2Inputs[e.id],delete n.inputs2Views[t.id],n.eventChannel.removeInput(t))},this.onBoundlessEvent=function(e,t){switch(t.kind){case Oc.MouseDown:case Oc.MouseMove:case Oc.MouseUp:case Oc.MouseLeave:case Oc.SortedTouchStart:case Oc.SortedTouchMove:case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:var r;null===(r=n.views2Inputs[e.id])||void 0===r||r.pushEvent(t);break;case Oc.KeyDown:case Oc.KeyUp:n.onKeyPressed(t)}},this.onReceviedPencilMouseEvent=function(e,t,r){var i;switch(e){case wS.Down:i=Oc.MouseDown;break;case wS.Move:i=Oc.MouseMove;break;case wS.Up:i=Oc.MouseUp;break;case wS.Leave:i=Oc.MouseLeave}var a=n._bezierPencilAppliance.pushBoundlessMouseEvent(i,r);a&&n.onCommit(a)},this.onReceviedOthersMouseEvent=function(e,t,r){var i=null;switch(e){case wS.Down:i=n.magix.trigger.onMouseDown(r);break;case wS.Move:i=n.magix.trigger.onMouseMove(r);break;case wS.Up:i=n.magix.trigger.onMouseUp(r);break;case wS.Leave:i=n.magix.trigger.onMouseLeave(r)}i&&n.onCommit(i)},this.magix=t.magix,this.viewsHub=t.viewsHub,this.pencilOptions=t.pencilOptions,this.onKeyPressed=t.onKeyPressed,this.onCommit=t.onCommit,this.onReceivedHandMouseEvent=t.onReceivedHandMouseEvent;var r=new SS(t.deviceType,t.screenType),i={isWorking:function(){return n.magix.phase===Ys.Connected},getWritableScreen:function(){return n.viewsHub.writableView&&n.viewsHub.writableView.screen},getCurrentApplianceName:function(){return n.magix.trigger.getMemberState().currentApplianceName},getTargetsMap:function(e,t){var r;return null===(r=n.viewsHub.writableView)||void 0===r?void 0:r.getTargetsMap(e,t)}};this._viewStateObserver=new kS(this.viewsHub,this.magix.trigger),this._bezierPencilAppliance=new mS(this.magix.trigger,t.cameraObserver,this.pencilOptions,t.bezierCurvePainter),this.pencilChannel=new CS(r,i),this.othersChannel=new CS(r,i),this.eventChannel=this.createEventsChannel(),this.viewsHub.callbacks.on("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.on("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.on("onReleasedView",this.onReleasedView),this.viewsHub.forEach((function(e){return n.onCreatedView(e)})),this.pencilChannel.onReceviedMouseEvent=this.onReceviedPencilMouseEvent,this.othersChannel.onReceviedMouseEvent=this.onReceviedOthersMouseEvent,this.customEventInput=this.eventChannel.createInput(),this.customInput=new PS(this.customEventInput,t.convertPointToScene)}return O(e,[{key:"viewStateObserver",get:function(){return this._viewStateObserver}},{key:"bezierPencilAppliance",get:function(){return this._bezierPencilAppliance}},{key:"release",value:function(){this._viewStateObserver.release(),this.pencilChannel.release(),this.othersChannel.release(),this.viewsHub.callbacks.off("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.off("onReleasedView",this.onReleasedView)}},{key:"createEventsChannel",value:function(){var e=this,t=new yS((function(t){if(t.id===e.customEventInput.id||e.inputs2Views[t.id]!==e.viewsHub.writableView)return 3;var n=e.magix.trigger.getMemberState().currentApplianceName;return n===iw.hand?0:e.pencilOptions.shouldUseNewPencil(n)?1:2}));return t.putOutput(1,this.pencilChannel),t.putOutput(2,this.othersChannel),t.putOutput(0,{onEvent:this.onReceivedHandMouseEvent}),t}}]),e}(),TS=function(){function e(t){M(this,e),this.lastCommitValues={},this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitTimestamp=Date.now(),this.backgroundValues=Object.freeze(s({},t))}return O(e,[{key:"report",value:function(){var e={},t={},n={};for(var r in this.backgroundValues){var i=this.backgroundValues[r],a=this.sumNodes[r],o=this.maxValues[r],s=this.minValues[r];if(void 0===a)e[r]=i;else if(void 0===a.otherValueSum)e[r]=a.firstValue;else{var c=this.lastCommitTimestamp-a.beginAt,u=c/a.count,l=a.firstValue*u+a.otherValueSum,h=u+c;e[r]=h>0?l/h:i}t[r]=void 0===o?i:o,n[r]=void 0===s?i:s}return this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},{averageValues:e,maxValues:t,minValues:n}}},{key:"clean",value:function(){for(var e in this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitValues)delete this.lastCommitValues[e]}},{key:"commit",value:function(e){var t=Date.now();this.commitSumValues(t,e),this.commitMaxAndMinValues(e),this.lastCommitTimestamp=t}},{key:"commitSumValues",value:function(e,t){for(var n in t)void 0!==t[n]&&(this.lastCommitValues[n]=t[n]);for(var r in this.lastCommitValues){var i=this.lastCommitValues[r],a=this.sumNodes[r];void 0===a?this.sumNodes[r]={beginAt:e,firstValue:i,count:1,otherValueSum:i}:(a.count+=1,void 0===a.otherValueSum?a.otherValueSum=i*(e-a.beginAt):a.otherValueSum+=i*(e-this.lastCommitTimestamp))}}},{key:"commitMaxAndMinValues",value:function(e){for(var t in e){var n=e[t],r=this.maxValues[t],i=this.minValues[t];this.maxValues[t]=void 0===r?n:Math.max(r,n),this.minValues[t]=void 0===i?n:Math.min(i,n)}}}]),e}(),OS=function(){function e(t){var n=this,r=t.connection,i=t.disconnection,a=t.sample;M(this,e),this.statisticsTimer=null,this.onReportStatistics=function(){n.statisticsTimer=null,n.latestReportAt=Date.now();var e=n.statistics.report(),t=e.maxValues,r=e.minValues,i=e.averageValues;n.sampleCommitter.commit({maxRTT:t.rtt,minRTT:r.rtt,averageRTT:i.rtt,maxQueue:t.illusionQueueLength,minQueue:r.illusionQueueLength,averageQueue:i.illusionQueueLength,maxInterval:t.frameReceivedInterval,minInterval:r.frameReceivedInterval,averageInterval:i.frameReceivedInterval})},this.connectionCommitter=r,this.disconnectionCommitter=i,this.sampleCommitter=a,this.statistics=new TS({rtt:0,frameReceivedInterval:0,illusionQueueLength:0})}return O(e,[{key:"commitConnection",value:function(e){this.connectionCommitter.commit(e)}},{key:"commitDisconnection",value:function(e){this.disconnectionCommitter.commit(e)}},{key:"commitStatistics",value:function(t){if(void 0===this.latestReportAt&&(this.latestReportAt=Date.now()),null===this.statisticsTimer){var n=this.latestReportAt+e.reportStatisticsInterval-Date.now();n<0&&(n=e.reportStatisticsInterval,this.statistics.clean()),this.statisticsTimer=setTimeout(this.onReportStatistics,n)}this.statistics.commit(t)}},{key:"stop",value:function(){null!==this.statisticsTimer&&(clearTimeout(this.statisticsTimer),this.statisticsTimer=null)}}]),e}();OS.reportStatisticsInterval=6e4;var ES=function(){function e(t,n,r){var i=this;M(this,e),this.queue=[],this.limiter=new We(n,(function(){var e=i.queue.shift();if(e){try{r(e.event,e.payload)}catch(e){t.error(e)}i.queue.length>0&&i.limiter.invoke()}}))}return O(e,[{key:"dispatch",value:function(e,t){this.queue.push({event:e,payload:t}),this.limiter.invoke()}}]),e}();function AS(e){if("object"==R(e)){if(null===e)return null;if(e instanceof Array)return e.map((function(e){return AS(e)}));var t={};for(var n in e){var r=AS(e[n]);void 0!==r&&(t[n]=r)}return t}return"function"==typeof e?void 0:e}function NS(e){if("object"==R(e)){var t=e.userId;switch(R(t)){case"string":return t;case"number":case"boolean":return"".concat(t)}}}var RS,LS,jS,DS=function(e){m(a,e);var t,n,r,i=y(a);function a(e){var t;return M(this,a),(t=i.call(this,{logger:e.whiteLogger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,disableCameraTransform:e.disableCameraTransform,useMultiViews:e.useMultiViews,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,pptHandler:{onPageJumpTo:function(e,n){return t.pptJumpTo(e,n)},onPageToNext:function(){return t.nextPpt()},onPageToPrev:function(){return t.previousPpt()}},textareaHub:e.floatBarOptions&&new Uk,floatBarClass:e.floatBarOptions&&dx,globalStateUpdater:function(e){return t.setGlobalState(e)},disableOperations:!1,disableOthersSelectingBox:e.disableOthersSelectingBox,willHideSelfCursor:!0,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,eventInterrupter:function(e){return t.willInterruptEvent(e)},urlInterrupter:e.urlInterrupter,onTextareaUpdate:function(e,n,r){t.magix.isWritable&&(t.applianceManager.updateTextarea(e,n),t.undoStack.onTextareaUpdate(!!r))},callbacks:e.callbacks,pptParams:e.pptParams,userPayload:e.userPayload}))._phase=Qw.Connecting,t._isWritable=!1,t._enableWriteNow=!1,t.isEraser=!1,t.writableView=null,t.copyBuffer=null,t.beginReconnectAt=0,t.onWritableScreenChanged=function(e){t.writableView!==e&&(t.writableView&&(t.writableView.cameraman.removeCameraTransformationListener(t.onCameraTransform),t.writableView.screen.removeCameraUpdatedListener(t.onCameraUpdated)),t.writableView=e,e&&(e.cameraman.addCameraTransformationListener(t.onCameraTransform),e.screen.addCameraUpdatedListener(t.onCameraUpdated)))},t.onRoomStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(AS(e.globalState)),e.memberState&&(t.isEraser=e.memberState.currentApplianceName===iw.eraser,t.refreshShouldDisableImageHit(),t.refreshCursorClass()),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onRoomStateChanged",(function(t){return t(e)}))},t.convertPointToScene=function(e,n){var r=t.viewsHub.writableView;return r?r.screen.convertPointToScene(e,n):{x:e,y:n}},t.onBoundlessKeyEvent=function(e){var n,r=t.hotKeys.checkHotKey(e);switch(r&&(t.handleHotKey(r,e),null!==(n=e.nativeEvent)&&void 0!==n&&n.preventDefault()),e.kind){case Oc.KeyDown:t.callbacks.dispatch("onKeyDown",(function(t){return t(e.nativeEvent)}));break;case Oc.KeyUp:t.callbacks.dispatch("onKeyUp",(function(t){return t(e.nativeEvent)}))}},t.onReceivedHandMouseEvent=function(e,n){if(t.magix.phase===Ys.Connected)switch(e.kind){case Oc.MouseDown:case Oc.SortedTouchStart:var r;t.viewsHub.putState({cursorClass:"cursor-hand-grasp"}),null===(r=t.writableView)||void 0===r||r.putState({handToolActive:!0});break;case Oc.MouseUp:case Oc.SortedTouchEnd:case Oc.SortedTouchCancel:var i;t.viewsHub.putState({cursorClass:"cursor-hand"}),null===(i=t.writableView)||void 0===i||i.putState({handToolActive:!1})}},t.onModified=function(){if(t._phase===Qw.Connected){var e=t.roomInput.viewStateObserver;Nw.Follower===e.getCurrentMode()&&e.refreshCameraRectangle(),t.refreshRender()}},t.onReconnected=function(e){var n;null!==(n=t.statistics)&&void 0!==n&&n.commitConnection(s(s({},e),{},{isReconnection:!0})),t.viewsHub.refreshPluginInstances(),t.syncCameraToRemote()},t.onDisconnectWithError=function(e){var n;0!==t.beginReconnectAt&&null!==(n=t.statistics)&&void 0!==n&&n.commitDisconnection({isReconnection:!0,duration:Date.now()-t.beginReconnectAt}),t.callbacks.dispatch("onDisconnectWithError",(function(t){return t(e)}))<=0&&t.logger.error(e)},t.updateSelfUserId=function(e){void 0===e?(t.setObserverId(nn),t._isWritable=!1):(t.setObserverId(e),t._isWritable=!0),t.refreshCursorClass(),t.refreshSyncOperations()},t.onCameraTransform=function(e){Qw.Connected===t._phase&&Bh.Begin===e&&Nw.Follower===t.stateTrigger.state.broadcastState.mode&&(t._isWritable?t.applianceManager.setViewState({mode:Nw.Freedom}):t.roomInput.viewStateObserver.overrideWithFreedom(!0))},t.onCameraUpdated=function(){if(t._isWritable)switch(t.stateTrigger.state.broadcastState.mode){case Nw.Broadcaster:case Nw.Freedom:t.syncCameraToRemoteLimiter.invoke()}},t.syncCameraToRemote=function(){var e=t.viewsHub.writableView;if(t._isWritable&&e){var n=e.screen,r=n.visionRectangle,i=n.camera.scale*Mk(t.screenType);t.applianceManager.setViewState({originX:r.originX,originY:r.originY,width:r.width,height:r.height,pixelWidth:i})}},t.updateSession=function(e){t.logger.context=s(s({},t.logger.context),{},{session:e})},t.onPhaseChanged=function(e){t.logger.info("change room phase to "+e),e===Ys.Disconnected&&t.dispose();var n=Qw.Connecting;switch(e){case Ys.Ready:case Ys.Connecting:n=Qw.Connecting;break;case Ys.Connected:n=Qw.Connected;break;case Ys.Reconnecting:n=Qw.Reconnecting;break;case Ys.Disconnecting:n=Qw.Disconnecting;break;case Ys.Disconnected:n=Qw.Disconnected}switch(n){case Qw.Reconnecting:t.beginReconnectAt=Date.now();break;case Qw.Connected:t.beginReconnectAt=0}var r=t._phase!==n;t._phase=n,t.refreshSyncOperations(),r&&t.callbacks.dispatch("onPhaseChanged",(function(e){return e(n)}))},t.floatBarDelegate=t.createFloatBarDelegate(),t.statistics=e.qualityComitters&&new OS(e.qualityComitters),t.rejectWhenReadonlyErrorLevel=e.rejectWhenReadonlyErrorLevel||Kw.ThrowError,t.magix=e.akkoApp.createMagix({logger:t.logger,userPayload:e.userPayload,libraryNodeFetcher:t.libraryNodeFetcher,callbacks:{onPhaseChanged:t.onPhaseChanged,onDisconnectWithError:t.onDisconnectWithError,onModified:t.onModified,onSelfUserIdUpdate:t.updateSelfUserId,onSessionChanged:t.updateSession,onEventFire:function(e){return t.dispatchMagixEventWithObject(e)},onReconnected:t.onReconnected,onKickedWithReason:function(e){return t.callbacks.dispatch("onKickedWithReason",(function(t){return t(e)}))},onCatchErrorWhenAppendFrame:function(e,n){t.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(t){return t(e,n)}))},onSliceChanged:function(e){return t.callbacks.dispatch("onSliceChanged",(function(t){return t(e)}))},onReceivedRttReport:t.statistics&&function(e){return t.statistics.commitStatistics({rtt:e})},onIllusionQueueLengthChanged:t.statistics&&function(e){t.statistics.commitStatistics({illusionQueueLength:e})},onFrameReceivedInterval:t.statistics&&function(e){t.statistics.commitStatistics({frameReceivedInterval:e})}}}),t.eventsQueue=new ES(t.logger,75,(function(e,n){return t.magix.dispatch(e,n)})),t._disableDeviceInputs=e.disableDeviceInputs,t._disableEraseImage=e.disableEraseImage,t.syncCameraToRemoteLimiter=new We(100,t.syncCameraToRemote),t.undoStack=new Bk({execute:function(e){return t.applianceManager.execute(e)},onCanUndoStepsUpdate:function(e){return t.callbacks.dispatch("onCanUndoStepsUpdate",(function(t){return t(e)}))},onCanRedoStepsUpdate:function(e){return t.callbacks.dispatch("onCanRedoStepsUpdate",(function(t){return t(e)}))}}),t.hotKeys=new xk(e.hotKeys),t.floatBarOptions=e.floatBarOptions,t}return O(a,[{key:"customInput",get:function(){return this.roomInput.customInput}},{key:"applianceManager",get:function(){return this.magix.trigger}},{key:"isWritable",get:function(){return this.magix.isWritable}},{key:"enableWriteNow",get:function(){return this._enableWriteNow}},{key:"setWritable",value:(r=I(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("set writable "+t),n=this.roomInput.viewStateObserver,!t){e.next=11;break}return e.next=5,this.magix.setWritable(t,this.deviceType);case 5:this.pencilOptions.becomeWritable(this.applianceManager),(r=this.applianceManager.getViewState().mode)!==Nw.Broadcaster&&(i=n.getCurrentMode())!==r&&this.stateTrigger.activeUpdate("broadcastState",(function(){return a.applianceManager.setViewState({mode:i}),n.getBroadcastState()})),n.setReadonlyMode(!1),e.next=14;break;case 11:return n.setReadonlyMode(!0),e.next=14,this.magix.setWritable(t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"disableDeviceInputs",get:function(){return this._disableDeviceInputs},set:function(e){this._disableDeviceInputs=e,this.refreshSyncOperations(),this.refreshCursorClass()}},{key:"disableEraseImage",get:function(){return this._disableEraseImage},set:function(e){this._disableEraseImage=e,this.refreshShouldDisableImageHit()}},{key:"disableSerialization",get:function(){return this._phase!==Qw.Connected||!this.applianceManager.enableExecute},set:function(e){this.isRoomEnableModify()&&(e&&(this.copyBuffer=null),this.applianceManager.setEnableExecute(!e))}},{key:"uuid",get:function(){return this._uuid}},{key:"session",get:function(){return this.magix.session}},{key:"slice",get:function(){return this.magix.slice}},{key:"roomToken",get:function(){return this._roomToken}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.magix.calibrationTimestamp}},{key:"state",get:function(){return this.stateTrigger.state}},{key:"timeDelay",get:function(){return this.magix.timeDelay},set:function(e){this.magix.timeDelay=e}},{key:"setupLibraryNode",value:function(e,t){var n,r=this;this.updateLibraryNode(t),this.roomInput=new MS({deviceType:e,screenType:this.screenType,magix:this.magix,viewsHub:this.viewsHub,cameraObserver:this.cameraObserver,pencilOptions:this.pencilOptions,bezierCurvePainter:this.bezierCurvePainter,convertPointToScene:this.convertPointToScene,onKeyPressed:this.onBoundlessKeyEvent,onReceivedHandMouseEvent:this.onReceivedHandMouseEvent,onCommit:function(e){return r.undoStack.commit(e)}}),this.viewsHub.callbacks.on("onWritableScreenChanged",this.onWritableScreenChanged),this.onWritableScreenChanged(this.viewsHub.writableView);var i=this.roomInput.viewStateObserver,a=this.cameraObserver,o=this.applianceManager;this.stateTrigger=new Pk({useMobXMode:this.useMobXState,disableMaskKey:this.onlyCallbackRemoteStateModify,onStateChanged:this.onRoomStateChanged,propertyGetters:{globalState:function(){return zo(o.getGlobalState())},memberState:function(){return zo(o.getMemberState())},roomMembers:function(){return o.getMemberDisplayers().map(r.covertMemberDisplayerToMember)},sceneState:function(){return r.getCurrentSceneState()},broadcastState:function(){return i.getBroadcastState()},zoomScale:function(){return a.cameraState.scale},cameraState:function(){return a.cameraState}}}),this.invisiblePluginNode.isWatching=!0,this.isEraser=(null===(n=this.stateTrigger.state.memberState)||void 0===n?void 0:n.currentApplianceName)===iw.eraser,this.dynamicPpt.setGlobalState(zo(o.getGlobalState())),this.undoStack.setCurrentScenePath(this.stateTrigger.state.sceneState.scenePath),this.refreshCursorClass(),this.refreshShouldDisableImageHit(),this.refreshSyncOperations()}},{key:"dispose",value:function(){l(S(a.prototype),"dispose",this).call(this),this.roomInput&&this.roomInput.release(),this.stateTrigger&&this.stateTrigger.release()}},{key:"handleHotKey",value:function(e,t){switch(e){case"duplicate":this.duplicate();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"delete":this.delete();break;case"lock":var n=this.sendToApplianceManager(e,t);n&&this.undoStack.commit(n);break;case"changeToSelector":this.setMemberState({currentApplianceName:iw.selector});break;case"changeToClick":this.setMemberState({currentApplianceName:iw.clicker});break;case"changeToLaserPointer":this.setMemberState({currentApplianceName:iw.laserPointer});break;case"changeToPencil":this.setMemberState({currentApplianceName:iw.pencil});break;case"changeToRectangle":this.setMemberState({currentApplianceName:iw.rectangle});break;case"changeToEllipse":this.setMemberState({currentApplianceName:iw.ellipse});break;case"changeToEraser":this.setMemberState({currentApplianceName:iw.eraser});break;case"changeToText":this.setMemberState({currentApplianceName:iw.text});break;case"changeToStraight":this.setMemberState({currentApplianceName:iw.straight});break;case"changeToArrow":this.setMemberState({currentApplianceName:iw.arrow});break;case"changeToHand":this.setMemberState({currentApplianceName:iw.hand})}}},{key:"sendToApplianceManager",value:function(e,t){var n=null,r={kind:e};switch(t.kind){case Oc.KeyDown:n=this.applianceManager.onKeyDown(r);break;case Oc.KeyUp:n=this.applianceManager.onKeyUp(r)}return n}},{key:"willInterruptEvent",value:function(e){if(e instanceof KeyboardEvent){var t=!1;return this.callbacks.dispatch("willInterceptKeyboardEvent",(function(n){n(e)&&(t=!0)})),this.releaseAllTextareaByEsc(e),t}return!1}},{key:"refreshSyncOperations",value:function(){var e=!this._isWritable||this._phase===Qw.Reconnecting||this._phase===Qw.Disconnecting||this._phase===Qw.Disconnected,t=e||this._disableDeviceInputs;this.hasLibraryNode&&(this.viewsHub.putState({disableBoundlessEvent:t}),this.dynamicPpt.setDisableInteractive(t)),this._enableWriteNow!==e&&(this._enableWriteNow=e,this.callbacks.dispatch("onEnableWriteNowChanged",(function(t){return t(e)})))}},{key:"connect",value:(n=I(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),e.prev=1,void 0!==(i=NS(t.userPayload))&&(this.logger.context=s(s({},this.logger.context),{},{userId:i})),this._uuid=t.uuid,this._roomToken=t.roomToken,this.pencilOptions=new $w(t.enableDrawPoint,t.disableNewPencil,this.undoStack),e.next=6,this.magix.connect({uuid:t.uuid,region:t.region||nk.defaultRegion,roomToken:t.roomToken,connectedPayload:t.deviceType,isWritable:t.isWritable});case 6:a=e.sent,o=a.libraryNode,c=a.statistics,this.logger.context=s(s({},this.logger.context),{},{session:this.magix.session}),this.setupLibraryNode(t.deviceType,o),this.magix.isWritable&&this.updateSelfUserId(this.magix.selfUserId),this._isWritable||this.roomInput.viewStateObserver.setReadonlyMode(!0),this._isWritable&&this.pencilOptions.becomeWritable(this.applianceManager),null!==(r=this.statistics)&&void 0!==r&&r.commitConnection(s(s({},c),{},{isReconnection:!1})),this.logger.info("join room success"),this.fetchNextPptSlideIfNeeded(this.state.sceneState),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),null!==(u=this.statistics)&&void 0!==u&&u.commitDisconnection({isReconnection:!1,duration:Date.now()-n}),this.logger.error("join room fail"),this.logger.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return n.apply(this,arguments)})},{key:"onScreenSizeUpdated",value:function(){this.stateTrigger.state.broadcastState.mode!==Nw.Follower&&this.syncCameraToRemoteLimiter.invoke()}},{key:"syncBlockTimestamp",value:function(e){this.magix.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.magix.stopBlockTimestamp()}},{key:"dispatchMagixEvent",value:function(e,t){this.isRoomEnableModify()&&this.eventsQueue.dispatch(e,t)}},{key:"disconnect",value:(t=I(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._phase!==Qw.Disconnected){e.next=2;break}throw new Error("room did disconnect");case 2:return e.next=4,this.magix.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"memberState",value:function(e){return zo(this.magix.trigger.getMemberState(e))}},{key:"setGlobalState",value:function(e){var t=this;return this.isRoomEnableModify()?this.stateTrigger.activeUpdate("globalState",(function(){var n=zo(t.applianceManager.setGlobalState(e));return t.dynamicPpt.setGlobalState(AS(n)),n})):this.stateTrigger.state.globalState}},{key:"setMemberState",value:function(e){var t=this;if(this.isRoomEnableModify()){var n;e.currentApplianceName&&(null!==(n=this.viewsHub.writableView)&&void 0!==n&&n.cancelCurrentContinuityEvent(),this.beforeSceneChangeStoreCommit());var r=this.stateTrigger.activeUpdate("memberState",(function(){var n=t.applianceManager.setMemberStateWithCommitter(e),r=n.memberState,i=n.committer;return i&&t.undoStack.commit(i),zo(r)}));return this.refreshCursorClass(),r}return this.stateTrigger.state.memberState}},{key:"setViewMode",value:function(e){var t=this;this.assertRoomIsConnected();var n=this.roomInput.viewStateObserver;if(this._isWritable)this.stateTrigger.activeUpdate("broadcastState",(function(){return t.applianceManager.setViewState({mode:e}),n.getBroadcastState()})),e===Nw.Follower&&n.refreshCameraRectangle();else switch(e){case Nw.Follower:n.overrideWithFreedom(!1),n.refreshCameraRectangle();break;case Nw.Freedom:n.overrideWithFreedom(!0);break;case Nw.Broadcaster:throw new Error("cannot be broadcaster when room.isWritable is false")}}},{key:"nextPpt",value:function(){var e=this.stateTrigger.state.sceneState,t=e.scenes,n=e.index;n<t.length-1&&this.setSceneIndex(n+1)}},{key:"previousPpt",value:function(){var e=this.stateTrigger.state.sceneState.index;e>=1&&this.setSceneIndex(e-1)}},{key:"pptJumpTo",value:function(e,t){var n="".concat(e,"/").concat(t,".slide"),r=this.state.sceneState.scenes.findIndex((function(e){return!!e.ppt&&e.ppt.src.endsWith(n)}));r>0&&this.setSceneIndex(r)}},{key:"updatePptPageInfo",value:function(){var e=this.stateTrigger.state.sceneState,t=e.scenes[e.index],n=t.ppt&&t.ppt.src,r=n&&this.dynamicPpt.getSlideUrl&&this.dynamicPpt.getSlideUrl(n);r&&this.setGlobalState(AS(this.dynamicPpt.globalStateWith({uuid:r.uuid,pageIndex:r.index,disableAutoPlay:!1})))}},{key:"setScenePath",value:function(e){var t=this;if(this.isRoomEnableModify()){this.logger.info("change scene path ".concat(e));var n=this.applianceManager,r=this.scenePathType(e),i=e;if(r===ow.Dir){var a=zo(n.getSceneNames(uw.parse(e))).shift();i=void 0===a?i:[i,a].join("/")}this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){return n.changeScene(uw.parse(i)),t.undoStack.setCurrentScenePath(i),t.getCurrentSceneState()})),this.updatePptPageInfo()}}},{key:"setSceneIndex",value:function(e){var t=this;if(this.isRoomEnableModify()){var n=this.stateTrigger.state.sceneState.scenes[e];if(!n)throw new Error("index ".concat(e," is out of range"));var r=this.applianceManager,i=C(r.getCurrentScenePath());i.pop(),i.push(n.name),this.logger.info("change scene index ".concat(e," /").concat(i.join("/"))),this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){r.changeScene(i);var e=t.getCurrentSceneState();return t.undoStack.setCurrentScenePath(e.scenePath),e})),this.updatePptPageInfo()}}},{key:"moveCamera",value:function(e){var t=this;this.assertRoomIsConnected(),this._isWritable&&"number"==typeof e.scale?this.stateTrigger.activeUpdate("zoomScale",(function(){return l(S(a.prototype),"moveCamera",t).call(t,e),e.scale})):l(S(a.prototype),"moveCamera",this).call(this,e)}},{key:"moveCameraToContain",value:function(e){var t=this;this.assertRoomIsConnected();var n=this.viewsHub.writableView;this._isWritable&&n?this.stateTrigger.activeUpdate("zoomScale",(function(){return l(S(a.prototype),"moveCameraToContain",t).call(t,e),n.screen.camera.scale})):l(S(a.prototype),"moveCameraToContain",this).call(this,e)}},{key:"putScenes",value:function(e,t,n){var r=this;if(this.isRoomEnableModify()){var i,a=[],o=E(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;void 0!==s.name?a.push(s):a.push({name:(0,Jw.v1)().replace(/-/g,""),ppt:s.ppt})}}catch(e){o.e(e)}finally{o.f()}this.stateTrigger.activeUpdate("sceneState",(function(){return r.applianceManager.putScenes(uw.parse(e),a,n),r.getCurrentSceneState()}))}}},{key:"cleanCurrentScene",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isRoomEnableModify()){var t=this.applianceManager.cleanCurrentScene(e);t&&this.undoStack.commit(t)}}},{key:"removeScenes",value:function(e){var t=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return t.applianceManager.removeScenes(uw.parse(e)),t.getCurrentSceneState()}))}},{key:"moveScene",value:function(e,t){var n=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return n.applianceManager.moveScene(uw.parse(e),uw.parse(t)),n.getCurrentSceneState()}))}},{key:"createWrappedComponents",value:function(){return[].concat(C(l(S(a.prototype),"createWrappedComponents",this).call(this)),[fw(dw,this)])}},{key:"createPluginOperator",value:function(){var e=this;return Object.freeze(s(s({},l(S(a.prototype),"createPluginOperator",this).call(this)),{},{remove:function(t){return e.removePlugin(t)},update:function(t,n){return e.updatePlugin(t,n)},getPlugin:function(t){return e.applianceManager.getPlugin(t)}}))}},{key:"insertImage",value:function(e){this.isRoomEnableModify()&&this.applianceManager.insertImage(e)}},{key:"completeImageUpload",value:function(e,t){if(this.isRoomEnableModify()){var n=this.applianceManager.completeImageUpload(e,t);n&&this.undoStack.commit(n)}}},{key:"lockImage",value:function(e,t){this.isRoomEnableModify()&&this.applianceManager.lockImage(e,t)}},{key:"createInvisiblePlugin",value:function(e,t){return this.invisiblePluginNode.create(e,t)}},{key:"insertPlugin",value:function(e,t){if(this.isRoomEnableModify()){var n=t,r=n&&n.attributes,i=this.assignAttributes(e,r);return i!==r&&(n=s(s({},n),{},{attributes:i})),this.applianceManager.insertPlugin(e,n).identifier}return""}},{key:"removePlugin",value:function(e){var t=!1;return this.isRoomEnableModify()&&(t=!!this.applianceManager.removePlugin(e)),t}},{key:"updatePlugin",value:function(e,t){var n=!1;return this.isRoomEnableModify()&&(n=!!this.applianceManager.updatePlugin(e,t)),n}},{key:"getPluginAttributes",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&t.attributes}},{key:"getPluginRectangle",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&{originX:t.originX,originY:t.originY,width:t.width,height:t.height}}},{key:"duplicate",value:function(){if(this.isRoomEnableModify()){var e=12*(2*Math.random()-1),t=12*(2*Math.random()-1),n=this.applianceManager.duplicate(e,t);n&&this.undoStack.commit(n)}}},{key:"copy",value:function(){this.isRoomEnableModify()&&(this.copyBuffer=this.applianceManager.copy())}},{key:"paste",value:function(){if(this.isRoomEnableModify()&&this.copyBuffer){var e=12*(2*Math.random()-1),t=12*(2*Math.random()-1),n=this.applianceManager.paste(this.copyBuffer,e,t);n&&this.undoStack.commit(n)}}},{key:"canUndoSteps",get:function(){return this.undoStack.canUndoSteps}},{key:"canRedoSteps",get:function(){return this.undoStack.canRedoSteps}},{key:"undo",value:function(){return this.isRoomEnableModify()&&(this.applianceManager.hasEditingTextarea()&&this.beforeSceneChangeStoreCommit(),this.undoStack.undo()),this.undoStack.canUndoSteps}},{key:"redo",value:function(){return this.isRoomEnableModify()&&this.undoStack.redo(),this.undoStack.canRedoSteps}},{key:"delete",value:function(){if(this.isRoomEnableModify()){var e=this.applianceManager.delete();e&&this.undoStack.commit(e)}}},{key:"pptNextStep",value:function(){this.isRoomEnableModify()&&this.pptMoveStep(1)}},{key:"pptPreviousStep",value:function(){this.isRoomEnableModify()&&this.pptMoveStep(-1)}},{key:"pptMoveStep",value:function(e){var t=this.stateTrigger.state.sceneState,n=t.scenes,r=t.index,i=n[r],a=i.ppt&&i.ppt.src;if(a&&this.dynamicPpt.getSlideUrl(a))this.dynamicPpt.moveStep(e);else{var o=r+e;o>=0&&o<n.length&&this.setSceneIndex(o)}}},{key:"refreshCursorClass",value:function(){var e=this.stateTrigger.state.memberState;this.magix.isWritable&&!this._disableDeviceInputs&&e?this.viewsHub.putState({cursorClass:"cursor-"+e.currentApplianceName}):this.viewsHub.putState({cursorClass:null})}},{key:"refreshShouldDisableImageHit",value:function(){this.viewsHub.putState({disalbeImageHit:this._disableEraseImage&&this.isEraser})}},{key:"isRoomEnableModify",value:function(){if(this.assertRoomIsConnected(),this._isWritable)return!0;switch(this.rejectWhenReadonlyErrorLevel){case Kw.ThrowError:throw new Error("you can only call it when room is writable");case Kw.Warn:this.logger.warn("you can only call it when room is writable")}return!1}},{key:"createFloatBarDelegate",value:function(){var e=this;return Object.freeze({delete:function(){return e.delete()},lockImages:function(t){return e.applianceManager.lockImages(t)},moveSelectedComponentsToTop:function(){return e.applianceManager.moveSelectedComponentsToTop()},moveSelectedComponentsToBottom:function(){return e.applianceManager.moveSelectedComponentsToBottom()},duplicate:function(){return e.duplicate()},updateTextareaFormat:function(t){if(e.textareaHub){var n=e.textareaHub.getTextareaSizeMap(t),r=e.applianceManager.updateTextareaFormat(t,n);r&&e.undoStack.commit(r)}},updateTextareaFontSize:function(t){var n=e.applianceManager.updateTextareaFontSize(t);n&&e.undoStack.commit(n)}})}},{key:"assertRoomIsConnected",value:function(){if(this._phase!==Qw.Connected)throw new Error("you can only call it when room is connected. the phase of room is "+this._phase)}},{key:"beforeSceneChangeStoreCommit",value:function(){var e=this.applianceManager.releaseAllTextarea();e&&this.undoStack.commit(e)}},{key:"releaseAllTextareaByEsc",value:function(e){if("Escape"===e.code){var t=this.applianceManager.releaseAllTextarea();t&&this.undoStack.commit(t)}}}]),a}(qw);(LS=RS||(RS={})).WaitingFirstFrame="waitingFirstFrame",LS.Playing="playing",LS.Pause="pause",LS.Stopped="stop",LS.Ended="ended",LS.Buffering="buffering",function(e){e.Directory="directory",e.Freedom="freedom"}(jS||(jS={}));var zS=W(n("Pzfo")),FS=new Date("2019-06-23Z00:00:00").getTime(),BS=function(e){m(r,e);var t,n=y(r);function r(e){var t;return M(this,r),(t=n.call(this,{logger:e.logger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,disableOthersSelectingBox:e.disableOthersSelectingBox,disableCameraTransform:e.disableCameraTransform,useMultiViews:e.useMultiViews,disableOperations:!0,willHideSelfCursor:!1,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,urlInterrupter:e.urlInterrupter,pptParams:e.pptParams,callbacks:r.handleLegacyCallbacks(e.callbacks)})).didLoadFirstFrame=!1,t.observerMode=jS.Directory,t.onLibraryNodeChanged=function(e,n){var r=t.hasLibraryNode;if(t.updateLibraryNode(n),!r){var i,a=k(t),o=a.applianceManager,s=a.cameraObserver;t.viewStateObserver=new kS(t.viewsHub,o),t.stateTrigger=new Pk({useMobXMode:t.useMobXState,disableMaskKey:t.onlyCallbackRemoteStateModify,onStateChanged:t.onPlayerStateChanged,propertyGetters:{observerMode:function(){return t.observerMode},globalState:function(){return zo(o.getGlobalState())},roomMembers:function(){return o.getMemberDisplayers().map(t.covertMemberDisplayerToMember)},sceneState:function(){return t.getCurrentSceneState()},cameraState:function(){return s.cameraState}}}),t.useMultiViews&&(null===(i=t.mainView)||void 0===i||i.callbacks.on("onCameraTransform",t.onCameraTransform))}},t.onPhaseChanged=function(e){var n=!1;!t.didLoadFirstFrame&&t.hasFrameToDisplay(e)&&(t.didLoadFirstFrame=!0,n=!0,t.fetchNextPptSlideIfNeeded(t.state.sceneState),t.setupAfterLoadFirstFrame()),t.updatePhaseByReconstructorPhase(t.reconstructor.phase)&&(t.logger.info("change player phase to "+t._phase),t.callbacks.dispatch("onPhaseChanged",(function(e){return e(t._phase)})),t.dynamicPpt&&t.dynamicPpt.replayPasue&&t.dynamicPpt.replayPasue(t._phase!==RS.Playing)),n&&t.callbacks.dispatch("onLoadFirstFrame",(function(e){return e()})),t.invisiblePluginNode.isWatching=t._phase===RS.Playing||t._phase===RS.Pause},t.onPlayerStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(AS(e.globalState)),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onPlayerStateChanged",(function(t){return t(e)}))},t.onSliceChanged=function(e){t.logger.context=s(s({},t.logger.context),{},{slice:e&&e.uuid}),t.refreshForcePPTLandscapeWithSlice(e),t.callbacks.dispatch("onSliceChanged",(function(t){return t(e.uuid)}))},t.onCameraTransform=function(e){e===Bh.Begin&&t.observerMode===jS.Directory&&(t.observerMode=jS.Freedom)},t.onModified=function(){t.viewStateObserver&&t.observerMode===jS.Directory&&t.viewStateObserver.refreshCameraRectangle(),t.refreshRender()},t.callbacks.on("onProgressTimeChanged",(function(e){return t.putPlayerState({timestamp:e})})),t}return O(r,[{key:"applianceManager",get:function(){return this.reconstructor.trigger}},{key:"playbackSpeed",get:function(){return this.reconstructor.playbackSpeed},set:function(e){this.reconstructor.playbackSpeed=e,this.putPlayerState({playbackSpeed:e})}},{key:"setupReconstructor",value:(t=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.akkoApp.createReconstructor({logger:this.logger,roomToken:t.roomToken,clientVersion:nk.sdkVersion,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:this.createReconstructorCallbacks(),rangeQuery:{region:t.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration}});case 3:this.reconstructor=e.sent,this.updatePhaseByReconstructorPhase(this.reconstructor.phase),this.logger.info("setup player success"),this.logger.context=s(s({},this.logger.context),{},{uuid:this.reconstructor.roomUUID,slice:this.reconstructor.slice&&this.reconstructor.slice.uuid}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),this.logger.error("setup player fail"),this.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return t.apply(this,arguments)})},{key:"createReconstructorCallbacks",value:function(){var e=this;return{onEventFire:function(t){return e.dispatchMagixEventWithObject(t)},onSliceChanged:this.onSliceChanged,onLibraryNodeChanged:this.onLibraryNodeChanged,onPhaseChanged:this.onPhaseChanged,onModified:this.onModified,onIsPlayableChanged:function(t){return e.callbacks.dispatch("onIsPlayableChanged",(function(e){return e(t)}))},onProgressTimeChanged:function(t){return e.callbacks.dispatch("onProgressTimeChanged",(function(e){return e(t)}))},onStoppedWithError:function(t){return e.callbacks.dispatch("onStoppedWithError",(function(e){return e(t)}))},onCatchErrorWhenAppendFrame:function(t,n){e.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(e){return e(t,n)}))}}}},{key:"hasFrameToDisplay",value:function(e){switch(e){case nc.Playing:case nc.Pause:case nc.Buffering:case nc.Ended:return!0;default:return!1}}},{key:"setupAfterLoadFirstFrame",value:function(){this.reconstructor.slice&&this.refreshForcePPTLandscapeWithSlice(this.reconstructor.slice),this.dynamicPpt.setGlobalState(zo(this.applianceManager.getGlobalState()))}},{key:"dispose",value:function(){var e;l(S(r.prototype),"dispose",this).call(this),this.viewStateObserver&&this.viewStateObserver.release(),this.stateTrigger&&this.stateTrigger.release(),this.useMultiViews&&(null===(e=this.mainView)||void 0===e||e.callbacks.on("onCameraTransform",this.onCameraTransform))}},{key:"createWrappedComponents",value:function(){return[].concat(C(l(S(r.prototype),"createWrappedComponents",this).call(this)),[fw(pw,this)])}},{key:"refreshForcePPTLandscapeWithSlice",value:function(e){e.beginTimestamp<=FS?this.viewsHub.putState({forcePPTLandscape:!0}):this.viewsHub.putState({forcePPTLandscape:!1})}},{key:"setObserverMode",value:function(e){var t=this;this.stateTrigger.activeUpdate("observerMode",(function(){return t.observerMode=e})),this.viewStateObserver&&e===jS.Directory&&this.viewStateObserver.refreshCameraRectangle()}},{key:"memberState",value:function(e){return zo(this.reconstructor.trigger.getMemberState(e))}},{key:"state",get:function(){if(!this.hasLibraryNode)throw new Error("can't read state before load first frame");return this.stateTrigger.state}},{key:"roomUUID",get:function(){return this.reconstructor.roomUUID}},{key:"slice",get:function(){return this.reconstructor.slice&&this.reconstructor.slice.uuid}},{key:"isPlayable",get:function(){return this.reconstructor.isPlayable}},{key:"phase",get:function(){return this._phase}},{key:"progressTime",get:function(){return this.reconstructor.progressTime}},{key:"timeDuration",get:function(){return this.reconstructor.duration}},{key:"framesCount",get:function(){return this.reconstructor.framesCount}},{key:"beginTimestamp",get:function(){return this.reconstructor.beginTimestamp}},{key:"play",value:function(){this.assertRoomIsConnected(),this.reconstructor.play()}},{key:"pause",value:function(){this.assertRoomIsConnected(),this.reconstructor.pause()}},{key:"stop",value:function(){if(this._phase===RS.Stopped)throw new Error("player did stop");this.reconstructor.stop(),this.dispose()}},{key:"seekToProgressTime",value:function(e){this.assertRoomIsConnected(),this.reconstructor.seekToProgressTime(e)}},{key:"updatePhaseByReconstructorPhase",value:function(e){var t=r.covertPhase(e),n=this._phase!==t;return n&&(this._phase=t,this.putPlayerState({isPlaying:t===RS.Playing})),n}},{key:"scheduleTime",get:function(){return console.warn("scheduleTime was deprecated. please replace it with progressTime"),this.progressTime}},{key:"seekToScheduleTime",value:function(e){console.warn("seekToScheduleTime was deprecated. please replace it with seekToProgressTime"),this.seekToProgressTime(e)}},{key:"assertRoomIsConnected",value:function(){if(this._phase===RS.Stopped)throw new Error("you cannot call it when phase of player is stopped")}}],[{key:"handleLegacyCallbacks",value:function(e){var t=e;return t&&t.onScheduleTimeChanged&&(console.warn("onScheduleTimeChanged was deprecated. please replace it with onProgressTimeChanged"),delete(t=s(s({},t),{},{onProgressTimeChanged:t.onScheduleTimeChanged})).onScheduleTimeChanged),t}},{key:"covertPhase",value:function(e){switch(e){case nc.WaitingFirstFrame:return RS.WaitingFirstFrame;case nc.Playing:return RS.Playing;case nc.Pause:return RS.Pause;case nc.Stopped:return RS.Stopped;case nc.Ended:return RS.Ended;case nc.Buffering:case nc.Seeking:return RS.Buffering;default:throw new Error("invalid phase ".concat(e))}}}]),r}(qw);H([zS.observable],BS.prototype,"observerMode",2);var US=W(n("q1tI")),VS=W(n("q1tI")),WS=W(n("NbXW")),HS={"arrow-down-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",check:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIG9wYWNpdHk9Ii4wMSIgZD0iTTAgMGg4djhIMHoiLz48cGF0aCBkPSJNNy4xMjUgMS40ODRoLS41NDZhLjI0OS4yNDkgMCAwIDAtLjE5Ni4wOTZMMy4xNjIgNS42NiAxLjYxNyAzLjcwM2EuMjUuMjUgMCAwIDAtLjE5Ni0uMDk1SC44NzVhLjA2Mi4wNjIgMCAwIDAtLjA1LjFsMi4xNCAyLjcxMmEuMjUuMjUgMCAwIDAgLjM5NCAwbDMuODE1LTQuODM2YS4wNjIuMDYyIDAgMCAwLS4wNDktLjF6Ii8+PC9zdmc+",delete:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","easer-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg==","easer-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgrSURBVHgB7ZprTBRXFIDP7gIt8lQppTwE5V0KaAn6o1pqNGkDDTEmTUhsgKRp+gNJw68CFkLbVC2QkDS+gD8KJdWmARvbFBNNWpuIRGPFWBXQRMPDqIki+KLATs+ZnTvcvXtnX8w2beJJToaduTP3fHPOPffcOwC8kP+2WCDwIvahGFxTuN8KmNSZmULPNjLeqF9F8rdPkIEGEn+r+vjx46LQ0NA8/Dsader58+e/h4WFDWntFO7ot6fMFAt3JLWi2lCDpqamCux2+2+KROj82NhYGrXT2lu5Z/DP/deFByElA4Pv3LlTiHY/nJ6eVnbv3q1s2bJFyc7OVrZu3arU1dUp4+PjxPUQoT+g9tp9PkMFgpo9kxljHRoaWp2Xl3duYmIiurKyEvDoclNCQgIcPnxYPc7MzHwcGRnZhaft4Ag7O9fUbRhaITCie4lgcnNzT7qDIaHz27dvh+vXr0NEREQneqoCHKFnAR+8ZCaQGGq2CxcurCGYycnJZHcwTNAzUFFRoUJFRUV1IFQ5OKBsXB9uxSwgl0TQ3d29Yt26dccwoyVXV1d7hGEiQmGi2AzOUHx/hob4K2yuYS9G987s7OwPISEh7xPM6dOnwVfBsIMjR45AZmbmo5s3b76Xnp7+J55egMVxBSAZT0v1ED+76yn66dOnLQSzd+9ev2BIyFP0MjBco1JTU/sxfFeDazp3cYgZHmKqdoaGNISHh9fv378fSJcqlPV6e3sBJ+I/goOD34VFL0k95Y+HxPHCYGxmw5DQ2NuzZw8EBQVtunXr1jvgwUP+hhz/QDXMMCNVE8zx48dNg2FCz6QQjI2N/RA8VBFmANnu3btXihnpG8pM9fX1EAi5du0aeWkVOAMBCF7yN+R0z4yOjq6NiYlpp9CgdBtIwXpPH6vgDKWLt0CygtM6MDCwBuUYZSKaOCksAiVY9wFOBePgDOOytPAGSKzNVCCC2bBhw69YdK7ypgpYimzbtk2dl7CM+hFcveOUHDylbTFO1YdhFbByx44dA1QFUP0VSJj4+Hjo6+sDq9U6iEmHKvFZTedQ50GYbN15SITVlwNlZWUnLRZL8s6dOwMOQ9UCTtKTra2ttdppt9V2kMF5cbmsjxuM43bMNrmUzc6fP6+GQiDGDoOJi4ubwb4qm5ubafyIE6nLxGqTPEsGo1cBOGNX0TyDYafC0CyOaxcVziyh53Z2dkJycvLMvn37PmpoaBgFR4jxYSbWdVIgI89Iq4CjR48CZjlYv369+tssqI6ODsjPz4f+/v668vLycxrEHHfkYdwC8SB6mGEV8Cl64cuuri5oa2tTG+EyGjZu3AiXLl1qefDgwV8lJSUFZkDV1tZCcXExXLx4sbWoqKgPFj0zx8GI9ZwO5W4M6ekZYeqpaqbqmaSqqkpNpcPDw4dwzfM9nrLduHEjEs+X0XV/Sx96LnqE1kLtBQUF3eDwCO8dGQyzV5rl+JyuegfXI29jRotiRlKnpFghHMzKyjqotVXS0tLacKPjF3bdHxjSq1evduAkepAD+ZsDYlC8V5w8ZBVg+PPq2MGMlkInqE4joTf45MmT4YyMjAPcA+ltLSQlJX2BafxnX6HI29QeK44TOTk57mCYZ0QoJ8OBM4yB6dkNkwGlSygsLFQvYtYB3BTMxFL+M+0eFgZqp4mJiU2+QKGX1fGIk/QIrn0aYXGsyDxjmAyMhO2jhaCGoUbX1NSkLSwsPMJqV8Fspu6lIZS6OYhjiOLwdU7fQM1HfRPD7wS1obZ0j0xpb4726Z49ezaJf2/S7s9ATUGNR41BjdJseRnke3WGwhrRTS9pD1mOGoeG15BxOOfoxuCkp0Ih6NeaEaSZGlieJyiCoc1FgsGldokGk8nBvAKOrWIGQ5uPsm0tt0BWDiicAaGuGhkZ+YqMw9StGzU4OKhCnT179hNsswY1FTXdE5QEJhc1S3tGogazXLOBwQSBl3tzIhQPtAL1VQJCTcNx8y1vHIUghSKFZE9PT7H2dlM1b+Wgrr1y5Uq77J75+fnplpaWMg2ch4nlYEI5z7hdensDpI4hrYNErcMMXJ32koG4ztf3pultz83NjWG99Ra2WQ0OL2VjZjwgeufUqVOqV8+cOdPIwdBLSNJeHg8TAh5WqJ6EfSmgt7IMNRJ1JThiOlnrOAMHshprmMKdoGSCpb9s3B3SYLIFGIqICJB7xisYi+RvfiypXw40DWGdlJaWRmMd141hk8V2OWm7ieYTXhBc3+BgaZyqAISjOYxSMVvXsBTNlzdiNQDgRao2AtK3pjggpmrqbGpqSsLPIN/dv38/gaBwUjTshMHcvn27JyUlpRmc5xpPMD599LIYnLNyUKKndKjGxsakXbt2deMCLIE8IVvs0YRM1fjdu3d/wrXN5+BcnzEgvor2uN3rjzAYMp5lPEoQlE5fA0fWo8GfhlCbKVFQ1pKNIfzcOHH58mWqaimVUwJI0+6n59D4pIlzmdZPMPiZzXjDjX47Le5g0Uu8x2zgPqWyKpjVe7x3+AUbq9NYjQbgp2dsBud5o8TP7d5kHAWcQchQfoEmLgn8HjOiBIF7o5hI1x6CEbLNP3bdqYAF44JzyWLzcN1i8DcT/o3awbm8Fz3DAy2A62INwPV/E3wWdx5inmBHuwChCBD6R2JwHge80TIQRQLjt7e8DTkGZgfX8cUMZTDAteFDkveaIlzjX9ySQs8X18r2t2VHUURPKoICmDR+eCO9aSdmOIub3/w9RgpgUpiJhvraXpa6jZKHGEqyusw0GLFzX+5RhN/8kYnMSNMMfyH/V/kHST6OYVElTPAAAAAASUVORK5CYII=","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-size-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","font-size":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","hand-grasp":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTExLjcyIDE0LjM0NEg0Ljk3OGMtLjUxMyAwLS45MzEtLjQ3My0uOTMxLTEuMDU1IDAtLjQ0Mi0uMS0uNzQ0LS4zMzQtMS4wMUwuNDQ2IDguNzQxLjQ0NCA4Ljc0QTEuNzkgMS43OSAwIDAgMSAwIDcuNTU0VjQuODc4QzAgMy45OC42NDUgMy4yNSAxLjQzNyAzLjI1Yy4zOTQgMCAuNzU5LjE3NiAxLjAyOC40OTUuMDkyLjExLjE3LjIzMS4yMzIuMzYzVjIuMjAyYzAtLjg5OC42NDUtMS42MjggMS40MzctMS42MjguNTcgMCAxLjA1NC4zNjcgMS4yODcuOTEzLjA1OC0uMzYuMjEtLjY5Mi40NDMtLjk1NUExLjUwNiAxLjUwNiAwIDAgMSA3IDBhLjguOCAwIDAgMSAuMTc0LjAxNWMuNjMyLjA4IDEuMTQyLjU3OSAxLjM0MSAxLjI1LjItLjYyNi43My0xLjA3NCAxLjM1LTEuMDc0LjEgMCAuMTkzLjAxMy4yOC4wMjdsLjAxNS4wMDNjLjY2Mi4xNTYgMS4xNDMuODQzIDEuMTQzIDEuNjM1di4zM2MuMjQ0LS41MDQuNzE3LS44NDggMS4yNi0uODQ4LjM5NCAwIC43NTkuMTc2IDEuMDI4LjQ5NC4yNjQuMzEyLjQwOS43MjguNDA5IDEuMTd2Mi45NGMwIC4zNTItLjAzOC42ODYtLjExNC45OTNsLTEuMTM4IDUuMjEtLjAwMS4wMDRhMy41MyAzLjUzIDAgMCAwLS4wOTYuODQxdi4yOTljMCAuNTgyLS40MTcgMS4wNTUtLjkzIDEuMDU1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Im0xLjAyNCA4LjM5OSAzLjE1MiAzLjQxMi4wMDIuMDAyYy4zMi4zNjMuNDY4LjguNDY4IDEuMzc0IDAgLjI0OC4xODUuNDU3LjQwNC40NTdoNi41MDdjLjIxOCAwIC40MDMtLjIxLjQwMy0uNDU3VjEyLjljMC0uMzQuMDM3LS42NjIuMTEtLjk1OWwxLjA5OC01LjAyNlY2LjkxYTMuMzcgMy4zNyAwIDAgMCAuMDkzLS44MTJWMy4yNjJjMC0uNTg2LS4zOTEtMS4wNDUtLjg5MS0xLjA0NS0uNDkyIDAtLjg5MS40NTMtLjg5MSAxLjAxdi42NWgtLjgyVjIuMTU1YzAtLjQ5Ni0uMjk1LS45MjYtLjcwMS0xLjAyNS0uMDY2LS4wMS0uMTMtLjAyLS4xOTEtLjAyLS40OTEgMC0uODkxLjQ1My0uODkxIDEuMDF2MS43NTdoLS44MlYyLjE5YzAtLjY1MS0uNDA4LTEuMTktLjk0OC0xLjI1NEw3LjA5Ni45MzQgNy4wODUuOTMyYy0uMDI3LS4wMDYtLjA1LS4wMDYtLjA4My0uMDA2LS41ODEgMC0xLjA1NC41MzYtMS4wNTQgMS4xOTV2MS43NTZoLS44MlYyLjUyNGMwLS41ODYtLjM5Mi0xLjA0NC0uODkxLTEuMDQ0LS40OTIgMC0uODkyLjQ1My0uODkyIDEuMDF2NS41OTJsLS44Mi0uODcyVjUuMTA2YzAtLjU4Ni0uMzkxLTEuMDQ1LS44OS0xLjA0NS0uNDkzIDAtLjg5Mi40NTMtLjg5MiAxLjAxdjIuNTgzYzAgLjI3NC4xLjUzOC4yOC43NDV6IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTUuNTY2IDYuMDgydjQuNjM2YzAgLjE5LjIyMy4zNDQuNS4zNDQuMjc2IDAgLjUtLjE1NC41LS4zNDRWNi4wODJjMC0uMTktLjIyNC0uMzQ0LS41LS4zNDQtLjI3NyAwLS41LjE1NC0uNS4zNDR6bTIuMTggMHY0LjYzNmMwIC4xOS4yMjQuMzQ0LjUuMzQ0cy41LS4xNTQuNS0uMzQ0VjYuMDgyYzAtLjE5LS4yMjQtLjM0NC0uNS0uMzQ0cy0uNS4xNTQtLjUuMzQ0em0yLjE4IDB2NC42MzZjMCAuMTkuMjI0LjM0NC41LjM0NHMuNS0uMTU0LjUtLjM0NFY2LjA4MmMwLS4xOS0uMjI0LS4zNDQtLjUtLjM0NHMtLjUuMTU0LS41LjM0NHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","hand-loosen":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTkuMTU0IDBBMS4yMjYgMS4yMjYgMCAwIDAgOC4xMS42MDdjLS4yMDguMzQ4LS4yOTUuNzY4LS4zNDUgMS4yMzItLjEuOTI5LS4wMjUgMi4wNTgtLjAxNCAzLjA0Ni4wMDcuNTEyLjAwNCAxLjA0MS0uMDAxIDEuNTQ3YTYzLjMxIDYzLjMxIDAgMCAxLS4zNS0uOXYtLjAwM2wtLjAwMS0uMDAxYy0uMzU5LS45MjYtLjY5Mi0xLjg3LTEuMTUtMi41NjItLjIzLS4zNDYtLjQ5Ni0uNjQtLjg1LS44MDctLjM1Ni0uMTY2LS43OTItLjE2NS0xLjIwNC4wMmwtLjAwMy4wMDEtLjAwNC4wMDJjLS40LjE4Ny0uNjUuNTYzLS43MjIuOTU4LS4wNzQuMzk0LS4wMTkuODEyLjA4MiAxLjI2Mi4yMDMuOS42MTMgMS45NC44OTIgMi45Ny4yMi44MTMuNDM0IDEuNjMyLjYxMyAyLjMyMmExMy44NTUgMTMuODU1IDAgMCAwLS44NzQtLjgxNmMtLjU0My0uNDYyLTEuMTQtLjg4OS0xLjc1Ny0xLjExOS0uNjE2LS4yMy0xLjMyMy0uMjQ0LTEuODQ1LjIxOGwtLjAwNC4wMDQtLjAwNC4wMDRjLS40MS4zODQtLjYxNC44Ni0uNTYgMS4zMjMuMDUzLjQ2NC4zMDcuODcxLjY0MiAxLjI5LjY2OS44MzYgMS43MiAxLjc1MSAyLjczNCAyLjk2OCAxLjEzNSAxLjM2MiAyLjM3MiAzLjUzOCAzLjI1MSA0LjY4MWwuMTE4LjE1M2g3LjcwNGwuMDg2LS4yNzRjLjE1LS40ODIuMzE4LTEuNDQyLjU4Ny0yLjY0Mi4yNjgtMS4yLjYyNy0yLjYxIDEuMTA0LTMuODQ3LjYzNS0xLjY0NiAxLjI4NS0zLjE5NCAxLjU3Ny00LjQyMy4xNDctLjYxNC4yMTQtMS4xNTEuMDk1LTEuNjI2YTEuMzA2IDEuMzA2IDAgMCAwLTEuMDQ4LS45NmMtLjQ2Ny0uMDg4LS45MS4xMi0xLjIyLjQzNC0uMzEuMzE2LS41NDYuNzM2LS43NjUgMS4yMDctLjE3LjM2NS0uMzI3Ljc2NS0uNDgxIDEuMTY2bC0uMDEtMS43MzRjLS4wMDQtMS4wMDcuMDU5LTIuMTM2LS4wMTctMy4wNDQtLjAzOC0uNDU1LS4xMDMtLjg1NS0uMjcyLTEuMTkxLS4xNjUtLjMyNy0uNTI0LS42LS45MjUtLjU4NWExLjE4IDEuMTggMCAwIDAtLjk2OS40NmMtLjIyMy4yODUtLjM1NC42MzYtLjQ1OSAxLjAyMy0uMjEuNzczLS4zMDIgMS43MDktLjQ0MyAyLjQ4bC0uMTk1IDEuMDkyYTQ1Ljg3NCA0NS44NzQgMCAwIDEtLjEzNi0xLjE4N2MtLjA5NC0uOTM3LS4xNi0yLjA1NS0uMzU2LTIuOTctLjA5Ny0uNDU3LS4yMjItLjg2Ni0uNDM1LTEuMTk5LS4yMTQtLjMzMi0uNTgyLS41OTctMS4wMS0uNTc5aC4wM0w5LjE1NSAweiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik05LjE1Ljc4NGguMDQ5Yy4xMzItLjAwNS4xOTUuMDMuMzE3LjIyLjEyMy4xOTIuMjQxLjUyOC4zMjkuOTM5LjE3NS44Mi4yNDUgMS45MjQuMzQyIDIuODg0LjIxMiAyLjEwOC41MTQgMy42MzUuNTE0IDMuNjM1bC43Ny0uMDEzcy4yODctMS43NjMuNTk4LTMuNDYzYy4xNS0uODIuMjQ3LTEuNzQ2LjQyOS0yLjQxNy4wOS0uMzM1LjIwNy0uNi4zMTktLjc0My4xMTItLjE0Mi4xNjktLjE3NC4zMTktLjE2M2wuMDMuMDAyLjAyOC0uMDAyYy4xMi0uMDA5LjExNi0uMDEuMi4xNTYuMDg0LjE2Ny4xNTcuNDk1LjE5MS45MDMuMDY4LjgxNS4wMSAxLjk0Mi4wMTUgMi45ODNsLjAxOSAzLjcwNS43NDUuMTY4Yy40NTUtLjk0OC44MTktMi4xMTIgMS4yMjEtMi45NzguMjAxLS40MzMuNDE1LS43ODcuNjEzLS45ODguMTk3LS4yLjMyMy0uMjUuNTE2LS4yMTNoLjAwNGwuMDA1LjAwMmMuMjk5LjA1MS4zNi4xMjcuNDI0LjM3OC4wNjMuMjUuMDM1LjY5Ny0uMDk3IDEuMjU0LS4yNjUgMS4xMTUtLjkwNyAyLjY2NC0xLjU0NiA0LjMyMi0uNTAyIDEuMy0uODY2IDIuNzQtMS4xMzggMy45NTctLjIyLjk4My0uMzg3IDEuODM0LS40OTkgMi4zMDRINy4xNDRjLS44MDItMS4wOS0xLjk5Ny0zLjE2LTMuMTU3LTQuNTUyLTEuMDYtMS4yNzEtMi4xMzYtMi4yMi0yLjcyNC0yLjk1Ni0uMjk0LS4zNjgtLjQ1LS42NzMtLjQ3Ni0uODktLjAyNS0uMjE1LjAyNi0uMzg2LjMxMi0uNjU2LjI3LS4yMzcuNTgyLS4yNDMgMS4wNDktLjA2OS40NjcuMTc1IDEuMDE4LjU1MiAxLjUyNC45ODJhMTUuODggMTUuODggMCAwIDEgMS44NDcgMS45MDRsLjY4Ny0uMzRzLS41MDQtMi4wMS0xLjAxLTMuODcyQzQuOTAzIDYuMDggNC40OTQgNS4wMyA0LjMxNCA0LjIzYy0uMDktLjQtLjExNi0uNzMzLS4wNzctLjk0Ny4wNC0uMjEzLjA5Ny0uMzAyLjI4My0uMzkuMjQ4LS4xMS4zODgtLjA5OC41NDctLjAyNC4xNTkuMDc0LjM0NC4yNTEuNTI5LjUzLjM2OC41NTcuNzEgMS40NzYgMS4wNzMgMi40MTJsLS4wMDItLjAwNGMuMzcuOTgzIDEuMDc4IDIuNzE0IDEuMDc4IDIuNzE0bC43NTUtLjEzN3MuMDU1LTEuOTEuMDM2LTMuNTA5Yy0uMDEyLTEuMDE4LS4wNzgtMi4xMzYuMDEtMi45NTIuMDQzLS40MDguMTMxLS43MzUuMjM4LS45MTUuMTA3LS4xNzkuMTctLjIyNS4zNjctLjIyNHoiIGZpbGw9IiNGRkYiLz48cGF0aCBkPSJNNy43MjMgMTAuOHY0LjY5MmMwIC4xOTIuMjIzLjM0OC41LjM0OC4yNzYgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OC0uMjc3IDAtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OHMuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OHMtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OC4yNzcgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjIzLS4zNDgtLjUtLjM0OC0uMjc2IDAtLjUuMTU2LS41LjM0OHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","laser-pointer-cursor":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGZpbHRlciB4PSItMTIwJSIgeT0iLTEyMCUiIHdpZHRoPSIzNDAlIiBoZWlnaHQ9IjM0MCUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImEiPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQiIGluPSJTb3VyY2VHcmFwaGljIi8+PC9maWx0ZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkgOSkiIGZpbGw9IiNGRjAxMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWx0ZXI9InVybCgjYSkiIGN4PSI1IiBjeT0iNSIgcj0iNSIvPjxwYXRoIGQ9Ik01IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2em0wLTEuNzE0YTEuMjg2IDEuMjg2IDAgMSAxIDAtMi41NzIgMS4yODYgMS4yODYgMCAwIDEgMCAyLjU3MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","lock-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM3RDdEN0QiLz48L2c+PC9zdmc+","lock-new-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM1QjkwOEUiLz48L2c+PC9zdmc+",lock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiLz48L3N2Zz4=","pencil-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII=","pencil-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYISURBVHgB7ZpNSCtXFIBPEuvz+dMGpYUKD/sWFX+Qti6kK7Hqpm6e9q0rIoIUFUShPLV10VZx4+JZqa9v20LBhdq9fyBUCtKNPH8qYl2IOw3G38Rkek4y15y5uTOZJDOWggcOSSYzN/ebc+45554JwIM8iBCPyTEP+86T4vyMfsRN4b+nQTKIJp0vzuGvlpID7os8EQNEIBD4oKio6Bm9DwaDv/v9/n/076JgbtWUYPchwrW8qD7UnOvr6wFNkpubm+/wu7f0c7y6mrnlvQufxB0Iau7V1dX3BDA/P6/V1dVpzc3N2uLiIofK1c8VYHys/wRKBUN3/hGHqaysNOjc3FwMis6hc0FtLTHuvYLxCCZgci8uLn4wg5Gh6Fy8Jk+/NkcCAlAAuUkoW4g0B+d5tLS05O/r67O8eGxsDNra2uDy8nKsoKCAwCIQDxQa0yTxgrvCYXyTk5Ml+Orf2dlJeeHIyAigFSE/P38ELfUNqNdSkjgF5FF89jL1TU1NlQwODl5gZPujp6cHWltbUw7Koc7Pz8mkZpHPFeFrJuZeqLnoMoPoZqe0JjDP/IZgnyLUG/o8NDRkuo5Ua2pjY6MC4oFCFf1cA0oKzRSOp6enRfTaGh0d/QxBt+1CUVgnOTs7+xrHfQzGyOcKkK3QTJMnQffZ6e/v/xwttmsHqqmpKXbdycnJCxy7ABLh3FEgVZ6hZJhnFZoFFMF0d3c/w7v+dyookXBnZ2c/xvHfhriVcvXfdBRItsxjnOhYqjwjoAimq6vrCysoGofk+Ph4Esd/F/UdiFtJAGUd2DygTpp5dmBUUJ2dnc9VUALm8PDwJY7/BPU9VD8k3M4RC6kskxZMKigKIMLN9vf3p3H8DyWgfEhEOwOQD9IXOTz7EObbwsLC4YWFBRgeHrY9ECXYo6MjaGlpKWlsbPxkYGDgRW1tbSEWquVlZWXBzc3Nl1VVVa8hXiXc6ioqBqGaPDk7AACJTRZ3NS9lcUp86cJwoSQ7Pj4Op6enfxUXF3/V0NCQv7q6GsCvwrqGUG/01xAD4+VQTOxaSF43d5bBOisrGBJRCtXX17+/trb268rKSgASFgmz97KFkmo6OztWuVyPweiWGc4WRkhFRQVEIpHg8vJyQAIQVlLBROVxvBYQHsXnO8tk62ZcyN0wecLBwcEvYHSzEPscBqOLCRhLC4n9uqaA8UAWAcAKhtbQ3t7eTHl5+Y9gtAp3twhT056CDMQ7MRzIFTeTYKb1yYYVQFH9VdzsqNmYKpfTJBDX3Ixgdnd3XyHMT2AMALJlBBSPaMpNngrIsTyTCgaj288YDGakictrxizvKFNOjgSSBLS+vv6UYHDb7DgMVgsChjTEgCIKGG4ZU+EWkgNBzN1qamq+pAMTExPgFMzW1tZrhHkFyWE5KxgSszx0527RaDRmOSpRshEOU11dPQPG8CwHARHJlMnTSrwSRFIlfXt7m3V5ngJGuJtqzaQtZkFBVNJezN5ZAdmwjKo2k9tVtrcI3OXk4tPgcg7ChCDZ1URgMOu72Xa5VFHOkymQhWVU60YVmjN6wiC7k6p+S1syCACOwJBYFaexV+yhBekNPsMBO6KAEeE4BMaCU67RsoYhSbXgaT//ht709vZCaWmp6YkEbLFmVJWzas04+iBL7EKpm0J7duqu0B7+CTUpNJuyvb1NCfMj1CqI9wLKUOlOUMeG+gGFkHii4HizUF4z/KFUrPsJ8WbEIyx7nnZ0dDynME6BAuce09iFHo+GrnmGltltb2//E4wVAN82y7vOjKOZXSBhJdHNiT3TYWD8OY2PTUJkdd7MkJMnT5wZVQF2RFX6yBMUdzPMvvfqxz3sXHF+GNT9ANXit/10O1sgHkZvdQAOKvs9B5L7ARELGAAXLSTvM8QExTE+YbHe+HURhZp1aRyF4CJXClbbWwGketgkW9VsY+YaiBCVhfgE+XvxRwgZSM4jUVCDZFQ9pytmXR8hUTB2gnidx4XffVWydN0yQjwmx/jkAZJBrIBI5J7ZvQGZWUgVSuU/EqmOAzicKNMVu816DdRWUV1/7xAP8n+SfwF3Du3NF2sYhwAAAABJRU5ErkJggg==",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","selector-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC","selector-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAZoSURBVHgB7VlLSCRXFL3ljNEhEXTGhMQJmOjCz8ZNVLKICz9xIYhCNi7UgINkGEk2En8hW5cBUQNxo05GAoKikuCAmvGzGMdPcCUGjDPxD/4Vv/3JvWW97luvq7ur+hMZ8MKlqrteNfe8e965970GuLVbC5kpJr53+hjHx9yY3TUxJgLMAQG4ITARfp5T4Mri4uL9q6urnxwOxz/oY5eXl1/Pzs7e195X2FX4jZsIhAK7gx5ps9m6nGj9/f3OtbU1pzAE0318fPwVjYHrrN7R3AjU/wpOBwA9Cmf/9ejoqDMtLU31iooKGdA+ATo4OMiXAEWAHhBAGEApXj4rPAik0vPt7e0vCgoKPH4gMzMTSktLIS8vD2JiYgABvcHMTZyennbHxsaOg3udOJmLzwqEYB0ZgRCZENm4u7e39yQuLq65srISZmZmvP5Ybm4u5OfnQ0lJyXWUCAgzNLS+vt6SnJz8WgvYwV5xSlcRgyVg3ha2Dkxzc3MvfZmVlQW+bGxsDBobGyE7O1u94uJPjIqKqklKSvrbbrfPnp+ff7e8vJwMnlSTKWfJjDKhywJo6wLp0YcZ+dyIUr7s4cOHLsrRlQwBTSBFuzc2NiZYhjjVAIyzZBqEwgCQv0OOM/gNzuiP/ijlDxBRjgClpqa6AF1cXDydmpoaLCws3JcAGYHyC4JMzoKaibKysvienp6FtrY2IA/WCFB5ebkqCHSvARo8Ozt7igIxwIJ2gJ+seFMnDoIyEUV+dHT0G3qWVUr5M043DdAB0m2IKZwAYpgZX+qkywR6NFbuR0iDxmAoZRUQKRxSLTMnJ8eIaqqSeVMnIYUOdu+sq6vrp4f+VCoYo8khZaNs01VRlERUu2/BrWAA7sl2Anink1Ao18JGjyY/PDx8hq1GZqgp5c2mp6chMjLy2b179x7hRzvoqeUUwXIzqq4O5nZsNUaEbIbLqPLTou/s7FTvT05OpsA9sXJG1AVsZDwjutqBIN6gUlWjxod8XRBNKXgsrqpqYZfwEqX9h8TExD7wbFm8LmzxHQ0QHSlXKZVSqFC/hkqlaKapTaGgCQTK7PHW1lb/wsLC86KiokkccoV+qV1tcE0pO7AWxmhTxBszDzqRr66ujqanp2cRpQLNBgUsCh8BwQ54bn5+/s+mpqa+4eHhfS1gb52vwuP0trPjhSZCBtLQ0NA3MDDQQIFYAUHBYhuvzjpVbJr1lZWVP3p7e19UVVXNgHumXYrI4uBx6Yqevz02b0FcRQ8CoBQF3dXVpQLZ3d39C7n+ora29vfJyclDYFnWgFyxK3cxhss/+KoT/N6DVkQpKypFGUCp3Ozo6HgSHx//GLW/BwHsg57zl5pzADajwLn52mPL1ZHPloMoRYPMFL6EhAR18e7s7MxVV1fPsAAp4Avteq7dC/c1+wKI4g+EfGzDM+EYHBw8RDrNiA2QL6upqVGvKJ2/gHu2L1nA5wwEB2YDfSYMO1x/px0cgEc2zBY+eo67u6H29vZ/wU2VC8l58JxKNjDOgojNEp08aFVfX++3l6JMEdDx8fEB0FNIBsDXBc8ArwuW1EkeI1RKdLWmCx+1DhkZGRvR0dFfSsHKxYtnW0iqvJAN9xNm6MR/QO5sfapUSkqKmqW5ubmfwVgyZdpw/vPZl2kUEAinBMSUStG+gwra0NDQSynQKyloIxnlewafjDFLJzLRBJqiFMnqyMgIbG5uDuD996Dnv8iAPOMAPmbcm5lVJwA/vZRMKZGZlpaWVtAvUL4GZMqE1fjRJrUd76LHoX+InlhcXPwZnWW2tra6jjrpiBM3UK/weQr6J+gfodMh9HtwncG7YLA3CMSsLmxx5WuDCt8B7vZeicInTjCWlpb6wc15mfey7oc9E8LElpVmMgb9AXoC+qcTExOPKRu4NlTHs6Q10GfhgfYOvRsJQZ76BWMKuDtaolQs+gfoH6Mn436gDg+e+5BKXUQx/C5Je/a+NpbeiQJPKgUdlNXx/BCBKxVdxW5Q0I3XBqFKRhU4KLtjYawi3csuTKdc4FnIXNvKUJkVEGRG20QZAAUpA5DbaYAQLmQzfzxyk/ffdnCD4NWVnGdE7kQBQvQHC5lVEDxgMaM29lkxGCNLKrDnIbFAMkFmBIaDkHstU41coGZ1TZD5UjReCGUAYbNgdNqoXZB/T67yYbFAMiGML3BhYeH8rb0t9h/zgcTBcTNGiQAAAABJRU5ErkJggg==","to-bottom-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",unlock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSI4IiBjeT0iOSIgcj0iMSIvPjxyZWN0IHN0cm9rZT0iIzQ0NEU2MCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB4PSIzIiB5PSI2IiB3aWR0aD0iMTAiIGhlaWdodD0iOCIgcng9IjIiLz48cGF0aCBkPSJtNS4yMDQgNC40NDcuMjYtLjk2NmEzIDMgMCAxIDEgNS43OTUgMS41NTNMMTEgNmgwTTggOXYzIiBzdHJva2U9IiM0NDRFNjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4="};function _S(e){return HS[e]}var GS=W(n("q1tI")),YS=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).didUnmount=!1,r.onMouseDown=function(e){if(0===e.button){r.setState({isPressed:!0});document.body.addEventListener("mouseup",(function e(t){0===t.button&&(document.body.removeEventListener("mouseup",e),r.didUnmount||r.setState({isPressed:!1}))}))}},r.state={isHover:!1,isPressed:!1},r}return O(n,[{key:"componentWillUnmount",value:function(){this.didUnmount=!0}},{key:"render",value:function(){var e=this,t=this.props.className;t=void 0!==t?"button "+t:"button",this.props.disable&&(t+=" disable");var n=this.props.refObject;return GS.createElement("div",{className:t,ref:n,onMouseEnter:function(){return e.setState({isHover:!0})},onMouseLeave:function(){return e.setState({isHover:!1})},onMouseDown:this.onMouseDown,onClick:this.props.onClick},this.props.children)}}]),n}(GS.Component),XS=W(n("q1tI")),QS=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).divRef=XS.createRef(),r.onMouseDown=function(e){var t=r.divRef.current,i=e.target;t&&!n.isEventFiredOnElement(i,t)&&(0,r.props.onShouldBecomeHide)(i)},document.body.addEventListener("mousedown",r.onMouseDown),r}return O(n,[{key:"componentWillUnmount",value:function(){document.body.removeEventListener("mousedown",this.onMouseDown)}},{key:"render",value:function(){var e=s(s({},this.props),{},{ref:this.divRef});delete e.onShouldBecomeHide;var t=e.children;return XS.createElement("div",s({},e),t)}}],[{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}}]),n}(XS.Component);function ZS(e){var t=Math.floor(e);return e>=t+.5&&(t+=1),t}var KS=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).inputRef=VS.createRef(),r.upArrowButton=Object.freeze({iconName:"arrow-up",isUp:!0,ref:VS.createRef()}),r.downArrowButton=Object.freeze({iconName:"arrow-down",isUp:!1,ref:VS.createRef()}),r.onFocusInput=function(){var e=r.inputRef.current;e&&(e.type="text",e.setSelectionRange(0,e.value.length),e.type="number",r.setState({isFocusInput:!0}))},r.onShouldBecomeHide=function(e){var t=r.inputRef.current,n=r.upArrowButton.ref.current,i=r.downArrowButton.ref.current;t&&n&&i&&!QS.isEventFiredOnElement(e,n)&&!QS.isEventFiredOnElement(e,i)&&r.commitFontSizeWithString(t.value)},r.onPressKeyInput=function(e){"Enter"===e.key&&r.commitFontSizeWithString(e.target.value)},r.state={overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1},r}return O(n,[{key:"onSelectFontSize",value:function(e){this.commitFontSizeWithInt(e),this.setState({overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1})}},{key:"getFontSize",value:function(){var e,t,n=E(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=ZS(r.currentScale*r.textSize);if(void 0===e)e=i;else if(e!==i){e=void 0;break}}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"shouldUpdateFontSize",value:function(e){var t,n=E(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.currentScale*r.textSize!==e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"commitFontSizeWithString",value:function(e){var t,n=Number.parseFloat(e);Number.isNaN(n)||(n=ZS(n),n=Math.max(n,KS.minFontSize),n=Math.min(n,KS.maxFontSize),this.commitFontSizeWithInt(n),null!==(t=this.inputRef.current)&&void 0!==t&&t.blur(),this.setState({overrideFontSize:void 0,isFocusInput:!1,hoverIndex:void 0}))}},{key:"commitFontSizeWithInt",value:function(e){if(this.shouldUpdateFontSize(e)){var t=this.props,n=t.viewMovingState,r=t.delegate;n.maskHideFloatBarSometime(),r.updateTextareaFontSize(e)}}},{key:"renderMenu",value:function(e){var t=this,n=this.inputRef.current;if(!n)return null;var r,i=KS,a=i.menuMargin,o=i.menuSize,s=o.width,c=o.height,u=this.props.isMenuToDown,l=n.offsetLeft+(n.offsetWidth-s)/2;return r=u?n.offsetTop+n.offsetHeight+a:n.offsetTop-a-c,VS.createElement(QS,{className:"font-size-menu",style:{left:l,top:r,width:s,height:c},onMouseLeave:function(){return t.setState({hoverIndex:void 0})},onShouldBecomeHide:this.onShouldBecomeHide},this.renderFontSizeList(e))}},{key:"renderFontSizeList",value:function(e){for(var t=this,n=parseInt(e,10),r=KS.fontSizeList,i=[],a=function(e){var a=r[e],o=null,s="cell";n===a&&(o=VS.createElement("img",{className:"check",alt:"check",src:_S("check")}));var c=t.state.hoverIndex;e===c&&(s+=" hover"),i.push(VS.createElement("div",{key:"".concat(e),className:s,onMouseEnter:function(){return t.setState({hoverIndex:e})},onClick:function(){return t.onSelectFontSize(a)}},o&&VS.createElement("div",{className:"check"}),VS.createElement("span",null,a),o))},o=0;o<r.length;++o)a(o);return i}},{key:"renderArrowButton",value:function(e,t){var n,r=this,i=Number.parseFloat(e),a=KS.fontSizeList;if(!Number.isNaN(i))if(t.isUp)for(var o=0;o<a.length;++o){var s=a[o];if(s>i){n=s;break}}else for(var c=a.length-1;c>=0;--c){var u=a[c];if(u<i){n=u;break}}var l=t.iconName;return VS.createElement(YS,{className:"arrow-button",disable:void 0===n,refObject:t.ref,onClick:function(){void 0!==n&&(r.props.viewMovingState.maskHideFloatBarSometime(),r.commitFontSizeWithInt(n),r.setState({overrideFontSize:void 0,hoverIndex:void 0}))}},VS.createElement("img",{alt:"icon",src:_S(l)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.overrideFontSize,r=t.isFocusInput,i=n;if(void 0===i){var a=this.getFontSize();i=void 0===a?"":"".concat(a)}return VS.createElement(VS.Fragment,{key:"font-size"},VS.createElement("img",{className:"font-size-icon",alt:"icon",src:_S(r?"font-size-active":"font-size")}),VS.createElement("input",{className:"font-size-input",type:"number",value:i,ref:this.inputRef,onFocus:this.onFocusInput,onKeyUp:this.onPressKeyInput,onChange:function(t){return e.setState({overrideFontSize:t.target.value})}}),r&&this.renderMenu(i),VS.createElement("div",{className:"font-size-buttons"},this.renderArrowButton(i,this.upArrowButton),this.renderArrowButton(i,this.downArrowButton)))}}]),n}(VS.Component);KS.minFontSize=1,KS.maxFontSize=999,KS.fontSizeList=Object.freeze([12,14,18,24,36,48,64,80,144,288]),KS.menuMargin=21,KS.menuSize=Object.freeze({width:64,height:248}),KS=H([WS.observer],KS);var qS=W(n("NbXW")),JS=W(n("q1tI"));function $S(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}var ex=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).onClickDisplayButton=function(){r.state.isDisplayMenu||r.setState({isDisplayMenu:!0})},r.state={isDisplayMenu:!1},r}return O(n,[{key:"onClickColorButton",value:function(e){var t=C(e);this.props.delegate.updateTextareaFormat({color:t}),this.setState({isDisplayMenu:!1})}},{key:"getSelectedColor",value:function(){var e,t=null,n=E(this.props.components);try{for(n.s();!(e=n.n()).done;){var r=e.value.format.color;if(t){if(!$S(t,r)){t=null;break}}else t=r}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"renderMenu",value:function(e){var t,n=this,r=this.props,i=r.isMenuToDown,a=r.colors,o=r.parentWidth,s=r.parentHeight,c=Math.ceil(a.length/ex.menuLineCellsCount),u=Math.min(a.length,ex.menuLineCellsCount)*ex.menuCellSize.width+2*ex.menuPadding,l=c*ex.menuCellSize.height+2*ex.menuPadding,h=ex.menuMargin,d=o-u;return t=i?s+h:-(h+l),JS.createElement(QS,{className:"font-colors-menu",style:{left:d,top:t,width:u,height:l},onShouldBecomeHide:function(){return n.setState({isDisplayMenu:!1})}},this.renderColorButtons(e))}},{key:"renderColorButtons",value:function(e){for(var t=this,n=this.props.colors,r=[],i=function(i){var a=n[i],o="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"),s="font-color-button";e&&$S(e,a)?s+=" font-color-selected":s+=" font-color-not-selected",r.push(JS.createElement("div",{key:"".concat(i),className:s,onClick:function(){return t.onClickColorButton(a)}},JS.createElement("div",{className:"core",style:{backgroundColor:o}})))},a=0;a<n.length;++a)i(a);return r}},{key:"render",value:function(){var e=this.getSelectedColor(),t=e&&JS.createElement("div",{className:"bar",style:{backgroundColor:"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")")}}),n=this.state.isDisplayMenu,r=n?"font-colors-active":"font-colors";return JS.createElement(JS.Fragment,null,JS.createElement(YS,{className:"normal-button",onClick:this.onClickDisplayButton},JS.createElement("div",{className:"font-colors-icon"},JS.createElement("img",{alt:"icon",src:_S(r)}),t)),n&&this.renderMenu(e))}}]),n}(JS.Component);ex.menuMargin=8,ex.menuPadding=8,ex.menuLineCellsCount=4,ex.menuCellSize=Object.freeze({width:28,height:28}),ex=H([qS.observer],ex);var tx=W(n("q1tI")),nx=W(n("NbXW"));var rx=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).buttonRef=tx.createRef(),r.state={isDisplayMenu:!1},r}return O(n,[{key:"renderMenu",value:function(){var e=this,t=this.buttonRef.current;if(!t)return null;var n,r=rx.menuSize,i=r.width,a=r.height,o=rx.menuMargin,s=this.props,c=s.isMenuToDown,u=s.delegate,l=t.offsetLeft+(t.offsetWidth-i)/2;return n=c?t.offsetTop+t.offsetHeight+o:t.offsetTop-o-a,tx.createElement(QS,{className:"image-layer-menu",style:{left:l,top:n,width:i,height:a},onShouldBecomeHide:function(){return e.setState({isDisplayMenu:!1})}},tx.createElement(YS,{key:"layer-unlock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToTop()}},tx.createElement("img",{alt:"icon",src:_S("to-top")})),tx.createElement(YS,{key:"layer-lock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToBottom()}},tx.createElement("img",{alt:"icon",src:_S("to-bottom")})))}},{key:"render",value:function(){var e=this,t=this.state.isDisplayMenu,n=t?"layer-pressed":"layer";return tx.createElement(tx.Fragment,null,tx.createElement(YS,{key:"layer",className:"normal-button ".concat(t?"highlight-button":""),refObject:this.buttonRef,onClick:function(){return e.setState({isDisplayMenu:!t})}},tx.createElement("img",{alt:"icon",src:_S(n)})),t&&this.renderMenu())}}]),n}(tx.Component);rx.menuMargin=21,rx.menuSize=Object.freeze({width:72,height:40}),rx=H([nx.observer],rx);var ix=Object.freeze({top:12,bottom:24,left:12,right:12}),ax=Object.freeze({top:1,bottom:1,left:1,right:1});function ox(e){var t=e.whiteModel,n=t.ImageShape,r=t.TextareaShape,i=[],a=e.components;if(0===a.length)return i;var o,s=0,c=0,u=!0,l=!0,h=!0,d=!0,p=!0,f=E(a);try{for(f.s();!(o=f.n()).done;){var v=o.value;if(Lo(v,n))s+=1;else if(Lo(v,r)){var m=v.format;m.bold||(l=!1),m.italic||(h=!1),m.underline||(d=!1),m.lineThrough||(p=!1),c+=1}v.locked||(u=!1)}}catch(e){f.e(e)}finally{f.f()}var g=40,y=40;return s===a.length?(i.push({width:g,height:y,node:function(){return sx(e)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.delegate,r=!t;return US.createElement(YS,{key:"lock",className:"normal-button",onClick:function(){return n.lockImages(r)}},US.createElement("img",{alt:"lock",src:_S(t?"unlock-new":"lock-new")}))}(e,u)}}),u||i.push(function(e){var t=e.delegate;return{width:40,height:40,node:function(e,n,r,i,a,o){var s=n+i/2<=o/2;return tx.createElement(rx,{key:"image-layer-button",isMenuToDown:s,delegate:t})}}}(e)),i.push({width:g,height:y,node:function(){return function(e){var t=e.delegate;return US.createElement(YS,{key:"duplicate",className:"normal-button",onClick:function(){return t.duplicate()}},US.createElement("img",{alt:"duplicate",src:_S("duplicate")}))}(e)}})):c===a.length&&(i.push({width:g,height:y,node:function(){return sx(e)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return US.createElement(YS,{key:"text-blob",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({bold:i})}},US.createElement("img",{alt:"text-blob",src:_S(t?"bold-active":"bold")}))}(e,l)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return US.createElement(YS,{key:"text-italic",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({italic:i})}},US.createElement("img",{alt:"text-italic",src:_S(t?"italic-active":"italic")}))}(e,h)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return US.createElement(YS,{key:"text-line-through",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({lineThrough:i})}},US.createElement("img",{alt:"text-line-through",src:_S(t?"line-through-active":"line-through")}))}(e,p)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return US.createElement(YS,{key:"text-underline",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({underline:i})}},US.createElement("img",{alt:"text-underline",src:_S(t?"underline-active":"underline")}))}(e,d)}}),i.push(function(e){var t=e.viewMovingState,n=e.delegate,r=e.components;return{width:95,height:40,node:function(e,i,a,o,s,c){var u=i+o/2<=c/2;return VS.createElement(KS,{key:"font-size",delegate:n,viewMovingState:t,components:r,isMenuToDown:u})}}}(e)),i.push(function(e){var t=e.viewMovingState,n=e.delegate,r=e.components,i=e.colors;return{width:40,height:40,node:function(e,a,o,s,c,u){var l=a+s/2<=u/2;return JS.createElement(ex,{key:"font-colors",delegate:n,viewMovingState:t,colors:i,components:r,parentWidth:o,parentHeight:s,isMenuToDown:l})}}}(e))),i}function sx(e){var t=e.delegate,n=e.isEditTextarea;return US.createElement(YS,{key:"delete",className:"normal-button",onClick:function(){return t.delete()},disable:n},US.createElement("img",{alt:"delete",src:_S("delete")}))}var cx=W(n("Pzfo"));function ux(e,t){return Math.abs(e-t)<=.01}var lx,hx=function(){function e(t){var n=this;M(this,e),this.latestCallMaskTimestamp=0,this.timer=null,this._shouldHideFloatBar=!1,this.onAfterMoving=function(){n._shouldHideFloatBar&&(n._shouldHideFloatBar=!1),n.timer=null},this.rectangle=t}return O(e,[{key:"shouldHideFloatBar",get:function(){return this._shouldHideFloatBar}},{key:"setState",value:function(t,n){var r=this.rectangle,i=!ux(r.originX,t.originX)||!ux(r.originY,t.originY),a=!ux(r.width,t.width)||!ux(r.height,t.height);(i||!n&&a)&&(!this._shouldHideFloatBar&&Date.now()>=this.latestCallMaskTimestamp+e.maskDuration&&(this._shouldHideFloatBar=!0),null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onAfterMoving,e.cameraTouchInterval)),(i||a)&&(this.rectangle=t)}},{key:"maskHideFloatBarSometime",value:function(){this.latestCallMaskTimestamp=Date.now()}},{key:"release",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null,this._shouldHideFloatBar=!1)}}],[{key:"isRectangleEquals",value:function(e,t){return e.originX===t.originX&&e.originY===t.originY&&e.width===t.width&&e.height===t.height}}]),e}();hx.cameraTouchInterval=300,hx.maskDuration=100,H([cx.observable],hx.prototype,"_shouldHideFloatBar",2),H([cx.action],hx.prototype,"setState",1),function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right",e[e.Center=4]="Center"}(lx||(lx={}));var dx=function(e){m(n,e);var t=y(n);function n(e){var r;return M(this,n),(r=t.call(this,e)).lockView=function(e){r.setState({lockedPosition:e})},r.state={lockedPosition:void 0},r.viewMovingState=new hx(e.rectangle),r}return O(n,[{key:"componentDidMount",value:function(){var e=this,t=!0;this.disposer=(0,Zk.autorun)((function(){e.viewMovingState.shouldHideFloatBar?t||(e.unlockView(),t=!0):t=!1}))}},{key:"componentDidUpdate",value:function(){var e=this.props.rectangle;this.viewMovingState.setState(e,this.isEditTextarea())}},{key:"componentWillUnmount",value:function(){var e;this.viewMovingState.release(),null===(e=this.disposer)||void 0===e||e.call(this)}},{key:"isEditTextarea",value:function(){var e,t=this.props,n=t.components,r=t.whiteModel.TextareaShape,i=E(n);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(Lo(a,r)&&void 0!==a.editedBy)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"position",value:function(e,t,n){var r,i=e.originX,a=e.originY,o=i+e.width,s=a+e.height,c=ax.left+ax.right,u=ax.top+ax.bottom,l=0,h=E(n);try{for(h.s();!(r=h.n()).done;){var d=r.value,p=d.width,f=d.height;c+=p,l=Math.max(l,f)}}catch(e){h.e(e)}finally{h.f()}u+=l;var v=c+ix.left+ix.right,m=u+ix.top+ix.bottom,g=this.props.screenSize,y=g.width,b=g.height;return{left:i,right:o,top:a,bottom:s,position:a>=m?0:b-s>=m?1:i>=v?2:y-o>=v?3:4,boxWidth:c,boxHeight:u,width:v,height:m}}},{key:"centerXWithTopOrBottom",value:function(e,t){var n=Math.max(e.left,0),r=Math.min(e.right,t),i=e.width/2,a=(n+r)/2;return a-i<0?a=i:a+i>t&&(a=t-i),a}},{key:"render",value:function(){var e=this;return Xk.createElement(mw,null,(function(t){return Xk.createElement(Qk.Observer,null,(function(){return t?e.renderWhenIsRoom(t):null}))}))}},{key:"unlockView",value:function(){this.setState({lockedPosition:void 0})}},{key:"renderWhenIsRoom",value:function(e){var t=this;if(this.viewMovingState.shouldHideFloatBar)return null;var n=this.props,r=n.whiteModel,i=n.components,a=n.screenSize,o=n.rectangle,s=n.cnode,c=this.state.lockedPosition,u=ox({viewMovingState:this.viewMovingState,isEditTextarea:this.isEditTextarea(),whiteModel:r,components:i,delegate:e.floatBarDelegate,colors:e.floatBarOptions.colors});if(u.length<=0)return null;var l,h,d=c||this.position(o,e,u),p=a.width,f=a.height;switch(d.position){case 0:l=this.centerXWithTopOrBottom(d,p),h=d.top-d.height/2;break;case 1:l=this.centerXWithTopOrBottom(d,p),h=d.bottom+d.height/2;break;case 2:l=d.left-d.width/2,h=Math.max(d.top,0)+d.height/2;break;case 3:l=d.right+d.width/2,h=Math.max(d.top,0)+d.height/2;break;case 4:l=(Math.max(d.left,0)+Math.min(d.right,p))/2,h=Math.max(d.top,0)+d.height/2}var v,m=l-d.width/2,g=h-d.height/2,y="translate(".concat(m,"px,").concat(g,"px)"),b=[],k=m,w=E(u);try{for(w.s();!(v=w.n()).done;){var S=v.value,x=S.width,I=(0,S.node)(k,g,d.boxWidth,d.boxHeight,p,f);b.push(I),k+=x}}catch(e){w.e(e)}finally{w.f()}return Xk.createElement(qu,{context:s,className:"float-bar",onMouseEnter:function(){return t.lockView(d)},style:{WebkitTransform:y,transform:y,width:d.boxWidth,height:d.boxHeight,padding:0,marginLeft:ix.left,marginRight:ix.right,marginTop:ix.top,marginBottom:ix.bottom}},b)}}],[{key:"willInterruptEvent",value:function(){return!0}}]),n}(Xk.Component);function px(e){var t;return"boolean"==typeof e?t=e?Object.freeze({colors:fx()}):void 0:e&&(t=Object.freeze({colors:fx(e.colors)})),t}function fx(e){return e?Object.freeze(e.map((function(e){return Object.freeze(C(e))}))):vx}dx=H([Qk.observer],dx);var vx=Object.freeze([Object.freeze([224,32,32]),Object.freeze([250,100,0]),Object.freeze([247,181,0]),Object.freeze([109,212,0]),Object.freeze([68,215,182]),Object.freeze([50,197,255]),Object.freeze([0,145,255]),Object.freeze([98,54,255]),Object.freeze([182,32,224]),Object.freeze([109,114,120]),Object.freeze([0,0,0]),Object.freeze([255,255,255])]),mx=Object.defineProperty,gx=Object.defineProperties,yx=Object.getOwnPropertyDescriptors,bx=Object.getOwnPropertySymbols,kx=Object.prototype.hasOwnProperty,wx=Object.prototype.propertyIsEnumerable,Sx=function(e,t,n){return t in e?mx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},xx=function(e,t){for(var n in t||(t={}))kx.call(t,n)&&Sx(e,n,t[n]);if(bx){var r,i=E(bx(t));try{for(i.s();!(r=i.n()).done;){n=r.value;wx.call(t,n)&&Sx(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Ix=function(e,t){return gx(e,yx(t))},Cx=function(){function e(t,n,r){M(this,e),this.argusEncoder=t,this.resourceURL=n,this.timestampKey=r}var t,n,r;return O(e,[{key:"report",value:(r=I(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this.convertToBody(n),a=this.argusEncoder.encode(r,i),e.logQueue.append(a),1===e.logQueue.length&&this.sendLog().catch((function(e){console.warn(e)}));case 2:case"end":return t.stop()}}),t,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"sendLog",value:(n=I(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.logQueue.next)){t.next=15;break}return t.prev=2,t.next=5,this.request(n,3);case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),console.warn(t.t0);case 10:return t.prev=10,e.logQueue.done(),t.finish(10);case 13:t.next=16;break;case 15:return t.abrupt("break",18);case 16:t.next=0;break;case 18:case"end":return t.stop()}}),t,this,[[2,7,10,13]])}))),function(){return n.apply(this,arguments)})},{key:"request",value:(t=I(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=1;case 1:if(!(r<=n)){e.next=18;break}return e.prev=2,e.next=5,window.fetch(this.resourceURL,{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 5:if((i=e.sent).ok){e.next=8;break}throw new Error("report log failed, request status code ".concat(i.status));case 8:return e.abrupt("break",18);case 11:if(e.prev=11,e.t0=e.catch(2),r!==n){e.next=15;break}throw new Error("report log failed (with ".concat(n," times failed), error: ").concat(e.t0));case 15:r++,e.next=1;break;case 18:case"end":return e.stop()}}),e,this,[[2,11]])}))),function(e,n){return t.apply(this,arguments)})},{key:"convertToBody",value:function(e){var t=e.timestamp,n=e.logObject,r={};for(var i in void 0!==this.timestampKey&&(r[this.timestampKey]="".concat(t)),n)r[i]="".concat(n[i]);return r}}]),e}();Cx.logQueue=new Nc;var Px,Mx=function(){function e(t){M(this,e),this.events=t.events,this.argusEncoder=new Ac(t.events,t.vid),this.reporter=new Cx(this.argusEncoder,t.reportResourceURL,t.timestampKey),this.logger=new Sc({prefix:t.prefix,levelMask:t.printLevelMask}),this.reportLevelMaskIndex=wc[t.reportLevelMask||"info"]}return O(e,[{key:"commit",value:function(e,t){this.reportLogNode(e,{timestamp:Date.now(),logObject:xx({},t)})}},{key:"log",value:function(e,t,n,r){if(this.logger.log(e,t,n),wc[t]>=this.reportLevelMaskIndex){var i={timestamp:Date.now(),logObject:Ix(xx({},r),{level:t,message:n})};this.reportLogNode(e,i)}}},{key:"isSupportedEvents",value:function(e){return e in this.events}},{key:"reportLogNode",value:function(e,t){this.reporter.report(t,e).catch((function(e){console.warn(e)}))}}]),e}(),Tx=W(n("VDtp")),Ox=Tx.Reader,Ex=Tx.Writer,Ax=Tx.util,Nx=Tx.roots.default||(Tx.roots.default={}),Rx=Nx.WhiteBoardPlayer=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=Ax.Long?Ax.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.region="",e.prototype.slice="",e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ex.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(18).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),null!=e.slice&&Object.hasOwnProperty.call(e,"slice")&&t.uint32(34).string(e.slice),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(42).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(50).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(58).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(66).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(74).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(82).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(90).string(e.os),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(98).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(106).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(114).string(e.message),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(130).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ox||(e=Ox.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Nx.WhiteBoardPlayer;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.uuid=e.string();break;case 3:r.region=e.string();break;case 4:r.slice=e.string();break;case 5:r.team=e.string();break;case 6:r.app=e.string();break;case 7:r.akkoVersion=e.string();break;case 8:r.sdkVersion=e.string();break;case 9:r.nativeVersion=e.string();break;case 10:r.platform=e.string();break;case 11:r.os=e.string();break;case 12:r.createdAt=e.string();break;case 13:r.level=e.string();break;case 14:r.message=e.string();break;case 15:r.vid=e.int32();break;case 16:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof Ox||(e=new Ox(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=R(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||Ax.isInteger(e.lts)||e.lts&&Ax.isInteger(e.lts.low)&&Ax.isInteger(e.lts.high)?null!=e.uuid&&e.hasOwnProperty("uuid")&&!Ax.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ax.isString(e.region)?"region: string expected":null!=e.slice&&e.hasOwnProperty("slice")&&!Ax.isString(e.slice)?"slice: string expected":null!=e.team&&e.hasOwnProperty("team")&&!Ax.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!Ax.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!Ax.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ax.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!Ax.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!Ax.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!Ax.isString(e.os)?"os: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!Ax.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!Ax.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!Ax.isString(e.message)?"message: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!Ax.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!Ax.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof Nx.WhiteBoardPlayer)return e;var t=new Nx.WhiteBoardPlayer;return null!=e.lts&&(Ax.Long?(t.lts=Ax.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==R(e.lts)&&(t.lts=new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.slice&&(t.slice=String(e.slice)),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ax.Long){var r=new Ax.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.uuid="",n.region="",n.slice="",n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.createdAt="",n.level="",n.message="",n.vid=0,n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?Ax.Long.prototype.toString.call(e.lts):t.longs===Number?new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.slice&&e.hasOwnProperty("slice")&&(n.slice=e.slice),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Tx.util.toJSONOptions)},e}(),Lx=Nx.WhiteBoardQualityConnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=Ax.Long?Ax.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.isReconnection="",e.prototype.retryCount="",e.prototype.buildWebSocketDuration="",e.prototype.buildMagixDuration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ex.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(114).string(e.isReconnection),null!=e.retryCount&&Object.hasOwnProperty.call(e,"retryCount")&&t.uint32(122).string(e.retryCount),null!=e.buildWebSocketDuration&&Object.hasOwnProperty.call(e,"buildWebSocketDuration")&&t.uint32(130).string(e.buildWebSocketDuration),null!=e.buildMagixDuration&&Object.hasOwnProperty.call(e,"buildMagixDuration")&&t.uint32(138).string(e.buildMagixDuration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(146).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(152).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(162).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ox||(e=Ox.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Nx.WhiteBoardQualityConnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.isReconnection=e.string();break;case 15:r.retryCount=e.string();break;case 16:r.buildWebSocketDuration=e.string();break;case 17:r.buildMagixDuration=e.string();break;case 18:r.createdAt=e.string();break;case 19:r.vid=e.int32();break;case 20:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof Ox||(e=new Ox(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=R(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||Ax.isInteger(e.lts)||e.lts&&Ax.isInteger(e.lts.low)&&Ax.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!Ax.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!Ax.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!Ax.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ax.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!Ax.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!Ax.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!Ax.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!Ax.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!Ax.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ax.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!Ax.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!Ax.isString(e.session)?"session: string expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!Ax.isString(e.isReconnection)?"isReconnection: string expected":null!=e.retryCount&&e.hasOwnProperty("retryCount")&&!Ax.isString(e.retryCount)?"retryCount: string expected":null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&!Ax.isString(e.buildWebSocketDuration)?"buildWebSocketDuration: string expected":null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&!Ax.isString(e.buildMagixDuration)?"buildMagixDuration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!Ax.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!Ax.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!Ax.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof Nx.WhiteBoardQualityConnection)return e;var t=new Nx.WhiteBoardQualityConnection;return null!=e.lts&&(Ax.Long?(t.lts=Ax.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==R(e.lts)&&(t.lts=new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.retryCount&&(t.retryCount=String(e.retryCount)),null!=e.buildWebSocketDuration&&(t.buildWebSocketDuration=String(e.buildWebSocketDuration)),null!=e.buildMagixDuration&&(t.buildMagixDuration=String(e.buildMagixDuration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ax.Long){var r=new Ax.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.isReconnection="",n.retryCount="",n.buildWebSocketDuration="",n.buildMagixDuration="",n.createdAt="",n.vid=0,n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?Ax.Long.prototype.toString.call(e.lts):t.longs===Number?new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.retryCount&&e.hasOwnProperty("retryCount")&&(n.retryCount=e.retryCount),null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&(n.buildWebSocketDuration=e.buildWebSocketDuration),null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&(n.buildMagixDuration=e.buildMagixDuration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Tx.util.toJSONOptions)},e}(),jx=Nx.WhiteBoardQualityDisconnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=Ax.Long?Ax.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.duration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.isReconnection="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ex.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.duration&&Object.hasOwnProperty.call(e,"duration")&&t.uint32(122).string(e.duration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(130).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(136).int32(e.vid),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(146).string(e.isReconnection),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(154).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ox||(e=Ox.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Nx.WhiteBoardQualityDisconnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 15:r.duration=e.string();break;case 16:r.createdAt=e.string();break;case 17:r.vid=e.int32();break;case 18:r.isReconnection=e.string();break;case 19:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof Ox||(e=new Ox(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=R(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||Ax.isInteger(e.lts)||e.lts&&Ax.isInteger(e.lts.low)&&Ax.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!Ax.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!Ax.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!Ax.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ax.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!Ax.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!Ax.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!Ax.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!Ax.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!Ax.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ax.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!Ax.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!Ax.isString(e.session)?"session: string expected":null!=e.duration&&e.hasOwnProperty("duration")&&!Ax.isString(e.duration)?"duration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!Ax.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!Ax.isInteger(e.vid)?"vid: integer expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!Ax.isString(e.isReconnection)?"isReconnection: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!Ax.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof Nx.WhiteBoardQualityDisconnection)return e;var t=new Nx.WhiteBoardQualityDisconnection;return null!=e.lts&&(Ax.Long?(t.lts=Ax.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==R(e.lts)&&(t.lts=new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.duration&&(t.duration=String(e.duration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ax.Long){var r=new Ax.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.duration="",n.createdAt="",n.vid=0,n.isReconnection="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?Ax.Long.prototype.toString.call(e.lts):t.longs===Number?new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.duration&&e.hasOwnProperty("duration")&&(n.duration=e.duration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Tx.util.toJSONOptions)},e}(),Dx=Nx.WhiteBoardQualitySample=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=Ax.Long?Ax.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.maxRTT="",e.prototype.minRTT="",e.prototype.averageRTT="",e.prototype.maxQueue="",e.prototype.minQueue="",e.prototype.averageQueue="",e.prototype.maxInterval="",e.prototype.minInterval="",e.prototype.averageInterval="",e.prototype.vid=0,e.prototype.createdAt="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ex.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.maxRTT&&Object.hasOwnProperty.call(e,"maxRTT")&&t.uint32(114).string(e.maxRTT),null!=e.minRTT&&Object.hasOwnProperty.call(e,"minRTT")&&t.uint32(122).string(e.minRTT),null!=e.averageRTT&&Object.hasOwnProperty.call(e,"averageRTT")&&t.uint32(130).string(e.averageRTT),null!=e.maxQueue&&Object.hasOwnProperty.call(e,"maxQueue")&&t.uint32(138).string(e.maxQueue),null!=e.minQueue&&Object.hasOwnProperty.call(e,"minQueue")&&t.uint32(146).string(e.minQueue),null!=e.averageQueue&&Object.hasOwnProperty.call(e,"averageQueue")&&t.uint32(154).string(e.averageQueue),null!=e.maxInterval&&Object.hasOwnProperty.call(e,"maxInterval")&&t.uint32(162).string(e.maxInterval),null!=e.minInterval&&Object.hasOwnProperty.call(e,"minInterval")&&t.uint32(170).string(e.minInterval),null!=e.averageInterval&&Object.hasOwnProperty.call(e,"averageInterval")&&t.uint32(178).string(e.averageInterval),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(184).int32(e.vid),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(194).string(e.createdAt),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(202).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ox||(e=Ox.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Nx.WhiteBoardQualitySample;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.maxRTT=e.string();break;case 15:r.minRTT=e.string();break;case 16:r.averageRTT=e.string();break;case 17:r.maxQueue=e.string();break;case 18:r.minQueue=e.string();break;case 19:r.averageQueue=e.string();break;case 20:r.maxInterval=e.string();break;case 21:r.minInterval=e.string();break;case 22:r.averageInterval=e.string();break;case 23:r.vid=e.int32();break;case 24:r.createdAt=e.string();break;case 25:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof Ox||(e=new Ox(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=R(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||Ax.isInteger(e.lts)||e.lts&&Ax.isInteger(e.lts.low)&&Ax.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!Ax.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!Ax.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!Ax.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ax.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!Ax.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!Ax.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!Ax.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!Ax.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!Ax.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ax.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!Ax.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!Ax.isString(e.session)?"session: string expected":null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&!Ax.isString(e.maxRTT)?"maxRTT: string expected":null!=e.minRTT&&e.hasOwnProperty("minRTT")&&!Ax.isString(e.minRTT)?"minRTT: string expected":null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&!Ax.isString(e.averageRTT)?"averageRTT: string expected":null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&!Ax.isString(e.maxQueue)?"maxQueue: string expected":null!=e.minQueue&&e.hasOwnProperty("minQueue")&&!Ax.isString(e.minQueue)?"minQueue: string expected":null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&!Ax.isString(e.averageQueue)?"averageQueue: string expected":null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&!Ax.isString(e.maxInterval)?"maxInterval: string expected":null!=e.minInterval&&e.hasOwnProperty("minInterval")&&!Ax.isString(e.minInterval)?"minInterval: string expected":null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&!Ax.isString(e.averageInterval)?"averageInterval: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!Ax.isInteger(e.vid)?"vid: integer expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!Ax.isString(e.createdAt)?"createdAt: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!Ax.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof Nx.WhiteBoardQualitySample)return e;var t=new Nx.WhiteBoardQualitySample;return null!=e.lts&&(Ax.Long?(t.lts=Ax.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==R(e.lts)&&(t.lts=new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.maxRTT&&(t.maxRTT=String(e.maxRTT)),null!=e.minRTT&&(t.minRTT=String(e.minRTT)),null!=e.averageRTT&&(t.averageRTT=String(e.averageRTT)),null!=e.maxQueue&&(t.maxQueue=String(e.maxQueue)),null!=e.minQueue&&(t.minQueue=String(e.minQueue)),null!=e.averageQueue&&(t.averageQueue=String(e.averageQueue)),null!=e.maxInterval&&(t.maxInterval=String(e.maxInterval)),null!=e.minInterval&&(t.minInterval=String(e.minInterval)),null!=e.averageInterval&&(t.averageInterval=String(e.averageInterval)),null!=e.vid&&(t.vid=0|e.vid),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ax.Long){var r=new Ax.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.maxRTT="",n.minRTT="",n.averageRTT="",n.maxQueue="",n.minQueue="",n.averageQueue="",n.maxInterval="",n.minInterval="",n.averageInterval="",n.vid=0,n.createdAt="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?Ax.Long.prototype.toString.call(e.lts):t.longs===Number?new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&(n.maxRTT=e.maxRTT),null!=e.minRTT&&e.hasOwnProperty("minRTT")&&(n.minRTT=e.minRTT),null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&(n.averageRTT=e.averageRTT),null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&(n.maxQueue=e.maxQueue),null!=e.minQueue&&e.hasOwnProperty("minQueue")&&(n.minQueue=e.minQueue),null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&(n.averageQueue=e.averageQueue),null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&(n.maxInterval=e.maxInterval),null!=e.minInterval&&e.hasOwnProperty("minInterval")&&(n.minInterval=e.minInterval),null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&(n.averageInterval=e.averageInterval),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Tx.util.toJSONOptions)},e}(),zx=Nx.WhiteBoardRealtime=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=Ax.Long?Ax.Long.fromBits(0,0,!1):0,e.prototype.akkoVersion="",e.prototype.app="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.os="",e.prototype.platform="",e.prototype.region="",e.prototype.sdkVersion="",e.prototype.session="",e.prototype.team="",e.prototype.userId="",e.prototype.uuid="",e.prototype.vid=0,e.prototype.nativeVersion="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ex.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(18).string(e.akkoVersion),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(34).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(42).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(50).string(e.message),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(58).string(e.os),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(66).string(e.platform),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(74).string(e.region),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(82).string(e.sdkVersion),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(90).string(e.session),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(98).string(e.team),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(106).string(e.userId),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(114).string(e.uuid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(130).string(e.nativeVersion),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(138).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ox||(e=Ox.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Nx.WhiteBoardRealtime;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.akkoVersion=e.string();break;case 3:r.app=e.string();break;case 4:r.createdAt=e.string();break;case 5:r.level=e.string();break;case 6:r.message=e.string();break;case 7:r.os=e.string();break;case 8:r.platform=e.string();break;case 9:r.region=e.string();break;case 10:r.sdkVersion=e.string();break;case 11:r.session=e.string();break;case 12:r.team=e.string();break;case 13:r.userId=e.string();break;case 14:r.uuid=e.string();break;case 15:r.vid=e.int32();break;case 16:r.nativeVersion=e.string();break;case 17:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof Ox||(e=new Ox(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=R(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||Ax.isInteger(e.lts)||e.lts&&Ax.isInteger(e.lts.low)&&Ax.isInteger(e.lts.high)?null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!Ax.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.app&&e.hasOwnProperty("app")&&!Ax.isString(e.app)?"app: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!Ax.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!Ax.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!Ax.isString(e.message)?"message: string expected":null!=e.os&&e.hasOwnProperty("os")&&!Ax.isString(e.os)?"os: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!Ax.isString(e.platform)?"platform: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ax.isString(e.region)?"region: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ax.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.session&&e.hasOwnProperty("session")&&!Ax.isString(e.session)?"session: string expected":null!=e.team&&e.hasOwnProperty("team")&&!Ax.isString(e.team)?"team: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!Ax.isString(e.userId)?"userId: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!Ax.isString(e.uuid)?"uuid: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!Ax.isInteger(e.vid)?"vid: integer expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!Ax.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!Ax.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof Nx.WhiteBoardRealtime)return e;var t=new Nx.WhiteBoardRealtime;return null!=e.lts&&(Ax.Long?(t.lts=Ax.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==R(e.lts)&&(t.lts=new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.app&&(t.app=String(e.app)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.os&&(t.os=String(e.os)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.region&&(t.region=String(e.region)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.session&&(t.session=String(e.session)),null!=e.team&&(t.team=String(e.team)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.vid&&(t.vid=0|e.vid),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ax.Long){var r=new Ax.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.akkoVersion="",n.app="",n.createdAt="",n.level="",n.message="",n.os="",n.platform="",n.region="",n.sdkVersion="",n.session="",n.team="",n.userId="",n.uuid="",n.vid=0,n.nativeVersion="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?Ax.Long.prototype.toString.call(e.lts):t.longs===Number?new Ax.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Tx.util.toJSONOptions)},e}();!function(e){e.Connected="connected",e.ConnectFailed="connectFailed",e.Sample="sample"}(Px||(Px={}));var Fx,Bx=Object.freeze({Realtime:Object.freeze({eventID:9115,proto:zx}),Player:Object.freeze({eventID:9118,proto:Rx})}),Ux=Object.freeze({QualityConnection:Object.freeze({eventID:9120,proto:Lx}),QualityDisconnection:Object.freeze({eventID:9121,proto:jx}),QualitySample:Object.freeze({eventID:9123,proto:Dx})});function Vx(e,t){var n,r=function(){var e=window.__nativeTags;if("object"==R(e)&&null!==e){var t=e.nativeVersion,n=e.platform;if("string"==typeof t&&"string"==typeof n)return{nativeVersion:t,platform:n}}return null}(),i={team:e,app:t,platform:(null==r?void 0:r.platform)||"browser",akkoVersion:Ge,sdkVersion:nk.sdkVersion,nativeVersion:null==r?void 0:r.nativeVersion,os:null===(n=window.navigator)||void 0===n?void 0:n.platform};for(var a in i)void 0===i[a]&&delete i[a];return i}!function(e){e.AlwaysReport="alwaysReport",e.BanReport="banReport",e.DependsOnRemote="dependsOnRemote"}(Fx||(Fx={}));var Wx,Hx,_x=function(){function e(t,n,r){M(this,e),this.teamUUID=t,this.appUUID=n,this.loggerHub=this.createLoggerHub(r)}return O(e,[{key:"createLoggerHub",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="[White]",r=t.reportDebugLogMode||Fx.AlwaysReport;switch(r){case Fx.BanReport:e=new Sc({prefix:n,levelMask:t.printLevelMask});break;case Fx.AlwaysReport:case Fx.DependsOnRemote:var i=nk.log.argusOptions,a=i.reportResourceURL,o=i.vid;e=new Mx({vid:o,reportResourceURL:a,prefix:n,reportLevelMask:t.reportLevelMask,printLevelMask:t.printLevelMask,timestampKey:"createdAt",events:Bx});break;default:throw new Error("unrecognized LoggerReportMode ".concat(JSON.stringify(r)))}return e}},{key:"createRealtimeLogger",value:function(e,t){var n=Object.freeze(s(s({},Vx(this.teamUUID,this.appUUID)),{},{uuid:e,region:t}));return Ic(this.loggerHub,"Realtime",n)}},{key:"createPlayerLogger",value:function(e){var t=Object.freeze(s(s({},Vx(this.teamUUID,this.appUUID)),{},{region:e}));return Ic(this.loggerHub,"Player",t)}}]),e}(),Gx=function(){function e(t,n){M(this,e);var r=nk.log.argusOptions,i=r.reportResourceURL,a=r.vid;this.loggerHub=new Mx({vid:a,reportResourceURL:i,timestampKey:"createdAt",events:Ux}),this.teamUUID=t,this.appUUID=n}return O(e,[{key:"createQualityConnectionCommitter",value:function(e,t){var n=Object.freeze(s(s({},Vx(this.teamUUID,this.appUUID)),{},{kind:Px.Connected,uuid:e,region:t}));return Tc(this.loggerHub,"QualityConnection",n)}},{key:"createQualityDisconnectionCommitter",value:function(e,t){var n=Object.freeze(s(s({},Vx(this.teamUUID,this.appUUID)),{},{kind:Px.ConnectFailed,uuid:e,region:t}));return Tc(this.loggerHub,"QualityDisconnection",n)}},{key:"createQualitySampleCommitter",value:function(e,t){var n=Object.freeze(s(s({},Vx(this.teamUUID,this.appUUID)),{},{kind:Px.Sample,uuid:e,region:t}));return Tc(this.loggerHub,"QualitySample",n)}}]),e}();function Yx(e){return e}(Hx=Wx||(Wx={})).Hand="cursor-hand",Hx.HandGrasp="cursor-hand-grasp",Hx.LaserPointer="cursor-laserPointer",Hx.Selector="cursor-selector",Hx.Pencil="cursor-pencil",Hx.Eraser="cursor-eraser",Hx.Rectangle="cursor-rectangle",Hx.Ellipse="cursor-ellipse",Hx.Shape="cursor-shape",Hx.Straight="cursor-straight",Hx.Arrow="cursor-arrow",Hx.Text="cursor-text",Hx.Nwse="cursor-nwse",Hx.Nesw="cursor-nesw",Hx.Ns="cursor-ns",Hx.Ew="cursor-ew";var Xx,Qx=Object.freeze((c(a={},Wx.Hand,Object.freeze(["url(".concat(HS["hand-loosen"],") 7 7, auto;"),"-webkit-image-set(url(".concat(HS["hand-loosen"],") 7 7, auto);")])),c(a,Wx.HandGrasp,Object.freeze(["url(".concat(HS["hand-grasp"],") 6 6, auto;"),"-webkit-image-set(url(".concat(HS["hand-grasp"],") 6 6, auto);")])),c(a,Wx.LaserPointer,Object.freeze(["url(".concat(HS["laser-pointer-cursor"],") 14 14, auto;"),"-webkit-image-set(url(".concat(HS["laser-pointer-cursor"],") 14 14, auto);")])),c(a,Wx.Selector,Object.freeze(["url(".concat(HS["selector-cursor"],") 5 4, auto;"),"-webkit-image-set(\n            url(".concat(HS["selector-cursor"],") 1x,\n            url(").concat(HS["selector-cursor@2x"],") 2x) 5 4, auto;")])),c(a,Wx.Pencil,Object.freeze(["url(".concat(HS["pencil-cursor"],") 2 22, auto;"),"-webkit-image-set(\n            url(".concat(HS["pencil-cursor"],") 1x,\n            url(").concat(HS["pencil-cursor@2x"],") 2x) 2 22, auto;")])),c(a,Wx.Eraser,Object.freeze(["url(".concat(HS["easer-cursor"],") 8 18, auto;"),"-webkit-image-set(\n            url(".concat(HS["easer-cursor"],") 1x,\n            url(").concat(HS["easer-cursor@2x"],") 2x) 8 18, auto;")])),c(a,Wx.Rectangle,Object.freeze(["crosshair;"])),c(a,Wx.Ellipse,Object.freeze(["crosshair;"])),c(a,Wx.Shape,Object.freeze(["crosshair;"])),c(a,Wx.Straight,Object.freeze(["crosshair;"])),c(a,Wx.Arrow,Object.freeze(["crosshair;"])),c(a,Wx.Text,Object.freeze(["text;"])),c(a,Wx.Nwse,Object.freeze(["nwse-resize;"])),c(a,Wx.Nesw,Object.freeze(["nesw-resize;"])),c(a,Wx.Ns,Object.freeze(["ns-resize;"])),c(a,Wx.Ew,Object.freeze(["ew-resize;"])),a)),Zx=new(function(){function e(){M(this,e),this.isInjected=!1}return O(e,[{key:"injectDefaultStyleIfNotInjectBefore",value:function(){this.isInjected||(this.injectToDom(Qx),this.isInjected=!0)}},{key:"injectCustomStyle",value:function(e){if(this.isInjected)throw new Error("cannot be called repeatedly, or after new WhiteWebSdk().");var t=s(s({},Qx),e);this.injectToDom(t),this.isInjected=!0}},{key:"injectToDom",value:function(e){if(Object.keys(e).length>0){var t=document.createElement("style"),n=[];for(var r in e){var i=e[r];if(i){var a=".netless-whiteboard.".concat(r," {\n                        ").concat(i.map((function(e){return"cursor: ".concat(e)})).join(""),"\n                    }");n.push(a)}}t.appendChild(document.createTextNode(n.join("")));var o=document.head;o&&o.appendChild(t)}}}]),e}());function Kx(e){Zx.injectCustomStyle(e)}!function(e){e.Desktop="desktop",e.Phone="phone",e.Pad="pad",e.TV="tv"}(Xx||(Xx={}));var qx=function(){function e(t){var n;M(this,e),this.version=nk.sdkVersion;var r=this.parseAppIdentifier(t.appIdentifier),i=r.teamUUID,a=r.appUUID;if(t.deviceType&&t.screenType)this.deviceType=t.deviceType,this.screenType=t.screenType;else if(t.deviceType&&!t.screenType)this.deviceType=t.deviceType,this.screenType=t.deviceType===Ah.Desktop?Xx.Desktop:Xx.Phone;else if(!t.deviceType&&t.screenType)this.deviceType=t.screenType===Xx.Desktop?Ah.Desktop:Ah.Touch,this.screenType=t.screenType;else switch(hk.default.deviceType){case"mouseOnly":this.deviceType=Ah.Desktop,this.screenType=Xx.Desktop;break;case"touchOnly":this.deviceType=Ah.Touch,this.screenType=Xx.Phone;break;case"hybrid":this.deviceType=Ah.Surface,this.screenType=Xx.Desktop}if(t.renderEngine===Aw.SVG||this.isCanvasRenderEngineAvailable()?t.renderEngine?this.renderEngine=t.renderEngine:this.renderEngine=Aw.Canvas:this.renderEngine=Aw.SVG,this.region=t.region||nk.defaultRegion,this.pptParams=t.pptParams,void 0!==(null===(n=t.loggerOptions)||void 0===n?void 0:n.disableReportLog))throw new Error("loggserOptions.disableReportLog is deprecated. please replace it with reportDebugLogMode or reportQualityMode");this.enableReportQuality(t.loggerOptions)&&(this.qualityLoggerFactory=new Gx(i,a)),this.whiteLoggerFactory=new _x(i,a,t.loggerOptions),this.akkoApp=new cc({appIdentifier:t.appIdentifier,observerAdapter:new mk,clientVersion:nk.sdkVersion,enableAnimationFrame:!0,jsxFactory:dk.createElement,escapeObjectFilter:dk.isValidElement,reconnectionOptions:t.reconnectionOptions,netStateAdapter:e.netState,convertIdToUrl:t.urlInterrupter||function(e){return e},configsInterrupter:Yx,shuntApiHosts:nk.shuntApiHosts,onAkkoSetupFailed:t.onWhiteSetupFailed}),this.preloadDynamicPPT=!!t.preloadDynamicPPT,this.fonts=Object.freeze(s({},t.fonts)),this.handToolKey=t.handToolKey,this.fontFamily=t.fontFamily,this.urlInterrupter=t.urlInterrupter||function(e){return e},this.boundless=new Hh(this.deviceType),this.plugins=this.assertPlugins(t.plugins),this.invisiblePlugins=this.assertInvisiblePlugins(t.invisiblePlugins),this.wrappedComponents=Object.freeze(t.wrappedComponents?C(t.wrappedComponents):[]),this.useMobXState=!!t.useMobXState,this.onlyCallbackRemoteStateModify=!!t.onlyCallbackRemoteStateModify,Zx.injectDefaultStyleIfNotInjectBefore()}var t,n,r;return O(e,[{key:"joinRoom",value:(r=I(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.region||this.region,a=n.uuid,o=this.whiteLoggerFactory.createRealtimeLogger(a,i),s=this.qualityLoggerFactory&&{connection:this.qualityLoggerFactory.createQualityConnectionCommitter(a,i),disconnection:this.qualityLoggerFactory.createQualityDisconnectionCommitter(a,i),sample:this.qualityLoggerFactory.createQualitySampleCommitter(a,i)},c=new DS({whiteLogger:o,qualityComitters:s,region:i,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!n.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(n.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,n.wrappedComponents),akkoApp:this.akkoApp,preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(n.cameraBound),userPayload:n.userPayload,disableDeviceInputs:!!n.disableDeviceInputs,disableCameraTransform:n.disableCameraTransform,disableEraseImage:!!n.disableEraseImage,disableOthersSelectingBox:!!n.disableOthersSelectingBox,useMultiViews:n.useMultiViews,onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,cursorAdapter:n.cursorAdapter,hotKeys:n.hotKeys,rejectWhenReadonlyErrorLevel:n.rejectWhenReadonlyErrorLevel,eraserRadiusCursor:new Fk(o),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,floatBarOptions:px(n.floatBar),callbacks:r}),t.next=3,c.connect({uuid:a,region:i,roomToken:n.roomToken,userPayload:n.userPayload,deviceType:this.deviceType,isWritable:e.defaultValue(n.isWritable,!0),enableDrawPoint:e.defaultValue(n.enableDrawPoint,!1),disableNewPencil:e.defaultValue(n.disableNewPencil,!0)});case 3:return t.abrupt("return",c);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"isPlayable",value:(n=I(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={region:t.region||this.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration},e.next=3,this.akkoApp.searchSlices(n);case 3:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"replayRoom",value:(t=I(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.mediaURL){e.next=2;break}throw new Error("mediaURL was deprecated. please to see https://github.com/netless-io/netless-combine-player");case 2:return r=t.region||this.region,i=this.whiteLoggerFactory.createPlayerLogger(r),a=new BS({logger:i,region:r,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,disableCameraTransform:t.disableCameraTransform,disableOthersSelectingBox:!!t.disableOthersSelectingBox,useMultiViews:t.useMultiViews,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:new Fk(i),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:n}),e.next=5,a.setupReconstructor({akkoApp:this.akkoApp,region:r,slice:t.slice,room:t.room,roomToken:t.roomToken,beginTimestamp:t.beginTimestamp,duration:t.duration});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"pptConverter",value:function(e){return new Yk(e)}},{key:"standardizeCameraBound",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s({maxContentMode:Kk(10),minContentMode:Kk(.1),width:1/0,height:1/0},e)}},{key:"enableReportQuality",value:function(e){return(null==e?void 0:e.reportQualityMode)!==Fx.BanReport}},{key:"isCanvasRenderEngineAvailable",value:function(){var e=document.createElement("canvas");if(void 0===e)return!1;var t=e.getContext("2d");if(null===t)return!1;for(var n=0,r=["setTransform","translate","scale","drawImage","getTransform","resetTransform","clearRect","fillStyle","lineWidth","strokeStyle","lineJoin","lineCap","beginPath","moveTo","quadraticCurveTo","bezierCurveTo","stroke","lineTo","arc","fill","ellipse","setLineDash","strokeRect","closePath"];n<r.length;n++){if(!(r[n]in t))return!1}return!0}},{key:"parseAppIdentifier",value:function(e){if(!/^[0-9a-zA-Z\-_]+\/[0-9a-zA-Z\-_]+$/.test(e))throw new Error("find invalid appIdentifier: ".concat(JSON.stringify(e)));var t=h(e.split("/"),2);return{teamUUID:t[0],appUUID:t[1]}}},{key:"assertPlugins",value:function(e){var t;return e&&(e instanceof bw?t=e:console.warn("plugins is not instance of Plugins. plugins will not be working. you should call createPlugins() to create it")),t||(t=new bw({})),t}},{key:"assertInvisiblePlugins",value:function(e){var t=[];if(e){var n,r=E(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.isValidInvisiblePluginClass(i)&&t.push(i)}}catch(e){r.e(e)}finally{r.f()}}return Object.freeze(t)}},{key:"isValidInvisiblePluginClass",value:function(e){if("string"!=typeof e.kind)return console.warn("invisible plugin class is invalid. expect `public static readonly kind: string = 'xxx';`"),!1;for(var t=e.prototype;null!==t;){if(t===ww.prototype)return!0;t=Object.getPrototypeOf(t)}return console.warn("invisible plugin class is not extends InvisiblePlugin"),!1}},{key:"mergeArray",value:function(e,t){var n=C(e);if(t){var r,i=E(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;-1===e.indexOf(a)&&n.push(a)}}catch(e){i.e(e)}finally{i.f()}}return n}}],[{key:"defaultValue",value:function(e,t){return void 0===e?t:e}}]),e}();function Jx(e){return e instanceof DS}function $x(e){return e instanceof BS}qx.netState=new gk,window.numeric=uk;var eI=nk.sdkVersion}).call(this,n("tjlA").Buffer,n("yLpj"),n("8oxB"))},zLF4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("aHma")),i=a(n("pMVe"));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v3",48,i.default);t.default=o,e.exports=t.default}}]);